!function (global, factory) {window.juicebox = factory()}(this,(function(){"use strict";function t(t){return function(t,e){const i=document.createElement(t);e&&(e.class&&i.classList.add(e.class),e.id&&(i.id=e.id),e.style&&function(t,e){for(let i of Object.keys(e))t.style[i]=e[i]}(i,e.style));return i}("div",t)}function e(t){const e=getComputedStyle(t);"none"!==e.display&&(t._initialDisplay=e.display),t.style.display="none"}function i(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function n(e,i){const n=t({class:"igv-ui-trackgear-popover-check-container"}),s=r("check",!0===i?"#444":"transparent");s.style.borderColor="gray",s.style.borderWidth="1px",s.style.borderStyle="solid",n.appendChild(s);let o=t();return o.textContent=e,n.appendChild(o),n}function r(t,e){e=e||"currentColor";let i=s[t];i||(console.error(`No icon named: ${t}`),i=s.question);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"viewBox","0 0 "+i[0]+" "+i[1]);const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"fill",e),r.setAttributeNS(null,"d",i[4]),n.appendChild(r),n}const s={check:[512,512,[],"f00c","M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"],cog:[512,512,[],"f013","M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"],exclamation:[192,512,[],"f12a","M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z"],"exclamation-circle":[512,512,[],"f06a","M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"exclamation-triangle":[576,512,[],"f071","M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],minus:[448,512,[],"f068","M424 318.2c13.3 0 24-10.7 24-24v-76.4c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h400z"],"minus-circle":[512,512,[],"f056","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"],"minus-square":[448,512,[],"f146","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"],plus:[448,512,[],"f067","M448 294.2v-76.4c0-13.3-10.7-24-24-24H286.2V56c0-13.3-10.7-24-24-24h-76.4c-13.3 0-24 10.7-24 24v137.8H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h137.8V456c0 13.3 10.7 24 24 24h76.4c13.3 0 24-10.7 24-24V318.2H424c13.3 0 24-10.7 24-24z"],"plus-circle":[512,512,[],"f055","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],"plus-square":[448,512,[],"f0fe","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],question:[384,512,[],"f128","M202.021 0C122.202 0 70.503 32.703 29.914 91.026c-7.363 10.58-5.093 25.086 5.178 32.874l43.138 32.709c10.373 7.865 25.132 6.026 33.253-4.148 25.049-31.381 43.63-49.449 82.757-49.449 30.764 0 68.816 19.799 68.816 49.631 0 22.552-18.617 34.134-48.993 51.164-35.423 19.86-82.299 44.576-82.299 106.405V320c0 13.255 10.745 24 24 24h72.471c13.255 0 24-10.745 24-24v-5.773c0-42.86 125.268-44.645 125.268-160.627C377.504 66.256 286.902 0 202.021 0zM192 373.459c-38.196 0-69.271 31.075-69.271 69.271 0 38.195 31.075 69.27 69.271 69.27s69.271-31.075 69.271-69.271-31.075-69.27-69.271-69.27z"],save:[448,512,[],"f0c7","M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"],share:[512,512,[],"f064","M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"],spinner:[512,512,[],"f110","M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"],square:[448,512,[],"f0c8","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"],"square-full":[512,512,[],"f45c","M512 512H0V0h512v512z"],times:[384,512,[],"f00d","M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z"],"times-circle":[512,512,[],"f057","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"],wrench:[512,512,[],"f0ad","M481.156 200c9.3 0 15.12 10.155 10.325 18.124C466.295 259.992 420.419 288 368 288c-79.222 0-143.501-63.974-143.997-143.079C223.505 65.469 288.548-.001 368.002 0c52.362.001 98.196 27.949 123.4 69.743C496.24 77.766 490.523 88 481.154 88H376l-40 56 40 56h105.156zm-171.649 93.003L109.255 493.255c-24.994 24.993-65.515 24.994-90.51 0-24.993-24.994-24.993-65.516 0-90.51L218.991 202.5c16.16 41.197 49.303 74.335 90.516 90.503zM104 432c0-13.255-10.745-24-24-24s-24 10.745-24 24 10.745 24 24 24 24-10.745 24-24z"]};function o(t,e){var i=document.createElement("div");t.appendChild(i),i.appendChild(function(t,e){return r(t,e)}("times")),i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e()}))}var a={Huffman:{},Util:{},CRC32:{},CompressionMethod:{DEFLATE:8,RESERVED:15},Zip:function(t){t=t||{},this.files=[],this.comment=t.comment,this.password}};a.Zip.CompressionMethod={STORE:0,DEFLATE:8},a.Zip.OperatingSystem={MSDOS:0,UNIX:3,MACINTOSH:7},a.Zip.Flags={ENCRYPT:1,DESCRIPTOR:8,UTF8:2048},a.Zip.FileHeaderSignature=[80,75,1,2],a.Zip.LocalFileHeaderSignature=[80,75,3,4],a.Zip.CentralDirectorySignature=[80,75,5,6],a.Zip.prototype.addFile=function(t,e){var i;(e=e||{}).filename;var n=t.length,r=0;if(t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof e.compressionMethod&&(e.compressionMethod=a.Zip.CompressionMethod.DEFLATE),e.compress)switch(e.compressionMethod){case a.Zip.CompressionMethod.STORE:break;case a.Zip.CompressionMethod.DEFLATE:r=a.CRC32.calc(t),t=this.deflateWithOption(t,e),i=!0;break;default:throw new Error("unknown compression method:"+e.compressionMethod)}this.files.push({buffer:t,option:e,compressed:i,encrypted:!1,size:n,crc32:r})},a.Zip.prototype.setPassword=function(t){this.password=t},a.Zip.prototype.compress=function(){var t,e,i,n,r,s,o,h,l,c,u,f,d,p,g,m,w,b,y,v,x,C,S,k,T,R,I=this.files,D=0,M=0;for(S=0,k=I.length;S<k;++S){if(p=(t=I[S]).option.filename?t.option.filename.length:0,g=t.option.extraField?t.option.extraField.length:0,m=t.option.comment?t.option.comment.length:0,!t.compressed)switch(t.crc32=a.CRC32.calc(t.buffer),t.option.compressionMethod){case a.Zip.CompressionMethod.STORE:break;case a.Zip.CompressionMethod.DEFLATE:t.buffer=this.deflateWithOption(t.buffer,t.option),t.compressed=!0;break;default:throw new Error("unknown compression method:"+t.option.compressionMethod)}if(void 0!==t.option.password||void 0!==this.password){for(C=this.createEncryptionKey(t.option.password||this.password),v=t.buffer,(x=new Uint8Array(v.length+12)).set(v,12),v=x,T=0;T<12;++T)v[T]=this.encode(C,11===S?255&t.crc32:256*Math.random()|0);for(R=v.length;T<R;++T)v[T]=this.encode(C,v[T]);t.buffer=v}D+=30+p+t.buffer.length,M+=46+p+m}for(s=22+(this.comment?this.comment.length:0),e=new Uint8Array(D+M+s),i=0,r=(n=D)+M,S=0,k=I.length;S<k;++S)p=(t=I[S]).option.filename?t.option.filename.length:0,g=0,m=t.option.comment?t.option.comment.length:0,o=i,e[i++]=a.Zip.LocalFileHeaderSignature[0],e[i++]=a.Zip.LocalFileHeaderSignature[1],e[i++]=a.Zip.LocalFileHeaderSignature[2],e[i++]=a.Zip.LocalFileHeaderSignature[3],e[n++]=a.Zip.FileHeaderSignature[0],e[n++]=a.Zip.FileHeaderSignature[1],e[n++]=a.Zip.FileHeaderSignature[2],e[n++]=a.Zip.FileHeaderSignature[3],20,e[n++]=20,e[n++]=t.option.os||a.Zip.OperatingSystem.MSDOS,e[i++]=e[n++]=20,e[i++]=e[n++]=0,h=0,(t.option.password||this.password)&&(h|=a.Zip.Flags.ENCRYPT),e[i++]=e[n++]=255&h,e[i++]=e[n++]=h>>8&255,l=t.option.compressionMethod,e[i++]=e[n++]=255&l,e[i++]=e[n++]=l>>8&255,c=t.option.date||new Date,e[i++]=e[n++]=(7&c.getMinutes())<<5|c.getSeconds()/2|0,e[i++]=e[n++]=c.getHours()<<3|c.getMinutes()>>3,e[i++]=e[n++]=(c.getMonth()+1&7)<<5|c.getDate(),e[i++]=e[n++]=(c.getFullYear()-1980&127)<<1|c.getMonth()+1>>3,u=t.crc32,e[i++]=e[n++]=255&u,e[i++]=e[n++]=u>>8&255,e[i++]=e[n++]=u>>16&255,e[i++]=e[n++]=u>>24&255,f=t.buffer.length,e[i++]=e[n++]=255&f,e[i++]=e[n++]=f>>8&255,e[i++]=e[n++]=f>>16&255,e[i++]=e[n++]=f>>24&255,d=t.size,e[i++]=e[n++]=255&d,e[i++]=e[n++]=d>>8&255,e[i++]=e[n++]=d>>16&255,e[i++]=e[n++]=d>>24&255,e[i++]=e[n++]=255&p,e[i++]=e[n++]=p>>8&255,e[i++]=e[n++]=255&g,e[i++]=e[n++]=g>>8&255,e[n++]=255&m,e[n++]=m>>8&255,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=255&o,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,(w=t.option.filename)&&(e.set(w,i),e.set(w,n),i+=p,n+=p),(b=t.option.extraField)&&(e.set(b,i),e.set(b,n),i+=g,n+=g),(y=t.option.comment)&&(e.set(y,n),n+=m),e.set(t.buffer,i),i+=t.buffer.length;return e[r++]=a.Zip.CentralDirectorySignature[0],e[r++]=a.Zip.CentralDirectorySignature[1],e[r++]=a.Zip.CentralDirectorySignature[2],e[r++]=a.Zip.CentralDirectorySignature[3],e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=255&k,e[r++]=k>>8&255,e[r++]=255&k,e[r++]=k>>8&255,e[r++]=255&M,e[r++]=M>>8&255,e[r++]=M>>16&255,e[r++]=M>>24&255,e[r++]=255&D,e[r++]=D>>8&255,e[r++]=D>>16&255,e[r++]=D>>24&255,m=this.comment?this.comment.length:0,e[r++]=255&m,e[r++]=m>>8&255,this.comment&&(e.set(this.comment,r),r+=m),e},a.Zip.prototype.deflateWithOption=function(t,e){return new a.RawDeflate(t,e.deflateOption).compress()},a.Zip.prototype.getByte=function(t){var e=65535&t[2]|2;return e*(1^e)>>8&255},a.Zip.prototype.encode=function(t,e){var i=this.getByte(t);return this.updateKeys(t,e),i^e},a.Zip.prototype.updateKeys=function(t,e){t[0]=a.CRC32.single(t[0],e),t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=a.CRC32.single(t[2],t[1]>>>24)},a.Zip.prototype.createEncryptionKey=function(t){var e,i,n=[305419896,591751049,878082192];for(n=new Uint32Array(n),e=0,i=t.length;e<i;++e)this.updateKeys(n,255&t[e]);return n},a.Huffman.buildHuffmanTable=function(t){var e,i,n,r,s,o,a,h,l,c,u,f=t.length,d=0,p=Number.POSITIVE_INFINITY;for(h=0,l=f;h<l;++h)t[h]>d&&(d=t[h]),t[h]<p&&(p=t[h]);for(e=1<<d,i=new Uint32Array(e),n=1,r=0,s=2;n<=d;){for(h=0;h<f;++h)if(t[h]===n){for(o=0,a=r,c=0;c<n;++c)o=o<<1|1&a,a>>=1;for(u=n<<16|h,c=o;c<e;c+=s)i[c]=u;++r}++n,r<<=1,s<<=1}return[i,d,p]};var h=a.Huffman.buildHuffmanTable;a.RawInflate=function(t,e){switch(this.buffer,this.blocks=[],this.bufferSize=32768,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output,this.op,this.bfinal=!1,this.bufferType=a.RawInflate.BufferType.ADAPTIVE,this.resize=!1,!e&&(e={})||(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case a.RawInflate.BufferType.BLOCK:this.op=a.RawInflate.MaxBackwardLength,this.output=new Uint8Array(a.RawInflate.MaxBackwardLength+this.bufferSize+a.RawInflate.MaxCopyLength);break;case a.RawInflate.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize);break;default:throw new Error("invalid inflate mode")}},a.RawInflate.BufferType={BLOCK:0,ADAPTIVE:1},a.RawInflate.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case a.RawInflate.BufferType.BLOCK:return this.concatBufferBlock();case a.RawInflate.BufferType.ADAPTIVE:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}},a.RawInflate.MaxBackwardLength=32768,a.RawInflate.MaxCopyLength=258,a.RawInflate.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a.RawInflate.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),a.RawInflate.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),a.RawInflate.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),a.RawInflate.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a.RawInflate.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return h(i)}(),a.RawInflate.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return h(i)}(),a.RawInflate.prototype.parseBlock=function(){var t=this.readBits(3);switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+t)}},a.RawInflate.prototype.readBits=function(t){var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;if(s+(t-n+7>>3)>=r.length)throw new Error("input buffer is broken");for(;n<t;)i|=r[s++]<<n,n+=8;return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},a.RawInflate.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=s.length,h=t[0],l=t[1];r<l&&!(o>=a);)n|=s[o++]<<r,r+=8;if((i=(e=h[n&(1<<l)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},a.RawInflate.prototype.parseUncompressedBlock=function(){var t,e,i=this.input,n=this.ip,r=this.output,s=this.op,o=i.length,h=r.length;if(this.bitsbuf=0,this.bitsbuflen=0,n+1>=o)throw new Error("invalid uncompressed block header: LEN");if(t=i[n++]|i[n++]<<8,n+1>=o)throw new Error("invalid uncompressed block header: NLEN");if(t===~(i[n++]|i[n++]<<8))throw new Error("invalid uncompressed block header: length verify");if(n+t>i.length)throw new Error("input buffer is broken");switch(this.bufferType){case a.RawInflate.BufferType.BLOCK:for(;s+t>r.length;)t-=e=h-s,r.set(i.subarray(n,n+e),s),s+=e,n+=e,this.op=s,r=this.expandBufferBlock(),s=this.op;break;case a.RawInflate.BufferType.ADAPTIVE:for(;s+t>r.length;)r=this.expandBufferAdaptive({fixRatio:2});break;default:throw new Error("invalid inflate mode")}r.set(i.subarray(n,n+t),s),s+=t,n+=t,this.ip=n,this.op=s,this.output=r},a.RawInflate.prototype.parseFixedHuffmanBlock=function(){switch(this.bufferType){case a.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(a.RawInflate.FixedLiteralLengthTable,a.RawInflate.FixedDistanceTable);break;case a.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(a.RawInflate.FixedLiteralLengthTable,a.RawInflate.FixedDistanceTable);break;default:throw new Error("invalid inflate mode")}},a.RawInflate.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r,s,o,l,c,u=this.readBits(5)+257,f=this.readBits(5)+1,d=this.readBits(4)+4,p=new Uint8Array(a.RawInflate.Order.length);for(l=0;l<d;++l)p[a.RawInflate.Order[l]]=this.readBits(3);for(t=h(p),n=new Uint8Array(u+f),l=0,c=u+f;l<c;)switch(r=this.readCodeByTable(t)){case 16:for(o=3+this.readBits(2);o--;)n[l++]=s;break;case 17:for(o=3+this.readBits(3);o--;)n[l++]=0;s=0;break;case 18:for(o=11+this.readBits(7);o--;)n[l++]=0;s=0;break;default:n[l++]=r,s=r}switch(e=h(n.subarray(0,u)),i=h(n.subarray(u)),this.bufferType){case a.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(e,i);break;case a.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(e,i);break;default:throw new Error("invalid inflate mode")}},a.RawInflate.prototype.decodeHuffmanBlock=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,h,l=i.length-a.RawInflate.MaxCopyLength,c=a.RawInflate.LengthCodeTable,u=a.RawInflate.LengthExtraTable,f=a.RawInflate.DistCodeTable,d=a.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=l&&(this.op=n,i=this.expandBufferBlock(),n=this.op),i[n++]=r;else for(h=c[s=r-257],u[s]>0&&(h+=this.readBits(u[s])),o=f[r=this.readCodeByTable(e)],d[r]>0&&(o+=this.readBits(d[r])),n>=l&&(this.op=n,i=this.expandBufferBlock(),n=this.op);h--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},a.RawInflate.prototype.decodeHuffmanAdaptive=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,h,l=i.length,c=a.RawInflate.LengthCodeTable,u=a.RawInflate.LengthExtraTable,f=a.RawInflate.DistCodeTable,d=a.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=l&&(l=(i=this.expandBufferAdaptive()).length),i[n++]=r;else for(h=c[s=r-257],u[s]>0&&(h+=this.readBits(u[s])),o=f[r=this.readCodeByTable(e)],d[r]>0&&(o+=this.readBits(d[r])),n+h>l&&(l=(i=this.expandBufferAdaptive()).length);h--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},a.RawInflate.prototype.expandBufferBlock=function(t){var e=new Uint8Array(this.op-a.RawInflate.MaxBackwardLength),i=this.op-a.RawInflate.MaxBackwardLength,n=this.output;return e.set(n.subarray(a.RawInflate.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,n.set(n.subarray(i,i+a.RawInflate.MaxBackwardLength)),this.op=a.RawInflate.MaxBackwardLength,n},a.RawInflate.prototype.expandBufferAdaptive=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.currentLitlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},a.RawInflate.prototype.concatBufferBlock=function(){var t,e,i,n,r,s=0,o=this.totalpos+(this.op-a.RawInflate.MaxBackwardLength),h=this.output,l=this.blocks,c=new Uint8Array(o);if(0===l.length)return this.output.subarray(a.RawInflate.MaxBackwardLength,this.op);for(e=0,i=l.length;e<i;++e)for(n=0,r=(t=l[e]).length;n<r;++n)c[s++]=t[n];for(e=a.RawInflate.MaxBackwardLength,i=this.op;e<i;++e)c[s++]=h[e];return this.blocks=[],this.buffer=c,this.buffer},a.RawInflate.prototype.concatBufferDynamic=function(){var t,e=this.op;return this.resize?(t=new Uint8Array(e)).set(this.output.subarray(0,e)):t=this.output.subarray(0,e),this.buffer=t,this.buffer};var l;h=a.Huffman.buildHuffmanTable;function c(t){return"string"==typeof t||t instanceof String}function u(t){var e=String(t).split(/[.,]/);return e[0].split("").reverse().reduce((function(t,e,i){return i%3==0?t+","+e:t+e})).split("").reverse().join("")+(e[1]?"."+e[1]:"")}a.RawInflateStream=function(t,e,i){this.blocks=[],this.bufferSize=i||65e3,this.totalpos=0,this.ip=void 0===e?0:e,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output=new Uint8Array(this.bufferSize),this.op=0,this.bfinal=!1,this.blockLength,this.resize=!1,this.litlenTable,this.distTable,this.sp=0,this.status=a.RawInflateStream.Status.INITIALIZED,this.ip_,this.bitsbuflen_,this.bitsbuf_},a.RawInflateStream.BlockType={UNCOMPRESSED:0,FIXED:1,DYNAMIC:2},a.RawInflateStream.Status={INITIALIZED:0,BLOCK_HEADER_START:1,BLOCK_HEADER_END:2,BLOCK_BODY_START:3,BLOCK_BODY_END:4,DECODE_BLOCK_START:5,DECODE_BLOCK_END:6},a.RawInflateStream.prototype.decompress=function(t,e){var i=!1;for(void 0!==t&&(this.input=t),void 0!==e&&(this.ip=e);!i;)switch(this.status){case a.RawInflateStream.Status.INITIALIZED:case a.RawInflateStream.Status.BLOCK_HEADER_START:this.readBlockHeader()<0&&(i=!0);break;case a.RawInflateStream.Status.BLOCK_HEADER_END:case a.RawInflateStream.Status.BLOCK_BODY_START:switch(this.currentBlockType){case a.RawInflateStream.BlockType.UNCOMPRESSED:this.readUncompressedBlockHeader()<0&&(i=!0);break;case a.RawInflateStream.BlockType.FIXED:this.parseFixedHuffmanBlock()<0&&(i=!0);break;case a.RawInflateStream.BlockType.DYNAMIC:this.parseDynamicHuffmanBlock()<0&&(i=!0)}break;case a.RawInflateStream.Status.BLOCK_BODY_END:case a.RawInflateStream.Status.DECODE_BLOCK_START:switch(this.currentBlockType){case a.RawInflateStream.BlockType.UNCOMPRESSED:this.parseUncompressedBlock()<0&&(i=!0);break;case a.RawInflateStream.BlockType.FIXED:case a.RawInflateStream.BlockType.DYNAMIC:this.decodeHuffman()<0&&(i=!0)}break;case a.RawInflateStream.Status.DECODE_BLOCK_END:this.bfinal?i=!0:this.status=a.RawInflateStream.Status.INITIALIZED}return this.concatBuffer()},a.RawInflateStream.MaxBackwardLength=32768,a.RawInflateStream.MaxCopyLength=258,a.RawInflateStream.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a.RawInflateStream.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),a.RawInflateStream.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),a.RawInflateStream.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),a.RawInflateStream.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a.RawInflateStream.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return h(i)}(),a.RawInflateStream.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return h(i)}(),a.RawInflateStream.prototype.readBlockHeader=function(){var t;if(this.status=a.RawInflateStream.Status.BLOCK_HEADER_START,this.save_(),(t=this.readBits(3))<0)return this.restore_(),-1;switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.currentBlockType=a.RawInflateStream.BlockType.UNCOMPRESSED;break;case 1:this.currentBlockType=a.RawInflateStream.BlockType.FIXED;break;case 2:this.currentBlockType=a.RawInflateStream.BlockType.DYNAMIC;break;default:throw new Error("unknown BTYPE: "+t)}this.status=a.RawInflateStream.Status.BLOCK_HEADER_END},a.RawInflateStream.prototype.readBits=function(t){for(var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;n<t;){if(r.length<=s)return-1;i|=(e=r[s++])<<n,n+=8}return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},a.RawInflateStream.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=t[0],h=t[1];r<h;){if(s.length<=o)return-1;n|=s[o++]<<r,r+=8}if((i=(e=a[n&(1<<h)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},a.RawInflateStream.prototype.readUncompressedBlockHeader=function(){var t,e=this.input,i=this.ip;if(this.status=a.RawInflateStream.Status.BLOCK_BODY_START,i+4>=e.length)return-1;if((t=e[i++]|e[i++]<<8)===~(e[i++]|e[i++]<<8))throw new Error("invalid uncompressed block header: length verify");this.bitsbuf=0,this.bitsbuflen=0,this.ip=i,this.blockLength=t,this.status=a.RawInflateStream.Status.BLOCK_BODY_END},a.RawInflateStream.prototype.parseUncompressedBlock=function(){var t=this.input,e=this.ip,i=this.output,n=this.op,r=this.blockLength;for(this.status=a.RawInflateStream.Status.DECODE_BLOCK_START;r--;){if(n===i.length&&(i=this.expandBuffer({fixRatio:2})),e>=t.length)return this.ip=e,this.op=n,this.blockLength=r+1,-1;i[n++]=t[e++]}return r<0&&(this.status=a.RawInflateStream.Status.DECODE_BLOCK_END),this.ip=e,this.op=n,0},a.RawInflateStream.prototype.parseFixedHuffmanBlock=function(){return this.status=a.RawInflateStream.Status.BLOCK_BODY_START,this.litlenTable=a.RawInflateStream.FixedLiteralLengthTable,this.distTable=a.RawInflateStream.FixedDistanceTable,this.status=a.RawInflateStream.Status.BLOCK_BODY_END,0},a.RawInflateStream.prototype.save_=function(){this.ip_=this.ip,this.bitsbuflen_=this.bitsbuflen,this.bitsbuf_=this.bitsbuf},a.RawInflateStream.prototype.restore_=function(){this.ip=this.ip_,this.bitsbuflen=this.bitsbuflen_,this.bitsbuf=this.bitsbuf_},a.RawInflateStream.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r=new Uint8Array(a.RawInflateStream.Order.length);if(this.status=a.RawInflateStream.Status.BLOCK_BODY_START,this.save_(),t=this.readBits(5)+257,e=this.readBits(5)+1,i=this.readBits(4)+4,t<0||e<0||i<0)return this.restore_(),-1;try{(function(){var s,o,l,c,u,f,d=0;for(u=0;u<i;++u){if((s=this.readBits(3))<0)throw new Error("not enough input");r[a.RawInflateStream.Order[u]]=s}for(n=h(r),c=new Uint8Array(t+e),u=0,f=t+e;u<f;){if((o=this.readCodeByTable(n))<0)throw new Error("not enough input");switch(o){case 16:if((s=this.readBits(2))<0)throw new Error("not enough input");for(l=3+s;l--;)c[u++]=d;break;case 17:if((s=this.readBits(3))<0)throw new Error("not enough input");for(l=3+s;l--;)c[u++]=0;d=0;break;case 18:if((s=this.readBits(7))<0)throw new Error("not enough input");for(l=11+s;l--;)c[u++]=0;d=0;break;default:c[u++]=o,d=o}}this.litlenTable=h(c.subarray(0,t)),this.distTable=h(c.subarray(t))}).call(this)}catch(t){return this.restore_(),-1}return this.status=a.RawInflateStream.Status.BLOCK_BODY_END,0},a.RawInflateStream.prototype.decodeHuffman=function(){var t,e,i,n,r,s=this.output,o=this.op,h=this.litlenTable,l=this.distTable,c=s.length;for(this.status=a.RawInflateStream.Status.DECODE_BLOCK_START;;){if(this.save_(),(t=this.readCodeByTable(h))<0)return this.op=o,this.restore_(),-1;if(256===t)break;if(t<256)o===c&&(c=(s=this.expandBuffer()).length),s[o++]=t;else{if(e=t-257,n=a.RawInflateStream.LengthCodeTable[e],a.RawInflateStream.LengthExtraTable[e]>0){if((r=this.readBits(a.RawInflateStream.LengthExtraTable[e]))<0)return this.op=o,this.restore_(),-1;n+=r}if((t=this.readCodeByTable(l))<0)return this.op=o,this.restore_(),-1;if(i=a.RawInflateStream.DistCodeTable[t],a.RawInflateStream.DistExtraTable[t]>0){if((r=this.readBits(a.RawInflateStream.DistExtraTable[t]))<0)return this.op=o,this.restore_(),-1;i+=r}for(o+n>=c&&(c=(s=this.expandBuffer()).length);n--;)s[o]=s[o++-i];if(this.ip===this.input.length)return this.op=o,-1}}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=o,this.status=a.RawInflateStream.Status.DECODE_BLOCK_END},a.RawInflateStream.prototype.expandBuffer=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.litlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},a.RawInflateStream.prototype.concatBuffer=function(){var t,e,i=this.op;return t=this.resize?new Uint8Array(this.output.subarray(this.sp,i)):this.output.subarray(this.sp,i),this.sp=i,i>a.RawInflateStream.MaxBackwardLength+this.bufferSize&&(this.op=this.sp=a.RawInflateStream.MaxBackwardLength,e=this.output,this.output=new Uint8Array(this.bufferSize+a.RawInflateStream.MaxBackwardLength),this.output.set(e.subarray(i-a.RawInflateStream.MaxBackwardLength,i))),t},a.Inflate=function(t,e){var i,n;if(this.input=t,this.ip=0,this.rawinflate,this.verify,!e&&(e={})||(e.index&&(this.ip=e.index),e.verify&&(this.verify=e.verify)),i=t[this.ip++],n=t[this.ip++],(15&i)!==a.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=a.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.rawinflate=new a.RawInflate(t,{index:this.ip,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})},a.Inflate.BufferType=a.RawInflate.BufferType,a.Inflate.prototype.decompress=function(){var t,e=this.input;if(t=this.rawinflate.decompress(),this.ip=this.rawinflate.ip,this.verify&&(e[this.ip++]<<24|e[this.ip++]<<16|e[this.ip++]<<8|e[this.ip++])>>>0!==a.Adler32(t))throw new Error("invalid adler-32 checksum");return t},a.InflateStream=function(t){this.input=void 0===t?new Uint8Array:t,this.ip=0,this.rawinflate=new a.RawInflateStream(this.input,this.ip),this.method,this.output=this.rawinflate.output},a.InflateStream.prototype.decompress=function(t){var e;if(void 0!==t){var i=new Uint8Array(this.input.length+t.length);i.set(this.input,0),i.set(t,this.input.length),this.input=i}return void 0===this.method&&this.readHeader()<0?new Uint8Array:(e=this.rawinflate.decompress(this.input,this.ip),0!==this.rawinflate.ip&&(this.input=this.input.subarray(this.rawinflate.ip),this.ip=0),e)},a.InflateStream.prototype.readHeader=function(){var t=this.ip,e=this.input,i=e[t++],n=e[t++];if(void 0===i||void 0===n)return-1;if((15&i)!==a.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=a.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.ip=t},a.Gunzip=function(t,e){this.input=t,this.ip=0,this.member=[],this.decompressed=!1},a.Gunzip.prototype.getMembers=function(){return this.decompressed||this.decompress(),this.member.slice()},a.Gunzip.prototype.decompress=function(){for(var t=this.input.length;this.ip<t;)this.decodeMember();return this.decompressed=!0,this.concatMember()},a.Gunzip.prototype.decodeMember=function(){var t,e,i,n,r,s,o,h,l,c=new a.GunzipMember,u=this.input,f=this.ip;if(c.id1=u[f++],c.id2=u[f++],31!==c.id1||139!==c.id2)throw new Error("invalid file signature:"+c.id1+","+c.id2);if(c.cm=u[f++],8!==c.cm)throw new Error("unknown compression method: "+c.cm);if(c.flg=u[f++],h=u[f++]|u[f++]<<8|u[f++]<<16|u[f++]<<24,c.mtime=new Date(1e3*h),c.xfl=u[f++],c.os=u[f++],(c.flg&a.Gzip.FlagsMask.FEXTRA)>0&&(c.xlen=u[f++]|u[f++]<<8,f=this.decodeSubField(f,c.xlen)),(c.flg&a.Gzip.FlagsMask.FNAME)>0){for(o=[],s=0;(r=u[f++])>0;)o[s++]=String.fromCharCode(r);c.name=o.join("")}if((c.flg&a.Gzip.FlagsMask.FCOMMENT)>0){for(o=[],s=0;(r=u[f++])>0;)o[s++]=String.fromCharCode(r);c.comment=o.join("")}if((c.flg&a.Gzip.FlagsMask.FHCRC)>0&&(c.crc16=65535&a.CRC32.calc(u,0,f),c.crc16!==(u[f++]|u[f++]<<8)))throw new Error("invalid header crc16");if(t=u[u.length-4]|u[u.length-3]<<8|u[u.length-2]<<16|u[u.length-1]<<24,u.length-f-4-4<512*t&&(n=t),e=new a.RawInflate(u,{index:f,bufferSize:n}),c.data=i=e.decompress(),f=e.ip,c.crc32=l=(u[f++]|u[f++]<<8|u[f++]<<16|u[f++]<<24)>>>0,a.CRC32.calc(i)!==l)throw new Error("invalid CRC-32 checksum: 0x"+a.CRC32.calc(i).toString(16)+" / 0x"+l.toString(16));if(c.isize=t=(u[f++]|u[f++]<<8|u[f++]<<16|u[f++]<<24)>>>0,(4294967295&i.length)!==t)throw new Error("invalid input size: "+(4294967295&i.length)+" / "+t);this.member.push(c),this.ip=f},a.Gunzip.prototype.decodeSubField=function(t,e){return t+e},a.Gunzip.prototype.concatMember=function(){var t,e,i,n=this.member,r=0,s=0;for(t=0,e=n.length;t<e;++t)s+=n[t].data.length;for(i=new Uint8Array(s),t=0;t<e;++t)i.set(n[t].data,r),r+=n[t].data.length;return i},a.GunzipMember=function(){this.id1,this.id2,this.cm,this.flg,this.mtime,this.xfl,this.os,this.crc16,this.xlen,this.crc32,this.isize,this.name,this.comment,this.data},a.GunzipMember.prototype.getName=function(){return this.name},a.GunzipMember.prototype.getData=function(){return this.data},a.GunzipMember.prototype.getMtime=function(){return this.mtime},a.Gzip=function(t,e){this.input=t,this.ip=0,this.output,this.op=0,this.flags={},this.filename,this.comment,this.deflateOptions,e&&(e.flags&&(this.flags=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.comment=e.comment),e.deflateOptions&&(this.deflateOptions=e.deflateOptions)),this.deflateOptions||(this.deflateOptions={})},a.Gzip.DefaultBufferSize=32768,a.Gzip.prototype.compress=function(){var t,e,i,n,r,s,o,h,l=new Uint8Array(a.Gzip.DefaultBufferSize),c=0,u=this.input,f=this.ip,d=this.filename,p=this.comment;if(l[c++]=31,l[c++]=139,l[c++]=8,t=0,this.flags.fname&&(t|=a.Gzip.FlagsMask.FNAME),this.flags.fcomment&&(t|=a.Gzip.FlagsMask.FCOMMENT),this.flags.fhcrc&&(t|=a.Gzip.FlagsMask.FHCRC),l[c++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,l[c++]=255&e,l[c++]=e>>>8&255,l[c++]=e>>>16&255,l[c++]=e>>>24&255,l[c++]=0,l[c++]=a.Gzip.OperatingSystem.UNKNOWN,void 0!==this.flags.fname){for(o=0,h=d.length;o<h;++o)(s=d.charCodeAt(o))>255&&(l[c++]=s>>>8&255),l[c++]=255&s;l[c++]=0}if(this.flags.comment){for(o=0,h=p.length;o<h;++o)(s=p.charCodeAt(o))>255&&(l[c++]=s>>>8&255),l[c++]=255&s;l[c++]=0}return this.flags.fhcrc&&(i=65535&a.CRC32.calc(l,0,c),l[c++]=255&i,l[c++]=i>>>8&255),this.deflateOptions.outputBuffer=l,this.deflateOptions.outputIndex=c,l=(r=new a.RawDeflate(u,this.deflateOptions)).compress(),(c=r.op)+8>l.buffer.byteLength?(this.output=new Uint8Array(c+8),this.output.set(new Uint8Array(l.buffer)),l=this.output):l=new Uint8Array(l.buffer),n=a.CRC32.calc(u),l[c++]=255&n,l[c++]=n>>>8&255,l[c++]=n>>>16&255,l[c++]=n>>>24&255,h=u.length,l[c++]=255&h,l[c++]=h>>>8&255,l[c++]=h>>>16&255,l[c++]=h>>>24&255,this.ip=f,c<l.length&&(this.output=l=l.subarray(0,c)),l},a.Gzip.OperatingSystem={FAT:0,AMIGA:1,VMS:2,UNIX:3,VM_CMS:4,ATARI_TOS:5,HPFS:6,MACINTOSH:7,Z_SYSTEM:8,CP_M:9,TOPS_20:10,NTFS:11,QDOS:12,ACORN_RISCOS:13,UNKNOWN:255},a.Gzip.FlagsMask={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},a.Heap=function(t){this.buffer=new Uint16Array(2*t),this.length=0},a.Heap.prototype.getParent=function(t){return 2*((t-2)/4|0)},a.Heap.prototype.getChild=function(t){return 2*t+2},a.Heap.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;i>0&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},a.Heap.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;!((n=this.getChild(r))>=this.length)&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}},a.RawDeflate=function(t,e){this.compressionType=a.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.freqsLitLen,this.freqsDist,this.input=t instanceof Array?new Uint8Array(t):t,this.output,this.op=0,e&&(e.lazy&&(this.lazy=e.lazy),"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e.outputBuffer&&(this.output=e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.op=e.outputIndex)),this.output||(this.output=new Uint8Array(32768))},a.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3},a.RawDeflate.Lz77MinLength=3,a.RawDeflate.Lz77MaxLength=258,a.RawDeflate.WindowSize=32768,a.RawDeflate.MaxCodeLength=16,a.RawDeflate.HUFMAX=286,a.RawDeflate.FixedHuffmanTable=function(){var t,e=[];for(t=0;t<288;t++)switch(!0){case t<=143:e.push([t+48,8]);break;case t<=255:e.push([t-144+400,9]);break;case t<=279:e.push([t-256+0,7]);break;case t<=287:e.push([t-280+192,8]);break;default:throw"invalid literal: "+t}return e}(),a.RawDeflate.prototype.compress=function(){var t,e,i,n=this.input;switch(this.compressionType){case a.RawDeflate.CompressionType.NONE:for(e=0,i=n.length;e<i;)e+=(t=n.subarray(e,e+65535)).length,this.makeNocompressBlock(t,e===i);break;case a.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(n,!0),this.op=this.output.length;break;case a.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(n,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output},a.RawDeflate.prototype.makeNocompressBlock=function(t,e){var i,n,r,s,o=this.output,h=this.op;for(o=new Uint8Array(this.output.buffer);o.length<=h+t.length+5;)o=new Uint8Array(o.length<<1);return o.set(this.output),i=e?1:0,n=a.RawDeflate.CompressionType.NONE,o[h++]=i|n<<1,s=65536+~(r=t.length)&65535,o[h++]=255&r,o[h++]=r>>>8&255,o[h++]=255&s,o[h++]=s>>>8&255,o.set(t,h),h+=t.length,o=o.subarray(0,h),this.op=h,this.output=o,o},a.RawDeflate.prototype.makeFixedHuffmanBlock=function(t,e){var i,n,r,s=new a.BitStream(new Uint8Array(this.output.buffer),this.op);return i=e?1:0,n=a.RawDeflate.CompressionType.FIXED,s.writeBits(i,1,!0),s.writeBits(n,2,!0),r=this.lz77(t),this.fixedHuffman(r,s),s.finish()},a.RawDeflate.prototype.makeDynamicHuffmanBlock=function(t,e){var i,n,r,s,o,h,l,c,u,f,d,p,g,m,w,b,y,v=new a.BitStream(new Uint8Array(this.output.buffer),this.op),x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(19);for(i=e?1:0,n=a.RawDeflate.CompressionType.DYNAMIC,v.writeBits(i,1,!0),v.writeBits(n,2,!0),r=this.lz77(t),l=this.getLengths_(this.freqsLitLen,15),c=this.getCodesFromLengths_(l),u=this.getLengths_(this.freqsDist,7),f=this.getCodesFromLengths_(u),s=286;s>257&&0===l[s-1];s--);for(o=30;o>1&&0===u[o-1];o--);for(d=this.getTreeSymbols_(s,l,o,u),p=this.getLengths_(d.freqs,7),b=0;b<19;b++)C[b]=p[x[b]];for(h=19;h>4&&0===C[h-1];h--);for(g=this.getCodesFromLengths_(p),v.writeBits(s-257,5,!0),v.writeBits(o-1,5,!0),v.writeBits(h-4,4,!0),b=0;b<h;b++)v.writeBits(C[b],3,!0);for(b=0,y=d.codes.length;b<y;b++)if(m=d.codes[b],v.writeBits(g[m],p[m],!0),m>=16){switch(b++,m){case 16:w=2;break;case 17:w=3;break;case 18:w=7;break;default:throw"invalid code: "+m}v.writeBits(d.codes[b],w,!0)}return this.dynamicHuffman(r,[c,l],[f,u],v),v.finish()},a.RawDeflate.prototype.dynamicHuffman=function(t,e,i,n){var r,s,o,a,h,l,c,u;for(h=e[0],l=e[1],c=i[0],u=i[1],r=0,s=t.length;r<s;++r)if(o=t[r],n.writeBits(h[o],l[o],!0),o>256)n.writeBits(t[++r],t[++r],!0),a=t[++r],n.writeBits(c[a],u[a],!0),n.writeBits(t[++r],t[++r],!0);else if(256===o)break;return n},a.RawDeflate.prototype.fixedHuffman=function(t,e){var i,n,r;for(i=0,n=t.length;i<n;i++)if(r=t[i],a.BitStream.prototype.writeBits.apply(e,a.RawDeflate.FixedHuffmanTable[r]),r>256)e.writeBits(t[++i],t[++i],!0),e.writeBits(t[++i],5),e.writeBits(t[++i],t[++i],!0);else if(256===r)break;return e},a.RawDeflate.Lz77Match=function(t,e){this.length=t,this.backwardDistance=e},a.RawDeflate.Lz77Match.LengthCodeTable=(l=function(){var t,e,i=[];for(t=3;t<=258;t++)e=n(t),i[t]=e[2]<<24|e[1]<<16|e[0];function n(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}return i}(),new Uint32Array(l)),a.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(t){var e;switch(!0){case 1===t:e=[0,t-1,0];break;case 2===t:e=[1,t-2,0];break;case 3===t:e=[2,t-3,0];break;case 4===t:e=[3,t-4,0];break;case t<=6:e=[4,t-5,1];break;case t<=8:e=[5,t-7,1];break;case t<=12:e=[6,t-9,2];break;case t<=16:e=[7,t-13,2];break;case t<=24:e=[8,t-17,3];break;case t<=32:e=[9,t-25,3];break;case t<=48:e=[10,t-33,4];break;case t<=64:e=[11,t-49,4];break;case t<=96:e=[12,t-65,5];break;case t<=128:e=[13,t-97,5];break;case t<=192:e=[14,t-129,6];break;case t<=256:e=[15,t-193,6];break;case t<=384:e=[16,t-257,7];break;case t<=512:e=[17,t-385,7];break;case t<=768:e=[18,t-513,8];break;case t<=1024:e=[19,t-769,8];break;case t<=1536:e=[20,t-1025,9];break;case t<=2048:e=[21,t-1537,9];break;case t<=3072:e=[22,t-2049,10];break;case t<=4096:e=[23,t-3073,10];break;case t<=6144:e=[24,t-4097,11];break;case t<=8192:e=[25,t-6145,11];break;case t<=12288:e=[26,t-8193,12];break;case t<=16384:e=[27,t-12289,12];break;case t<=24576:e=[28,t-16385,13];break;case t<=32768:e=[29,t-24577,13];break;default:throw"invalid distance"}return e},a.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var t,e=this.length,i=this.backwardDistance,n=[],r=0;return t=a.RawDeflate.Lz77Match.LengthCodeTable[e],n[r++]=65535&t,n[r++]=t>>16&255,n[r++]=t>>24,t=this.getDistanceCode_(i),n[r++]=t[0],n[r++]=t[1],n[r++]=t[2],n},a.RawDeflate.prototype.lz77=function(t){var e,i,n,r,s,o,h,l,c,u={},f=a.RawDeflate.WindowSize,d=new Uint16Array(2*t.length),p=0,g=0,m=new Uint32Array(286),w=new Uint32Array(30),b=this.lazy;function y(t,e){var i,n,r=t.toLz77Array();for(i=0,n=r.length;i<n;++i)d[p++]=r[i];m[r[0]]++,w[r[3]]++,g=t.length+e-1,l=null}for(m[256]=1,e=0,i=t.length;e<i;++e){for(s=0,n=0,r=a.RawDeflate.Lz77MinLength;n<r&&e+n!==i;++n)s=s<<8|t[e+n];if(void 0===u[s]&&(u[s]=[]),o=u[s],g-- >0)o.push(e);else{for(;o.length>0&&e-o[0]>f;)o.shift();if(e+a.RawDeflate.Lz77MinLength>=i){for(l&&y(l,-1),n=0,r=i-e;n<r;++n)c=t[e+n],d[p++]=c,++m[c];break}o.length>0?(h=this.searchLongestMatch_(t,e,o),l?l.length<h.length?(c=t[e-1],d[p++]=c,++m[c],y(h,0)):y(l,-1):h.length<b?l=h:y(h,0)):l?y(l,-1):(c=t[e],d[p++]=c,++m[c]),o.push(e)}}return d[p++]=256,m[256]++,this.freqsLitLen=m,this.freqsDist=w,d.subarray(0,p)},a.RawDeflate.prototype.searchLongestMatch_=function(t,e,i){var n,r,s,o,h,l,c=0,u=t.length;t:for(o=0,l=i.length;o<l;o++){if(n=i[l-o-1],s=a.RawDeflate.Lz77MinLength,c>a.RawDeflate.Lz77MinLength){for(h=c;h>a.RawDeflate.Lz77MinLength;h--)if(t[n+h-1]!==t[e+h-1])continue t;s=c}for(;s<a.RawDeflate.Lz77MaxLength&&e+s<u&&t[n+s]===t[e+s];)++s;if(s>c&&(r=n,c=s),s===a.RawDeflate.Lz77MaxLength)break}return new a.RawDeflate.Lz77Match(c,e-r)},a.RawDeflate.prototype.getTreeSymbols_=function(t,e,i,n){var r,s,o,a,h,l,c=new Uint32Array(t+i),u=new Uint32Array(316),f=new Uint8Array(19);for(s=0,r=0;r<t;r++)c[s++]=e[r];for(r=0;r<i;r++)c[s++]=n[r];for(h=0,r=0,a=c.length;r<a;r+=s){for(s=1;r+s<a&&c[r+s]===c[r];++s);if(o=s,0===c[r])if(o<3)for(;o-- >0;)u[h++]=0,f[0]++;else for(;o>0;)(l=o<138?o:138)>o-3&&l<o&&(l=o-3),l<=10?(u[h++]=17,u[h++]=l-3,f[17]++):(u[h++]=18,u[h++]=l-11,f[18]++),o-=l;else if(u[h++]=c[r],f[c[r]]++,--o<3)for(;o-- >0;)u[h++]=c[r],f[c[r]]++;else for(;o>0;)(l=o<6?o:6)>o-3&&l<o&&(l=o-3),u[h++]=16,u[h++]=l-3,f[16]++,o-=l}return{codes:u.subarray(0,h),freqs:f}},a.RawDeflate.prototype.getLengths_=function(t,e){var i,n,r,s,o,h=t.length,l=new a.Heap(2*a.RawDeflate.HUFMAX),c=new Uint8Array(h);for(s=0;s<h;++s)t[s]>0&&l.push(s,t[s]);if(i=new Array(l.length/2),n=new Uint32Array(l.length/2),1===i.length)return c[l.pop().index]=1,c;for(s=0,o=l.length/2;s<o;++s)i[s]=l.pop(),n[s]=i[s].value;for(r=this.reversePackageMerge_(n,n.length,e),s=0,o=i.length;s<o;++s)c[i[s].index]=r[s];return c},a.RawDeflate.prototype.reversePackageMerge_=function(t,e,i){var n,r,s,o,a,h=new Uint16Array(i),l=new Uint8Array(i),c=new Uint8Array(e),u=new Array(i),f=new Array(i),d=new Array(i),p=(1<<i)-e,g=1<<i-1;function m(t){var i=f[t][d[t]];i===e?(m(t+1),m(t+1)):--c[i],++d[t]}for(h[i-1]=e,r=0;r<i;++r)p<g?l[r]=0:(l[r]=1,p-=g),p<<=1,h[i-2-r]=(h[i-1-r]/2|0)+e;for(h[0]=l[0],u[0]=new Array(h[0]),f[0]=new Array(h[0]),r=1;r<i;++r)h[r]>2*h[r-1]+l[r]&&(h[r]=2*h[r-1]+l[r]),u[r]=new Array(h[r]),f[r]=new Array(h[r]);for(n=0;n<e;++n)c[n]=i;for(s=0;s<h[i-1];++s)u[i-1][s]=t[s],f[i-1][s]=s;for(n=0;n<i;++n)d[n]=0;for(1===l[i-1]&&(--c[0],++d[i-1]),r=i-2;r>=0;--r){for(n=0,o=0,a=d[r+1],s=0;s<h[r];s++)(o=u[r+1][a]+u[r+1][a+1])>t[n]?(u[r][s]=o,f[r][s]=e,a+=2):(u[r][s]=t[n],f[r][s]=n,++n);d[r]=0,1===l[r]&&m(r)}return c},a.RawDeflate.prototype.getCodesFromLengths_=function(t){var e,i,n,r,s=new Uint16Array(t.length),o=[],h=[],l=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,i=a.RawDeflate.MaxCodeLength;e<=i;e++)h[e]=l,l+=0|o[e],l<<=1;for(e=0,i=t.length;e<i;e++)for(l=h[t[e]],h[t[e]]+=1,s[e]=0,n=0,r=t[e];n<r;n++)s[e]=s[e]<<1|1&l,l>>>=1;return s},a.Unzip=function(t,e){e=e||{},this.input=t instanceof Array?new Uint8Array(t):t,this.ip=0,this.eocdrOffset,this.numberOfThisDisk,this.startDisk,this.totalEntriesThisDisk,this.totalEntries,this.centralDirectorySize,this.centralDirectoryOffset,this.commentLength,this.comment,this.fileHeaderList,this.filenameToIndex,this.verify=e.verify||!1,this.password=e.password},a.Unzip.CompressionMethod=a.Zip.CompressionMethod,a.Unzip.FileHeaderSignature=a.Zip.FileHeaderSignature,a.Unzip.LocalFileHeaderSignature=a.Zip.LocalFileHeaderSignature,a.Unzip.CentralDirectorySignature=a.Zip.CentralDirectorySignature,a.Unzip.FileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.version,this.os,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.fileCommentLength,this.diskNumberStart,this.internalFileAttributes,this.externalFileAttributes,this.relativeOffset,this.filename,this.extraField,this.comment},a.Unzip.FileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==a.Unzip.FileHeaderSignature[0]||t[e++]!==a.Unzip.FileHeaderSignature[1]||t[e++]!==a.Unzip.FileHeaderSignature[2]||t[e++]!==a.Unzip.FileHeaderSignature[3])throw new Error("invalid file header signature");this.version=t[e++],this.os=t[e++],this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.fileCommentLength=t[e++]|t[e++]<<8,this.diskNumberStart=t[e++]|t[e++]<<8,this.internalFileAttributes=t[e++]|t[e++]<<8,this.externalFileAttributes=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,this.relativeOffset=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.comment=t.subarray(e,e+this.fileCommentLength),this.length=e-this.offset},a.Unzip.LocalFileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.filename,this.extraField},a.Unzip.LocalFileHeader.Flags=a.Zip.Flags,a.Unzip.LocalFileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==a.Unzip.LocalFileHeaderSignature[0]||t[e++]!==a.Unzip.LocalFileHeaderSignature[1]||t[e++]!==a.Unzip.LocalFileHeaderSignature[2]||t[e++]!==a.Unzip.LocalFileHeaderSignature[3])throw new Error("invalid local file header signature");this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.length=e-this.offset},a.Unzip.prototype.searchEndOfCentralDirectoryRecord=function(){var t,e=this.input;for(t=e.length-12;t>0;--t)if(e[t]===a.Unzip.CentralDirectorySignature[0]&&e[t+1]===a.Unzip.CentralDirectorySignature[1]&&e[t+2]===a.Unzip.CentralDirectorySignature[2]&&e[t+3]===a.Unzip.CentralDirectorySignature[3])return void(this.eocdrOffset=t);throw new Error("End of Central Directory Record not found")},a.Unzip.prototype.parseEndOfCentralDirectoryRecord=function(){var t,e=this.input;if(this.eocdrOffset||this.searchEndOfCentralDirectoryRecord(),t=this.eocdrOffset,e[t++]!==a.Unzip.CentralDirectorySignature[0]||e[t++]!==a.Unzip.CentralDirectorySignature[1]||e[t++]!==a.Unzip.CentralDirectorySignature[2]||e[t++]!==a.Unzip.CentralDirectorySignature[3])throw new Error("invalid signature");this.numberOfThisDisk=e[t++]|e[t++]<<8,this.startDisk=e[t++]|e[t++]<<8,this.totalEntriesThisDisk=e[t++]|e[t++]<<8,this.totalEntries=e[t++]|e[t++]<<8,this.centralDirectorySize=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.centralDirectoryOffset=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.commentLength=e[t++]|e[t++]<<8,this.comment=e.subarray(t,t+this.commentLength)},a.Unzip.prototype.parseFileHeader=function(){var t,e,i,n,r=[],s={};if(!this.fileHeaderList){for(void 0===this.centralDirectoryOffset&&this.parseEndOfCentralDirectoryRecord(),t=this.centralDirectoryOffset,i=0,n=this.totalEntries;i<n;++i)(e=new a.Unzip.FileHeader(this.input,t)).parse(),t+=e.length,r[i]=e,s[e.filename]=i;if(this.centralDirectorySize<t-this.centralDirectoryOffset)throw new Error("invalid file header size");this.fileHeaderList=r,this.filenameToIndex=s}},a.Unzip.prototype.getFileData=function(t,e){e=e||{};var i,n,r,s,o,h,l,c,u=this.input,f=this.fileHeaderList;if(f||this.parseFileHeader(),void 0===f[t])throw new Error("wrong index");if(n=f[t].relativeOffset,(i=new a.Unzip.LocalFileHeader(this.input,n)).parse(),n+=i.length,r=i.compressedSize,0!=(i.flags&a.Unzip.LocalFileHeader.Flags.ENCRYPT)){if(!e.password&&!this.password)throw new Error("please set password");for(h=this.createDecryptionKey(e.password||this.password),l=n,c=n+12;l<c;++l)this.decode(h,u[l]);for(l=n+=12,c=n+(r-=12);l<c;++l)u[l]=this.decode(h,u[l])}switch(i.compression){case a.Unzip.CompressionMethod.STORE:s=this.input.subarray(n,n+r);break;case a.Unzip.CompressionMethod.DEFLATE:s=new a.RawInflate(this.input,{index:n,bufferSize:i.plainSize}).decompress();break;default:throw new Error("unknown compression type")}if(this.verify&&(o=a.CRC32.calc(s),i.crc32!==o))throw new Error("wrong crc: file=0x"+i.crc32.toString(16)+", data=0x"+o.toString(16));return s},a.Unzip.prototype.getFilenames=function(){var t,e,i,n=[];for(this.fileHeaderList||this.parseFileHeader(),t=0,e=(i=this.fileHeaderList).length;t<e;++t)n[t]=i[t].filename;return n},a.Unzip.prototype.decompress=function(t,e){var i;if(this.filenameToIndex||this.parseFileHeader(),void 0===(i=this.filenameToIndex[t]))throw new Error(t+" not found");return this.getFileData(i,e)},a.Unzip.prototype.setPassword=function(t){this.password=t},a.Unzip.prototype.decode=function(t,e){return e^=this.getByte(t),this.updateKeys(t,e),e},a.Unzip.prototype.updateKeys=a.Zip.prototype.updateKeys,a.Unzip.prototype.createDecryptionKey=a.Zip.prototype.createEncryptionKey,a.Unzip.prototype.getByte=a.Zip.prototype.getByte,a.Util.stringToByteArray=function(t){var e,i,n=t.split("");for(e=0,i=n.length;e<i;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;return n},a.Adler32=function(t){return"string"==typeof t&&(t=a.Util.stringToByteArray(t)),a.Adler32.update(1,t)},a.Adler32.update=function(t,e){for(var i,n=65535&t,r=t>>>16&65535,s=e.length,o=0;s>0;){s-=i=s>a.Adler32.OptimizationParameter?a.Adler32.OptimizationParameter:s;do{r+=n+=e[o++]}while(--i);n%=65521,r%=65521}return(r<<16|n)>>>0},a.Adler32.OptimizationParameter=1024,a.BitStream=function(t,e){if(this.index="number"==typeof e?e:0,this.bitindex=0,this.buffer=t instanceof Uint8Array?t:new Uint8Array(a.BitStream.DefaultBlockSize),2*this.buffer.length<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()},a.BitStream.DefaultBlockSize=32768,a.BitStream.prototype.expandBuffer=function(){var t=this.buffer,e=t.length,i=new Uint8Array(e<<1);return i.set(t),this.buffer=i},a.BitStream.prototype.writeBits=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.bitindex,h=r[s];if(i&&e>1&&(t=e>8?function(t){return a.BitStream.ReverseTable[255&t]<<24|a.BitStream.ReverseTable[t>>>8&255]<<16|a.BitStream.ReverseTable[t>>>16&255]<<8|a.BitStream.ReverseTable[t>>>24&255]}(t)>>32-e:a.BitStream.ReverseTable[t]>>8-e),e+o<8)h=h<<e|t,o+=e;else for(n=0;n<e;++n)h=h<<1|t>>e-n-1&1,8==++o&&(o=0,r[s++]=a.BitStream.ReverseTable[h],h=0,s===r.length&&(r=this.expandBuffer()));r[s]=h,this.buffer=r,this.bitindex=o,this.index=s},a.BitStream.prototype.finish=function(){var t=this.buffer,e=this.index;return this.bitindex>0&&(t[e]<<=8-this.bitindex,t[e]=a.BitStream.ReverseTable[t[e]],e++),t.subarray(0,e)},a.BitStream.ReverseTable=function(){var t,e=new Uint8Array(256);for(t=0;t<256;++t)e[t]=function(t){var e=t,i=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--i;return(e<<i&255)>>>0}(t);return e}(),a.CRC32.calc=function(t,e,i){return a.CRC32.update(t,0,e,i)},a.CRC32.update=function(t,e,i,n){var r=a.CRC32.Table,s="number"==typeof i?i:i=0,o="number"==typeof n?n:t.length;for(e^=4294967295,s=7&o;s--;++i)e=e>>>8^r[255&(e^t[i])];for(s=o>>3;s--;i+=8)e=(e=(e=(e=(e=(e=(e=(e=e>>>8^r[255&(e^t[i])])>>>8^r[255&(e^t[i+1])])>>>8^r[255&(e^t[i+2])])>>>8^r[255&(e^t[i+3])])>>>8^r[255&(e^t[i+4])])>>>8^r[255&(e^t[i+5])])>>>8^r[255&(e^t[i+6])])>>>8^r[255&(e^t[i+7])];return(4294967295^e)>>>0},a.CRC32.single=function(t,e){return(a.CRC32.Table[255&(t^e)]^t>>>8)>>>0},a.CRC32.Table_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],a.CRC32.Table=new Uint32Array(a.CRC32.Table_),a.Deflate=function(t,e){this.input=t,this.output=new Uint8Array(a.Deflate.DefaultBufferSize),this.compressionType=a.Deflate.CompressionType.DYNAMIC,this.rawDeflate;var i,n={};for(i in!e&&(e={})||"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.output,this.rawDeflate=new a.RawDeflate(this.input,n)},a.Deflate.DefaultBufferSize=32768,a.Deflate.CompressionType=a.RawDeflate.CompressionType,a.Deflate.compress=function(t,e){return new a.Deflate(t,e).compress()},a.Deflate.prototype.compress=function(){var t,e,i,n,r,s,o=0;if(s=this.output,(t=a.CompressionMethod.DEFLATE)!==a.CompressionMethod.DEFLATE)throw new Error("invalid compression method");if(e=Math.LOG2E*Math.log(a.RawDeflate.WindowSize)-8<<4|t,s[o++]=e,0,t!==a.CompressionMethod.DEFLATE)throw new Error("invalid compression method");switch(this.compressionType){case a.Deflate.CompressionType.NONE:n=0;break;case a.Deflate.CompressionType.FIXED:n=1;break;case a.Deflate.CompressionType.DYNAMIC:n=2;break;default:throw new Error("unsupported compression type")}return i=n<<6|0,i|=31-(256*e+i)%31,s[o++]=i,r=a.Adler32(this.input),this.rawDeflate.op=o,o=(s=this.rawDeflate.compress()).length,(s=new Uint8Array(s.buffer)).length<=o+4&&(this.output=new Uint8Array(s.length+4),this.output.set(s),s=this.output),(s=s.subarray(0,o+4))[o++]=r>>24&255,s[o++]=r>>16&255,s[o++]=r>>8&255,s[o++]=255&r,s};const f=function(t){return t.split(/\n|\r\n|\r/g)};function d(t,e){var i,n,r=[],s=t.length,o=0,a=!1;if(s>0)for(r[o]=t.charAt(0),i=1;i<s;i++)'"'===(n=t.charAt(i))?a=!a:a||n!==e?r[o]+=n:r[++o]="";return r}function p(t){t=t.replace(/\./g,"+").replace(/_/g,"/").replace(/-/g,"=");const e=atob(t),i=[];for(let t=0;t<e.length;t++)i.push(e.charCodeAt(t));const n=new a.RawInflate(i).decompress();let r="";for(let t of n)r+=String.fromCharCode(t);return r}const g={gwascatalog:{fields:["bin","chr","start","end","name","pubMedID","author","pubDate","journal","title","trait","initSample","replSample","region","genes","riskAllele","riskAlFreq","pValue","pValueDesc","orOrBeta","ci95","platform","cnv"]},wgrna:{fields:["bin","chr","start","end","name","score","strand","thickStart","thickEnd","type"]},cpgislandext:{fields:["bin","chr","start","end","name","length","cpgNum","gcNum","perCpg","perGc","obsExp"]},clinVarMain:{fields:["chr1","start","end","name","score","strand","thickStart","thickEnd","reserved","blockCount","blockSizes","chromStarts","origName","clinSign","reviewStatus","type","geneId","snpId","nsvId","rcvAcc","testedInGtr","phenotypeList","phenotype","origin","assembly","cytogenetic","hgvsCod","hgvsProt","numSubmit","lastEval","guidelines","otherIds"]}},m=new Set(["narrowpeak","broadpeak","regionpeak","peaks","bedgraph","wig","gff3","gff","gtf","fusionjuncspan","refflat","seg","aed","bed","vcf","bb","bigbed","bw","bigwig","bam","tdf","refgene","genepred","genepredext","bedpe","bp","snp","rmsk","cram","gwas"]);function w(t){var e,i;if((t=t.toLowerCase()).endsWith("refgene.txt.gz")||t.endsWith("refgene.txt.bgz")||t.endsWith("refgene.txt")||t.endsWith("refgene.sorted.txt.gz")||t.endsWith("refgene.sorted.txt.bgz"))return"refgene";switch((e=t.indexOf("?"))>0&&(t=t.substr(0,e)),t.endsWith(".gz")&&(t=t.substr(0,t.length-3)),(t.endsWith(".txt")||t.endsWith(".tab")||t.endsWith(".bgz"))&&(t=t.substr(0,t.length-4)),i=(e=t.lastIndexOf("."))<0?t:t.substr(e+1)){case"bw":return"bigwig";case"bb":return"bigbed";default:return m.has(i)?i:void 0}}function b(t){return t.includes("googleapis")&&!t.includes("urlshortener")||y(t)||v(t)}function y(t){return t.startsWith("gs://")||t.startsWith("https://www.googleapis.com/storage")||t.startsWith("https://storage.cloud.google.com")||t.startsWith("https://storage.googleapis.com")}function v(t){return t.indexOf("drive.google.com")>=0||t.indexOf("www.googleapis.com/drive")>0}function x(t){let{bucket:e,object:i}=function(t){let e,i;if(t.startsWith("gs://")){const n=t.indexOf("/",5);if(n>=0){e=t.substring(5,n);const r=t.indexOf("?");i=r<0?t.substring(n+1):t.substring(n+1,r)}}else if(t.startsWith("https://storage.googleapis.com")||t.startsWith("https://storage.cloud.google.com")){const n=t.indexOf("/v1/b/",8);if(n>0){const r=t.indexOf("/o/",n);if(r>0){const s=t.indexOf("?",r);e=t.substring(n+6,r),i=s>0?t.substring(r+3,s):t.substring(r+3)}}else{const n=t.indexOf("/",8),r=t.indexOf("/",n+1),s=t.indexOf("?",r);r>0&&(e=t.substring(n+1,r),i=s<0?t.substring(r+1):t.substring(r+1,s))}}else if(t.startsWith("https://www.googleapis.com/storage/v1/b")){const n=t.indexOf("/v1/b/",8),r=t.indexOf("/o/",n);if(r>0){const s=t.indexOf("?",r);e=t.substring(n+6,r),i=s>0?t.substring(r+3,s):t.substring(r+3)}}if(e&&i)return{bucket:e,object:i};throw Error(`Unrecognized Google Storage URI: ${t}`)}(t);i=function(t){let e="";return t.split("").forEach((function(t){k.has(t)?e+=k.get(t):e+=t})),e}(i);const n=t.indexOf("?");return`https://storage.googleapis.com/storage/v1/b/${e}/o/${i}${n>0?t.substring(n)+"&alt=media":"?alt=media"}`}function C(t){var e=S(t);return e?"https://www.googleapis.com/drive/v3/files/"+e+"?alt=media&supportsTeamDrives=true":t}function S(t){if(t.includes("/open?id=")){const e=t.indexOf("/open?id=")+9,i=t.indexOf("&");if(e>0&&i>e)return t.substring(e,i);if(e>0)return t.substring(e)}else{if(t.includes("/file/d/")){const e=t.indexOf("/file/d/")+8,i=t.lastIndexOf("/");return t.substring(e,i)}if(t.startsWith("https://www.googleapis.com/drive")){let e=t.indexOf("/files/");const i=t.indexOf("?");if(e>0)return e+=7,i>0?t.substring(e,i):t.substring(e)}}throw Error("Unknown Google Drive url format: "+t)}const k=new Map;k.set("!","%21"),k.set("#","%23"),k.set("$","%24"),k.set("%","%25"),k.set("&","%26"),k.set("'","%27"),k.set("(","%28"),k.set(")","%29"),k.set("*","%2A"),k.set("+","%2B"),k.set(",","%2C"),k.set("/","%2F"),k.set(":","%3A"),k.set(";","%3B"),k.set("=","%3D"),k.set("?","%3F"),k.set("@","%40"),k.set("[","%5B"),k.set("]","%5D"),k.set(" ","%20");function T(){return"undefined"!=typeof gapi&&gapi.auth2&&gapi.auth2.getAuthInstance()}let R=!1;async function I(t){if("undefined"==typeof gapi)throw Error("Google authentication requires the 'gapi' library");if(!gapi.auth2)throw Error("Google 'auth2' has not been initialized");if(R)return new Promise((function(e,i){let n;n=setInterval((()=>{try{!1===R&&(e(I(t)),clearInterval(n))}catch(t){clearInterval(n),i(t)}}),100)}));R=!0;try{let e,i=gapi.auth2.getAuthInstance().currentUser.get();if(i.isSignedIn()){i.hasGrantedScopes(t)||await i.grant({scope:t});const{access_token:n,expires_at:r}=i.getAuthResponse();if(Date.now()<r-3e5)e={access_token:n,expires_at:r};else{const{access_token:t,expires_at:n}=i.reloadAuthResponse();e={access_token:t,expires_at:n}}}else{i=await async function(t){const e=new gapi.auth2.SigninOptionsBuilder;return e.setPrompt("select_account"),e.setScope(t),gapi.auth2.getAuthInstance().signIn(e)}(t);const{access_token:n,expires_at:r}=i.getAuthResponse();e={access_token:n,expires_at:r}}return e}finally{R=!1}}function D(){return gapi.apiKey}async function M(t){let e="https://www.googleapis.com/drive/v3/files/"+S(t)+"?supportsTeamDrives=true";const i=D();i&&(e+="&key="+i);const n=await fetch(e);let r=await n.json();if(r.error&&404===r.error.code){const{access_token:t}=await I("https://www.googleapis.com/auth/drive.readonly");if(!t)throw Error(r.error);{const i=await fetch(e,{headers:{Authorization:`Bearer ${t}`}});if(r=await i.json(),r.error)throw Error(r.error)}}return r}function L(t){const e=t.split(","),i=e[0].split(":")[1];let n=e[1];n=i.indexOf("base64")>=0?atob(n):decodeURI(n);const r=new Uint8Array(n.length);for(let t=0;t<n.length;t++)r[t]=n.charCodeAt(t);let s;if(i.indexOf("gzip")>0){s=new a.Gunzip(r).decompress()}else s=r;return s}function E(t){for(var e=A,i=e.parser.loose.exec(t),n={},r=14;r--;)n[e.key[r]]=i[r]||"";return n[e.q.name]={},n[e.key[12]].replace(e.q.parser,(function(t,i,r){i&&(n[e.q.name][i]=r)})),n}"object"==typeof process&&"undefined"==typeof window&&(global.atob=function(t){return Buffer.from(t,"base64").toString("binary")});const A={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};async function B(t){if(z(t))return t.name;if(v(t)){if("undefined"==typeof gapi)throw Error(`Google initialization with API key is required to load Google urls (${t})`);const e=await M(t);return e.name||e.originalFileName}return E(t).file}function z(t){return!!t&&("function"!=typeof t&&(t instanceof File||t.hasOwnProperty("name")&&"function"==typeof t.slice&&"function"==typeof t.arrayBuffer))}function F(t,e){const i=[];let n=0,r=0;for(e=e||t.byteLength-18;n<e;)try{const e=new Uint8Array(t,n,18),s=e[11]<<8|e[10],o=(e[12],e[13],e[15],e[14],1+(e[17]<<8|e[16])),h=12+s+n,l=t.byteLength-h,c=o-s-19;if(l<c||c<=0)break;const u=new Uint8Array(t,h,c),f=new a.RawInflate(u),d=f.decompress();n+=f.ip+26,r+=d.byteLength,i.push(d)}catch(t){console.error(t);break}if(1===i.length)return i[0];{const t=new Uint8Array(r);let e=0;for(let n=0;n<i.length;++n){var s=new Uint8Array(i[n]);O(s,0,t,e,s.length),e+=s.length}return t}}function N(t){const e=new Uint8Array(t);return 1+(e[17]<<8|e[16])}const _="function"==typeof new Uint8Array(1).subarray;function O(t,e,i,n,r){if(0!==r){if(!t)throw"Undef src";if(!i)throw"Undef dest";0===e&&r===t.length?$(t,i,n):_?$(t.subarray(e,e+r),i,n):1===t.BYTES_PER_ELEMENT&&r>100?$(new Uint8Array(t.buffer,t.byteOffset+e,r),i,n):function(t,e,i,n,r){for(let s=0;s<r;++s)i[n+s]=t[e+s]}(t,e,i,n,r)}}function $(t,e,i){e.set(t,i)}const U=function(t,e,i){return Math.min(Math.max(t,e),i)};function H(){this.content=[]}function P(t,e){return Math.random()*(e-t)+t}H.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},remove:function(t){for(var e=this.content.length,i=0;i<e;i++)if(this.content[i]===t){var n=this.content.pop();if(i===e-1)break;this.content[i]=n,this.bubbleUp(i),this.sinkDown(i);break}},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t],i=e;t>0;){var n=Math.floor((t+1)/2)-1,r=this.content[n];if(i>=r)break;this.content[n]=e,this.content[t]=r,t=n}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],n=i;;){var r=2*(t+1),s=r-1,o=null;if(s<e){var a=this.content[s],h=a;a<n&&(o=s)}if(r<e)this.content[r]<(null==o?n:h)&&(o=r);if(null==o)break;this.content[t]=this.content[o],this.content[o]=i,t=o}}};const V={rgbListFromHSV:()=>{let t=[];for(let e=1;e>=.5;e-=.1)for(let i=0;i<1;i+=1/28){const n="rgb("+V.hsvToRgb(i,1,e).join(",")+")";t.push(n)}return t.pop(),t.push(V.rgbColor(16,16,16)),t},rgbToHex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(null!==e)return"rgb("+parseInt(e[1],16)+","+parseInt(e[2],16)+","+parseInt(e[3],16)+")"},hsvToRgb:function(t,e,i){var n,r,s,o=Math.floor(6*t),a=6*t-o,h=i*(1-e),l=i*(1-a*e),c=i*(1-(1-a)*e);switch(o%6){case 0:n=i,r=c,s=h;break;case 1:n=l,r=i,s=h;break;case 2:n=h,r=i,s=c;break;case 3:n=h,r=l,s=i;break;case 4:n=c,r=h,s=i;break;case 5:n=i,r=h,s=l}return[Math.floor(255*n),Math.floor(255*r),Math.floor(255*s)]},hslToRgb:function(t,e,i){var n,r,s;if(0===e)n=r=s=i;else{var o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;n=V.hue2rgb(a,o,t+1/3),r=V.hue2rgb(a,o,t),s=V.hue2rgb(a,o,t-1/3)}return[255*n,255*r,255*s]},hue2rgb:(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t),rgbaColor:function(t,e,i,n){return"rgba("+(t=U(t,0,255))+","+(e=U(e,0,255))+","+(i=U(i,0,255))+","+(n=U(n,0,1))+")"},rgbColor:function(t,e,i){return"rgb("+(t=U(t,0,255))+","+(e=U(e,0,255))+","+(i=U(i,0,255))+")"},greyScale:function(t){var e=U(t,0,255);return"rgb("+e+","+e+","+e+")"},randomGrey:function(t,e){t=U(t,0,255),e=U(e,0,255);var i=Math.round(P(t,e)).toString(10);return"rgb("+i+","+i+","+i+")"},randomRGB:function(t,e){return t=U(t,0,255),e=U(e,0,255),"rgb("+Math.round(P(t,e)).toString(10)+","+Math.round(P(t,e)).toString(10)+","+Math.round(P(t,e)).toString(10)+")"},randomRGBConstantAlpha:function(t,e,i){return t=U(t,0,255),e=U(e,0,255),"rgba("+Math.round(P(t,e)).toString(10)+","+Math.round(P(t,e)).toString(10)+","+Math.round(P(t,e)).toString(10)+","+i+")"},addAlpha:function(t,e){if("0"===t||"."===t)t="rgb(0,0,0)";else{const e=this.colorNameToHex(t);e&&(t=e)}var i=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t);if(t.startsWith("rgba")){const i=t.lastIndexOf(",");return t.substring(0,i+1)+e.toString()+")"}return i&&(t=V.hexToRgb(t)),t.startsWith("rgb")?t.replace("rgb","rgba").replace(")",", "+e+")"):(console.log(t+" is not an rgb style string"),t)},rgbComponents:function(t){if("0"===t||"."===t)return[0,0,0];if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))t=V.hexToRgb(t);else if(!t.startsWith("rgb")){const e=this.colorNameToHex(t);t=this.hexToRgb(e)}if(t.startsWith("rgb("))return t.substring(4,t.length-1).split(",").map((t=>Number.parseInt(t.trim())));if(t.startsWith("rgba("))return t.substring(5,t.length-1).split(",").map(((t,e)=>(t=t.trim(),3===e?Number.parseFloat(t):Number.parseInt(t))));throw Error("Unrecognized color string: color")},getCompositeColor:function(t,e,i){return"rgb("+Math.floor(i*e[0]+(1-i)*t[0])+","+Math.floor(i*e[1]+(1-i)*t[1])+","+Math.floor(i*e[2]+(1-i)*t[2])+")"},createColorString:function(t){return(t=function(t){return void 0===t||((t.startsWith("'")||t.startsWith('"'))&&(t=t.substring(1)),(t.endsWith("'")||t.endsWith('"'))&&(t=t.substring(0,t.length-1))),t}(t)).includes(",")?t.startsWith("rgb")?t:"rgb("+t+")":t},darkenLighten:function(t,e){let i,n=this.colorNameToHex(t);i=n?V.hexToRgb(n):t.startsWith("rgb(")?t:V.hexToRgb(t);const r=i.replace(")","").substring(4).split(","),s=Math.max(0,Math.min(255,Number.parseInt(r[0].trim())+e)),o=Math.max(0,Math.min(255,Number.parseInt(r[1].trim())+e)),a=Math.max(0,Math.min(255,Number.parseInt(r[2].trim())+e));return"rgb("+s.toString()+","+o.toString()+","+a.toString()+")"},colorNameToHex:function(t){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",darkgrey:"#a9a9a9",darkslategrey:"#2f4f4f",dimgrey:"#696969",grey:"#808080",lightgray:"#d3d3d3",lightslategrey:"#778899",slategrey:"#708090"}[t]}};let W;function G(t,e){e.addEventListener("mousedown",j.bind(t))}function j(t){t.stopPropagation(),t.preventDefault(),function(t){if(!t.getClientRects().length)return{top:0,left:0};const e=t.getBoundingClientRect(),i=t.ownerDocument.defaultView;e.top,i.pageYOffset,e.left,i.pageXOffset}(this);const e=q.bind(this),i=Z.bind(this),n=getComputedStyle(this),r=parseInt(n.top.replace("px","")),s=parseInt(n.left.replace("px",""));W={dragFunction:e,dragEndFunction:i,screenX:t.screenX,screenY:t.screenY,top:r,left:s},document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",i),document.addEventListener("mouseexit",i)}function q(t){if(!W)return void console.log("No drag data!");t.stopPropagation(),t.preventDefault();const e=t.screenX-W.screenX,i=t.screenY-W.screenY;this.style.left=`${W.left+e}px`,this.style.top=`${W.top+i}px`}function Z(t){if(!W)return void console.log("No drag data!");t.stopPropagation(),t.preventDefault();const e=W.dragFunction,i=W.dragEndFunction;document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",i),document.removeEventListener("mouseexit",i),W=void 0}const K={Set1:["rgb(228,26,28)","rgb(55,126,184)","rgb(77,175,74)","rgb(166,86,40)","rgb(152,78,163)","rgb(255,127,0)","rgb(247,129,191)","rgb(153,153,153)","rgb(255,255,51)"],Dark2:["rgb(27,158,119)","rgb(217,95,2)","rgb(117,112,179)","rgb(231,41,138)","rgb(102,166,30)","rgb(230,171,2)","rgb(166,118,29)","rgb(102,102,102)"],Set2:["rgb(102, 194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],Set3:["rgb(141,211,199)","rgb(255,255,179)","rgb(190,186,218)","rgb(251,128,114)","rgb(128,177,211)","rgb(253,180,98)","rgb(179,222,105)","rgb(252,205,229)","rgb(217,217,217)","rgb(188,128,189)","rgb(204,235,197)","rgb(255,237,111)"],Pastel1:["rgb(251,180,174)","rgb(179,205,227)","rgb(204,235,197)","rgb(222,203,228)","rgb(254,217,166)","rgb(255,255,204)","rgb(229,216,189)","rgb(253,218,236)"],Pastel2:["rgb(173,226,207)","rgb(253,205,172)","rgb(203,213,232)","rgb(244,202,228)","rgb(230,245,201)","rgb(255,242,174)","rgb(243,225,206)"],Accent:["rgb(127,201,127)","rgb(190,174,212)","rgb(253,192,134)","rgb(255,255,153)","rgb(56,108,176)","rgb(240,2,127)","rgb(191,91,23)"]};function Y(t){this.colors=K[t],Array.isArray(this.colors)||(this.colors=[]),this.colorTable={},this.nextIdx=0,this.colorGenerator=new X}function X(){this.hue=Math.random(),this.goldenRatio=.618033988749895,this.hexwidth=2}Y.prototype.getColor=function(t){return this.colorTable.hasOwnProperty(t)||(this.nextIdx<this.colors.length?this.colorTable[t]=this.colors[this.nextIdx]:this.colorTable[t]=this.colorGenerator.get(),this.nextIdx++),this.colorTable[t]},X.prototype.hsvToRgb=function(t,e,i){var n=Math.floor(6*t),r=6*t-n,s=i*(1-e),o=i*(1-r*e),a=i*(1-(1-r)*e),h=255,l=255,c=255;switch(n){case 0:h=i,l=a,c=s;break;case 1:h=o,l=i,c=s;break;case 2:h=s,l=i,c=a;break;case 3:h=s,l=o,c=i;break;case 4:h=a,l=s,c=i;break;case 5:h=i,l=s,c=o}return[Math.floor(256*h),Math.floor(256*l),Math.floor(256*c)]},X.prototype.padHex=function(t){return t.length>this.hexwidth?t:new Array(this.hexwidth-t.length+1).join("0")+t},X.prototype.get=function(t,e){this.hue+=this.goldenRatio,this.hue%=1,"number"!=typeof t&&(t=.5),"number"!=typeof e&&(e=.95);var i=this.hsvToRgb(this.hue,t,e);return"#"+this.padHex(i[0].toString(16))+this.padHex(i[1].toString(16))+this.padHex(i[2].toString(16))};const J="googleapis",Q={oauthTokens:{},setToken:function(t,e){e=e||J,this.oauthTokens[e]=t,e===J&&(this.google.access_token=t)},getToken:function(t){let e;t=t||J;for(let i of Object.keys(this.oauthTokens)){if(tt(i).test(t)){e=this.oauthTokens[i];break}}return e},removeToken:function(t){t=t||J;for(let e of Object.keys(this.oauthTokens)){tt(e).test(t)&&(this.oauthTokens[e]=void 0)}t===J&&(this.google.access_token=void 0)},google:{setToken:function(t){Q.setToken(t)}}};function tt(t){return new RegExp("^"+t.split(/\*+/).map(et).join(".*")+"$")}function et(t){return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}const it=new class{constructor(t){this.requestsPerSecond=t.requestsPerSecond||10,this.lastStartTime=0,this.queued=[]}add(t,e){var i=this;return new Promise((function(e,n){i.queued.push({resolve:e,reject:n,asyncFunction:t}),i.dequeue()}))}addAll(t,e){var i=t.map(function(t){return this.add(t,e)}.bind(this));return Promise.all(i)}dequeue(){if(this.queued.length>0){var t=new Date,e=1e3/this.requestsPerSecond+1,i=t-this.lastStartTime;i>=e?this._execute():setTimeout(function(){this.dequeue()}.bind(this),e-i)}}async _execute(){this.lastStartTime=new Date;var t=this.queued.shift();const e=t.asyncFunction;try{const i=await e();t.resolve(i)}catch(e){t.reject(e)}}}({requestsPerSecond:8}),nt={apiKey:void 0,setApiKey:function(t){this.apiKey=t},load:rt,loadArrayBuffer:async function(t,e){return(e=e||{}).responseType||(e.responseType="arraybuffer"),z(t)?ot(t,e):rt(t,e)},loadJson:async function(t,e){"POST"===((e=e||{}).method||(e.sendData?"POST":"GET"))&&(e.contentType="application/json");const i=await this.loadString(t,e);return i?JSON.parse(i):i},loadString:async function(t,e){return e=e||{},z(t)?async function(t,e){const i=e.range?t.slice(e.range.start,e.range.start+e.range.size):t;let n=0;e&&e.bgz||t.name.endsWith(".bgz")?n=2:t.name.endsWith(".gz")&&(n=1);if(0===n)return ht(i);return ct(await at(i),n)}(t,e):async function(t,e){const i=(e=e||{}).filename||await async function(t){if(c(t)&&t.startsWith("https://drive.google.com")){if(void 0===D())throw Error("Google drive is referenced, but API key is not defined.  An API key is required for Google Drive access");const e=await M(t);return e.originalFileName||e.name}return function(t){if(void 0!==t.name)return t.name;if(c(t)){let e=t.lastIndexOf("/"),i=e<0?t:t.substr(e+1);return e=i.indexOf("?"),e>0&&(i=i.substr(0,e)),i}throw Error("Expected File or string, got "+typeof t)}(t)}(t);let n=3;e.bgz?n=2:i.endsWith(".gz")&&(n=1);e.responseType="arraybuffer";return ct(await nt.load(t,e),n)}(t,e)}};async function rt(t,e){e=e||{};const i=typeof t;if(z(t=await("function"==typeof t?t():t)))return ot(t,e);if("function"==typeof t.startsWith)return t.startsWith("data:")?L(t):(t.startsWith("https://drive.google.com")&&(t=C(t)),v(t)||t.startsWith("https://www.dropbox.com")?it.add((async function(){return st(t,e)})):st(t,e));throw Error(`url must be either a 'File', 'string', 'function', or 'Promise'.  Actual type: ${i}`)}async function st(t,e){t=function(t){return t.includes("//www.dropbox.com")?t.replace("//www.dropbox.com","//dl.dropboxusercontent.com"):t.includes("//drive.google.com")?C(t):t.includes("//www.broadinstitute.org/igvdata")?t.replace("//www.broadinstitute.org/igvdata","//data.broadinstitute.org/igvdata"):t.includes("//igvdata.broadinstitute.org")?t.replace("//igvdata.broadinstitute.org","https://dn7ywbm9isq8j.cloudfront.net"):t.startsWith("ftp://ftp.ncbi.nlm.nih.gov/geo")?t.replace("ftp://","https://"):t}(t);let i=(e=e||{}).oauthToken||function(t){const e=b(t)?void 0:E(t).host;let i=Q.getToken(e);if(i)return i;if(void 0===e){const t=lt();if(t&&t.expires_at>Date.now())return t.access_token}}(t);return i&&(i=await("function"==typeof i?i():i)),new Promise((function(n,r){b(t)&&(y(t)&&(t=x(t)),v(t=function(t){let e=nt.apiKey;e||"undefined"==typeof gapi||(e=gapi.apiKey);if(void 0!==e&&!t.includes("key=")){const i=t.includes("?")?"&":"?";t=t+i+"key="+e}return t}(t))&&function(t){if(t.includes("supportsTeamDrive"))return t;{const e=t.includes("?")?"&":"?";t=t+e+"supportsTeamDrive=true"}}(t),i||(i=lt()));const s=e.headers||{};i&&function(t,e){e&&(t["Cache-Control"]="no-cache",t.Authorization="Bearer "+e)}(s,i);const o=e.range,a=navigator.userAgent.indexOf("Chrome")>-1;0===navigator.vendor.indexOf("Apple")&&/\sSafari\//.test(navigator.userAgent),o&&a&&!function(t){return t.indexOf("X-Amz-Signature")>-1}(t)&&(t+=t.includes("?")?"&":"?",t+="someRandomSeed="+Math.random().toString(36));const h=new XMLHttpRequest,l=e.sendData||e.body,c=e.method||(l?"POST":"GET"),u=e.responseType,f=e.contentType,d=e.mimeType;if(h.open(c,t),e.timeout&&(h.timeout=e.timeout),o){var p=o.size?o.start+o.size-1:"";h.setRequestHeader("Range","bytes="+o.start+"-"+p)}if(f&&h.setRequestHeader("Content-Type",f),d&&h.overrideMimeType(d),u&&(h.responseType=u),s)for(let t of Object.keys(s)){const e=s[t];h.setRequestHeader(t,e)}!0===e.withCredentials&&(h.withCredentials=!0),h.onload=async function(i){0===h.status||h.status>=200&&h.status<=300?o&&206!==h.status&&0!==o.start?(h.response.length>1e5&&alert(`Warning: Range header ignored for URL: ${t}.  This can have performance impacts.`),n(h.response.slice(o.start,o.start+o.size))):n(h.response):"undefined"==typeof gapi||404!==h.status&&401!==h.status&&403!==h.status||!b(t)||e.retries?403===h.status?g("Access forbidden: "+t):416===h.status?g("Unsatisfiable range"):g(h.status):m()},h.onerror=function(i){b(t)&&!e.retries&&m(),g("Error accessing resource: "+t+" Status: "+h.status)},h.ontimeout=function(t){g("Timed out")},h.onabort=function(t){console.log("Aborted"),r(t)};try{h.send(l)}catch(t){r(t)}function g(t){if(!r)throw t;r(t)}async function m(){try{const i=await async function(t){if(console.log("Fetch token for "+t),T()){const e=function(t){return v(t)?"https://www.googleapis.com/auth/drive.file":y(t)?"https://www.googleapis.com/auth/devstorage.read_only":"https://www.googleapis.com/auth/userinfo.profile"}(t),i=await I(e);return i?i.access_token:void 0}throw Error("Authorization is required, but Google oAuth has not been initalized. Contact your site administrator for assistance.")}(t);e.retries=1,e.oauthToken=i;const r=await rt(t,e);n(r)}catch(t){if(t.error){const e=t.error.startsWith("popup_blocked")?"Google login popup blocked by browser.":t.error;alert(e)}else g(t)}}}))}async function ot(t,e){let i=e&&e.range?t.slice(e.range.start,e.range.start+e.range.size):t;return"arraybuffer"===e.responseType?at(i):new Promise((function(e,n){const r=new FileReader;r.onload=function(t){e(r.result)},r.onerror=function(e){console.error("reject uploading local file "+t.name),n(null,r)},r.readAsBinaryString(i),console.warn("Deprecated method used: readAsBinaryString")}))}async function at(t){return"function"==typeof t.arrayBuffer?t.arrayBuffer():new Promise((function(e,i){const n=new FileReader;n.onload=function(t){e(n.result)},n.onerror=function(t){console.error("reject uploading local file "+localfile.name),i(null,n)},n.readAsArrayBuffer(t)}))}async function ht(t){return"function"==typeof t.text?t.text():new Promise((function(e,i){const n=new FileReader;n.onload=function(t){e(n.result)},n.onerror=function(t){console.error("reject uploading local file "+localfile.name),i(null,n)},n.readAsText(t)}))}function lt(){if(T()){const t=function(){let t=gapi.auth2.getAuthInstance().currentUser.get();if(t&&t.isSignedIn()){const{access_token:e,expires_at:i}=t.getAuthResponse();return{access_token:e,expires_at:i}}}();return t?t.access_token:void 0}}function ct(t,e){if(3===e&&t.byteLength>2){const i=new Uint8Array(t,0,2);31===i[0]&&139===i[1]&&(e=1)}let i;if(1===e){i=new a.Gunzip(new Uint8Array(t)).decompress()}else i=2===e?F(t):new Uint8Array(t);return"TextDecoder"in function(){if("undefined"!=typeof self)return self;return"undefined"!=typeof global?global:window}()?(new TextDecoder).decode(i):function(t){var e="",i=0;for(;i<t.length;){var n=t[i],r=0,s=0;if(n<=127?(r=0,s=255&n):n<=223?(r=1,s=31&n):n<=239?(r=2,s=15&n):n<=244&&(r=3,s=7&n),t.length-i-r>0)for(var o=0;o<r;)s=s<<6|63&(n=t[i+o+1]),o+=1;else s=65533,r=t.length-i;e+=String.fromCodePoint(s),i+=r+1}return e}(i)}var ut={color:1};ut.parent=ut,ut.left=ut,ut.right=ut;class ft{constructor(){this.root=ut}insert(t,e,i){var n=new bt(new wt(t,e,i));for(this.treeInsert(n),n.color=2;n!==this.root&&2===n.parent.color;)if(n.parent===n.parent.parent.left){let t=n.parent.parent.right;2===t.color?(n.parent.color=1,t.color=1,n.parent.parent.color=2,n=n.parent.parent):(n===n.parent.right&&(n=n.parent,pt.call(this,n)),n.parent.color=1,n.parent.parent.color=2,gt.call(this,n.parent.parent))}else{let t=n.parent.parent.left;2===t.color?(n.parent.color=1,t.color=1,n.parent.parent.color=2,n=n.parent.parent):(n===n.parent.left&&(n=n.parent,gt.call(this,n)),n.parent.color=1,n.parent.parent.color=2,pt.call(this,n.parent.parent))}this.root.color=1}findOverlapping(t,e){var i=new wt(t,e,0);if(this.root===ut)return[];var n=dt.call(this,i,this.root,[]);return n.length>1&&n.sort((function(t,e){return t.low-e.low})),n}logIntervals(){!function t(e,i){for(var n="",r=0;r<i;r++)n+=" ";console.log(n+e.interval.low+" "+e.interval.high),i+=5,e.left!==ut&&t(e.left,i);e.right!==ut&&t(e.right,i)}(this.root,0)}mapIntervals(t){!function e(i){t(i.interval),i.left!==ut&&e(i.left);i.right!==ut&&e(i.right)}(this.root)}treeInsert(t){for(var e=this.root,i=ut;e!==ut;)i=e,e=t.interval.low<=e.interval.low?e.left:e.right;t.parent=i,i===ut?(this.root=t,t.left=t.right=ut):t.interval.low<=i.interval.low?i.left=t:i.right=t,mt.call(this,t)}}function dt(t,e,i){return e.interval.overlaps(t)&&i.push(e.interval),e.left!==ut&&e.left.max>=t.low&&dt.call(this,t,e.left,i),e.right!==ut&&e.right.min<=t.high&&dt.call(this,t,e.right,i),i}function pt(t){var e=t.right;t.right=e.left,e.left!==ut&&(e.left.parent=t),e.parent=t.parent,t.parent===ut?this.root=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,mt.call(this,t)}function gt(t){var e=t.left;t.left=e.right,e.right!==ut&&(e.right.parent=t),e.parent=t.parent,t.parent===ut?this.root=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e,mt.call(this,t)}function mt(t){for(;t!==ut;){var e=t.left.max>t.right.max?t.left.max:t.right.max,i=t.interval.high;t.max=e>i?e:i;var n=t.left.min<t.right.min?t.left.min:t.right.min,r=t.interval.low;t.min=n<r?n:r,t=t.parent}}class wt{constructor(t,e,i){this.low=t,this.high=e,this.value=i}equals(t){return!!t&&(this===t||this.low===t.low&&this.high===t.high)}compareTo(t){return this.low<t.low?-1:this.low>t.low?1:this.high<t.high?-1:this.high>t.high?1:0}overlaps(t){return this.low<=t.high&&t.low<=this.high}}function bt(t){this.parent=ut,this.left=ut,this.right=ut,this.interval=t,this.color=2}class yt{constructor(t,e,i){t=t||[],this.treeMap=this.buildTreeMap(t,e),this.range=i,this.count=t.length}containsRange(t){return void 0===this.range||this.range.contains(t.chr,t.start,t.end)}queryFeatures(t,e,i){const n=this.treeMap[t];if(!n)return[];const r=n.findOverlapping(e,i);if(0===r.length)return[];{const n=[],s=this.allFeatures[t];if(s){for(let t of r){const r=t.value;for(let t=r.start;t<r.end;t++){let r=s[t];if(r.start>i)break;r.end>=e&&n.push(r)}}n.sort((function(t,e){return t.start-e.start}))}return n}}getAllFeatures(){return this.allFeatures}buildTreeMap(t,e){const i={},n=[];if(this.allFeatures={},t){for(let i of t){let t=i.chr;e&&(t=e.getChromosomeName(t));let r=this.allFeatures[t];r||(n.push(t),r=[],this.allFeatures[t]=r),r.push(i)}for(let t of n){const e=this.allFeatures[t];e.sort((function(t,e){return t.start===e.start?0:t.start>e.start?1:-1})),i[t]=vt(e)}}return i}}function vt(t){const e=new ft,i=t.length,n=Math.max(10,Math.round(i/10));for(let r=0;r<i;r+=n){const s=Math.min(i,r+n),o=new xt(r,s),a=t[r].start;let h=a;for(let e=r;e<s;e++)h=Math.max(h,t[e].end);e.insert(a,h,o)}return e}class xt{constructor(t,e){this.start=t,this.end=e}}const Ct=function(t,e,i){if(t&&0!==t.length){const n=function(t){const e=new ft,i=t.length,n=Math.max(10,Math.round(i/100));t.sort((function(t,e){return t.start===e.start?0:t.start>e.start?1:-1}));for(let r=0;r<i;r+=n){const s=Math.min(i,r+n),o=t.slice(r,s),a=o[0].start;let h=a;o.forEach((function(t){h=Math.max(h,t.end)})),e.insert(a,h,o)}return e}
/*!
     * jQuery JavaScript Library v3.3.1 -ajax,-ajax/jsonp,-ajax/load,-ajax/parseXML,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-event/ajax,-effects,-effects/Tween,-effects/animatedSelector
     * https://jquery.com/
     *
     * Includes Sizzle.js
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://jquery.org/license
     *
     * Date: 2018-01-20T17:24Z
     */(t),r=n.findOverlapping(e,i);return 0===r.length?[]:(t=[],r.forEach((function(n){const r=n.value,s=r.length;for(let n=0;n<s;n++){const s=r[n];if(s.start>i)break;s.end>e&&t.push(s)}})),t.sort((function(t,e){return t.start-e.start})),t)}return[]};var St=[],kt=window.document,Tt=Object.getPrototypeOf,Rt=St.slice,It=St.concat,Dt=St.push,Mt=St.indexOf,Lt={},Et=Lt.toString,At=Lt.hasOwnProperty,Bt=At.toString,zt=Bt.call(Object),Ft={},Nt=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},_t=function(t){return null!=t&&t===t.window},Ot={type:!0,src:!0,noModule:!0};function $t(t,e,i){var n,r=(e=e||kt).createElement("script");if(r.text=t,i)for(n in Ot)i[n]&&(r[n]=i[n]);e.head.appendChild(r).parentNode.removeChild(r)}function Ut(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?Lt[Et.call(t)]||"object":typeof t}var Ht="3.3.1 -ajax,-ajax/jsonp,-ajax/load,-ajax/parseXML,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-event/ajax,-effects,-effects/Tween,-effects/animatedSelector",Pt=function(t,e){return new Pt.fn.init(t,e)},Vt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function Wt(t){var e=!!t&&"length"in t&&t.length,i=Ut(t);return!Nt(t)&&!_t(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}Pt.fn=Pt.prototype={jquery:Ht,constructor:Pt,length:0,toArray:function(){return Rt.call(this)},get:function(t){return null==t?Rt.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=Pt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return Pt.each(this,t)},map:function(t){return this.pushStack(Pt.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(Rt.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:Dt,sort:St.sort,splice:St.splice},Pt.extend=Pt.fn.extend=function(){var t,e,i,n,r,s,o=arguments[0]||{},a=1,h=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||Nt(o)||(o={}),a===h&&(o=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],o!==(n=t[e])&&(l&&n&&(Pt.isPlainObject(n)||(r=Array.isArray(n)))?(r?(r=!1,s=i&&Array.isArray(i)?i:[]):s=i&&Pt.isPlainObject(i)?i:{},o[e]=Pt.extend(l,s,n)):void 0!==n&&(o[e]=n));return o},Pt.extend({expando:"jQuery"+(Ht+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==Et.call(t))&&(!(e=Tt(t))||"function"==typeof(i=At.call(e,"constructor")&&e.constructor)&&Bt.call(i)===zt)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t){$t(t)},each:function(t,e){var i,n=0;if(Wt(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(Vt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(Wt(Object(t))?Pt.merge(i,"string"==typeof t?[t]:t):Dt.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:Mt.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,s=t.length,o=!i;r<s;r++)!e(t[r],r)!==o&&n.push(t[r]);return n},map:function(t,e,i){var n,r,s=0,o=[];if(Wt(t))for(n=t.length;s<n;s++)null!=(r=e(t[s],s,i))&&o.push(r);else for(s in t)null!=(r=e(t[s],s,i))&&o.push(r);return It.apply([],o)},guid:1,support:Ft}),"function"==typeof Symbol&&(Pt.fn[Symbol.iterator]=St[Symbol.iterator]),Pt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){Lt["[object "+e+"]"]=e.toLowerCase()}));var Gt=
/*!
    * Sizzle CSS Selector Engine v2.3.3
    * https://sizzlejs.com/
    *
    * Copyright jQuery Foundation and other contributors
    * Released under the MIT license
    * http://jquery.org/license
    *
    * Date: 2016-08-08
    */
function(t){var e,i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y,v="sizzle"+1*new Date,x=t.document,C=0,S=0,k=ot(),T=ot(),R=ot(),I=function(t,e){return t===e&&(u=!0),0},D={}.hasOwnProperty,M=[],L=M.pop,E=M.push,A=M.push,B=M.slice,z=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",_="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",O="\\[[\\x20\\t\\r\\n\\f]*("+_+")(?:"+N+"*([*^$|!~]?=)"+N+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+_+"))|)"+N+"*\\]",$=":("+_+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",U=new RegExp(N+"+","g"),H=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),P=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),V=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),W=new RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),G=new RegExp($),j=new RegExp("^"+_+"$"),q={ID:new RegExp("^#("+_+")"),CLASS:new RegExp("^\\.("+_+")"),TAG:new RegExp("^("+_+"|[*])"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Z=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,X=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,J=/[+~]/,Q=new RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),tt=function(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},et=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,it=function(t,e){return e?"\0"===t?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},nt=function(){f()},rt=bt((function(t){return!0===t.disabled&&("form"in t||"label"in t)}),{dir:"parentNode",next:"legend"});try{A.apply(M=B.call(x.childNodes),x.childNodes),M[x.childNodes.length].nodeType}catch(t){A={apply:M.length?function(t,e){E.apply(t,B.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function st(t,e,n,r){var s,a,l,c,u,p,w,b=e&&e.ownerDocument,C=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==C&&9!==C&&11!==C)return n;if(!r&&((e?e.ownerDocument||e:x)!==d&&f(e),e=e||d,g)){if(11!==C&&(u=X.exec(t)))if(s=u[1]){if(9===C){if(!(l=e.getElementById(s)))return n;if(l.id===s)return n.push(l),n}else if(b&&(l=b.getElementById(s))&&y(e,l)&&l.id===s)return n.push(l),n}else{if(u[2])return A.apply(n,e.getElementsByTagName(t)),n;if((s=u[3])&&i.getElementsByClassName&&e.getElementsByClassName)return A.apply(n,e.getElementsByClassName(s)),n}if(i.qsa&&!R[t+" "]&&(!m||!m.test(t))){if(1!==C)b=e,w=t;else if("object"!==e.nodeName.toLowerCase()){for((c=e.getAttribute("id"))?c=c.replace(et,it):e.setAttribute("id",c=v),a=(p=o(t)).length;a--;)p[a]="#"+c+" "+wt(p[a]);w=p.join(","),b=J.test(t)&&gt(e.parentNode)||e}if(w)try{return A.apply(n,b.querySelectorAll(w)),n}catch(t){}finally{c===v&&e.removeAttribute("id")}}}return h(t.replace(H,"$1"),e,n,r)}function ot(){var t=[];return function e(i,r){return t.push(i+" ")>n.cacheLength&&delete e[t.shift()],e[i+" "]=r}}function at(t){return t[v]=!0,t}function ht(t){if(!d)return!0;var e=d.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function lt(t,e){for(var i=t.split("|"),r=i.length;r--;)n.attrHandle[i[r]]=e}function ct(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ut(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ft(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function dt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&rt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function pt(t){return at((function(e){return e=+e,at((function(i,n){for(var r,s=t([],i.length,e),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))}))}))}function gt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=st.support={},s=st.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},f=st.setDocument=function(t){var e,r,o=t?t.ownerDocument||t:x;return o!==d&&9===o.nodeType&&o.documentElement?(p=(d=o).documentElement,g=!s(d),x!==d&&(r=d.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",nt,!1):r.attachEvent&&r.attachEvent("onunload",nt)),i.attributes=ht((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=ht((function(t){return t.appendChild(d.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=Y.test(d.getElementsByClassName),i.getById=ht((function(t){return p.appendChild(t).id=v,!d.getElementsByName||!d.getElementsByName(v).length})),i.getById?(n.filter.ID=function(t){var e=t.replace(Q,tt);return function(t){return t.getAttribute("id")===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i=e.getElementById(t);return i?[i]:[]}}):(n.filter.ID=function(t){var e=t.replace(Q,tt);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i,n,r,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(r=e.getElementsByName(t),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),n.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},n.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},w=[],m=[],(i.qsa=Y.test(d.querySelectorAll))&&(ht((function(t){p.appendChild(t).innerHTML="<a id='"+v+"'></a><select id='"+v+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll("[selected]").length||m.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+F+")"),t.querySelectorAll("[id~="+v+"-]").length||m.push("~="),t.querySelectorAll(":checked").length||m.push(":checked"),t.querySelectorAll("a#"+v+"+*").length||m.push(".#.+[+~]")})),ht((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=d.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&m.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),p.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),m.push(",.*:")}))),(i.matchesSelector=Y.test(b=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ht((function(t){i.disconnectedMatch=b.call(t,"*"),b.call(t,"[s!='']:x"),w.push("!=",$)})),m=m.length&&new RegExp(m.join("|")),w=w.length&&new RegExp(w.join("|")),e=Y.test(p.compareDocumentPosition),y=e||Y.test(p.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},I=e?function(t,e){if(t===e)return u=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===n?t===d||t.ownerDocument===x&&y(x,t)?-1:e===d||e.ownerDocument===x&&y(x,e)?1:c?z(c,t)-z(c,e):0:4&n?-1:1)}:function(t,e){if(t===e)return u=!0,0;var i,n=0,r=t.parentNode,s=e.parentNode,o=[t],a=[e];if(!r||!s)return t===d?-1:e===d?1:r?-1:s?1:c?z(c,t)-z(c,e):0;if(r===s)return ct(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[n]===a[n];)n++;return n?ct(o[n],a[n]):o[n]===x?-1:a[n]===x?1:0},d):d},st.matches=function(t,e){return st(t,null,null,e)},st.matchesSelector=function(t,e){if((t.ownerDocument||t)!==d&&f(t),e=e.replace(W,"='$1']"),i.matchesSelector&&g&&!R[e+" "]&&(!w||!w.test(e))&&(!m||!m.test(e)))try{var n=b.call(t,e);if(n||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return st(e,d,null,[t]).length>0},st.contains=function(t,e){return(t.ownerDocument||t)!==d&&f(t),y(t,e)},st.attr=function(t,e){(t.ownerDocument||t)!==d&&f(t);var r=n.attrHandle[e.toLowerCase()],s=r&&D.call(n.attrHandle,e.toLowerCase())?r(t,e,!g):void 0;return void 0!==s?s:i.attributes||!g?t.getAttribute(e):(s=t.getAttributeNode(e))&&s.specified?s.value:null},st.escape=function(t){return(t+"").replace(et,it)},st.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},st.uniqueSort=function(t){var e,n=[],r=0,s=0;if(u=!i.detectDuplicates,c=!i.sortStable&&t.slice(0),t.sort(I),u){for(;e=t[s++];)e===t[s]&&(r=n.push(s));for(;r--;)t.splice(n[r],1)}return c=null,t},r=st.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=r(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=r(e);return i},n=st.selectors={cacheLength:50,createPseudo:at,match:q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Q,tt),t[3]=(t[3]||t[4]||t[5]||"").replace(Q,tt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||st.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&st.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return q.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&G.test(i)&&(e=o(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Q,tt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=k[t+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+t+"("+N+"|$)"))&&k(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(n){var r=st.attr(n,t);return null==r?"!="===e:!e||(r+="","="===e?r===i:"!="===e?r!==i:"^="===e?i&&0===r.indexOf(i):"*="===e?i&&r.indexOf(i)>-1:"$="===e?i&&r.slice(-i.length)===i:"~="===e?(" "+r.replace(U," ")+" ").indexOf(i)>-1:"|="===e&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,n,r){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,h){var l,c,u,f,d,p,g=s!==o?"nextSibling":"previousSibling",m=e.parentNode,w=a&&e.nodeName.toLowerCase(),b=!h&&!a,y=!1;if(m){if(s){for(;g;){for(f=e;f=f[g];)if(a?f.nodeName.toLowerCase()===w:1===f.nodeType)return!1;p=g="only"===t&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&b){for(y=(d=(l=(c=(u=(f=m)[v]||(f[v]={}))[f.uniqueID]||(u[f.uniqueID]={}))[t]||[])[0]===C&&l[1])&&l[2],f=d&&m.childNodes[d];f=++d&&f&&f[g]||(y=d=0)||p.pop();)if(1===f.nodeType&&++y&&f===e){c[t]=[C,d,y];break}}else if(b&&(y=d=(l=(c=(u=(f=e)[v]||(f[v]={}))[f.uniqueID]||(u[f.uniqueID]={}))[t]||[])[0]===C&&l[1]),!1===y)for(;(f=++d&&f&&f[g]||(y=d=0)||p.pop())&&((a?f.nodeName.toLowerCase()!==w:1!==f.nodeType)||!++y||(b&&((c=(u=f[v]||(f[v]={}))[f.uniqueID]||(u[f.uniqueID]={}))[t]=[C,y]),f!==e)););return(y-=r)===n||y%n==0&&y/n>=0}}},PSEUDO:function(t,e){var i,r=n.pseudos[t]||n.setFilters[t.toLowerCase()]||st.error("unsupported pseudo: "+t);return r[v]?r(e):r.length>1?(i=[t,t,"",e],n.setFilters.hasOwnProperty(t.toLowerCase())?at((function(t,i){for(var n,s=r(t,e),o=s.length;o--;)t[n=z(t,s[o])]=!(i[n]=s[o])})):function(t){return r(t,0,i)}):r}},pseudos:{not:at((function(t){var e=[],i=[],n=a(t.replace(H,"$1"));return n[v]?at((function(t,e,i,r){for(var s,o=n(t,null,r,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))})):function(t,r,s){return e[0]=t,n(e,null,s,i),e[0]=null,!i.pop()}})),has:at((function(t){return function(e){return st(t,e).length>0}})),contains:at((function(t){return t=t.replace(Q,tt),function(e){return(e.textContent||e.innerText||r(e)).indexOf(t)>-1}})),lang:at((function(t){return j.test(t||"")||st.error("unsupported lang: "+t),t=t.replace(Q,tt).toLowerCase(),function(e){var i;do{if(i=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===p},focus:function(t){return t===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:dt(!1),disabled:dt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!n.pseudos.empty(t)},header:function(t){return K.test(t.nodeName)},input:function(t){return Z.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:pt((function(){return[0]})),last:pt((function(t,e){return[e-1]})),eq:pt((function(t,e,i){return[i<0?i+e:i]})),even:pt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:pt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:pt((function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t})),gt:pt((function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[e]=ut(e);for(e in{submit:!0,reset:!0})n.pseudos[e]=ft(e);function mt(){}function wt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function bt(t,e,i){var n=e.dir,r=e.next,s=r||n,o=i&&"parentNode"===s,a=S++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||o)return t(e,i,r);return!1}:function(e,i,h){var l,c,u,f=[C,a];if(h){for(;e=e[n];)if((1===e.nodeType||o)&&t(e,i,h))return!0}else for(;e=e[n];)if(1===e.nodeType||o)if(c=(u=e[v]||(e[v]={}))[e.uniqueID]||(u[e.uniqueID]={}),r&&r===e.nodeName.toLowerCase())e=e[n]||e;else{if((l=c[s])&&l[0]===C&&l[1]===a)return f[2]=l[2];if(c[s]=f,f[2]=t(e,i,h))return!0}return!1}}function yt(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function vt(t,e,i,n,r){for(var s,o=[],a=0,h=t.length,l=null!=e;a<h;a++)(s=t[a])&&(i&&!i(s,n,r)||(o.push(s),l&&e.push(a)));return o}function xt(t,e,i,n,r,s){return n&&!n[v]&&(n=xt(n)),r&&!r[v]&&(r=xt(r,s)),at((function(s,o,a,h){var l,c,u,f=[],d=[],p=o.length,g=s||function(t,e,i){for(var n=0,r=e.length;n<r;n++)st(t,e[n],i);return i}(e||"*",a.nodeType?[a]:a,[]),m=!t||!s&&e?g:vt(g,f,t,a,h),w=i?r||(s?t:p||n)?[]:o:m;if(i&&i(m,w,a,h),n)for(l=vt(w,d),n(l,[],a,h),c=l.length;c--;)(u=l[c])&&(w[d[c]]=!(m[d[c]]=u));if(s){if(r||t){if(r){for(l=[],c=w.length;c--;)(u=w[c])&&l.push(m[c]=u);r(null,w=[],l,h)}for(c=w.length;c--;)(u=w[c])&&(l=r?z(s,u):f[c])>-1&&(s[l]=!(o[l]=u))}}else w=vt(w===o?w.splice(p,w.length):w),r?r(null,o,w,h):A.apply(o,w)}))}function Ct(t){for(var e,i,r,s=t.length,o=n.relative[t[0].type],a=o||n.relative[" "],h=o?1:0,c=bt((function(t){return t===e}),a,!0),u=bt((function(t){return z(e,t)>-1}),a,!0),f=[function(t,i,n){var r=!o&&(n||i!==l)||((e=i).nodeType?c(t,i,n):u(t,i,n));return e=null,r}];h<s;h++)if(i=n.relative[t[h].type])f=[bt(yt(f),i)];else{if((i=n.filter[t[h].type].apply(null,t[h].matches))[v]){for(r=++h;r<s&&!n.relative[t[r].type];r++);return xt(h>1&&yt(f),h>1&&wt(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(H,"$1"),i,h<r&&Ct(t.slice(h,r)),r<s&&Ct(t=t.slice(r)),r<s&&wt(t))}f.push(i)}return yt(f)}return mt.prototype=n.filters=n.pseudos,n.setFilters=new mt,o=st.tokenize=function(t,e){var i,r,s,o,a,h,l,c=T[t+" "];if(c)return e?0:c.slice(0);for(a=t,h=[],l=n.preFilter;a;){for(o in i&&!(r=P.exec(a))||(r&&(a=a.slice(r[0].length)||a),h.push(s=[])),i=!1,(r=V.exec(a))&&(i=r.shift(),s.push({value:i,type:r[0].replace(H," ")}),a=a.slice(i.length)),n.filter)!(r=q[o].exec(a))||l[o]&&!(r=l[o](r))||(i=r.shift(),s.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return e?a.length:a?st.error(t):T(t,h).slice(0)},a=st.compile=function(t,e){var i,r=[],s=[],a=R[t+" "];if(!a){for(e||(e=o(t)),i=e.length;i--;)(a=Ct(e[i]))[v]?r.push(a):s.push(a);a=R(t,function(t,e){var i=e.length>0,r=t.length>0,s=function(s,o,a,h,c){var u,p,m,w=0,b="0",y=s&&[],v=[],x=l,S=s||r&&n.find.TAG("*",c),k=C+=null==x?1:Math.random()||.1,T=S.length;for(c&&(l=o===d||o||c);b!==T&&null!=(u=S[b]);b++){if(r&&u){for(p=0,o||u.ownerDocument===d||(f(u),a=!g);m=t[p++];)if(m(u,o||d,a)){h.push(u);break}c&&(C=k)}i&&((u=!m&&u)&&w--,s&&y.push(u))}if(w+=b,i&&b!==w){for(p=0;m=e[p++];)m(y,v,o,a);if(s){if(w>0)for(;b--;)y[b]||v[b]||(v[b]=L.call(h));v=vt(v)}A.apply(h,v),c&&!s&&v.length>0&&w+e.length>1&&st.uniqueSort(h)}return c&&(C=k,l=x),y};return i?at(s):s}(s,r)),a.selector=t}return a},h=st.select=function(t,e,i,r){var s,h,l,c,u,f="function"==typeof t&&t,d=!r&&o(t=f.selector||t);if(i=i||[],1===d.length){if((h=d[0]=d[0].slice(0)).length>2&&"ID"===(l=h[0]).type&&9===e.nodeType&&g&&n.relative[h[1].type]){if(!(e=(n.find.ID(l.matches[0].replace(Q,tt),e)||[])[0]))return i;f&&(e=e.parentNode),t=t.slice(h.shift().value.length)}for(s=q.needsContext.test(t)?0:h.length;s--&&(l=h[s],!n.relative[c=l.type]);)if((u=n.find[c])&&(r=u(l.matches[0].replace(Q,tt),J.test(h[0].type)&&gt(e.parentNode)||e))){if(h.splice(s,1),!(t=r.length&&wt(h)))return A.apply(i,r),i;break}}return(f||a(t,d))(r,e,!g,i,!e||J.test(t)&&gt(e.parentNode)||e),i},i.sortStable=v.split("").sort(I).join("")===v,i.detectDuplicates=!!u,f(),i.sortDetached=ht((function(t){return 1&t.compareDocumentPosition(d.createElement("fieldset"))})),ht((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||lt("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&ht((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||lt("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),ht((function(t){return null==t.getAttribute("disabled")}))||lt(F,(function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null})),st}(window);Pt.find=Gt,Pt.expr=Gt.selectors,Pt.expr[":"]=Pt.expr.pseudos,Pt.uniqueSort=Pt.unique=Gt.uniqueSort,Pt.text=Gt.getText,Pt.isXMLDoc=Gt.isXML,Pt.contains=Gt.contains,Pt.escapeSelector=Gt.escape;var jt=function(t,e,i){for(var n=[],r=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&Pt(t).is(i))break;n.push(t)}return n},qt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},Zt=Pt.expr.match.needsContext;function Kt(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var Yt=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Xt(t,e,i){return Nt(e)?Pt.grep(t,(function(t,n){return!!e.call(t,n,t)!==i})):e.nodeType?Pt.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?Pt.grep(t,(function(t){return Mt.call(e,t)>-1!==i})):Pt.filter(e,t,i)}Pt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?Pt.find.matchesSelector(n,t)?[n]:[]:Pt.find.matches(t,Pt.grep(e,(function(t){return 1===t.nodeType})))},Pt.fn.extend({find:function(t){var e,i,n=this.length,r=this;if("string"!=typeof t)return this.pushStack(Pt(t).filter((function(){for(e=0;e<n;e++)if(Pt.contains(r[e],this))return!0})));for(i=this.pushStack([]),e=0;e<n;e++)Pt.find(t,r[e],i);return n>1?Pt.uniqueSort(i):i},filter:function(t){return this.pushStack(Xt(this,t||[],!1))},not:function(t){return this.pushStack(Xt(this,t||[],!0))},is:function(t){return!!Xt(this,"string"==typeof t&&Zt.test(t)?Pt(t):t||[],!1).length}});var Jt,Qt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,te=Pt.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||Jt,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:Qt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof Pt?e[0]:e,Pt.merge(this,Pt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:kt,!0)),Yt.test(n[1])&&Pt.isPlainObject(e))for(n in e)Nt(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(r=kt.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):Nt(t)?void 0!==i.ready?i.ready(t):t(Pt):Pt.makeArray(t,this)};te.prototype=Pt.fn,Jt=Pt(kt);var ee=/^(?:parents|prev(?:Until|All))/,ie={children:!0,contents:!0,next:!0,prev:!0};function ne(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}Pt.fn.extend({has:function(t){var e=Pt(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(Pt.contains(this,e[t]))return!0}))},closest:function(t,e){var i,n=0,r=this.length,s=[],o="string"!=typeof t&&Pt(t);if(!Zt.test(t))for(;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&Pt.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?Pt.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?Mt.call(Pt(t),this[0]):Mt.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(Pt.uniqueSort(Pt.merge(this.get(),Pt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),Pt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return jt(t,"parentNode")},parentsUntil:function(t,e,i){return jt(t,"parentNode",i)},next:function(t){return ne(t,"nextSibling")},prev:function(t){return ne(t,"previousSibling")},nextAll:function(t){return jt(t,"nextSibling")},prevAll:function(t){return jt(t,"previousSibling")},nextUntil:function(t,e,i){return jt(t,"nextSibling",i)},prevUntil:function(t,e,i){return jt(t,"previousSibling",i)},siblings:function(t){return qt((t.parentNode||{}).firstChild,t)},children:function(t){return qt(t.firstChild)},contents:function(t){return Kt(t,"iframe")?t.contentDocument:(Kt(t,"template")&&(t=t.content||t),Pt.merge([],t.childNodes))}},(function(t,e){Pt.fn[t]=function(i,n){var r=Pt.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=Pt.filter(n,r)),this.length>1&&(ie[t]||Pt.uniqueSort(r),ee.test(t)&&r.reverse()),this.pushStack(r)}}));var re=/[^\x20\t\r\n\f]+/g;function se(t){return t}function oe(t){throw t}function ae(t,e,i,n){var r;try{t&&Nt(r=t.promise)?r.call(t).done(e).fail(i):t&&Nt(r=t.then)?r.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}Pt.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return Pt.each(t.match(re)||[],(function(t,i){e[i]=!0})),e}(t):Pt.extend({},t);var e,i,n,r,s=[],o=[],a=-1,h=function(){for(r=r||t.once,n=e=!0;o.length;a=-1)for(i=o.shift();++a<s.length;)!1===s[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=s.length,i=!1);t.memory||(i=!1),e=!1,r&&(s=i?[]:"")},l={add:function(){return s&&(i&&!e&&(a=s.length-1,o.push(i)),function e(i){Pt.each(i,(function(i,n){Nt(n)?t.unique&&l.has(n)||s.push(n):n&&n.length&&"string"!==Ut(n)&&e(n)}))}(arguments),i&&!e&&h()),this},remove:function(){return Pt.each(arguments,(function(t,e){for(var i;(i=Pt.inArray(e,s,i))>-1;)s.splice(i,1),i<=a&&a--})),this},has:function(t){return t?Pt.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=o=[],i||e||(s=i=""),this},locked:function(){return!!r},fireWith:function(t,i){return r||(i=[t,(i=i||[]).slice?i.slice():i],o.push(i),e||h()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},Pt.extend({Deferred:function(t){var e=[["notify","progress",Pt.Callbacks("memory"),Pt.Callbacks("memory"),2],["resolve","done",Pt.Callbacks("once memory"),Pt.Callbacks("once memory"),0,"resolved"],["reject","fail",Pt.Callbacks("once memory"),Pt.Callbacks("once memory"),1,"rejected"]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return Pt.Deferred((function(i){Pt.each(e,(function(e,n){var s=Nt(t[n[4]])&&t[n[4]];r[n[1]]((function(){var t=s&&s.apply(this,arguments);t&&Nt(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,s?[t]:arguments)}))})),t=null})).promise()},then:function(t,i,n){var r=0;function s(t,e,i,n){return function(){var o=this,a=arguments,h=function(){var h,l;if(!(t<r)){if((h=i.apply(o,a))===e.promise())throw new TypeError("Thenable self-resolution");l=h&&("object"==typeof h||"function"==typeof h)&&h.then,Nt(l)?n?l.call(h,s(r,e,se,n),s(r,e,oe,n)):(r++,l.call(h,s(r,e,se,n),s(r,e,oe,n),s(r,e,se,e.notifyWith))):(i!==se&&(o=void 0,a=[h]),(n||e.resolveWith)(o,a))}},l=n?h:function(){try{h()}catch(n){Pt.Deferred.exceptionHook&&Pt.Deferred.exceptionHook(n,l.stackTrace),t+1>=r&&(i!==oe&&(o=void 0,a=[n]),e.rejectWith(o,a))}};t?l():(Pt.Deferred.getStackHook&&(l.stackTrace=Pt.Deferred.getStackHook()),window.setTimeout(l))}}return Pt.Deferred((function(r){e[0][3].add(s(0,r,Nt(n)?n:se,r.notifyWith)),e[1][3].add(s(0,r,Nt(t)?t:se)),e[2][3].add(s(0,r,Nt(i)?i:oe))})).promise()},promise:function(t){return null!=t?Pt.extend(t,n):n}},r={};return Pt.each(e,(function(t,s){var o=s[2],a=s[5];n[s[1]]=o.add,a&&o.add((function(){i=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(s[3].fire),r[s[0]]=function(){return r[s[0]+"With"](this===r?void 0:this,arguments),this},r[s[0]+"With"]=o.fireWith})),n.promise(r),t&&t.call(r,r),r},when:function(t){var e=arguments.length,i=e,n=Array(i),r=Rt.call(arguments),s=Pt.Deferred(),o=function(t){return function(i){n[t]=this,r[t]=arguments.length>1?Rt.call(arguments):i,--e||s.resolveWith(n,r)}};if(e<=1&&(ae(t,s.done(o(i)).resolve,s.reject,!e),"pending"===s.state()||Nt(r[i]&&r[i].then)))return s.then();for(;i--;)ae(r[i],o(i),s.reject);return s.promise()}});var he=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;Pt.Deferred.exceptionHook=function(t,e){window.console&&window.console.warn&&t&&he.test(t.name)&&window.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},Pt.readyException=function(t){window.setTimeout((function(){throw t}))};var le=Pt.Deferred();function ce(){kt.removeEventListener("DOMContentLoaded",ce),window.removeEventListener("load",ce),Pt.ready()}Pt.fn.ready=function(t){return le.then(t).catch((function(t){Pt.readyException(t)})),this},Pt.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--Pt.readyWait:Pt.isReady)||(Pt.isReady=!0,!0!==t&&--Pt.readyWait>0||le.resolveWith(kt,[Pt]))}}),Pt.ready.then=le.then,"complete"===kt.readyState||"loading"!==kt.readyState&&!kt.documentElement.doScroll?window.setTimeout(Pt.ready):(kt.addEventListener("DOMContentLoaded",ce),window.addEventListener("load",ce));var ue=function(t,e,i,n,r,s,o){var a=0,h=t.length,l=null==i;if("object"===Ut(i))for(a in r=!0,i)ue(t,e,a,i[a],!0,s,o);else if(void 0!==n&&(r=!0,Nt(n)||(o=!0),l&&(o?(e.call(t,n),e=null):(l=e,e=function(t,e,i){return l.call(Pt(t),i)})),e))for(;a<h;a++)e(t[a],i,o?n:n.call(t[a],a,e(t[a],i)));return r?t:l?e.call(t):h?e(t[0],i):s},fe=/^-ms-/,de=/-([a-z])/g;function pe(t,e){return e.toUpperCase()}function ge(t){return t.replace(fe,"ms-").replace(de,pe)}var me=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function we(){this.expando=Pt.expando+we.uid++}we.uid=1,we.prototype={cache:function(t){var e=t[this.expando];return e||(e={},me(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[ge(e)]=i;else for(n in e)r[ge(n)]=e[n];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][ge(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=Array.isArray(e)?e.map(ge):(e=ge(e))in n?[e]:e.match(re)||[]).length;for(;i--;)delete n[e[i]]}(void 0===e||Pt.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!Pt.isEmptyObject(e)}};var be=new we,ye=new we,ve=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xe=/[A-Z]/g;function Ce(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(xe,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:ve.test(t)?JSON.parse(t):t)}(i)}catch(t){}ye.set(t,e,i)}else i=void 0;return i}Pt.extend({hasData:function(t){return ye.hasData(t)||be.hasData(t)},data:function(t,e,i){return ye.access(t,e,i)},removeData:function(t,e){ye.remove(t,e)},_data:function(t,e,i){return be.access(t,e,i)},_removeData:function(t,e){be.remove(t,e)}}),Pt.fn.extend({data:function(t,e){var i,n,r,s=this[0],o=s&&s.attributes;if(void 0===t){if(this.length&&(r=ye.get(s),1===s.nodeType&&!be.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&(n=ge(n.slice(5)),Ce(s,n,r[n]));be.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each((function(){ye.set(this,t)})):ue(this,(function(e){var i;if(s&&void 0===e)return void 0!==(i=ye.get(s,t))||void 0!==(i=Ce(s,t))?i:void 0;this.each((function(){ye.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){ye.remove(this,t)}))}}),Pt.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=be.get(t,e),i&&(!n||Array.isArray(i)?n=be.access(t,e,Pt.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=Pt.queue(t,e),n=i.length,r=i.shift(),s=Pt._queueHooks(t,e);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete s.stop,r.call(t,(function(){Pt.dequeue(t,e)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return be.get(t,i)||be.access(t,i,{empty:Pt.Callbacks("once memory").add((function(){be.remove(t,[e+"queue",i])}))})}}),Pt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?Pt.queue(this[0],t):void 0===e?this:this.each((function(){var i=Pt.queue(this,t,e);Pt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&Pt.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){Pt.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=Pt.Deferred(),s=this,o=this.length,a=function(){--n||r.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=be.get(s[o],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(e)}});var Se=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ke=new RegExp("^(?:([+-])=|)("+Se+")([a-z%]*)$","i"),Te=["Top","Right","Bottom","Left"],Re=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&Pt.contains(t.ownerDocument,t)&&"none"===Pt.css(t,"display")},Ie=function(t,e,i,n){var r,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];for(s in r=i.apply(t,n||[]),e)t.style[s]=o[s];return r};var De={};function Me(t){var e,i=t.ownerDocument,n=t.nodeName,r=De[n];return r||(e=i.body.appendChild(i.createElement(n)),r=Pt.css(e,"display"),e.parentNode.removeChild(e),"none"===r&&(r="block"),De[n]=r,r)}function Le(t,e){for(var i,n,r=[],s=0,o=t.length;s<o;s++)(n=t[s]).style&&(i=n.style.display,e?("none"===i&&(r[s]=be.get(n,"display")||null,r[s]||(n.style.display="")),""===n.style.display&&Re(n)&&(r[s]=Me(n))):"none"!==i&&(r[s]="none",be.set(n,"display",i)));for(s=0;s<o;s++)null!=r[s]&&(t[s].style.display=r[s]);return t}Pt.fn.extend({show:function(){return Le(this,!0)},hide:function(){return Le(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){Re(this)?Pt(this).show():Pt(this).hide()}))}});var Ee=/^(?:checkbox|radio)$/i,Ae=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Be=/^$|^module$|\/(?:java|ecma)script/i,ze={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Fe(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&Kt(t,e)?Pt.merge([t],i):i}function Ne(t,e){for(var i=0,n=t.length;i<n;i++)be.set(t[i],"globalEval",!e||be.get(e[i],"globalEval"))}ze.optgroup=ze.option,ze.tbody=ze.tfoot=ze.colgroup=ze.caption=ze.thead,ze.th=ze.td;var _e=/<|&#?\w+;/;function Oe(t,e,i,n,r){for(var s,o,a,h,l,c,u=e.createDocumentFragment(),f=[],d=0,p=t.length;d<p;d++)if((s=t[d])||0===s)if("object"===Ut(s))Pt.merge(f,s.nodeType?[s]:s);else if(_e.test(s)){for(o=o||u.appendChild(e.createElement("div")),a=(Ae.exec(s)||["",""])[1].toLowerCase(),h=ze[a]||ze._default,o.innerHTML=h[1]+Pt.htmlPrefilter(s)+h[2],c=h[0];c--;)o=o.lastChild;Pt.merge(f,o.childNodes),(o=u.firstChild).textContent=""}else f.push(e.createTextNode(s));for(u.textContent="",d=0;s=f[d++];)if(n&&Pt.inArray(s,n)>-1)r&&r.push(s);else if(l=Pt.contains(s.ownerDocument,s),o=Fe(u.appendChild(s),"script"),l&&Ne(o),i)for(c=0;s=o[c++];)Be.test(s.type||"")&&i.push(s);return u}!function(){var t=kt.createDocumentFragment().appendChild(kt.createElement("div")),e=kt.createElement("input");e.setAttribute("type","radio"),e.setAttribute("checked","checked"),e.setAttribute("name","t"),t.appendChild(e),Ft.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",Ft.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var $e=kt.documentElement,Ue=/^key/,He=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Pe=/^([^.]*)(?:\.(.+)|)/;function Ve(){return!0}function We(){return!1}function Ge(){try{return kt.activeElement}catch(t){}}function je(t,e,i,n,r,s){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(n=n||i,i=void 0),e)je(t,a,i,n,e[a],s);return t}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=We;else if(!r)return t;return 1===s&&(o=r,r=function(t){return Pt().off(t),o.apply(this,arguments)},r.guid=o.guid||(o.guid=Pt.guid++)),t.each((function(){Pt.event.add(this,e,r,n,i)}))}Pt.event={global:{},add:function(t,e,i,n,r){var s,o,a,h,l,c,u,f,d,p,g,m=be.get(t);if(m)for(i.handler&&(i=(s=i).handler,r=s.selector),r&&Pt.find.matchesSelector($e,r),i.guid||(i.guid=Pt.guid++),(h=m.events)||(h=m.events={}),(o=m.handle)||(o=m.handle=function(e){return void 0!==Pt&&Pt.event.triggered!==e.type?Pt.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(re)||[""]).length;l--;)d=g=(a=Pe.exec(e[l])||[])[1],p=(a[2]||"").split(".").sort(),d&&(u=Pt.event.special[d]||{},d=(r?u.delegateType:u.bindType)||d,u=Pt.event.special[d]||{},c=Pt.extend({type:d,origType:g,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&Pt.expr.match.needsContext.test(r),namespace:p.join(".")},s),(f=h[d])||((f=h[d]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,n,p,o)||t.addEventListener&&t.addEventListener(d,o)),u.add&&(u.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),r?f.splice(f.delegateCount++,0,c):f.push(c),Pt.event.global[d]=!0)},remove:function(t,e,i,n,r){var s,o,a,h,l,c,u,f,d,p,g,m=be.hasData(t)&&be.get(t);if(m&&(h=m.events)){for(l=(e=(e||"").match(re)||[""]).length;l--;)if(d=g=(a=Pe.exec(e[l])||[])[1],p=(a[2]||"").split(".").sort(),d){for(u=Pt.event.special[d]||{},f=h[d=(n?u.delegateType:u.bindType)||d]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=f.length;s--;)c=f[s],!r&&g!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(f.splice(s,1),c.selector&&f.delegateCount--,u.remove&&u.remove.call(t,c));o&&!f.length&&(u.teardown&&!1!==u.teardown.call(t,p,m.handle)||Pt.removeEvent(t,d,m.handle),delete h[d])}else for(d in h)Pt.event.remove(t,d+e[l],i,n,!0);Pt.isEmptyObject(h)&&be.remove(t,"handle events")}},dispatch:function(t){var e,i,n,r,s,o,a=Pt.event.fix(t),h=new Array(arguments.length),l=(be.get(this,"events")||{})[a.type]||[],c=Pt.event.special[a.type]||{};for(h[0]=a,e=1;e<arguments.length;e++)h[e]=arguments[e];if(a.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,a)){for(o=Pt.event.handlers.call(this,a,l),e=0;(r=o[e++])&&!a.isPropagationStopped();)for(a.currentTarget=r.elem,i=0;(s=r.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(s.namespace)||(a.handleObj=s,a.data=s.data,void 0!==(n=((Pt.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,h))&&!1===(a.result=n)&&(a.preventDefault(),a.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,a),a.result}},handlers:function(t,e){var i,n,r,s,o,a=[],h=e.delegateCount,l=t.target;if(h&&l.nodeType&&!("click"===t.type&&t.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==t.type||!0!==l.disabled)){for(s=[],o={},i=0;i<h;i++)void 0===o[r=(n=e[i]).selector+" "]&&(o[r]=n.needsContext?Pt(r,this).index(l)>-1:Pt.find(r,this,null,[l]).length),o[r]&&s.push(n);s.length&&a.push({elem:l,handlers:s})}return l=this,h<e.length&&a.push({elem:l,handlers:e.slice(h)}),a},addProp:function(t,e){Object.defineProperty(Pt.Event.prototype,t,{enumerable:!0,configurable:!0,get:Nt(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[Pt.expando]?t:new Pt.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Ge()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Ge()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&Kt(this,"input"))return this.click(),!1},_default:function(t){return Kt(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},Pt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},Pt.Event=function(t,e){if(!(this instanceof Pt.Event))return new Pt.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Ve:We,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&Pt.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[Pt.expando]=!0},Pt.Event.prototype={constructor:Pt.Event,isDefaultPrevented:We,isPropagationStopped:We,isImmediatePropagationStopped:We,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Ve,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Ve,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Ve,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},Pt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Ue.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&He.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},Pt.event.addProp),Pt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){Pt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,s=t.handleObj;return r&&(r===n||Pt.contains(n,r))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}})),Pt.fn.extend({on:function(t,e,i,n){return je(this,t,e,i,n)},one:function(t,e,i,n){return je(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,Pt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=We),this.each((function(){Pt.event.remove(this,t,i,e)}))}});var qe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ze=/<script|<style|<link/i,Ke=/checked\s*(?:[^=]|=\s*.checked.)/i,Ye=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Xe(t,e){return Kt(t,"table")&&Kt(11!==e.nodeType?e:e.firstChild,"tr")&&Pt(t).children("tbody")[0]||t}function Je(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Qe(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function ti(t,e){var i,n,r,s,o,a,h,l;if(1===e.nodeType){if(be.hasData(t)&&(s=be.access(t),o=be.set(e,s),l=s.events))for(r in delete o.handle,o.events={},l)for(i=0,n=l[r].length;i<n;i++)Pt.event.add(e,r,l[r][i]);ye.hasData(t)&&(a=ye.access(t),h=Pt.extend({},a),ye.set(e,h))}}function ei(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Ee.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function ii(t,e,i,n){e=It.apply([],e);var r,s,o,a,h,l,c=0,u=t.length,f=u-1,d=e[0],p=Nt(d);if(p||u>1&&"string"==typeof d&&!Ft.checkClone&&Ke.test(d))return t.each((function(r){var s=t.eq(r);p&&(e[0]=d.call(this,r,s.html())),ii(s,e,i,n)}));if(u&&(s=(r=Oe(e,t[0].ownerDocument,!1,t,n)).firstChild,1===r.childNodes.length&&(r=s),s||n)){for(a=(o=Pt.map(Fe(r,"script"),Je)).length;c<u;c++)h=r,c!==f&&(h=Pt.clone(h,!0,!0),a&&Pt.merge(o,Fe(h,"script"))),i.call(t[c],h,c);if(a)for(l=o[o.length-1].ownerDocument,Pt.map(o,Qe),c=0;c<a;c++)h=o[c],Be.test(h.type||"")&&!be.access(h,"globalEval")&&Pt.contains(l,h)&&(h.src&&"module"!==(h.type||"").toLowerCase()?Pt._evalUrl&&Pt._evalUrl(h.src):$t(h.textContent.replace(Ye,""),l,h))}return t}function ni(t,e,i){for(var n,r=e?Pt.filter(e,t):t,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||Pt.cleanData(Fe(n)),n.parentNode&&(i&&Pt.contains(n.ownerDocument,n)&&Ne(Fe(n,"script")),n.parentNode.removeChild(n));return t}Pt.extend({htmlPrefilter:function(t){return t.replace(qe,"<$1></$2>")},clone:function(t,e,i){var n,r,s,o,a=t.cloneNode(!0),h=Pt.contains(t.ownerDocument,t);if(!(Ft.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||Pt.isXMLDoc(t)))for(o=Fe(a),n=0,r=(s=Fe(t)).length;n<r;n++)ei(s[n],o[n]);if(e)if(i)for(s=s||Fe(t),o=o||Fe(a),n=0,r=s.length;n<r;n++)ti(s[n],o[n]);else ti(t,a);return(o=Fe(a,"script")).length>0&&Ne(o,!h&&Fe(t,"script")),a},cleanData:function(t){for(var e,i,n,r=Pt.event.special,s=0;void 0!==(i=t[s]);s++)if(me(i)){if(e=i[be.expando]){if(e.events)for(n in e.events)r[n]?Pt.event.remove(i,n):Pt.removeEvent(i,n,e.handle);i[be.expando]=void 0}i[ye.expando]&&(i[ye.expando]=void 0)}}}),Pt.fn.extend({detach:function(t){return ni(this,t,!0)},remove:function(t){return ni(this,t)},text:function(t){return ue(this,(function(t){return void 0===t?Pt.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return ii(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Xe(this,t).appendChild(t)}))},prepend:function(){return ii(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Xe(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return ii(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return ii(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(Pt.cleanData(Fe(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return Pt.clone(this,t,e)}))},html:function(t){return ue(this,(function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Ze.test(t)&&!ze[(Ae.exec(t)||["",""])[1].toLowerCase()]){t=Pt.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(Pt.cleanData(Fe(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return ii(this,arguments,(function(e){var i=this.parentNode;Pt.inArray(this,t)<0&&(Pt.cleanData(Fe(this)),i&&i.replaceChild(e,this))}),t)}}),Pt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){Pt.fn[t]=function(t){for(var i,n=[],r=Pt(t),s=r.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(!0),Pt(r[o])[e](i),Dt.apply(n,i.get());return this.pushStack(n)}}));var ri=new RegExp("^("+Se+")(?!px)[a-z%]+$","i"),si=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=window),e.getComputedStyle(t)},oi=new RegExp(Te.join("|"),"i");function ai(t,e,i){var n,r,s,o,a=t.style;return(i=i||si(t))&&(""!==(o=i.getPropertyValue(e)||i[e])||Pt.contains(t.ownerDocument,t)||(o=Pt.style(t,e)),!Ft.pixelBoxStyles()&&ri.test(o)&&oi.test(e)&&(n=a.width,r=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=r,a.maxWidth=s)),void 0!==o?o+"":o}function hi(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(h){a.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",$e.appendChild(a).appendChild(h);var t=window.getComputedStyle(h);i="1%"!==t.top,o=12===e(t.marginLeft),h.style.right="60%",s=36===e(t.right),n=36===e(t.width),h.style.position="absolute",r=36===h.offsetWidth||"absolute",$e.removeChild(a),h=null}}function e(t){return Math.round(parseFloat(t))}var i,n,r,s,o,a=kt.createElement("div"),h=kt.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",Ft.clearCloneStyle="content-box"===h.style.backgroundClip,Pt.extend(Ft,{boxSizingReliable:function(){return t(),n},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),o},scrollboxSize:function(){return t(),r}}))}();var li,ci,ui=/^(none|table(?!-c[ea]).+)/,fi=/^--/,di={position:"absolute",visibility:"hidden",display:"block"},pi={letterSpacing:"0",fontWeight:"400"},gi=["Webkit","Moz","ms"],mi=kt.createElement("div").style;function wi(t){var e=Pt.cssProps[t];return e||(e=Pt.cssProps[t]=function(t){if(t in mi)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=gi.length;i--;)if((t=gi[i]+e)in mi)return t}(t)||t),e}function bi(t,e,i){var n=ke.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function yi(t,e,i,n,r,s){var o="width"===e?1:0,a=0,h=0;if(i===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(h+=Pt.css(t,i+Te[o],!0,r)),n?("content"===i&&(h-=Pt.css(t,"padding"+Te[o],!0,r)),"margin"!==i&&(h-=Pt.css(t,"border"+Te[o]+"Width",!0,r))):(h+=Pt.css(t,"padding"+Te[o],!0,r),"padding"!==i?h+=Pt.css(t,"border"+Te[o]+"Width",!0,r):a+=Pt.css(t,"border"+Te[o]+"Width",!0,r));return!n&&s>=0&&(h+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-h-a-.5))),h}function vi(t,e,i){var n=si(t),r=ai(t,e,n),s="border-box"===Pt.css(t,"boxSizing",!1,n),o=s;if(ri.test(r)){if(!i)return r;r="auto"}return o=o&&(Ft.boxSizingReliable()||r===t.style[e]),("auto"===r||!parseFloat(r)&&"inline"===Pt.css(t,"display",!1,n))&&(r=t["offset"+e[0].toUpperCase()+e.slice(1)],o=!0),(r=parseFloat(r)||0)+yi(t,e,i||(s?"border":"content"),o,n,r)+"px"}Pt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=ai(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,s,o,a=ge(e),h=fi.test(e),l=t.style;if(h||(e=wi(a)),o=Pt.cssHooks[e]||Pt.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(r=o.get(t,!1,n))?r:l[e];"string"===(s=typeof i)&&(r=ke.exec(i))&&r[1]&&(i=function(t,e,i,n){var r,s,o=20,a=n?function(){return n.cur()}:function(){return Pt.css(t,e,"")},h=a(),l=i&&i[3]||(Pt.cssNumber[e]?"":"px"),c=(Pt.cssNumber[e]||"px"!==l&&+h)&&ke.exec(Pt.css(t,e));if(c&&c[3]!==l){for(h/=2,l=l||c[3],c=+h||1;o--;)Pt.style(t,e,c+l),(1-s)*(1-(s=a()/h||.5))<=0&&(o=0),c/=s;c*=2,Pt.style(t,e,c+l),i=i||[]}return i&&(c=+c||+h||0,r=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=l,n.start=c,n.end=r)),r}(t,e,r),s="number"),null!=i&&i==i&&("number"===s&&(i+=r&&r[3]||(Pt.cssNumber[a]?"":"px")),Ft.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(h?l.setProperty(e,i):l[e]=i))}},css:function(t,e,i,n){var r,s,o,a=ge(e);return fi.test(e)||(e=wi(a)),(o=Pt.cssHooks[e]||Pt.cssHooks[a])&&"get"in o&&(r=o.get(t,!0,i)),void 0===r&&(r=ai(t,e,n)),"normal"===r&&e in pi&&(r=pi[e]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),Pt.each(["height","width"],(function(t,e){Pt.cssHooks[e]={get:function(t,i,n){if(i)return!ui.test(Pt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?vi(t,e,n):Ie(t,di,(function(){return vi(t,e,n)}))},set:function(t,i,n){var r,s=si(t),o="border-box"===Pt.css(t,"boxSizing",!1,s),a=n&&yi(t,e,n,o,s);return o&&Ft.scrollboxSize()===s.position&&(a-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-yi(t,e,"border",!1,s)-.5)),a&&(r=ke.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=Pt.css(t,e)),bi(0,i,a)}}})),Pt.cssHooks.marginLeft=hi(Ft.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(ai(t,"marginLeft"))||t.getBoundingClientRect().left-Ie(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),Pt.each({margin:"",padding:"",border:"Width"},(function(t,e){Pt.cssHooks[t+e]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+Te[n]+e]=s[n]||s[n-2]||s[0];return r}},"margin"!==t&&(Pt.cssHooks[t+e].set=bi)})),Pt.fn.extend({css:function(t,e){return ue(this,(function(t,e,i){var n,r,s={},o=0;if(Array.isArray(e)){for(n=si(t),r=e.length;o<r;o++)s[e[o]]=Pt.css(t,e[o],!1,n);return s}return void 0!==i?Pt.style(t,e,i):Pt.css(t,e)}),t,e,arguments.length>1)}}),Pt.fn.delay=function(t,e){return t=Pt.fx&&Pt.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,i){var n=window.setTimeout(e,t);i.stop=function(){window.clearTimeout(n)}}))},li=kt.createElement("input"),ci=kt.createElement("select").appendChild(kt.createElement("option")),li.type="checkbox",Ft.checkOn=""!==li.value,Ft.optSelected=ci.selected,(li=kt.createElement("input")).value="t",li.type="radio",Ft.radioValue="t"===li.value;var xi,Ci=Pt.expr.attrHandle;Pt.fn.extend({attr:function(t,e){return ue(this,Pt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){Pt.removeAttr(this,t)}))}}),Pt.extend({attr:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?Pt.prop(t,e,i):(1===s&&Pt.isXMLDoc(t)||(r=Pt.attrHooks[e.toLowerCase()]||(Pt.expr.match.bool.test(e)?xi:void 0)),void 0!==i?null===i?void Pt.removeAttr(t,e):r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:null==(n=Pt.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!Ft.radioValue&&"radio"===e&&Kt(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,r=e&&e.match(re);if(r&&1===t.nodeType)for(;i=r[n++];)t.removeAttribute(i)}}),xi={set:function(t,e,i){return!1===e?Pt.removeAttr(t,i):t.setAttribute(i,i),i}},Pt.each(Pt.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=Ci[e]||Pt.find.attr;Ci[e]=function(t,e,n){var r,s,o=e.toLowerCase();return n||(s=Ci[o],Ci[o]=r,r=null!=i(t,e,n)?o:null,Ci[o]=s),r}}));var Si=/^(?:input|select|textarea|button)$/i,ki=/^(?:a|area)$/i;function Ti(t){return(t.match(re)||[]).join(" ")}function Ri(t){return t.getAttribute&&t.getAttribute("class")||""}function Ii(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(re)||[]}Pt.fn.extend({prop:function(t,e){return ue(this,Pt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[Pt.propFix[t]||t]}))}}),Pt.extend({prop:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&Pt.isXMLDoc(t)||(e=Pt.propFix[e]||e,r=Pt.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=Pt.find.attr(t,"tabindex");return e?parseInt(e,10):Si.test(t.nodeName)||ki.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Ft.optSelected||(Pt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),Pt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){Pt.propFix[this.toLowerCase()]=this})),Pt.fn.extend({addClass:function(t){var e,i,n,r,s,o,a,h=0;if(Nt(t))return this.each((function(e){Pt(this).addClass(t.call(this,e,Ri(this)))}));if((e=Ii(t)).length)for(;i=this[h++];)if(r=Ri(i),n=1===i.nodeType&&" "+Ti(r)+" "){for(o=0;s=e[o++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");r!==(a=Ti(n))&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,r,s,o,a,h=0;if(Nt(t))return this.each((function(e){Pt(this).removeClass(t.call(this,e,Ri(this)))}));if(!arguments.length)return this.attr("class","");if((e=Ii(t)).length)for(;i=this[h++];)if(r=Ri(i),n=1===i.nodeType&&" "+Ti(r)+" "){for(o=0;s=e[o++];)for(;n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");r!==(a=Ti(n))&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t,n="string"===i||Array.isArray(t);return"boolean"==typeof e&&n?e?this.addClass(t):this.removeClass(t):Nt(t)?this.each((function(i){Pt(this).toggleClass(t.call(this,i,Ri(this),e),e)})):this.each((function(){var e,r,s,o;if(n)for(r=0,s=Pt(this),o=Ii(t);e=o[r++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||((e=Ri(this))&&be.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":be.get(this,"__className__")||""))}))},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+Ti(Ri(i))+" ").indexOf(e)>-1)return!0;return!1}});var Di=/\r/g;Pt.fn.extend({val:function(t){var e,i,n,r=this[0];return arguments.length?(n=Nt(t),this.each((function(i){var r;1===this.nodeType&&(null==(r=n?t.call(this,i,Pt(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=Pt.map(r,(function(t){return null==t?"":t+""}))),(e=Pt.valHooks[this.type]||Pt.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))}))):r?(e=Pt.valHooks[r.type]||Pt.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(Di,""):null==i?"":i:void 0}}),Pt.extend({valHooks:{option:{get:function(t){var e=Pt.find.attr(t,"value");return null!=e?e:Ti(Pt.text(t))}},select:{get:function(t){var e,i,n,r=t.options,s=t.selectedIndex,o="select-one"===t.type,a=o?null:[],h=o?s+1:r.length;for(n=s<0?h:o?s:0;n<h;n++)if(((i=r[n]).selected||n===s)&&!i.disabled&&(!i.parentNode.disabled||!Kt(i.parentNode,"optgroup"))){if(e=Pt(i).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var i,n,r=t.options,s=Pt.makeArray(e),o=r.length;o--;)((n=r[o]).selected=Pt.inArray(Pt.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),Pt.each(["radio","checkbox"],(function(){Pt.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=Pt.inArray(Pt(t).val(),e)>-1}},Ft.checkOn||(Pt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),Ft.focusin="onfocusin"in window;var Mi=/^(?:focusinfocus|focusoutblur)$/,Li=function(t){t.stopPropagation()};Pt.extend(Pt.event,{trigger:function(t,e,i,n){var r,s,o,a,h,l,c,u,f=[i||kt],d=At.call(t,"type")?t.type:t,p=At.call(t,"namespace")?t.namespace.split("."):[];if(s=u=o=i=i||kt,3!==i.nodeType&&8!==i.nodeType&&!Mi.test(d+Pt.event.triggered)&&(d.indexOf(".")>-1&&(p=d.split("."),d=p.shift(),p.sort()),h=d.indexOf(":")<0&&"on"+d,(t=t[Pt.expando]?t:new Pt.Event(d,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=p.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),e=null==e?[t]:Pt.makeArray(e,[t]),c=Pt.event.special[d]||{},n||!c.trigger||!1!==c.trigger.apply(i,e))){if(!n&&!c.noBubble&&!_t(i)){for(a=c.delegateType||d,Mi.test(a+d)||(s=s.parentNode);s;s=s.parentNode)f.push(s),o=s;o===(i.ownerDocument||kt)&&f.push(o.defaultView||o.parentWindow||window)}for(r=0;(s=f[r++])&&!t.isPropagationStopped();)u=s,t.type=r>1?a:c.bindType||d,(l=(be.get(s,"events")||{})[t.type]&&be.get(s,"handle"))&&l.apply(s,e),(l=h&&s[h])&&l.apply&&me(s)&&(t.result=l.apply(s,e),!1===t.result&&t.preventDefault());return t.type=d,n||t.isDefaultPrevented()||c._default&&!1!==c._default.apply(f.pop(),e)||!me(i)||h&&Nt(i[d])&&!_t(i)&&((o=i[h])&&(i[h]=null),Pt.event.triggered=d,t.isPropagationStopped()&&u.addEventListener(d,Li),i[d](),t.isPropagationStopped()&&u.removeEventListener(d,Li),Pt.event.triggered=void 0,o&&(i[h]=o)),t.result}},simulate:function(t,e,i){var n=Pt.extend(new Pt.Event,i,{type:t,isSimulated:!0});Pt.event.trigger(n,null,e)}}),Pt.fn.extend({trigger:function(t,e){return this.each((function(){Pt.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return Pt.event.trigger(t,e,i,!0)}}),Ft.focusin||Pt.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){Pt.event.simulate(e,t.target,Pt.event.fix(t))};Pt.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=be.access(n,e);r||n.addEventListener(t,i,!0),be.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=be.access(n,e)-1;r?be.access(n,e,r):(n.removeEventListener(t,i,!0),be.remove(n,e))}}}));var Ei,Ai=/\[\]$/,Bi=/\r?\n/g,zi=/^(?:submit|button|image|reset|file)$/i,Fi=/^(?:input|select|textarea|keygen)/i;function Ni(t,e,i,n){var r;if(Array.isArray(e))Pt.each(e,(function(e,r){i||Ai.test(t)?n(t,r):Ni(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,i,n)}));else if(i||"object"!==Ut(e))n(t,e);else for(r in e)Ni(t+"["+r+"]",e[r],i,n)}Pt.param=function(t,e){var i,n=[],r=function(t,e){var i=Nt(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(t)||t.jquery&&!Pt.isPlainObject(t))Pt.each(t,(function(){r(this.name,this.value)}));else for(i in t)Ni(i,t[i],e,r);return n.join("&")},Pt.fn.extend({serialize:function(){return Pt.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=Pt.prop(this,"elements");return t?Pt.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!Pt(this).is(":disabled")&&Fi.test(this.nodeName)&&!zi.test(t)&&(this.checked||!Ee.test(t))})).map((function(t,e){var i=Pt(this).val();return null==i?null:Array.isArray(i)?Pt.map(i,(function(t){return{name:e.name,value:t.replace(Bi,"\r\n")}})):{name:e.name,value:i.replace(Bi,"\r\n")}})).get()}}),Pt.fn.extend({wrapAll:function(t){var e;return this[0]&&(Nt(t)&&(t=t.call(this[0])),e=Pt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return Nt(t)?this.each((function(e){Pt(this).wrapInner(t.call(this,e))})):this.each((function(){var e=Pt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=Nt(t);return this.each((function(i){Pt(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){Pt(this).replaceWith(this.childNodes)})),this}}),Pt.expr.pseudos.hidden=function(t){return!Pt.expr.pseudos.visible(t)},Pt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},Ft.createHTMLDocument=((Ei=kt.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ei.childNodes.length),Pt.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(Ft.createHTMLDocument?((n=(e=kt.implementation.createHTMLDocument("")).createElement("base")).href=kt.location.href,e.head.appendChild(n)):e=kt),s=!i&&[],(r=Yt.exec(t))?[e.createElement(r[1])]:(r=Oe([t],e,s),s&&s.length&&Pt(s).remove(),Pt.merge([],r.childNodes)));var n,r,s},Pt.offset={setOffset:function(t,e,i){var n,r,s,o,a,h,l=Pt.css(t,"position"),c=Pt(t),u={};"static"===l&&(t.style.position="relative"),a=c.offset(),s=Pt.css(t,"top"),h=Pt.css(t,"left"),("absolute"===l||"fixed"===l)&&(s+h).indexOf("auto")>-1?(o=(n=c.position()).top,r=n.left):(o=parseFloat(s)||0,r=parseFloat(h)||0),Nt(e)&&(e=e.call(t,i,Pt.extend({},a))),null!=e.top&&(u.top=e.top-a.top+o),null!=e.left&&(u.left=e.left-a.left+r),"using"in e?e.using.call(t,u):c.css(u)}},Pt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){Pt.offset.setOffset(this,t,e)}));var e,i,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,n=this[0],r={top:0,left:0};if("fixed"===Pt.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===Pt.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((r=Pt(t).offset()).top+=Pt.css(t,"borderTopWidth",!0),r.left+=Pt.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-Pt.css(n,"marginTop",!0),left:e.left-r.left-Pt.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===Pt.css(t,"position");)t=t.offsetParent;return t||$e}))}}),Pt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;Pt.fn[t]=function(n){return ue(this,(function(t,n,r){var s;if(_t(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===r)return s?s[e]:t[n];s?s.scrollTo(i?s.pageXOffset:r,i?r:s.pageYOffset):t[n]=r}),t,n,arguments.length)}})),Pt.each(["top","left"],(function(t,e){Pt.cssHooks[e]=hi(Ft.pixelPosition,(function(t,i){if(i)return i=ai(t,e),ri.test(i)?Pt(t).position()[e]+"px":i}))})),Pt.each({Height:"height",Width:"width"},(function(t,e){Pt.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,n){Pt.fn[n]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(!0===r||!0===s?"margin":"border");return ue(this,(function(e,i,r){var s;return _t(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===r?Pt.css(e,i,a):Pt.style(e,i,r,a)}),e,o?r:void 0,o)}}))})),Pt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){Pt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}})),Pt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),Pt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),Pt.proxy=function(t,e){var i,n,r;if("string"==typeof e&&(i=t[e],e=t,t=i),Nt(t))return n=Rt.call(arguments,2),r=function(){return t.apply(e||this,n.concat(Rt.call(arguments)))},r.guid=t.guid=t.guid||Pt.guid++,r},Pt.holdReady=function(t){t?Pt.readyWait++:Pt.ready(!0)},Pt.isArray=Array.isArray,Pt.parseJSON=JSON.parse,Pt.nodeName=Kt,Pt.isFunction=Nt,Pt.isWindow=_t,Pt.camelCase=ge,Pt.type=Ut,Pt.now=Date.now,Pt.isNumeric=function(t){var e=Pt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))};const _i=Pt;function Oi(t){return!!t&&("function"!=typeof t&&(t instanceof File||void 0!==t.name&&"function"==typeof t.slice&&"function"==typeof t.arrayBuffer))}function $i(t){const e=new Set(["boolean","number","string","symbol"]),i=typeof t;return void 0!==t&&(e.has(i)||t.substring||t.toFixed)}function Ui(t,e){var i={oauthToken:t.oauthToken,headers:t.headers,withCredentials:t.withCredentials,filename:t.filename};return Object.assign(i,e)}function Hi(t){if(function(t){t.featureType&&(t.type=t.type||t.featureType,t.featureType=void 0);"junctions"===t.type?t.type="spliceJunctions":"bed"===t.type?(t.type="annotation",t.format=t.format||"bed"):"annotations"===t.type?t.type="annotation":"alignments"===t.type?t.type="alignment":"bam"===t.type?(t.type="alignment",t.format="bam"):"vcf"===t.type?(t.type="variant",t.format="vcf"):"t2d"===t.type?t.type="gwas":"FusionJuncSpan"!==t.type||t.format?"aed"===t.type&&(t.type="annotation",t.format=t.format||"aed"):t.format="fusionjuncspan"}(t),t.type)return t.type;let e;if("file"===t.sourceType||void 0===t.sourceType&&t.url)if(void 0===t.format){e=w(Oi(t.url)?t.url.name:t.url)}else e=t.format.toLowerCase();if(e)switch(e){case"bw":case"bigwig":case"wig":case"bedgraph":case"tdf":return"wig";case"vcf":return"variant";case"seg":return"seg";case"bam":case"cram":return"alignment";case"bedpe":case"bedpe-loop":return"interaction";case"bp":return"arc";case"gwas":return"gwas";case"bed":case"bigbed":case"bb":return"bedtype";default:return"annotation"}}function Pi(t,e){if(t.length<6)console.log("Skipping line: "+t.join(" "));else{var i={chr1:t[0],start1:Number.parseInt(t[1]),end1:Number.parseInt(t[2]),chr2:t[3],start2:Number.parseInt(t[4]),end2:Number.parseInt(t[5])};if(!(isNaN(i.start1)||isNaN(i.end1)||isNaN(i.start2)||isNaN(i.end2))){if(t.length>6&&"."!==t[6]&&(i.name=t[6]),t.length>7&&"."!==t[7]&&(i.score=parseFloat(t[7])),t.length>8&&"."!==t[8]&&(i.strand1=t[8]),t.length>9&&"."!==t[9]&&(i.strand2=t[9]),e){const n=e.colorColumn;n&&n<t.length&&(i.color=V.createColorString(t[n]));const r=e.thicknessColumn;r&&r<t.length&&(i.thickness=t[r]),t.length>10&&e.columnNames&&e.columnNames.length===t.length&&(i.extras=t.slice(10))}return i.chr1===i.chr2&&(i.chr=i.chr1,i.start=Math.min(i.start1,i.start2),i.end=Math.max(i.end1,i.end2)),i}}}function Vi(t,e){if(!(t.length<8))return{chr:t[0],start:Number.parseInt(t[1]),end:Number.parseInt(t[2]),color:V.createColorString(t[6]),value:Number.parseFloat(t[7])}}function Wi(t,e){if(!(t.length<6))return{chr:t[0],start:t[1],end:t[2],chr1:t[8],start1:Number.parseInt(t[9]),end1:Number.parseInt(t[10]),chr2:t[13],start2:Number.parseInt(t[14]),end2:Number.parseInt(t[15]),name:t[3],score:Number.parseFloat(t[4]),value:Number.parseFloat(t[5]),color:"."===t[7]?void 0:"0"===t[7]?"rgb(0,0,0)":t[7]};console.log("Skipping line: "+t.join(" "))}const Gi=["Name","gene_name","gene","gene_id","alias","locus","name"];function ji(t,e){var i,n,r,s,o,a,h,l,c,u,f=e.format;if(t.length<9)return null;i=t[0],o=t[2],n=parseInt(t[3])-1,r=parseInt(t[4]),a="."===t[5]?0:parseFloat(t[5]),s=t[6],"."!==t[7]&&parseInt(t[7]);var d="gff3"===f?"=":/\s+/,p=qi(h=t[8],d);for(let[t,e]of Object.entries(p)){const i=t.toLowerCase();if("color"===i||"colour"===i)l=V.createColorString(e);else if("gff3"===f)try{p[t]=unescape(e)}catch(i){p[t]=e,console.error(`Malformed gff3 attibute value: ${e}`)}}if(e.nameField)c=p[e.nameField];else for(u=0;u<Gi.length;u++)if(p.hasOwnProperty(Gi[u])){e.nameField=Gi[u],c=p[e.nameField];break}return{id:p.ID||p.transcript_id,parent:p.Parent,name:c,type:o,chr:i,start:n,end:r,score:a,strand:s,color:l,attributeString:h,delim:d,popupData:Zi}}function qi(t,e){var i={};for(let n of t.split(";")){const t=n.trim().split(e,2);if(2===t.length){const e=t[0].trim();let n=t[1].trim();n.startsWith('"')&&n.endsWith('"')&&(n=n.substr(1,n.length-2)),i[e]=n}}return i}function Zi(t){const e=this.attributeString.split(";"),i=[];this.name&&i.push({name:"name:",value:this.name}),i.push({name:"type:",value:this.type});for(let t of e){const e=t.trim().split(this.delim,2);if(2===e.length&&void 0!==e[1]){const t=e[0].trim();if("name"===t.toLowerCase())continue;let n=e[1].trim();n.startsWith('"')&&n.endsWith('"')&&(n=n.substr(1,n.length-2)),i.push({name:t+":",value:n})}}return i.push({name:"position:",value:`${this.chr}:${u(this.start+1)}-${u(this.end)}`}),i}function Ki(t,e){if(t.length<3)return;e&&e.gffTags;const i=t[0],n=parseInt(t[1]),r=t.length>2?parseInt(t[2]):n+1;if(isNaN(n)||isNaN(r))throw Error(`Unparsable bed record: ${t.join("\t")}`);const s={chr:i,start:n,end:r,score:1e3};try{if(t.length>3){if(t[3].indexOf(";")>0&&t[3].indexOf("=")>0){const e=qi(t[3],"=");for(let t of Gi)if(e.hasOwnProperty(t)){s.name=e[t],delete e[t];break}s.attributes=e}s.name||(s.name="."===t[3]?"":t[3])}if(t.length>4&&(s.score="."===t[4]?0:parseFloat(t[4]),isNaN(s.score)))return s;if(t.length>5&&(s.strand=t[5],"."!==s.strand&&"+"!==s.strand&&"-"!==s.strand))return s;if(t.length>6&&(s.cdStart=parseInt(t[6]),isNaN(s.cdStart)))return s;if(t.length>7&&(s.cdEnd=parseInt(t[7]),isNaN(s.cdEnd)))return s;if(t.length>8&&"."!==t[8]&&"0"!==t[8]&&(s.color=V.createColorString(t[8])),t.length>11){const e=parseInt(t[9]);if(e>1e3)return s;const i=t[10].replace(/,$/,"").split(","),r=t[11].replace(/,$/,"").split(",");if(i.length!==r.length||e!==i.length)return s;const o=[];for(let t=0;t<e;t++){const e=n+parseInt(r[t]),s=e+parseInt(i[t]);o.push({start:e,end:s})}tn(o,s.cdStart,s.cdEnd),s.exons=o}if(e){let i=e.thicknessColumn,n=e.colorColumn;n&&n<t.length&&(s.color=V.createColorString(t[n])),i&&i<t.length&&(s.thickness=t[i])}}catch(t){}return s}function Yi(t,e){if(t.length<=15)return;return{swScore:Number.parseInt(t[1]),milliDiv:Number.parseInt(t[2]),milliDel:Number.parseInt(t[3]),milliIns:Number.parseInt(t[4]),chr:t[5],start:Number.parseInt(t[6]),end:Number.parseInt(t[7]),strand:t[9],repName:t[10],repClass:t[11],repFamily:t[12],repStart:Number.parseInt(t[13]),repEnd:Number.parseInt(t[14]),repLeft:Number.parseInt(t[15])}}function Xi(t,e){var i=void 0===e.shift?0:1;if(t.length<=9+i)return;const n=parseInt(t[5+i]),r=parseInt(t[6+i]);var s={name:t[0+i],chr:t[1+i],strand:t[2+i],start:parseInt(t[3+i]),end:parseInt(t[4+i]),cdStart:n,cdEnd:r,id:t[0+i]},o=parseInt(t[7+i]),a=t[8+i].split(","),h=t[9+i].split(","),l=[];for(let t=0;t<o;t++){const e=parseInt(a[t]),i=parseInt(h[t]);l.push({start:e,end:i})}return tn(l,n,r),s.exons=l,s}function Ji(t,e){var i=void 0===e.shift?0:1;if(t.length<=11+i)return;const n=parseInt(t[5+i]),r=parseInt(t[6+i]),s={name:t[11+i],chr:t[1+i],strand:t[2+i],start:parseInt(t[3+i]),end:parseInt(t[4+i]),cdStart:n,cdEnd:r,id:t[0+i]},o=parseInt(t[7+i]),a=t[8+i].split(","),h=t[9+i].split(","),l=[];for(let t=0;t<o;t++){const e=parseInt(a[t]),i=parseInt(h[t]);l.push({start:e,end:i})}return tn(l,n,r),s.exons=l,s}function Qi(t,e){var i=void 0===e.shift?0:1;if(t.length<=10+i)return;const n=parseInt(t[6+i]),r=parseInt(t[7+i]);var s={name:t[0+i],id:t[1+i],chr:t[2+i],strand:t[3+i],start:parseInt(t[4+i]),end:parseInt(t[5+i]),cdStart:n,cdEnd:r},o=parseInt(t[8+i]),a=t[9+i].split(","),h=t[10+i].split(","),l=[];for(let t=0;t<o;t++){const e=parseInt(a[t]),i=parseInt(h[t]);l.push({start:e,end:i})}return tn(l,n,r),s.exons=l,s}function tn(t,e,i){for(let n of t){const t=n.end,r=n.start;t<e||r>i?n.utr=!0:(e>=r&&e<=t&&(n.cdStart=e),i>=r&&i<=t&&(n.cdEnd=i))}}function en(t,e){var i,n,r,s,o,a,h;if(!(t.length<9))return i=t[0],n=parseInt(t[1]),r=parseInt(t[2]),o=t[3],a=parseFloat(t[4]),s=t[5].trim(),h=parseFloat(t[6]),0===a&&(a=h),{chr:i,start:n,end:r,name:o,score:a,strand:s,signal:h,pValue:parseFloat(t[7]),qValue:parseFloat(t[8])}}function nn(t,e){if(t.length<=3)return;const i={chr:t[0],start:parseInt(t[1]),end:parseInt(t[2]),value:parseFloat(t[3])};if(e){let n=e.colorColumn;n&&n<t.length&&(i.color=V.createColorString(t[n]))}return i}function rn(t,e){const i=e.wig;if(i&&"fixedStep"===i.format){const e=i.index*i.step+i.start,n=e+i.span,r=parseFloat(t[0]);return++i.index,isNaN(r)?null:{chr:i.chrom,start:e,end:n,value:r}}if(i&&"variableStep"===i.format){if(t.length<2)return null;const e=parseInt(t[0],10)-1,n=e+i.span,r=parseFloat(t[1]);return isNaN(r)?null:{chr:i.chrom,start:e,end:n,value:r}}return nn(t)}function sn(t,e){if(t.length<6)return;const i=["bin","chr","start","end","name","score","strand","refNCBI","refUCSC","observed","molType","class","valid","avHet","avHetSE","func","locType","weight","exceptions","submitterCount","submitters","alleleFreqCount","alleles","alleleNs","alleleFreqs","bitfields"],n={chr:t[1],start:Number.parseInt(t[2]),end:Number.parseInt(t[3]),name:t[4],score:Number.parseInt(t[5])},r=Math.min(t.length,i.length);for(let e=6;e<r;e++)n[i[e]]=t[e];return n}class on{constructor(t){this.config=t,this.header={},t.nameField&&(this.header.nameField=t.nameField),this.skipRows=0,t.decode?(this.decode=t.decode,this.delimiter=t.delimiter||"\t"):t.format&&(this.header.format=t.format.toLowerCase(),this.setDecoder(this.header.format)),this.delimiter||(this.delimiter="\t")}async parseHeader(t){let e,i,n=this.header;for(;void 0!==(i=await t.nextLine());)if(i.startsWith("track")||i.startsWith("#track")){let t=an(i);Object.assign(n,t)}else if(i.startsWith("browser"));else if(i.startsWith("#columns")){let t=hn(i);Object.assign(n,t)}else if(i.startsWith("##gff-version 3"))n.format="gff3";else if(i.startsWith("#gffTags"))n.gffTags=!0;else{if(i.startsWith("fixedStep")||i.startsWith("variableStep"))break;if(i.startsWith("#")){const t=i.split(this.delimiter||"\t");t.length>1&&(e=t)}else{this.setDecoder(n.format);try{const t=i.split(this.delimiter||"\t"),r=Object.assign({columnNames:e},n);if(this.decode(t,r))break;t.length>1&&(e=t)}catch(t){}}}if(e){n.columnNames=e;for(let t=0;t<e.length;t++)"color"===e[t]||"colour"===e[t]?n.colorColumn=t:"thickness"===e[t]&&(n.thicknessColumn=t)}return this.header=n,n}async parseFeatures(t){const e=[],i=this.decode,n=this.header.format,r=this.delimiter||"\t";let s,o=0;for(;void 0!==(s=await t.nextLine());){if(o++,o<=this.skipRows)continue;if(!s||s.startsWith("track")||s.startsWith("#")||s.startsWith("browser"))continue;if("wig"===n&&s.startsWith("fixedStep")){this.header.wig=ln(s);continue}if("wig"===n&&s.startsWith("variableStep")){this.header.wig=cn(s);continue}const t=s.split(r);if(t.length<1)continue;const a=i(t,this.header);a&&e.push(a)}return i===Pi&&function(t){if(0==t.length)return;const e=t[0];if(void 0===e.score&&void 0!==e.name){for(let e of t)if(!("number"==typeof(i=e.name)?i-i==0:"string"==typeof i&&""!==i.trim()&&(Number.isFinite?Number.isFinite(+i):isFinite(+i)))&&"."!==e.name)return;for(let e of t)e.score=parseFloat(e.name),delete e.name}var i;const n=t.filter((t=>t.chr1!==t.chr2));for(let e of n){const i=Object.assign({},e);i.dup=!0,t.push(i),e.chr=e.chr1,e.start=e.start1,e.end=e.end1,i.chr=i.chr2,i.start=i.start2,i.end=i.end2}}(e),e}setDecoder(t){switch(t){case"narrowpeak":case"broadpeak":case"regionpeak":case"peaks":this.decode=en,this.delimiter=this.config.delimiter||/\s+/;break;case"bedgraph":this.decode=nn,this.delimiter=/\s+/;break;case"wig":this.decode=rn,this.delimiter=this.config.delimiter||/\s+/;break;case"gff3":case"gff":case"gtf":this.decode=ji,this.delimiter="\t";break;case"fusionjuncspan":this.decode=decodeFusionJuncSpan,this.delimiter=this.config.delimiter||/\s+/;break;case"gtexgwas":this.skipRows=1,this.decode=decodeGtexGWAS,this.delimiter="\t";break;case"refflat":this.decode=Qi,this.delimiter=this.config.delimiter||/\s+/;break;case"genepred":this.decode=Xi,this.delimiter=this.config.delimiter||/\s+/;break;case"genepredext":this.decode=Ji,this.delimiter=this.config.delimiter||/\s+/;break;case"ensgene":this.decode=Xi,this.header.shift=1,this.delimiter=this.config.delimiter||/\s+/;break;case"refgene":this.decode=Ji,this.delimiter=this.config.delimiter||/\s+/,this.header.shift=1;break;case"bed":this.decode=Ki,this.delimiter=this.config.delimiter||/\s+/;break;case"bedpe":this.decode=Pi,this.delimiter=this.config.delimiter||"\t";break;case"bedpe-domain":this.decode=Vi,this.headerLine=!0,this.delimiter=this.config.delimiter||"\t";break;case"bedpe-loop":this.decode=Pi,this.delimiter=this.config.delimiter||"\t",this.header={colorColumn:7};break;case"interact":this.decode=Wi,this.delimiter=this.config.delimiter||/\s+/;break;case"snp":this.decode=sn,this.delimiter="\t";break;case"rmsk":this.decode=Yi,this.delimiter="\t";break;case"gcnv":this.decode=decodeGcnv,this.delimiter="\t";break;default:const e=function(t){return g&&g[t]?function(t){const e=t.fields,i=["chr","start","end"];for(let n=0;n<e.length;n++)for(let r of i)r===e[n]&&(t[r]=n);return t}(g[t]):void 0}(t);void 0!==e?(this.decode=decodeCustom,this.header.customFormat=e,this.delimiter=e.delimiter||"\t"):(this.decode=Ki,this.delimiter=this.config.delimiter||/\s+/)}}}function an(t){const e={},i=t.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g);let n;const r=[];for(let t of i)t&&0!==t.trim().length&&(t.endsWith("=")?n=t:n?(r.push(n+t),n=void 0):r.push(t));for(let t of r){if(!t)return;var s=t.split("=",2);if(2===s.length){const t=s[0].trim(),i=s[1].trim();if(e.hasOwnProperty(t)){let n=e[t];Array.isArray(n)?n.push(i):e[t]=[n,i]}else e[t]=i}}return"interact"==e.type?e.format="interact":"gcnv"===e.type&&(e.format="gcnv"),e}function hn(t){let e={},i=t.split(/\s+/);if(2===i.length){i[1].split(";").forEach((function(t){let i=t.split("=");"color"===i[0]?e.colorColumn=Number.parseInt(i[1])-1:"thickness"===i[0]&&(e.thicknessColumn=Number.parseInt(i[1])-1)}))}return e}function ln(t){const e=t.split(/\s+/);return{format:"fixedStep",chrom:e[1].split("=")[1],start:parseInt(e[2].split("=")[1],10)-1,step:parseInt(e[3].split("=")[1],10),span:e.length>4?parseInt(e[4].split("=")[1],10):1,index:0}}function cn(t){const e=t.split(/\s+/);return{format:"variableStep",chrom:e[1].split("=")[1],span:e.length>2?parseInt(e[2].split("=")[1],10):1}}class un{constructor(t,e){t.displayMode&&(t.displayMode=t.displayMode.toUpperCase()),this.config=t,this.browser=e,this.url=t.url,this.type=t.type,this.description=t.description,this.supportHiDPI=void 0===t.supportHiDPI||t.supportHiDPI,t.name||t.label?this.name=t.name||t.label:Oi(t.url)?this.name=t.url.name:this.name=t.url,this.id=void 0===this.config.id?this.name:this.config.id,this.order=t.order,this.color=t.color,this.altColor=t.altColor,"civic-ws"===t.sourceType?this.defaultColor="rgb(155,20,20)":this.defaultColor="rgb(0,0,150)",this.autoscaleGroup=t.autoscaleGroup,this.removable=void 0===t.removable||t.removable,this.height=t.height||100,this.autoHeight=t.autoHeight,this.minHeight=t.minHeight||Math.min(25,this.height),this.maxHeight=t.maxHeight||Math.max(1e3,this.height),this.visibilityWindow=t.visibilityWindow}getState(){const t={};for(let e of Object.keys(this.config))e.startsWith("_")||(t[e]=this.config[e]);for(let e of Object.keys(t)){if(e.startsWith("_"))continue;const i=this[e];i&&($i(i)||"boolean"==typeof i)&&(t[e]=i)}this.color&&(t.color=this.color),this.altColor&&(t.altColor=this.altColor),!this.autoscale&&this.dataRange&&(void 0!==t.min&&null!==t.min&&(t.min=this.dataRange.min),void 0!==t.max&&null!==t.max&&(t.max=this.dataRange.max));for(let e of Object.keys(t)){if("function"==typeof t[e])throw Error(`Property '${e}' of track '${this.name} is a function. Functions cannot be saved in sessions.`);if(t[e]instanceof File)throw Error(`Property '${e}' of track '${this.name} is a local File. Local file references cannot be saved in sessions.`);if(t[e]instanceof Promise)throw Error(`Property '${e}' of track '${this.name} is a Promise. Promises cannot be saved in sessions.`)}let e=Object.keys(t);for(let i of e)void 0===t[i]&&delete t[i];return t}supportsWholeGenome(){return!1}getGenomeId(){return this.browser.genome?this.browser.genome.id:void 0}setTrackProperties(t){const e={};let i;for(let n of Object.keys(t))switch(n.toLowerCase()){case"usescore":e.useScore=1===t[n]||"1"===t[n]||"on"===t[n]||!0===t[n];break;case"visibility":switch(t[n]){case"2":case"3":case"pack":case"full":e.displayMode="EXPANDED";break;case"4":case"squish":e.displayMode="SQUISHED";break;case"1":case"dense":e.displayMode="COLLAPSED"}break;case"color":case"altcolor":e[n]=t[n].startsWith("rgb(")?t[n]:"rgb("+t[n]+")";break;case"featurevisiblitywindow":case"visibilitywindow":e.visibilityWindow=Number.parseInt(t[n]);break;case"maxheightpixels":i=t[n].split(":"),3===i.length&&(e.minHeight=Number.parseInt(i[2]),e.height=Number.parseInt(i[1]),e.maxHeight=Number.parseInt(i[0]));break;case"viewlimits":if(!this.config.autoscale){i=t[n].split(":");let r,s=0;1==i.length?r=Number.parseFloat(i[0]):2==i.length&&(s=Number.parseFloat(i[0]),r=Number.parseFloat(i[1])),e.autoscale=!1,e.dataRange={min:s,max:r}}case"name":e[n]=t[n]}for(let t of Object.keys(e))this.config.hasOwnProperty(t)||(this[t]=e[t])}getVisibilityWindow(){return this.visibilityWindow}clickedFeatures(t){const e=t.viewport.getCachedFeatures();if(!e||0===e.length)return[];const i=t.genomicLocation,n=t.referenceFrame.bpPerPixel>.2?3*t.referenceFrame.bpPerPixel:0,r=Math.floor(i)-n,s=Math.floor(i)+n;return Ct(e,r,s)}static extractPopupData(t,e){const i=new Set(["row","color","chr","start","end","cdStart","cdEnd","strand","alpha"]),n=[];let r,s;for(var o in t)if(t.hasOwnProperty(o)&&!i.has(o)&&$i(t[o])){let e=t[o];n.push({name:(a=o,a.length>0?a.charAt(0).toUpperCase()+a.slice(1):a),value:e}),"alleles"===o?r=t[o]:"alleleFreqs"===o&&(s=t[o])}var a;if(r&&s){r.endsWith(",")&&(r=r.substr(0,r.length-1)),s.endsWith(",")&&(s=s.substr(0,s.length-1));let i=r.split(","),o=s.split(",");if(o.length>1){let r=[];for(let t=0;t<o.length;t++)r.push({a:i[t],af:Number.parseFloat(o[t])});r.sort((function(t,e){return t.af-e.af}));let s=r[r.length-1].a;if(1===s.length)for(let i=r.length-2;i>=0;i--){let o=r[i].a;if(1===o.length){const i=un.getCravatLink(t.chr,t.start+1,s,o,e);i&&(n.push("<hr/>"),n.push(i))}}}}if(t.attributes)for(let e of Object.keys(t.attributes))n.push({name:e,value:t.attributes[e]});let h=`${t.chr}:${u(t.start+1)}-${u(t.end)}`;return t.strand&&(h+=` (${t.strand})`),n.push("<hr>"),n.push(h),n}static getCravatLink(t,e,i,n,r){if("hg38"===r||"GRCh38"===r){return`<a target="_blank" href="https://run.opencravat.org/result/nocache/variant.html?chrom=${t.startsWith("chr")?t:"chr"+t}&pos=${e}&ref_base=${i}&alt_base=${n}">Cravat ${i}->${n}</a>`}}}const fn=new Set(["A","C","T","G"].map((t=>t.charCodeAt(0))));function dn(t){return new pn(t)}class pn{constructor(t){this.chr=t[0],this.pos=parseInt(t[1]),this.names=t[2],this.referenceBases=t[3],this.alternateBases=t[4],this.quality=t[5],this.filter=t[6],this.info=function(t){var e={};t&&t.split(";").forEach((function(t){var i=t.split("=");e[i[0]]=i[1]}));return e}(t[7]),this.init()}init(){const t=this.referenceBases,e=this.alternateBases;if(this.info&&(this.info.VT?this.type=this.info.VT:this.info.SVTYPE?this.type="SV":this.info.PERIOD&&(this.type="STR")),void 0===this.type&&(this.type=function(t,e){const i=t.length;if(void 0===e)return"UNKNOWN";if(0===e.trim().length||"<NON_REF>"===e||"<*>"===e||"."===e)return"NONVARIANT";{const t=e.split(",").map((function(t){return 1===i&&1===t.length?"SNP":"<NON_REF>"===t?"NONVARIANT":"OTHER"}));let n=t[0];for(let e of t)if(e!==n)return"MIXED";return n}}(t,e)),"NONVARIANT"===this.type&&(this.heterozygosity=0),this.info.END)this.start=this.pos-1,this.info.CHR2&&this.info.CHR2!==this.chr?this.end=this.start+1:this.end=Number.parseInt(this.info.END);else if("NONVARIANT"===this.type)this.start=this.pos-1,this.end=this.start+t.length;else{const i=e.split(",").filter((t=>t.length>0));this.alleles=[],this.start=void 0,this.end=void 0;for(let e of i)if(this.alleles.push(e),"SV"!==this.type&&gn(e)){let i=e.length,n=t.length,r=0;for(t.charCodeAt(0)===e.charCodeAt(0)&&(r++,i--,n--);i>0&&n>0;){const s=r+i-1,o=r+n-1;if(e.charCodeAt(s)!==t.charCodeAt(o))break;i--,n--}for(;i>0&&n>0;){const s=r,o=r;if(e.charCodeAt(s)!==t.charCodeAt(o))break;r++,i--,n--}const s=this.pos+r-1,o=s+n;this.start=void 0===this.start?s:Math.min(this.start,s),this.end=void 0===this.end?o:Math.max(this.end,o)}void 0===this.start&&(this.start=this.pos-1,this.end=this.pos)}}popupData(t,e){var i,n,r=this;const s=this.end===this.pos?this.pos:`${this.pos}-${this.end}`;if(i=[{name:"Chr",value:this.chr},{name:"Pos",value:s},{name:"Names",value:this.names?this.names:""},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases.replace("<","&lt;")},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter}],"SNP"===this.type){let t=this.referenceBases;if(1===t.length){let n=this.alternateBases.split(",");for(let r of n)if(1===r.length){let n=un.getCravatLink(this.chr,this.pos,t,r,e);n&&(i.push("<hr/>"),i.push(n))}}}return this.hasOwnProperty("heterozygosity")&&i.push({name:"Heterozygosity",value:this.heterozygosity}),this.info&&(i.push("<hr>"),Object.keys(this.info).forEach((function(t){i.push({name:t,value:mn(r.info[t])})}))),this.calls&&1===this.calls.length&&(i.push("<hr>"),n=this.alleles[this.calls[0].genotype[0]]+this.alleles[this.calls[0].genotype[1]],i.push({name:"Genotype",value:n})),i}isRefBlock(){return"NONVARIANT"===this.type}}function gn(t){for(let e=0;e<t.length;e++)if(!fn.has(t.charCodeAt(e)))return!1;return!0}function mn(t,e){return void 0===e&&(e=","),Array.isArray(t)?t.join(e):t}class wn{construtor(){}async parseHeader(t){const e={};let i=await t.nextLine();if(!i.startsWith("##fileformat"))throw new Error("Invalid VCF file: missing fileformat line");for(e.version=i.substr(13);void 0!==(i=await t.nextLine())&&i.startsWith("#");){let t;const r={};if(i.startsWith("##")){if(i.startsWith("##INFO")||i.startsWith("##FILTER")||i.startsWith("##FORMAT")){const s=i.indexOf("<"),o=i.lastIndexOf(">");if(!(s>2&&o>0)){console.log("Malformed VCF header line: "+i);continue}const a=i.substring(2,s-1);e[a]||(e[a]={});const h=d(i.substring(s+1,o-1),",");for(let e of h){var n=e.split("=");n.length>1&&("ID"===n[0]?t=n[1]:r[n[0]]=n[1])}t&&(e[a][t]=r)}}else if(i.startsWith("#CHROM")){const t=i.split("\t");if(t.length>8){e.callSets=[];for(let i=9;i<t.length;i++)e.callSets.push({id:i,name:t[i]})}}}return this.header=e,e}async parseFeatures(t){const e=[],i=this.header.callSets,n=8+(i?i.length+1:0);let r;for(;void 0!==(r=await t.nextLine());)if(r&&!r.startsWith("#")){const t=r.split("\t");if(t.length===n){const n=dn(t);if(n.header=this.header,e.push(n),t.length>9){const e=bn(t[8].split(":"));n.calls={};for(let r=9;r<t.length;r++){const a=t[r];var s=i[r-9],o={callSetName:s.name,info:{}};n.calls[s.id]=o,a.split(":").forEach((function(t,i){if(i===e.genotypeIndex)o.genotype=[],t.split(/[\|\/]/).forEach((function(t){o.genotype.push("."===t?t:parseInt(t))}));else o.info[e.fields[i]]=t}))}}}}return e}}function bn(t){const e={genotypeIndex:-1,fields:t};for(let i=0;i<t.length;i++)"GT"===t[i]&&(e.genotypeIndex=i);return e}var yn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},vn=function(t){return t&&t.Math==Math&&t},xn=vn("object"==typeof globalThis&&globalThis)||vn("object"==typeof window&&window)||vn("object"==typeof self&&self)||vn("object"==typeof yn&&yn)||function(){return this}()||Function("return this")(),Cn=function(t){try{return!!t()}catch(t){return!0}},Sn=!Cn((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),kn=Sn,Tn=Function.prototype.call,Rn=kn?Tn.bind(Tn):function(){return Tn.apply(Tn,arguments)},In="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Dn=!Cn((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Mn=function(t){return"function"==typeof t},Ln=Mn,En=function(t){return"object"==typeof t?null!==t:Ln(t)},An=Sn,Bn=Function.prototype,zn=Bn.bind,Fn=Bn.call,Nn=An&&zn.bind(Fn,Fn),_n=An?function(t){return t&&Nn(t)}:function(t){return t&&function(){return Fn.apply(t,arguments)}},On=xn.TypeError,$n=function(t){if(null==t)throw On("Can't call method on "+t);return t},Un=xn.Object,Hn=function(t){return Un($n(t))},Pn=Hn,Vn=_n({}.hasOwnProperty),Wn=Object.hasOwn||function(t,e){return Vn(Pn(t),e)},Gn={exports:{}},jn=xn,qn=Object.defineProperty,Zn=function(t,e){try{qn(jn,t,{value:e,configurable:!0,writable:!0})}catch(i){jn[t]=e}return e},Kn=Zn,Yn="__core-js_shared__",Xn=xn[Yn]||Kn(Yn,{}),Jn=Xn;(Gn.exports=function(t,e){return Jn[t]||(Jn[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.1",mode:"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qn,tr,er=_n,ir=0,nr=Math.random(),rr=er(1..toString),sr=function(t){return"Symbol("+(void 0===t?"":t)+")_"+rr(++ir+nr,36)},or=xn,ar=Mn,hr=function(t){return ar(t)?t:void 0},lr=function(t,e){return arguments.length<2?hr(or[t]):or[t]&&or[t][e]},cr=xn,ur=lr("navigator","userAgent")||"",fr=cr.process,dr=cr.Deno,pr=fr&&fr.versions||dr&&dr.version,gr=pr&&pr.v8;gr&&(tr=(Qn=gr.split("."))[0]>0&&Qn[0]<4?1:+(Qn[0]+Qn[1])),!tr&&ur&&(!(Qn=ur.match(/Edge\/(\d+)/))||Qn[1]>=74)&&(Qn=ur.match(/Chrome\/(\d+)/))&&(tr=+Qn[1]);var mr=tr,wr=Cn,br=!!Object.getOwnPropertySymbols&&!wr((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&mr&&mr<41})),yr=br&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,vr=xn,xr=Gn.exports,Cr=Wn,Sr=sr,kr=br,Tr=yr,Rr=xr("wks"),Ir=vr.Symbol,Dr=Ir&&Ir.for,Mr=Tr?Ir:Ir&&Ir.withoutSetter||Sr,Lr=function(t){if(!Cr(Rr,t)||!kr&&"string"!=typeof Rr[t]){var e="Symbol."+t;kr&&Cr(Ir,t)?Rr[t]=Ir[t]:Rr[t]=Tr&&Dr?Dr(e):Mr(e)}return Rr[t]},Er={};Er[Lr("toStringTag")]="z";var Ar="[object z]"===String(Er),Br=_n,zr=Br({}.toString),Fr=Br("".slice),Nr=xn,_r=Ar,Or=Mn,$r=function(t){return Fr(zr(t),8,-1)},Ur=Lr("toStringTag"),Hr=Nr.Object,Pr="Arguments"==$r(function(){return arguments}()),Vr=_r?$r:function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Hr(t),Ur))?i:Pr?$r(e):"Object"==(n=$r(e))&&Or(e.callee)?"Arguments":n},Wr=xn.String,Gr=function(t){try{return Wr(t)}catch(t){return"Object"}},jr={},qr=En,Zr=xn.document,Kr=qr(Zr)&&qr(Zr.createElement),Yr=function(t){return Kr?Zr.createElement(t):{}},Xr=!Dn&&!Cn((function(){return 7!=Object.defineProperty(Yr("div"),"a",{get:function(){return 7}}).a})),Jr=Dn&&Cn((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Qr=xn,ts=En,es=Qr.String,is=Qr.TypeError,ns=function(t){if(ts(t))return t;throw is(es(t)+" is not an object")},rs=_n({}.isPrototypeOf),ss=lr,os=Mn,as=rs,hs=yr,ls=xn.Object,cs=hs?function(t){return"symbol"==typeof t}:function(t){var e=ss("Symbol");return os(e)&&as(e.prototype,ls(t))},us=Mn,fs=Gr,ds=xn.TypeError,ps=function(t){if(us(t))return t;throw ds(fs(t)+" is not a function")},gs=Rn,ms=Mn,ws=En,bs=xn.TypeError,ys=Rn,vs=En,xs=cs,Cs=function(t,e){var i=t[e];return null==i?void 0:ps(i)},Ss=function(t,e){var i,n;if("string"===e&&ms(i=t.toString)&&!ws(n=gs(i,t)))return n;if(ms(i=t.valueOf)&&!ws(n=gs(i,t)))return n;if("string"!==e&&ms(i=t.toString)&&!ws(n=gs(i,t)))return n;throw bs("Can't convert object to primitive value")},ks=Lr,Ts=xn.TypeError,Rs=ks("toPrimitive"),Is=function(t,e){if(!vs(t)||xs(t))return t;var i,n=Cs(t,Rs);if(n){if(void 0===e&&(e="default"),i=ys(n,t,e),!vs(i)||xs(i))return i;throw Ts("Can't convert object to primitive value")}return void 0===e&&(e="number"),Ss(t,e)},Ds=cs,Ms=Dn,Ls=Xr,Es=Jr,As=ns,Bs=function(t){var e=Is(t,"string");return Ds(e)?e:e+""},zs=xn.TypeError,Fs=Object.defineProperty,Ns=Object.getOwnPropertyDescriptor,_s="enumerable",Os="configurable",$s="writable";jr.f=Ms?Es?function(t,e,i){if(As(t),e=Bs(e),As(i),"function"==typeof t&&"prototype"===e&&"value"in i&&$s in i&&!i.writable){var n=Ns(t,e);n&&n.writable&&(t[e]=i.value,i={configurable:Os in i?i.configurable:n.configurable,enumerable:_s in i?i.enumerable:n.enumerable,writable:!1})}return Fs(t,e,i)}:Fs:function(t,e,i){if(As(t),e=Bs(e),As(i),Ls)try{return Fs(t,e,i)}catch(t){}if("get"in i||"set"in i)throw zs("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var Us=jr,Hs=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Ps=Dn?function(t,e,i){return Us.f(t,e,Hs(1,i))}:function(t,e,i){return t[e]=i,t},Vs={exports:{}},Ws=Mn,Gs=Xn,js=_n(Function.toString);Ws(Gs.inspectSource)||(Gs.inspectSource=function(t){return js(t)});var qs,Zs,Ks,Ys=Gs.inspectSource,Xs=Mn,Js=Ys,Qs=xn.WeakMap,to=Xs(Qs)&&/native code/.test(Js(Qs)),eo=Gn.exports,io=sr,no=eo("keys"),ro=function(t){return no[t]||(no[t]=io(t))},so=to,oo=xn,ao=_n,ho=En,lo=Ps,co=Wn,uo=Xn,fo=ro,po={},go="Object already initialized",mo=oo.TypeError,wo=oo.WeakMap;if(so||uo.state){var bo=uo.state||(uo.state=new wo),yo=ao(bo.get),vo=ao(bo.has),xo=ao(bo.set);qs=function(t,e){if(vo(bo,t))throw new mo(go);return e.facade=t,xo(bo,t,e),e},Zs=function(t){return yo(bo,t)||{}},Ks=function(t){return vo(bo,t)}}else{var Co=fo("state");po[Co]=!0,qs=function(t,e){if(co(t,Co))throw new mo(go);return e.facade=t,lo(t,Co,e),e},Zs=function(t){return co(t,Co)?t[Co]:{}},Ks=function(t){return co(t,Co)}}var So={set:qs,get:Zs,has:Ks,enforce:function(t){return Ks(t)?Zs(t):qs(t,{})},getterFor:function(t){return function(e){var i;if(!ho(e)||(i=Zs(e)).type!==t)throw mo("Incompatible receiver, "+t+" required");return i}}},ko=Dn,To=Wn,Ro=Function.prototype,Io=ko&&Object.getOwnPropertyDescriptor,Do=To(Ro,"name"),Mo=Do&&"something"===function(){}.name,Lo=Do&&(!ko||ko&&Io(Ro,"name").configurable),Eo=xn,Ao=Mn,Bo=Wn,zo=Ps,Fo=Zn,No=Ys,_o={EXISTS:Do,PROPER:Mo,CONFIGURABLE:Lo}.CONFIGURABLE,Oo=So.get,$o=So.enforce,Uo=String(String).split("String");(Vs.exports=function(t,e,i,n){var r,s=!!n&&!!n.unsafe,o=!!n&&!!n.enumerable,a=!!n&&!!n.noTargetGet,h=n&&void 0!==n.name?n.name:e;Ao(i)&&("Symbol("===String(h).slice(0,7)&&(h="["+String(h).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Bo(i,"name")||_o&&i.name!==h)&&zo(i,"name",h),(r=$o(i)).source||(r.source=Uo.join("string"==typeof h?h:""))),t!==Eo?(s?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=i:zo(t,e,i)):o?t[e]=i:Fo(e,i)})(Function.prototype,"toString",(function(){return Ao(this)&&Oo(this).source||No(this)}));var Ho,Po,Vo,Wo=!Cn((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Go=xn,jo=Wn,qo=Mn,Zo=Hn,Ko=Wo,Yo=ro("IE_PROTO"),Xo=Go.Object,Jo=Xo.prototype,Qo=Ko?Xo.getPrototypeOf:function(t){var e=Zo(t);if(jo(e,Yo))return e[Yo];var i=e.constructor;return qo(i)&&e instanceof i?i.prototype:e instanceof Xo?Jo:null},ta=xn,ea=Mn,ia=ta.String,na=ta.TypeError,ra=_n,sa=ns,oa=function(t){if("object"==typeof t||ea(t))return t;throw na("Can't set "+ia(t)+" as a prototype")},aa=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=ra(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(i,[]),e=i instanceof Array}catch(t){}return function(i,n){return sa(i),oa(n),e?t(i,n):i.__proto__=n,i}}():void 0),ha=In,la=Dn,ca=xn,ua=Mn,fa=En,da=Wn,pa=Vr,ga=Gr,ma=Ps,wa=Vs.exports,ba=jr.f,ya=rs,va=Qo,xa=aa,Ca=Lr,Sa=sr,ka=ca.Int8Array,Ta=ka&&ka.prototype,Ra=ca.Uint8ClampedArray,Ia=Ra&&Ra.prototype,Da=ka&&va(ka),Ma=Ta&&va(Ta),La=Object.prototype,Ea=ca.TypeError,Aa=Ca("toStringTag"),Ba=Sa("TYPED_ARRAY_TAG"),za=Sa("TYPED_ARRAY_CONSTRUCTOR"),Fa=ha&&!!xa&&"Opera"!==pa(ca.opera),Na=!1,_a={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Oa={BigInt64Array:8,BigUint64Array:8},$a=function(t){if(!fa(t))return!1;var e=pa(t);return da(_a,e)||da(Oa,e)};for(Ho in _a)(Vo=(Po=ca[Ho])&&Po.prototype)?ma(Vo,za,Po):Fa=!1;for(Ho in Oa)(Vo=(Po=ca[Ho])&&Po.prototype)&&ma(Vo,za,Po);if((!Fa||!ua(Da)||Da===Function.prototype)&&(Da=function(){throw Ea("Incorrect invocation")},Fa))for(Ho in _a)ca[Ho]&&xa(ca[Ho],Da);if((!Fa||!Ma||Ma===La)&&(Ma=Da.prototype,Fa))for(Ho in _a)ca[Ho]&&xa(ca[Ho].prototype,Ma);if(Fa&&va(Ia)!==Ma&&xa(Ia,Ma),la&&!da(Ma,Aa))for(Ho in Na=!0,ba(Ma,Aa,{get:function(){return fa(this)?this[Ba]:void 0}}),_a)ca[Ho]&&ma(ca[Ho],Ba,Ho);var Ua={NATIVE_ARRAY_BUFFER_VIEWS:Fa,TYPED_ARRAY_CONSTRUCTOR:za,TYPED_ARRAY_TAG:Na&&Ba,aTypedArray:function(t){if($a(t))return t;throw Ea("Target is not a typed array")},aTypedArrayConstructor:function(t){if(ua(t)&&(!xa||ya(Da,t)))return t;throw Ea(ga(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,i,n){if(la){if(i)for(var r in _a){var s=ca[r];if(s&&da(s.prototype,t))try{delete s.prototype[t]}catch(i){try{s.prototype[t]=e}catch(t){}}}Ma[t]&&!i||wa(Ma,t,i?e:Fa&&Ta[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,i){var n,r;if(la){if(xa){if(i)for(n in _a)if((r=ca[n])&&da(r,t))try{delete r[t]}catch(t){}if(Da[t]&&!i)return;try{return wa(Da,t,i?e:Fa&&Da[t]||e)}catch(t){}}for(n in _a)!(r=ca[n])||r[t]&&!i||wa(r,t,e)}},isView:function(t){if(!fa(t))return!1;var e=pa(t);return"DataView"===e||da(_a,e)||da(Oa,e)},isTypedArray:$a,TypedArray:Da,TypedArrayPrototype:Ma},Ha=Math.ceil,Pa=Math.floor,Va=function(t){var e=+t;return e!=e||0===e?0:(e>0?Pa:Ha)(e)},Wa=Va,Ga=Math.min,ja=function(t){return t>0?Ga(Wa(t),9007199254740991):0},qa=Va,Za=xn.RangeError,Ka=function(t){var e=qa(t);if(e<0)throw Za("The argument can't be less than 0");return e},Ya=xn.RangeError,Xa=xn,Ja=Rn,Qa=Ua,th=function(t){return ja(t.length)},eh=function(t,e){var i=Ka(t);if(i%e)throw Ya("Wrong offset");return i},ih=Hn,nh=Cn,rh=Xa.RangeError,sh=Xa.Int8Array,oh=sh&&sh.prototype,ah=oh&&oh.set,hh=Qa.aTypedArray,lh=Qa.exportTypedArrayMethod,ch=!nh((function(){var t=new Uint8ClampedArray(2);return Ja(ah,t,{length:1,0:3},1),3!==t[1]})),uh=ch&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&nh((function(){var t=new sh(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));lh("set",(function(t){hh(this);var e=eh(arguments.length>1?arguments[1]:void 0,1),i=ih(t);if(ch)return Ja(ah,this,i,e);var n=this.length,r=th(i),s=0;if(r+e>n)throw rh("Wrong length");for(;s<r;)this[e+s]=i[s++]}),!ch||uh);class fh{constructor(t,e){this.littleEndian=void 0===e||e,this.position=0,this.view=t,this.length=t.byteLength}available(){return this.length-this.position}remLength(){return this.length-this.position}hasNext(){return this.position<this.length-1}getByte(){var t=this.view.getUint8(this.position,this.littleEndian);return this.position++,t}getShort(){var t=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,t}getUShort(){var t=this.view.getUint16(this.position,this.littleEndian);return this.position+=2,t}getInt(){var t=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,t}getUInt(){var t=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,t}getLong(){var t=[];t[0]=this.view.getUint8(this.position),t[1]=this.view.getUint8(this.position+1),t[2]=this.view.getUint8(this.position+2),t[3]=this.view.getUint8(this.position+3),t[4]=this.view.getUint8(this.position+4),t[5]=this.view.getUint8(this.position+5),t[6]=this.view.getUint8(this.position+6),t[7]=this.view.getUint8(this.position+7);var e=0;if(this.littleEndian)for(let i=t.length-1;i>=0;i--)e=256*e+t[i];else for(let i=0;i<t.length;i++)e=256*e+t[i];return this.position+=8,e}getString(t){for(var e,i="";0!==(e=this.view.getUint8(this.position++))&&(i+=String.fromCharCode(e),!t||i.length!==t););return i}getFixedLengthString(t){var e,i,n="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>0&&(n+=String.fromCharCode(i));return n}getFixedLengthTrimmedString(t){var e,i,n="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>32&&(n+=String.fromCharCode(i));return n}getFloat(){var t=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,t}getDouble(){var t=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,t}skip(t){return this.position+=t,this.position}getVPointer(){var t=this.position,e=this.view.getUint8(t+1)<<8|this.view.getUint8(t),i=4294967296*(255&this.view.getUint8(t+6))+16777216*(255&this.view.getUint8(t+5))+65536*(255&this.view.getUint8(t+4))+256*(255&this.view.getUint8(t+3))+(255&this.view.getUint8(t+2));return this.position+=8,new dh(i,e)}}class dh{constructor(t,e){this.block=t,this.offset=e}isLessThan(t){return this.block<t.block||this.block===t.block&&this.offset<t.offset}isGreaterThan(t){return this.block>t.block||this.block===t.block&&this.offset>t.offset}print(){return this.block+":"+this.offset}}class ph{constructor(t){this.tabix=!0}parse(t,e){const i=new fh(new DataView(t)),n=i.getInt();if(21582659!==n)throw 38359875===n?Error("CSI version 2 is not supported.  Please enter an issue at https://github.com/igvteam/igv.js"):Error("Not a CSI index");this.indices=[],this.blockMin=Number.MAX_SAFE_INTEGER,this.blockMax=0,this.sequenceIndexMap={},this.minShift=i.getInt(),this.depth=i.getInt();if(i.getInt()>=28){i.getInt(),i.getInt(),i.getInt(),i.getInt(),i.getInt(),i.getInt();const t=i.getInt(),n=i.position+t;let r=0;for(;i.position<n;){let t=i.getString();e&&(t=e.getChromosomeName(t)),this.sequenceIndexMap[t]=r,r++}}const r=this.bin_limit()+1,s=i.getInt();for(let t=0;t<s;t++){const e=[],n=[],s=i.getInt();for(let t=0;t<s;t++){const t=i.getInt();if(n[t]=i.getVPointer(),t>r)i.getInt(),i.getVPointer(),i.getVPointer(),i.getLong(),i.getLong();else{e[t]=[];const n=i.getInt();for(let r=0;r<n;r++){const n=i.getVPointer(),r=i.getVPointer();n&&r&&(n.block<this.blockMin&&(this.blockMin=n.block),r.block>this.blockMax&&(this.blockMax=r.block),e[t].push([n,r]))}}}s>0&&(this.indices[t]={binIndex:e,loffset:n})}}blocksForRange(t,e,i){const n=this.indices[t];if(n){const t=this.reg2bins(e,i);if(0==t.length)return[];const r=[];for(let e of t)for(let t=e[0];t<=e[1];t++)if(n.binIndex[t]){const e=n.binIndex[t],i=e.length;for(let n=0;n<i;++n){const i=e[n][0],s=e[n][1];r.push({minv:i,maxv:s,bin:t})}}return function(t,e){const i=[];let n=null;return 0===t.length?t:(t.sort((function(t,e){const i=t.minv.block-e.minv.block;return 0!==i?i:t.minv.offset-e.minv.offset})),t.forEach((function(t){var r,s;!e||t.maxv.isGreaterThan(e)?null===n?(i.push(t),n=t):(r=n,(s=t).minv.block-r.maxv.block<65e3&&s.maxv.block-r.minv.block<5e6?t.maxv.isGreaterThan(n.maxv)&&(n.maxv=t.maxv):(i.push(t),n=t)):console.log(`skipping chunk ${t.minv.block} - ${t.maxv.block}`)})),i)}(r,n.loffset[t[0]])}return[]}reg2bins(t,e){(t-=1)<1&&(t=1),e>2**50&&(e=2**34),e-=1;let i=0,n=0,r=this.minShift+3*this.depth;const s=[];for(;i<=this.depth;r-=3,n+=1<<3*i,i+=1){const i=n+(t>>r),o=n+(e>>r);if(o-i+s.length>this.maxBinNumber)throw new Error(`query ${t}-${e} is too large for current binning scheme (shift ${this.minShift}, depth ${this.depth}), try a smaller query or a coarser index binning scheme`);s.push([i,o])}return s}bin_limit(){return((1<<3*(this.depth+1))-1)/7}}async function gh(t,e,i){const n=[];let r=Number.MAX_SAFE_INTEGER,s=0;const o=new fh(new DataView(t)),a=o.getInt(),h={};if(!(21578050===a||e&&21578324===a))throw new Error(indexURL+" is not a "+(e?"tabix":"bai")+" file");{const t=o.getInt();if(e){o.getInt(),o.getInt(),o.getInt(),o.getInt(),o.getInt(),o.getInt(),o.getInt();for(let e=0;e<t;e++){let t=o.getString();i&&(t=i.getChromosomeName(t)),h[t]=e}}for(let e=0;e<t;e++){const t={},i=[],a=o.getInt();for(let e=0;e<a;e++){const e=o.getInt();if(37450===e)o.getInt(),o.getVPointer(),o.getVPointer(),o.getLong(),o.getLong();else{t[e]=[];const i=o.getInt();for(let n=0;n<i;n++){const i=o.getVPointer(),n=o.getVPointer();i&&n&&(i.block<r&&(r=i.block),n.block>s&&(s=n.block),t[e].push([i,n]))}}}const h=o.getInt();for(let t=0;t<h;t++){const t=o.getVPointer();i.push(t)}a>0&&(n[e]={binIndex:t,linearIndex:i})}}return new mh(n,r,s,h,e)}class mh{constructor(t,e,i,n,r){this.firstAlignmentBlock=e,this.lastAlignmentBlock=i,this.indices=t,this.sequenceIndexMap=n,this.tabix=r}blocksForRange(t,e,i){const n=this.indices[t];if(n){const t=function(t,e){const i=[];e>=1<<29&&(e=1<<29);return--e,i.push(0),i.push([1+(t>>26),1+(e>>26)]),i.push([9+(t>>23),9+(e>>23)]),i.push([73+(t>>20),73+(e>>20)]),i.push([585+(t>>17),585+(e>>17)]),i.push([4681+(t>>14),4681+(e>>14)]),i}(e,i),r=[];for(let e of t)for(let t=e[0];t<=e[1];t++)if(n.binIndex[t]){const e=n.binIndex[t],i=e.length;for(let n=0;n<i;++n){const i=e[n][0],s=e[n][1];r.push({minv:i,maxv:s,bin:t})}}const s=n.linearIndex.length;let o=null;const a=Math.min(e>>14,s-1),h=Math.min(i>>14,s-1);for(let t=a;t<=h;++t){const e=n.linearIndex[t];e&&(o&&!e.isLessThan(o)||(o=e))}return function(t,e){const i=[];let n=null;return 0===t.length?t:(t.sort((function(t,e){const i=t.minv.block-e.minv.block;return 0!==i?i:t.minv.offset-e.minv.offset})),t.forEach((function(t){var r,s;!e||t.maxv.isGreaterThan(e)?null===n?(i.push(t),n=t):(r=n,(s=t).minv.block-r.maxv.block<65e3&&s.maxv.block-r.minv.block<5e6?t.maxv.isGreaterThan(n.maxv)&&(n.maxv=t.maxv):(i.push(t),n=t)):console.log(`skipping chunk ${t.minv.block} - ${t.maxv.block}`)})),i)}(r,o)}return[]}}class wh{constructor(t){this.chrIndex=t}blocksForRange(t,e,i){const n=this.chrIndex[t];if(n){const t=n.blocks,r=n.longestFeature,s=n.binWidth,o=Math.max(e-r,0),a=Math.floor(o/s);if(a>=t.length)return[];{const e=Math.min(Math.floor((i-1)/s),t.length-1),n=t[a].min,r=t[e].max;if(0===r-n)return[];return[{minv:{block:n,offset:0},maxv:{block:r,offset:0}}]}}}}async function bh(t,e,i){let n=await nt.loadArrayBuffer(t,Ui(e)),r=new DataView(n);if(31===r.getUint8(0)&&139===r.getUint8(1)){n=new a.Gunzip(new Uint8Array(n)).decompress().buffer,r=new DataView(n)}switch(r.getInt32(0,!0)){case 21578050:return async function(t,e){return gh(t,!1,e)}(n,i);case 21578324:return async function(t,e){return gh(t,!0,e)}(n,i);case 21582659:return async function(t,e){const i=new ph;return i.parse(t,e),i}(n,i);case 1480870228:return async function(t,e){const i={},n=new fh(new DataView(t));!function(t){t.getInt(),t.getInt();const e=t.getInt();if(t.getString(),t.getLong(),t.getLong(),t.getString(),t.getInt(),e>=3){let e=t.getInt();for(;e-- >0;)t.getString(),t.getString()}}(n);let r=n.getInt();for(;r-- >0;){const t=s(n);i[t.chr]=t}return new wh(i);function s(t){let i=t.getString();e&&(i=e.getChromosomeName(i));const n=t.getInt(),r=t.getInt(),s=t.getInt();t.getInt(),t.getInt();let o=t.getLong();const a=new Array;for(let e=0;e<r;e++){const e=t.getLong();a.push({min:o,max:e}),o=e}return{chr:i,blocks:a,longestFeature:s,binWidth:n}}}(n,i);case 38359875:throw Error("CSI version 2 is not supported.");default:throw Error(`Unrecognized index type: ${t}`)}}function yh(t){return"string"==typeof t||t instanceof String?new vh(t):new xh(t)}class vh{constructor(t){this.data=t,this.ptr=0}nextLine(){var t=this.ptr,e=this.data.indexOf("\n",t),i=this.data;if(e>0)return this.ptr=e+1,e>t&&"\r"===i.charAt(e-1)?i.substring(t,e-1):i.substring(t,e);var n=i.length;return this.ptr=n,t>=n?void 0:i.substring(t)}}class xh{constructor(t){this.data=t,this.length=this.data.length,this.ptr=0}nextLine(){var t,e;if(e="",!(this.ptr>=this.length)){for(var i=this.ptr;i<this.length;i++)if("\r"!==(t=String.fromCharCode(this.data[i]))){if("\n"===t)break;e+=t}return this.ptr=i+1,e}}}class Ch{constructor(t){this.config=t,this.filePtr=0,this.bufferPtr=0,this.buffer}async nextLine(){let t;try{for(;;){const e=this.buffer?this.buffer.length:0;for(;this.bufferPtr<e;){const e=String.fromCharCode(this.buffer[this.bufferPtr++]);if("\r"!==e){if("\n"===e)return t;t=t?t+e:e}}if(this.eof)return t;await this.readNextBlock()}}catch(e){return console.warn(e),this.eof=!0,t}}async readNextBlock(){const t=Ui(this.config,{range:{start:this.filePtr,size:26}}),e=N(await nt.loadArrayBuffer(this.config.url,t));if(0===e)this.eof=!0,this.buffer=void 0;else{const t=Ui(this.config,{range:{start:this.filePtr,size:e}}),i=await nt.loadArrayBuffer(this.config.url,t);i.byteLength<e&&(this.eof=!0),this.buffer=F(i),this.bufferPtr=0,this.filePtr+=i.byteLength}}}const Sh=c;class kh{constructor(t,e){var i;this.config=t||{},this.genome=e,this.indexURL=t.indexURL,this.indexed=t.indexed,Oi(this.config.url)?this.filename=this.config.url.name:Sh(this.config.url)&&this.config.url.startsWith("data:")?(this.indexed=!1,this.dataURI=t.url):(i=E(this.config.url),this.filename=t.filename||i.file),this.parser=this.getParser(this.config),"vcf"!==this.config.format||this.config.indexURL||console.warn("Warning: index file not specified.  The entire vcf file will be loaded.")}async readFeatures(t,e,i){return await this.getIndex()?(this.indexed=!0,this.loadFeaturesWithIndex(t,e,i)):this.dataURI?(this.indexed=!1,this.loadFeaturesFromDataURI()):(this.indexed=!1,this.loadFeaturesNoIndex())}async readHeader(){if(this.dataURI)return this.loadFeaturesFromDataURI(this.dataURI),this.header;if(this.config.indexURL){const t=await this.getIndex();if(!t)throw new Error("Unable to load index: "+this.config.indexURL);let e;if(t.tabix)e=new Ch(this.config);else{const i=Object.values(t.chrIndex).flatMap((t=>t.blocks)).map((t=>t.max)).reduce(((t,e)=>Math.min(t,e)),Number.MAX_SAFE_INTEGER),n=Ui(this.config,{bgz:t.tabix,range:{start:0,size:i}});e=yh(await nt.loadString(this.config.url,n))}return this.header=await this.parser.parseHeader(e),this.header}{const t=Ui(this.config),e=await nt.loadString(this.config.url,t);let i=yh(e);return this.header=await this.parser.parseHeader(i),i=yh(e),this.features=await this.parser.parseFeatures(i),this.header}}getParser(t){switch(t.format){case"vcf":return new wn(t);case"seg":return new SegParser;case"gwas":return new GWASParser(t);case"aed":return new AEDParser(t);default:return new on(t)}}async loadFeaturesNoIndex(){if(this.features){const t=this.features;return delete this.features,t}{const t=Ui(this.config),e=await nt.loadString(this.config.url,t);if(!this.header){const t=yh(e);this.header=await this.parser.parseHeader(t)}const i=yh(e);return await this.parser.parseFeatures(i)}}async loadFeaturesWithIndex(t,e,i){const n=this.config,r=this.parser,s=this.index.tabix,o=s?this.index.sequenceIndexMap[t]:t;if(void 0===o)return[];const a=this.genome,h=this.index.blocksForRange(o,e,i);if(h&&0!==h.length){const o=[];for(let l of h){const h=l.minv.block,c=l.minv.offset,u=l.maxv.offset;let f;if(s){let t=0;if(u>0){const e=Ui(n,{range:{start:l.maxv.block,size:26}});t=N(await nt.loadArrayBuffer(n.url,e))}f=l.maxv.block+t}else f=l.maxv.block;const d=Ui(n,{range:{start:h,size:f-h+1}});let p;if(s){p=F(await nt.loadArrayBuffer(n.url,d))}else p=await nt.loadString(n.url,d);const g=yh(c?p.slice(c):p),m=await r.parseFeatures(g);let w=!1;for(let n=0;n<m.length;n++){const r=m[n];if((a?a.getChromosomeName(r.chr):r.chr)!==t){if(0===o.length)continue;break}if(r.start>i){o.push(r);break}r.end>=e&&r.start<=i&&(w||(w=!0,n>0&&o.push(m[n-1])),o.push(r))}}return o.sort((function(t,e){return t.start-e.start})),o}return[]}async getIndex(){return this.index||!this.config.indexURL||(this.index=await this.loadIndex()),this.index}async loadIndex(){return bh(this.config.indexURL,this.config,this.genome)}async loadFeaturesFromDataURI(){if(this.features){const t=this.features;return delete this.features,t}{const t=L(this.dataURI);let e=yh(t);return this.header=await this.parser.parseHeader(e),this.header instanceof String&&this.header.startsWith("##gff-version 3")&&(this.format="gff3"),e=yh(t),this.features=await this.parser.parseFeatures(e),this.features}}}const Th=new Set(["transcript","primary_transcript","processed_transcript","mRNA","mrna"]),Rh=new Set(["CDS","cds"]),Ih=new Set(["start_codon","stop_codon"]),Dh=new Set(["5UTR","3UTR","UTR","five_prime_UTR","three_prime_UTR","3'-UTR","5'-UTR"]),Mh=new Set(["exon","coding-exon"]),Lh=new Set;for(let lf of[Th,Rh,Ih,Dh,Mh])for(let cf of lf)Lh.add(cf);class Eh{constructor(t){this.format=t.format,this.filterTypes=void 0===t.filterTypes?new Set(["chromosome"]):new Set(t.filterTypes)}combineFeatures(t){let e;if("gff3"===this.format){const i=this.combineFeaturesById(t);e=this.combineFeaturesGFF(i)}else e=this.combineFeaturesGTF(t);return e.sort((function(t,e){return t.start-e.start})),e}combineFeaturesById(t){const e=[],i={};for(let n of t)if(void 0===n.id)e.push(n);else{let t=i[n.chr];if(t||(t={},i[n.chr]=t),t.hasOwnProperty(n.id)){const e=t[n.id];if(e.hasOwnProperty("exons"))e.start=Math.min(e.start,n.start),e.end=Math.max(e.end,n.end),e.exons.push(n);else{const i={id:n.id,type:n.type,chr:n.chr,strand:n.strand,start:Math.min(n.start,e.start),end:Math.max(n.end,e.end),exons:[e,n]};n.parent&&""!==n.parent.trim()&&(i.parent=n.parent),t[n.id]=i}}else t[n.id]=n}for(let t of Object.keys(i)){const n=i[t];for(let t of Object.keys(n))e.push(n[t])}return e}combineFeaturesGTF(t){const e=Object.create(null),i=[],n=new Set,r=this.filterTypes;t=t.filter((t=>void 0===r||!r.has(t.type)));for(let r of t)if(Th.has(r.type)){const t=r.id;if(void 0!==t){const s=new Ah(r);e[t]=s,i.push(s),n.add(r)}}for(let r of t)if(Mh.has(r.type)){const t=r.id;if(t){let s=e[t];void 0===s&&(s=new Ah(r),e[t]=s,i.push(s)),s.addExon(r),n.add(r)}}for(let r of t)if(Rh.has(r.type)||Dh.has(r.type)||Ih.has(r.type)){const t=r.id;if(t){let s=e[t];void 0===s&&(s=new Ah(r),e[t]=s,i.push(s)),Dh.has(r.type)?s.addUTR(r):Rh.has(r.type)?s.addCDS(r):Ih.has(r.type),n.add(r)}}for(let t of i)"function"==typeof t.finish&&t.finish();const s=t.filter((t=>!n.has(t)));for(let t of s)i.push(t);return i}combineFeaturesGFF(t){const e=t.filter((t=>"gene"===t.type)),i=Object.create(null);for(let t of e)i[t.id]=t;const n=Object.create(null),r=[],s=new Set,o=this.filterTypes;t=t.filter((t=>void 0===o||!o.has(t.type)));for(let e of t)if(Th.has(e.type)){const t=e.id;if(void 0!==t){const o=new Ah(e);n[t]=o,r.push(o),s.add(e);const a=i[e.parent];a&&(o.gene=i[e.parent],s.add(a))}}for(let e of t)if(Mh.has(e.type)){const t=l(e);if(t)for(let i of t){let t=n[i];void 0!==t&&(t.addExon(e),s.add(e))}}for(let e of t)if(Rh.has(e.type)||Dh.has(e.type)||Ih.has(e.type)){const t=l(e);if(t)for(let i of t){let t=n[i];void 0!==t&&(Dh.has(e.type)?t.addUTR(e):Rh.has(e.type)?t.addCDS(e):Ih.has(e.type),s.add(e))}}const a=t.filter((t=>"intron"===t.type));for(let t of a){const e=l(t);for(let i of e)if(n[i]){s.add(t);break}}r.forEach((function(t){"function"==typeof t.finish&&t.finish()}));const h=t.filter((t=>!s.has(t)));for(let t of h)r.push(t);return r;function l(t){return t.parent&&""!==t.parent.trim()?t.parent.trim().split(","):null}}}var Ah=function(t){Object.assign(this,t),this.exons=[]};Ah.prototype.addExon=function(t){this.exons.push(t),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end)},Ah.prototype.addCDS=function(t){let e;const i=this.exons;for(let n=0;n<i.length;n++)if(i[n].start<=t.start&&i[n].end>=t.end){e=i[n];break}e?(e.cdStart=e.cdStart?Math.min(t.start,e.cdStart):t.start,e.cdEnd=e.cdEnd?Math.max(t.end,e.cdEnd):t.end,e.children||(e.children=[]),e.children.push(t)):(t.cdStart=t.start,t.cdEnd=t.end,i.push(t)),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end),this.cdStart=this.cdStart?Math.min(t.start,this.cdStart):t.start,this.cdEnd=this.cdEnd?Math.max(t.end,this.cdEnd):t.end},Ah.prototype.addUTR=function(t){let e;const i=this.exons;for(let n=0;n<i.length;n++)if(i[n].start<=t.start&&i[n].end>=t.end){e=i[n];break}e?(t.start===e.start&&t.end===e.end?e.utr=!0:(t.end<e.end&&(e.cdStart=t.end),t.start>e.start&&(e.cdEnd=t.start)),e.children||(e.children=[]),e.children.push(t)):(t.utr=!0,i.push(t)),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end)},Ah.prototype.finish=function(){var t=this.cdStart,e=this.cdEnd;this.exons.sort((function(t,e){return t.start-e.start})),t&&this.exons.forEach((function(i){(i.end<t||i.start>e)&&(i.utr=!0)}))},Ah.prototype.popupData=function(t){const e=this.attributeString.split(";"),i=[];if(this.gene&&"function"==typeof this.gene.popupData){const e=this.gene.popupData(t);for(let t of e)i.push(t);i.push("<hr>")}this.name&&i.push({name:"name",value:this.name}),i.push({name:"type",value:this.type});for(let t of e){var n=t.trim().split(this.delim,2);if(2===n.length&&void 0!==n[1]){const t=n[0].trim();if("name"===t.toLowerCase())continue;let e=n[1].trim();e.startsWith('"')&&e.endsWith('"')&&(e=e.substr(1,e.length-2)),i.push({name:t,value:e})}}i.push({name:"position",value:`${this.chr}:${u(this.start+1)}-${u(this.end)}`});for(let e of this.exons)if(t>=e.start&&t<e.end&&"function"==typeof e.popupData){i.push("<hr>");const n=e.popupData(t);for(let t of n)i.push(t);if(e.children)for(let n of e.children){i.push("<hr>");const e=n.popupData(t);for(let t of e)i.push(t)}}return i};const Bh=function(t,e,i,n){this.chr=t,this.start=e,this.end=i,this.features=n};function zh(t,e){e=e||Number.MAX_SAFE_INTEGER;const i=[];t.sort((function(t,e){return t.start-e.start})),i.push(-1e3);for(let n of t){let t=0;const r=Math.min(i.length,e);for(t=0;t<r;t++)if(n.start>i[t]){n.row=t,i[t]=n.end;break}n.row=t,i[t]=n.end}}Bh.prototype.contains=function(t,e,i){return this.chr===t&&this.start<=e&&this.end>=i},Bh.prototype.containsRange=function(t){return this.chr===t.chr&&this.start<=t.start&&this.end>=t.end};class Fh{constructor(t,e){this.config=t||{},this.genome=e,this.sourceType=void 0===t.sourceType?"file":t.sourceType,this.visibilityWindow=t.visibilityWindow;const i=new Set(["bigwig","bw","bigbed","bb","tdf"]);if(t.features&&Array.isArray(t.features)){let i=function(t){if(!t||0===t.length)return;if(void 0===t[0].chr&&void 0!==t[0].chr1){const e=[];for(let i of t)i.chr1===i.chr2?(i.chr=i.chr1,i.start=Math.min(i.start1,i.start2),i.end=Math.max(i.end1,i.end2)):e.push(i);for(let i of e){const e=Object.assign({dup:!0},i);t.push(e),i.chr=i.chr1,i.start=i.start1,i.end=i.end1,e.chr=e.chr2,e.start=e.start2,e.end=e.end2}}return t}(t.features);Nh(i),t.mappings&&function(t,e){let i=Object.keys(e);t.forEach((function(t){i.forEach((function(i){t[i]=t[e[i]]}))}))}(i,t.mappings),this.queryable=!1,this.featureCache=new yt(i,e)}else t.reader?(this.reader=t.reader,this.queryable=void 0===t.queryable||t.queryable,this.expandQuery=!!t.expandQuery):"ga4gh"===t.sourceType?(this.reader=new Ga4ghVariantReader(t,e),this.queryable=!0):"immvar"===t.sourceType?(this.reader=new ImmVarReader(t),this.queryable=!0):"eqtl"===t.type&&"gtex-ws"===t.sourceType?(this.reader=new GtexReader(t),this.queryable=!0,this.expandQuery=!!t.expandQuery):"ucscservice"===t.sourceType?(this.reader=new UCSCServiceReader(t.source),this.queryable=!0):"custom"===t.sourceType||void 0!==t.source?(this.reader=new CustomServiceReader(t.source),this.queryable=void 0===t.source.queryable||t.source.queryable,this.expandQuery=!!t.expandQuery):"civic-ws"===t.sourceType?(this.reader=new CivicReader(t),this.queryable=!1,this.expandQuery=!!t.expandQuery):(this.reader=new kh(t,e),void 0!==t.queryable?this.queryable=t.queryable:i.has(t.format)&&(this.queryable=i.has(t.format)||this.reader.indexed))}supportsWholeGenome(){return!this.queryable&&(void 0===this.visibilityWindow||this.visibilityWindow<=0)}async trackType(){const t=await this.getHeader();return t?t.type:void 0}async getHeader(){if(!this.header)if(this.reader&&"function"==typeof this.reader.readHeader){const t=await this.reader.readHeader();t?(this.header=t,t.format&&(this.config.format=t.format)):this.header={}}else this.header={};return this.header}async getFeatures(t){let{chr:e,start:i,end:n,bpPerPixel:r,visibilityWindow:s}=t;const o=this.genome,a=o?o.getChromosomeName(e):e,h="all"===a.toLowerCase();return(h&&!this.getWGFeatures||this.config.disableCache||!this.featureCache||!this.featureCache.containsRange(new Bh(a,i,n)))&&await this.loadFeatures(i,n,s,a),h?(this.wgFeatures||(this.queryable?this.wgFeatures=[]:this.wgFeatures=this.getWGFeatures(this.featureCache.getAllFeatures())),this.wgFeatures):this.featureCache.queryFeatures(a,i,n)}async loadFeatures(t,e,i,n){const r=this.reader;let s=t,o=e;if((!i||i<=0)&&!1!==this.expandQuery){const t=this.genome?this.genome.getChromosome(n):void 0;s=0,o=t?t.bpLength:Number.MAX_SAFE_INTEGER}else if(i>e-t&&!1!==this.expandQuery){const n=Math.min(4.1*(e-t),i);s=Math.max(0,(t+e-n)/2),o=t+n}let a=await r.readFeatures(n,s,o);void 0===this.queryable&&(this.queryable=r.indexed);const h=this.queryable?new Bh(n,s,o):void 0;if(a){if("gtf"!==this.config.format&&"gff3"!==this.config.format&&"gff"!==this.config.format||(a=new Eh(this.config).combineFeatures(a)),"wig"!==this.config.format&&"junctions"!==this.config.type){Nh(a,this.config.maxRows||Number.MAX_SAFE_INTEGER)}this.featureCache=new yt(a,this.genome,h),this.config.searchable&&this.addFeaturesToDB(a)}else this.featureCache=new yt([],h)}addFeaturesToDB(t){for(let e of t)e.name&&(this.genome.featureDB[e.name.toUpperCase()]=e),e.gene&&e.gene.name&&(this.genome.featureDB[e.gene.name.toUpperCase()]=e)}getWGFeatures(t){const e=this.genome,i=new Set(e.wgChromosomeNames),n=[];for(let r of e.wgChromosomeNames){const s=t[r];if(s)for(let t of s){let r=e.getChromosomeName(t.chr);if(i.has(r)){const i=Object.assign({},t);i.chr="all",i.start=e.getGenomeCoordinate(t.chr,t.start),i.end=e.getGenomeCoordinate(t.chr,t.end),i._f=t,i.exons&&delete i.exons,i.popupData=function(t){return"function"==typeof this._f.popupData?this._f.popupData():un.extractPopupData(this._f,e.id)},n.push(i)}}}return n.sort((function(t,e){return t.start-e.start})),n}}function Nh(t,e){if(e=e||1e3,null==t||0===t.length)return;const i={},n=[];for(let e of t){const t=e.chr;let r=i[t];r||(r=[],i[t]=r,n.push(t)),r.push(e)}for(let t of n)zh(i[t],e)}class _h{constructor(t,e,i){this.path=t.url,this.bufferSize=i||512e3,this.range={start:-1,size:-1},this.config=t}async dataViewForRange(t,e){if(!(this.data&&this.range.start<=t.start&&this.range.start+this.range.size>=t.start+t.size)){let e;e=t.size?Math.max(this.bufferSize,t.size):this.bufferSize;const i={start:t.start,size:e},n=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:i}));this.data=n,this.range=i}const i=this.data.byteLength,n=t.start-this.range.start;return e?new Uint8Array(this.data,n,i-n):new DataView(this.data,n,i-n)}}let Oh=512e3;class $h{constructor(t,e){this.path=t.url,this.genome=e,this.rpTreeCache={},this.config=t}async readWGFeatures(t,e){await this.loadHeader();const i=this.chromTree.idToChrom.length-1,n=this.chromTree.idToChrom[0],r=this.chromTree.idToChrom[i];return this.readFeatures(n,0,r,Number.MAX_VALUE,t,e)}async readFeatures(t,e,i,n,r,s){await this.loadHeader();const o=this.chromTree.chromToID[t],h=this.chromTree.chromToID[i];if(void 0===o||void 0===h)return[];let l,c;if("bigwig"===this.type){const t=await this.getZoomHeaders();let e=r?function(t,e){let i;for(let n=0;n<e.length;n++){const r=e[n];if(r.reductionLevel<t){i=r;break}}return i}(r,t):void 0;e?(l=e.indexOffset,c=Kh):(l=this.header.fullIndexOffset,c=qh)}else l=this.header.fullIndexOffset,c=Zh.call(this);const u=await this.loadRPTree(l),f=await u.findLeafItemsOverlapping(o,e,h,n);if(f&&0!==f.length){let t=Number.MAX_VALUE,i=0;for(let e of f)t=Math.min(t,e.dataOffset),i=Math.max(i,e.dataOffset+e.dataSize);const r=i-t,l=await nt.loadArrayBuffer(this.config.url,Ui(this.config,{range:{start:t,size:r}})),u=[],d=new Uint8Array(l);for(let i of f){const r=d.subarray(i.dataOffset-t,i.dataOffset+i.dataSize);let l;if(this.header.uncompressBuffSize>0){l=new a.Inflate(r).decompress()}else l=r;c.call(this,new DataView(l.buffer),o,e,h,n,u,this.chromTree.idToChrom,s)}return u.sort((function(t,e){return t.start-e.start})),u}return[]}async getZoomHeaders(){return this.zoomLevelHeaders||await this.loadHeader(),this.zoomLevelHeaders}async loadHeader(){if(this.header)return this.header;{let t,e=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:0,size:64}}));this.littleEndian=!0;let i=new fh(new DataView(e)),n=i.getUInt();if(2291137574===n)this.type="bigwig";else if(2273964779===n)this.type="bigbed";else{this.littleEndian=!1,i.littleEndian=!1,i.position=0;let t=i.getUInt();654085990===t?this.type="bigwig":3958540679===t&&(this.type="bigbed")}t={bwVersion:i.getUShort(),nZoomLevels:i.getUShort(),chromTreeOffset:i.getLong(),fullDataOffset:i.getLong(),fullIndexOffset:i.getLong(),fieldCount:i.getUShort(),definedFieldCount:i.getUShort(),autoSqlOffset:i.getLong(),totalSummaryOffset:i.getLong(),uncompressBuffSize:i.getInt(),extensionOffset:i.getLong()};const r=64;let s={start:r,size:t.fullDataOffset-r+5};e=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:s}));const o=t.nZoomLevels;i=new fh(new DataView(e)),this.zoomLevelHeaders=[],this.firstZoomDataOffset=Number.MAX_SAFE_INTEGER;for(let t=1;t<=o;t++){const e=o-t,n=new Uh(e,i);this.firstZoomDataOffset=Math.min(n.dataOffset,this.firstZoomDataOffset),this.zoomLevelHeaders[e]=n}if(t.autoSqlOffset>0){i.position=t.autoSqlOffset-r;const e=i.getString();e&&(this.autoSql=function(t){let e;const i=[];let n=!1;const r=t.trim().split(/\s*[\r\n]+\s*/g);for(let t of r)if(t.startsWith("table"))e=t.split(/\s+/)[1].trim();else if(t.startsWith("("))n=!0;else if(t.startsWith(")"));else if(n&&t.length>0){const e=t.indexOf(";"),n=t.substr(0,e).split(/\s+/),r=t.substr(e+1).replace(/"/g,"").trim();i.push({type:n[0],name:n[1],description:r})}return{table:e,fields:i}}(e))}if(t.totalSummaryOffset>0&&(i.position=t.totalSummaryOffset-r,this.totalSummary=new Gh(i)),!(t.chromTreeOffset>0))throw"BigWig chromosome tree offset <= 0";return i.position=t.chromTreeOffset-r,this.chromTree=new Vh(i,r,this.genome),i.position=t.fullDataOffset-r,t.dataCount=i.getInt(),this.setDefaultVisibilityWindow(t),this.header=t,this.header}}async loadRPTree(t){let e=this.rpTreeCache[t];return e||(e=new Hh(t,this.config,this.littleEndian),await e.load(),this.rpTreeCache[t]=e,e)}async getType(){return await this.loadHeader(),this.type}async getTrackType(){return await this.loadHeader(),"bigwig"===this.type?"wig":this.autoSql&&"chromatinInteract"===this.autoSql.table?"interact":"annotation"}setDefaultVisibilityWindow(t){if("bigwig"===this.type)this.visibilityWindow=-1;else{let e=this.genome?this.genome.getGenomeLength():3088286401;this.visibilityWindow=t.dataCount<1e3?-1:e/t.dataCount*1e3}}}class Uh{constructor(t,e){this.index=t,this.reductionLevel=e.getInt(),this.reserved=e.getInt(),this.dataOffset=e.getLong(),this.indexOffset=e.getLong()}}class Hh{constructor(t,e,i){this.config=e,this.fileOffset=t,this.path=e.url,this.littleEndian=i}async load(){const t=this.fileOffset+48,e=new _h(this.config,Oh);return this.rootNode=await this.readNode(t,e),this}async readNode(t,e){let i=await e.dataViewForRange({start:t,size:4},!1),n=new fh(i,this.littleEndian);const r=1===n.getByte();n.getByte();const s=n.getUShort();let o={start:t+=4,size:s*(r?32:24)};i=await e.dataViewForRange(o,!1);const a=new Array(s);if(n=new fh(i),r){for(let t=0;t<s;t++){let e={isLeaf:!0,startChrom:n.getInt(),startBase:n.getInt(),endChrom:n.getInt(),endBase:n.getInt(),dataOffset:n.getLong(),dataSize:n.getLong()};a[t]=e}return new Ph(a)}for(let t=0;t<s;t++){let e={isLeaf:!1,startChrom:n.getInt(),startBase:n.getInt(),endChrom:n.getInt(),endBase:n.getInt(),childOffset:n.getLong()};a[t]=e}return new Ph(a)}async findLeafItemsOverlapping(t,e,i,n){let r=this;return new Promise((function(s,o){let a=[],h=new Set,l=new _h(r.config,Oh);h.add(0),function c(u,f){if(Wh(u,t,e,i,n)){u.items.forEach((function(s){Wh(s,t,e,i,n)&&(s.isLeaf?a.push(s):s.childNode?c(s.childNode):(h.add(s.childOffset),r.readNode(s.childOffset,l).then((function(t){s.childNode=t,c(t,s.childOffset)})).catch(o)))}))}void 0!==f&&h.delete(f);0===h.size&&s(a)}(r.rootNode,0)}))}}class Ph{constructor(t){this.items=t;let e,i,n=Number.MAX_SAFE_INTEGER,r=0,s=Number.MAX_SAFE_INTEGER,o=0;for(e=0;e<t.length;e++)i=t[e],n=Math.min(n,i.startChrom),r=Math.max(r,i.endChrom),s=Math.min(s,i.startBase),o=Math.max(o,i.endBase);this.startChrom=n,this.endChrom=r,this.startBase=s,this.endBase=o}}class Vh{constructor(t,e,i){let n=t.getInt(),r=t.getInt(),s=t.getInt(),o=t.getInt(),a=t.getLong(),h=t.getLong(),l={},c=[];this.header={magic:n,blockSize:r,keySize:s,valSize:o,itemCount:a,reserved:h},this.chromToID=l,this.idToChrom=c,function t(n,r){r>=0&&(n.position=r);let o=n.getByte();n.getByte();let a,h,u,f,d,p,g=n.getUShort();if(1===o)for(a=0;a<g;a++)h=n.getFixedLengthTrimmedString(s),u=n.getInt(),n.getInt(),i&&(h=i.getChromosomeName(h)),l[h]=u,c[u]=h;else for(a=0;a<g;a++)h=n.getFixedLengthTrimmedString(s),f=n.getLong(),d=f-e,p=n.position,t(n,d),n.position=p}(t,-1)}}function Wh(t,e,i,n,r){return t?(n>t.startChrom||n===t.startChrom&&r>=t.startBase)&&(e<t.endChrom||e===t.endChrom&&i<=t.endBase):(console.log("null item for "+e+" "+i+" "+r),!1)}class Gh{constructor(t){t?(this.basesCovered=t.getLong(),this.minVal=t.getDouble(),this.maxVal=t.getDouble(),this.sumData=t.getDouble(),this.sumSquares=t.getDouble(),jh.call(this)):(this.basesCovered=0,this.minVal=0,this.maxVal=0,this.sumData=0,this.sumSquares=0,this.mean=0,this.stddev=0)}}function jh(){let t=this.basesCovered;if(t>0){this.mean=this.sumData/t,this.stddev=Math.sqrt(this.sumSquares/(t-1));let e=this.minVal<0?this.mean-2*this.stddev:0,i=this.maxVal>0?this.mean+2*this.stddev:0;this.defaultRange={min:e,max:i}}}function qh(t,e,i,n,r,s,o){const a=new fh(t),h=a.getInt();let l=a.getInt(),c=a.getInt();const u=a.getInt(),f=a.getInt(),d=a.getByte();a.getByte();let p=a.getUShort();if(h>=e&&h<=n)for(;p-- >0;){let t;switch(d){case 1:l=a.getInt(),c=a.getInt(),t=a.getFloat();break;case 2:l=a.getInt(),t=a.getFloat(),c=l+f;break;case 3:t=a.getFloat(),c=l+f,l+=u}if(!(h<e||h===e&&c<i)){if(h>n||h===n&&l>=r)break;if(Number.isFinite(t)){const e=o[h];s.push({chr:e,start:l,end:c,value:t})}}}}function Zh(){const t=function(t,e,i){if(i&&"chromatinInteract"===i.table)return function(t,e){return t.chr1=e[5],t.start1=Number.parseInt(e[6]),t.end1=Number.parseInt(e[7]),t.chr2=e[10],t.start2=Number.parseInt(e[11]),t.end2=Number.parseInt(e[12]),t.name=e[0],t.score=Number.parseFloat(e[1]),t.value=Number.parseFloat(e[2]),t.color="."===e[4]?void 0:"0"===e[4]?"rgb(0,0,0)":e[4],t};{const n=t-3;return function(r,s){if(n>0&&(r.name=s[0]),n>1&&(r.score=parseFloat(s[1])),n>2&&(r.strand=s[2]),n>3&&(r.cdStart=parseInt(s[3])),n>4&&(r.cdEnd=parseInt(s[4])),n>5&&"."!==s[5]&&"0"!==s[5]&&"-1"!==s[5]){const t=V.createColorString(s[5]);r.color=t.startsWith("rgb")?t:void 0}if(n>8){const t=parseInt(s[6]),e=s[7].split(","),i=s[8].split(","),n=[];for(let s=0;s<t;s++){const t=r.start+parseInt(i[s]),o=t+parseInt(e[s]);n.push({start:t,end:o})}r.exons=n}if(i)for(let n=t;n<e;n++)if(n<i.fields.length){const t=i.fields[n].name,e=s[n-3];r[t]=e}}}}(this.header.definedFieldCount,this.header.fieldCount,this.autoSql);return function(e,i,n,r,s,o,a){const h=new fh(e);for(;h.remLength()>=13;){const e=h.getInt(),l=a[e],c=h.getInt(),u=h.getInt(),f=h.getString();if(!(e<i||e===i&&u<n)){if(e>r||e===r&&c>=s)break;if(u>0){const e={chr:l,start:c,end:u};o.push(e);const i=f.split("\t");t(e,i)}}}}}function Kh(t,e,i,n,r,s,o,a){const h=new fh(t);for(;h.remLength()>=32;){const t=h.getInt(),l=o[t],c=h.getInt(),u=h.getInt(),f=h.getInt(),d=h.getFloat(),p=h.getFloat(),g=h.getFloat();let m;switch(h.getFloat(),a){case"min":m=d;break;case"max":m=p;break;default:m=0===f?0:g/f}if(!(t<e||t===e&&u<i)){if(t>n||t===n&&c>=r)break;Number.isFinite(m)&&s.push({chr:l,start:c,end:u,value:m})}}}class Yh{constructor(t,e){this.reader=new $h(t,e),this.genome=e,this.format=t.format||"bigwig",this.wgValues={}}async getFeatures(t){let{chr:e,start:i,end:n,bpPerPixel:r,windowFunction:s}=t;const o="all"===e.toLowerCase()?await this.getWGValues(s):await this.reader.readFeatures(e,i,e,n,r,s);return"bigwig"===this.reader.type||zh(o),o}async getHeader(){return this.reader.loadHeader()}getDefaultRange(){return void 0!==this.reader.totalSummary?this.reader.totalSummary.defaultRange:void 0}async defaultVisibilityWindow(){return this.reader.defaultVisibilityWindow}async getWGValues(t){const e=this.genome;if(this.wgValues[t])return this.wgValues[t];{const i=e.getGenomeLength()/1e3,n=await this.reader.readWGFeatures(i,t);let r=[];for(let t of n){const i=t.chr,n=e.getCumulativeOffset(i),s=Object.assign({},t);s.chr="all",s.start=n+t.start,s.end=n+t.end,r.push(s)}return this.wgValues[t]=r,r}}supportsWholeGenome(){return"bigwig"===this.reader.type||this.defaultVisibilityWindow()<=0}async trackType(){return this.reader.getTrackType()}}class Xh{constructor(t,e){this.config=t,this.genome=e,this.path=t.url,this.groupCache={},this.datasetCache={}}async readHeader(){if(void 0!==this.magic)return this;let t=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:0,size:64e3}})),e=new fh(new DataView(t));if(this.magic=e.getInt(),this.version=e.getInt(),this.indexPos=e.getLong(),this.indexSize=e.getInt(),e.getInt(),this.version>=2){let t=e.getInt();for(this.windowFunctions=[];t-- >0;)this.windowFunctions.push(e.getString())}this.trackType=e.getString(),this.trackLine=e.getString();let i=e.getInt();for(this.trackNames=[];i-- >0;)this.trackNames.push(e.getString());this.genomeID=e.getString(),this.flags=e.getInt(),this.compressed=0!=(1&this.flags),t=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:this.indexPos,size:this.indexSize}})),e=new fh(new DataView(t)),this.datasetIndex={};let n=e.getInt();for(;n-- >0;){const t=e.getString(),i=e.getLong(),n=e.getInt();this.datasetIndex[t]={position:i,size:n}}for(this.groupIndex={},n=e.getInt();n-- >0;){const t=e.getString(),i=e.getLong(),n=e.getInt();this.groupIndex[t]={position:i,size:n}}return this}async readDataset(t,e,i){const n=t+"_"+e+"_"+i;if(this.datasetCache[n])return this.datasetCache[n];{await this.readHeader();const r=this.version<2?"":"/"+e,s="all"===t.toLowerCase()||void 0===i?"0":i.toString();let o;o="raw"===e?"/"+t+"/raw":"/"+t+"/z"+s+r;const a=this.datasetIndex[o];if(void 0===a)return;const h=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:a.position,size:a.size}}));if(!h)return;const l=new fh(new DataView(h));let c=l.getInt();const u={};for(;c-- >0;)u[l.getString()]=l.getString();const f=l.getString(),d=l.getFloat();let p=l.getInt();const g=[];for(;p-- >0;)g.push({position:l.getLong(),size:l.getInt()});const m={name:o,attributes:u,dataType:f,tileWidth:d,tiles:g};return this.datasetCache[n]=m,m}}async readRootGroup(){const t=this.genome,e=this.groupCache["/"];if(e)return e;{const e=await this.readGroup("/"),i=e.chromosomes,n=e.maxZoom;n&&(this.maxZoom=Number(n));const r=e.totalCount;r&&(e.totalCount=Number.parseFloat(r));const s={};return i&&i.split(",").forEach((function(e){const i=t.getChromosomeName(e);s[i]=e})),this.chrAliasTable=s,this.groupCache["/"]=e,e}}async readGroup(t){const e=this.groupCache[t];if(e)return e;{await this.readHeader();const e=this.groupIndex[t];if(void 0===e)return;const i=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:e.position,size:e.size}}));if(!i)return;const n=new fh(new DataView(i)),r={name:t};let s=n.getInt();for(;s-- >0;){const t=n.getString(),e=n.getString();r[t]=e}return this.groupCache[t]=r,r}}async readTiles(t,e){if(t.sort((function(t,e){return t.position-e.position})),0===(t=t.filter((function(t){return t.size>0}))).length)return Promise.resolve([]);const i=t[0],n=t[t.length-1],r=i.position,s=n.position+n.size-r,o=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:r,size:s}})),h=[];for(let i of t){const t=i.position-r,n=i.size;if(n>0){let i;if(this.compressed){i=new a.Inflate(new Uint8Array(o,t,n)).decompress().buffer}else i=o.slice(t,t+n);const r=new fh(new DataView(i)),s=r.getString();let l;switch(s){case"fixedStep":l=Jh(r,e);break;case"variableStep":l=Qh(r,e);break;case"bed":case"bedWithName":l=tl(r,e,s);break;default:throw"Unknown tile type: "+s}h.push(l)}}return h}async readTile(t,e){let i=await nt.loadArrayBuffer(this.path,Ui(this.config,{range:{start:t.position,size:t.size}}));if(this.compressed){i=new a.Inflate(new Uint8Array(i)).decompress().buffer}const n=new fh(new DataView(i)),r=n.getString();switch(r){case"fixedStep":return Jh(n,e);case"variableStep":return Qh(n,e);case"bed":case"bedWithName":return tl(n,e,r);default:throw"Unknown tile type: "+r}}}function Jh(t,e){const i=t.getInt(),n=t.getInt(),r=t.getFloat(),s=[];let o=e;for(;o-- >0;){let e=i;const n=[];for(;e-- >0;)n.push(t.getFloat());s.push(n)}return{type:"fixedStep",start:n,span:r,data:s,nTracks:e,nPositions:i}}function Qh(t,e){const i=t.getInt(),n=t.getFloat(),r=t.getInt(),s=[];let o=r;for(;o-- >0;)s.push(t.getInt());t.getInt();const a=[];let h=e;for(;h-- >0;){o=r;const e=[];for(;o-- >0;)e.push(t.getFloat());a.push(e)}return{type:"variableStep",tileStart:i,span:n,start:s,data:a,nTracks:e,nPositions:r}}function tl(t,e,i){const n=t.getInt();let r=n;const s=[];for(;r-- >0;)s.push(t.getInt());r=n;const o=[];for(;r-- >0;)o.push(t.getInt());t.getInt();const a=[];let h=e;for(;h-- >0;){let e=n;const i=[];for(;e-- >0;)i.push(t.getFloat());a.push(i)}if("bedWithName"===i){r=n;const e=[];for(;r-- >0;)e.push(t.getString())}return{type:i,start:s,end:o,data:a,nTracks:e,nPositions:n}}class el{constructor(t,e){this.genome=e,this.windowFunction=t.windowFunction||"mean",this.reader=new Xh(t,e)}async getFeatures(t){let{chr:e,start:i,end:n,bpPerPixel:r}=t;const s=new Bh(e,i,n),o=this.genome;if(!this.rootGroup&&(this.rootGroup=await this.reader.readRootGroup(),!this.normalizationFactor)){const t=this.rootGroup.totalCount;t&&(this.normalizationFactor=1e6/t)}if("all"===e.toLowerCase())return[];s.bpPerPixel=r;const a=function(t,e,i){var n=i.getChromosome(t).bpLength;return Math.ceil(Math.log(Math.max(0,n/(700*e)))/sl)}(e,r,o);let h=this.reader.chrAliasTable[e],l=this.reader.maxZoom;void 0===h&&(h=e),void 0===l&&(l=-1);const c=a>l?"raw":this.windowFunction,u=await this.reader.readDataset(h,c,a);if(null==u)return[];const f=u.tileWidth,d=Math.floor(i/f),p=Math.floor(n/f),g=await this.reader.readTiles(u.tiles.slice(d,p+1),1),m=[];for(let t of g)switch(t.type){case"bed":il(t,e,i,n,r,m);break;case"variableStep":nl(t,e,i,n,r,m);break;case"fixedStep":rl(t,e,i,n,r,m);break;default:throw"Unknown tile type: "+t.type}return m.sort((function(t,e){return t.start-e.start})),m}supportsWholeGenome(){return!1}}function il(t,e,i,n,r,s){const o=t.nPositions,a=t.start,h=t.end,l=t.data[0];for(let t=0;t<o;t++){const r=a[t],o=h[t];if(!(o<i)){if(r>n)break;s.push({chr:e,start:r,end:o,value:l[t]})}}}function nl(t,e,i,n,r,s){const o=t.nPositions,a=t.start,h=t.span,l=t.data[0];for(let t=0;t<o;t++){const r=a[t],o=r+h;if(!(o<i)){if(r>n)break;s.push({chr:e,start:r,end:o,value:l[t]})}}}function rl(t,e,i,n,r,s){const o=t.nPositions;let a=t.start;const h=t.span,l=t.data[0];for(let t=0;t<o;t++){const r=a+h;if(a>n)break;r>=i&&(Number.isNaN(l[t])||s.push({chr:e,start:a,end:r,value:l[t]})),a=r}}var sl=Math.log(2);function ol(t,e){const i=t.format?t.format.toLowerCase():void 0;return"bigwig"===i||"bigbed"===i||"bb"===i?new Yh(t,e):"tdf"===i?new el(t,e):new Fh(t,e)}const al={setProperties:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=n}},strokeLine:function(t,e,i,n,r,s){e=Math.floor(e)+.5,i=Math.floor(i)+.5,n=Math.floor(n)+.5,r=Math.floor(r)+.5,s&&(t.save(),al.setProperties(t,s)),t.beginPath(),t.moveTo(e,i),t.lineTo(n,r),t.stroke(),s&&t.restore()},fillRect:function(t,e,i,n,r,s){e=Math.round(e),i=Math.round(i),s&&(t.save(),al.setProperties(t,s)),t.fillRect(e,i,n,r),s&&t.restore()},fillPolygon:function(t,e,i,n){n&&(t.save(),al.setProperties(t,n)),hl(t,e,i),t.fill(),n&&t.restore()},strokePolygon:function(t,e,i,n){n&&(t.save(),al.setProperties(t,n)),hl(t,e,i),t.stroke(),n&&t.restore()},fillText:function(t,e,i,n,r,s){if((r||s)&&t.save(),r&&al.setProperties(t,r),s){for(var o in t.translate(i,n),s){var a=s[o];"translate"===o&&t.translate(a.x,a.y),"rotate"===o&&t.rotate(a.angle*Math.PI/180)}t.fillText(e,0,0)}else t.fillText(e,i,n);(r||s)&&t.restore()},strokeText:function(t,e,i,n,r,s){if((r||s)&&t.save(),r&&al.setProperties(t,r),s){for(var o in t.translate(i,n),s){var a=s[o];"translate"===o&&t.translate(a.x,a.y),"rotate"===o&&t.rotate(a.angle*Math.PI/180)}t.strokeText(e,0,0)}else t.strokeText(e,i,n);(r||s)&&t.restore()},strokeCircle:function(t,e,i,n,r){r&&(t.save(),al.setProperties(t,r)),t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.stroke(),r&&t.restore()},fillCircle:function(t,e,i,n,r){r&&(t.save(),al.setProperties(t,r)),t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.fill(),r&&t.restore()},drawArrowhead:function(t,e,i,n,r){t.save(),n||(n=5),r&&(t.lineWidth=r),t.beginPath(),t.moveTo(e,i-n/2),t.lineTo(e,i+n/2),t.lineTo(e+n,i),t.lineTo(e,i-n/2),t.closePath(),t.fill(),t.restore()},dashedLine:function(t,e,i,n,r,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};void 0===s&&(s=2),t.setLineDash([s,s]),al.strokeLine(t,e,i,n,r,o),t.setLineDash([])},roundRect:function(t,e,i,n,r,s,o,a){void 0===a&&(a=!0),void 0===s&&(s=5),t.beginPath(),t.moveTo(e+s,i),t.lineTo(e+n-s,i),t.quadraticCurveTo(e+n,i,e+n,i+s),t.lineTo(e+n,i+r-s),t.quadraticCurveTo(e+n,i+r,e+n-s,i+r),t.lineTo(e+s,i+r),t.quadraticCurveTo(e,i+r,e,i+r-s),t.lineTo(e,i+s),t.quadraticCurveTo(e,i,e+s,i),t.closePath(),a&&t.stroke(),o&&t.fill()},polygon:function(t,e,i,n,r){void 0===r&&(r=!0),t.beginPath();var s=e.length;t.moveTo(e[0],i[0]);for(var o=1;o<s;o++)t.lineTo(e[o],i[o]);t.closePath(),r&&t.stroke(),n&&t.fill()}};function hl(t,e,i){var n,r=e.length;for(n=0;n<r;n++)e[n]=Math.round(e[n]),i[n]=Math.round(i[n]);for(t.beginPath(),t.moveTo(e[0],i[0]),n=1;n<r;n++)t.lineTo(e[n],i[n]);t.closePath()}let ll=new Y("Dark2");["GT/AG","CT/AC","GC/AG","CT/GC","AT/AC","GT/AT","non-canonical"].forEach((t=>{ll.getColor(t)}));const cl={};class ul extends un{constructor(t,e){super(t,e),this.maxRows=void 0===t.maxRows?1e3:t.maxRows,this.displayMode=t.displayMode||"COLLAPSED",this.labelDisplayMode=t.labelDisplayMode,t._featureSource?(this.featureSource=t._featureSource,delete t._featureSource):this.featureSource=t.featureSource?t.featureSource:ol(t,e.genome),this.autoHeight=t.autoHeight,this.margin=void 0===t.margin?10:t.margin,this.featureHeight=t.featureHeight||14,"FusionJuncSpan"===t.type?(this.squishedRowHeight=t.squishedRowHeight||50,this.expandedRowHeight=t.expandedRowHeight||50,this.height=t.height||this.margin+2*this.expandedRowHeight):"snp"===t.type?(this.expandedRowHeight=t.expandedRowHeight||10,this.squishedRowHeight=t.squishedRowHeight||5,this.height=t.height||30):(this.squishedRowHeight=t.squishedRowHeight||15,this.expandedRowHeight=t.expandedRowHeight||30,this.height=t.height||this.margin+2*this.expandedRowHeight),void 0!==this.height&&this.height||(this.height=100),"spliceJunctions"===t.type&&void 0===t.colorByNumReadsThreshold&&(t.colorByNumReadsThreshold=5),t.render?this.render=t.render:"FusionJuncSpan"===t.type?this.render=ml:"spliceJunctions"===t.type?(this.render=wl,this.displayMode="COLLAPSED"):"snp"===t.type?(this.render=Cl,this.snpColors=["rgb(0,0,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,0,0)"],this.colorBy="function"):(this.render=pl,this.arrowSpacing=30,function(t){t.browser.on&&(t.browser.on("trackdragend",e),t.browser.on("trackremoved",i));function e(){t.trackView&&t.trackView.tile&&t.displayMode}function i(n){t.browser.un&&t===n&&(t.browser.un("trackdrag",e),t.browser.un("trackremoved",i))}}(this)),this.useScore=t.useScore}async postInit(){return"function"==typeof this.featureSource.getHeader&&(this.header=await this.featureSource.getHeader()),this.header&&this.setTrackProperties(this.header),void 0===this.visibilityWindow&&"function"==typeof this.featureSource.defaultVisibilityWindow&&(this.visibilityWindow=await this.featureSource.defaultVisibilityWindow(),this.featureSource.visibilityWindow=this.visibilityWindow),this}supportsWholeGenome(){return(!1===this.config.indexed||!this.config.indexURL)&&!1!==this.config.supportsWholeGenome}async getFeatures(t,e,i,n){const r=this.visibilityWindow;return this.featureSource.getFeatures({chr:t,start:e,end:i,bpPerPixel:n,visibilityWindow:r})}computePixelHeight(t){if("spliceJunctions"===this.type)return this.height;if("COLLAPSED"===this.displayMode)return this.margin+this.expandedRowHeight;{let e=0;if(t&&"function"==typeof t.forEach)for(let i of t)i.row&&i.row>e&&(e=i.row);return this.margin+(e+1)*("SQUISHED"===this.displayMode?this.squishedRowHeight:this.expandedRowHeight)}}draw(t){const e=t.features,i=t.context,n=t.bpPerPixel,r=t.bpStart,s=t.pixelWidth,o=t.pixelHeight,a=r+s*n+1;if(this.config.isMergedTrack||al.fillRect(i,0,t.pixelTop,s,o,{fillStyle:"rgb(255, 255, 255)"}),e){const h=[];t.rowLastX=[];for(let i of e){const e=i.row||0;void 0===h[e]?h[e]=1:h[e]++,t.rowLastX[e]=-Number.MAX_SAFE_INTEGER}"spliceJunctions"==this.config.type&&(cl.referenceFrame=t.viewport.referenceFrame,cl.referenceFrameStart=cl.referenceFrame.start,cl.referenceFrameEnd=cl.referenceFrameStart+cl.referenceFrame.toBP(_i(t.viewport.contentDiv).width()),cl.featureZoomOutTracker={});let l=[];for(let c of e){if(c.end<r)continue;if(c.start>a)break;const e="COLLAPSED"===this.displayMode?0:c.row,u=s/h[e];t.drawLabel=t.labelAllFeatures||u>10;const f=Math.ceil((c.end-r)/n),d=l[e];if((!d||f>d||"spliceJunctions"===this.config.type)&&(this.render.call(this,c,r,n,o,i,t),"spliceJunctions"!==this.config.type)){const t=Math.floor((c.start-r)/n);d&&t-d<=0&&(i.globalAlpha=.5,al.strokeLine(i,t,0,t,o,{strokeStyle:"rgb(255, 255, 255)"}),i.globalAlpha=1),l[e]=f}}}else console.log("No feature list")}clickedFeatures(t){const e=t.y-this.margin,i=super.clickedFeatures(t);let n;switch(this.displayMode){case"SQUISHED":n=Math.floor(e/this.squishedRowHeight);break;case"EXPANDED":n=Math.floor(e/this.expandedRowHeight);break;default:n=void 0}return i.filter((function(t){return void 0===n||void 0===t.row||n===t.row}))}popupData(t,e){e||(e=this.clickedFeatures(t));const i=t.genomicLocation,n=[];for(let t of e){if(!("spliceJunctions"!==this.config.type||t.isVisible&&t.attributes))continue;const e="function"==typeof t.popupData?t.popupData(i):un.extractPopupData(t,this.getGenomeId());e&&(n.length>0&&n.push("<HR>"),Array.prototype.push.apply(n,e))}return n}menuItemList(){const t=this,e=[];return this.render===Cl&&(["function","class"].forEach((function(i){e.push({object:_i(n("Color by "+i,i===t.colorBy)),click:function(){t.colorBy=i,t.trackView.repaintViews()}})})),e.push({object:_i('<div class="igv-track-menu-border-top">')})),e}description(){if(Cl===this.render){let t="<html>"+this.name+"<hr>";return t+="<em>Color By Function:</em><br>",t+='<span style="color:red">Red</span>: Coding-Non-Synonymous, Splice Site<br>',t+='<span style="color:green">Green</span>: Coding-Synonymous<br>',t+='<span style="color:blue">Blue</span>: Untranslated<br>',t+='<span style="color:black">Black</span>: Intron, Locus, Unknown<br><br>',t+="<em>Color By Class:</em><br>",t+='<span style="color:red">Red</span>: Deletion<br>',t+='<span style="color:green">Green</span>: MNP<br>',t+='<span style="color:blue">Blue</span>: Microsatellite, Named<br>',t+='<span style="color:black">Black</span>: Indel, Insertion, SNP',t+="</html>",t}return this.name}dispose(){this.trackView=void 0}}function fl(t,e,i){let n=(t.start-e)/i,r=(t.end-e)/i,s=r-n;return s<3&&(s=3,n-=1.5),{px:n,px1:r,pw:s}}function dl(t){let e;if(this.altColor&&"-"===t.strand)e=this.altColor;else if(this.color)e=this.color;else if(this.config.colorBy){const i=t[this.config.colorBy.field];i&&(e=this.config.colorBy.pallete[i])}else e=t.color?t.color:this.defaultColor;if(t.alpha&&1!==t.alpha)e=V.addAlpha(e,t.alpha);else if(this.useScore&&t.score&&!Number.isNaN(t.score)){const i=function(t,e,i){const n=(e-t)/9,r=Math.floor((i-t)/n);return Math.min(1,.2+.8*r/9)}(this.config.min?this.config.min:0,this.config.max?this.config.max:1e3,t.score);t.alpha=i,e=V.addAlpha(e,i)}return e}function pl(t,e,i,n,r,s){this.browser;let o,a,h=dl.call(this,t);r.fillStyle=h,r.strokeStyle=h,"SQUISHED"===this.displayMode&&void 0!==t.row?(o=this.featureHeight/2,a=this.margin+this.squishedRowHeight*t.row):"EXPANDED"===this.displayMode&&void 0!==t.row?(o=this.featureHeight,a=this.margin+this.expandedRowHeight*t.row):(o=this.featureHeight,a=this.margin);const l=a+o/2,c=o/2,u=l-c/2,f=t.exons?t.exons.length:0,d=fl(t,e,i),p=this.arrowSpacing,g="+"===t.strand?1:"-"===t.strand?-1:0;if(0===f){if(r.fillRect(d.px,a,d.pw,o),0!==g){r.fillStyle="white",r.strokeStyle="white";for(let t=d.px+p/2;t<d.px1;t+=p)al.strokeLine(r,t-2*g,l-2,t,l),al.strokeLine(r,t-2*g,l+2,t,l);r.fillStyle=h,r.strokeStyle=h}}else{al.strokeLine(r,d.px+1,l,d.px1-1,l);const n=s.pixelWidth,m=Math.max(0,d.px)+p/2,w=Math.min(n,d.px1);for(let t=m;t<w;t+=p)al.strokeLine(r,t-2*g,l-2,t,l),al.strokeLine(r,t-2*g,l+2,t,l);for(let s=0;s<f;s++){const f=t.exons[s];let d,m=Math.round((f.start-e)/i),w=Math.round((f.end-e)/i),b=Math.max(1,w-m);if(!(m+b<0)){if(m>n)break;if(f.utr)r.fillRect(m,u,b,c);else if(f.cdStart&&(d=Math.round((f.cdStart-e)/i),r.fillRect(m,u,d-m,c),b-=d-m,m=d),f.cdEnd&&(d=Math.round((f.cdEnd-e)/i),r.fillRect(d,u,w-d,c),b-=w-d,w=d),r.fillRect(m,a,b,o),b>p+5&&0!==g){r.fillStyle="white",r.strokeStyle="white";for(let t=m+p/2;t<w;t+=p)al.strokeLine(r,t-2*g,l-2,t,l),al.strokeLine(r,t-2*g,l+2,t,l);r.fillStyle=h,r.strokeStyle=h}}}}const m=Math.round(s.viewportContainerX),w=m+s.viewportWidth;s.drawLabel&&gl.call(this,r,t,d.px,d.px1,a,m,w,s.referenceFrame,s)}function gl(t,e,i,n,r,s,o,a,h){let l,c,u=e.name;if(void 0===u&&e.gene&&(u=e.gene.name),void 0===u&&(u=e.id||e.ID),!u||"."===u)return;n<s||i>o?(l=i,c=n):(l=Math.max(i,s),c=Math.min(n,o));let f,d=dl.call(this,e),p=!1;if(a.selection&&GtexUtils.gtexLoaded&&(p=!0,f=a.selection.colorForGene(u)),"SQUISHED"!==this.displayMode){const i={textAlign:"SLANT"===this.labelDisplayMode?void 0:"center",fillStyle:f||d,strokeStyle:f||d};let n;"COLLAPSED"===this.displayMode&&"SLANT"===this.labelDisplayMode&&(n={rotate:{angle:45}});const s=l+(c-l)/2,o=function(t,e){return e?t+20:t+25}(r,n),a=t.measureText(u),g=s-a.width/2,m=s+a.width/2;(h.labelAllFeatures||g>h.rowLastX[e.row]||p)&&(h.rowLastX[e.row]=m,h.labelTransform?(t.save(),h.labelTransform(t,s),al.fillText(t,u,s,o,i,void 0),t.restore()):al.fillText(t,u,s,o,i,n))}}function ml(t,e,i,n,r){var s,o="EXPANDED"===this.displayMode?this.expandedRowHeight:this.squishedRowHeight;"COLLAPSED"===this.display&&(s=this.margin),("SQUISHED"===this.displayMode&&void 0!==t.row||"EXPANDED"===this.displayMode&&void 0!==t.row)&&(s=this.margin+o*t.row);var a=s+.5*o,h=a-.5*o,l=a+.5*o,c=Math.round((t.junction_left-e)/i),u=Math.round((t.junction_right-e)/i);r.beginPath(),r.moveTo(c,a),r.bezierCurveTo(c,h,u,h,u,a),r.lineWidth=1+Math.log(t.num_junction_reads)/Math.log(2),r.strokeStyle="blue",r.stroke();for(var f=t.spanning_frag_coords,d=0;d<f.length;d++){var p=f[d],g=Math.round((p.left-e)/i),m=Math.round((p.right-e)/i);r.beginPath(),r.moveTo(g,a),r.bezierCurveTo(g,l,m,l,m,a),r.lineWidth=1,r.strokeStyle="purple",r.stroke()}}function wl(t,e,i,n,r){t.isVisible=!1;const s=Math.round((t.start-e)/i),o=Math.round((t.end-e)/i),a=(s+o)/2;if(o-s<=3){if(a in cl.featureZoomOutTracker)return;cl.featureZoomOutTracker[a]=!0}if(this.config.hideAnnotatedJunctions&&"true"===t.attributes.annotated_junction)return;if(this.config.hideUnannotatedJunctions&&"false"===t.attributes.annotated_junction)return;if(this.config.hideMotifs&&this.config.hideMotifs.includes(t.attributes.motif))return;if(this.config.hideStrand===t.strand)return;if(this.config.minJunctionEndsVisible){let e=0;if(t.start>=cl.referenceFrameStart&&t.start<=cl.referenceFrameEnd&&(e+=1),t.end>=cl.referenceFrameStart&&t.end<=cl.referenceFrameEnd&&(e+=1),e<this.config.minJunctionEndsVisible)return}let h,l,c,u;if(t.attributes.uniquely_mapped){if(h=parseInt(t.attributes.uniquely_mapped),h<this.config.minUniquelyMappedReads)return;if(l=parseInt(t.attributes.multi_mapped),c=h+l,c<this.config.minTotalReads)return;if(c>0&&l/c>this.config.maxFractionMultiMappedReads)return;if(t.attributes.maximum_spliced_alignment_overhang&&parseInt(t.attributes.maximum_spliced_alignment_overhang)<this.config.minSplicedAlignmentOverhang)return}if(t.attributes.num_samples_with_this_junction){if(u=parseInt(t.attributes.num_samples_with_this_junction),this.config.minSamplesWithThisJunction&&u<this.config.minSamplesWithThisJunction)return;if(this.config.maxSamplesWithThisJunction&&u>this.config.maxSamplesWithThisJunction)return;if(t.attributes.num_samples_total&&(t.attributes.percent_samples_with_this_junction=100*u/parseFloat(t.attributes.num_samples_total),this.config.minPercentSamplesWithThisJunction&&(t.attributes.percent_samples_with_this_junction<this.config.minPercentSamplesWithThisJunction||t.attributes.percent_samples_with_this_junction>this.config.maxPercentSamplesWithThisJunction)))return}const f=this.margin,d=this.height,p=f+.5*d;let g=f;const m=f+d-10,w=(s+a)/2,b=(a+o)/2;let y,v,x=1;t.attributes.line_width?x=parseFloat(t.attributes.line_width):(void 0===this.config.thicknessBasedOn||"numUniqueReads"===this.config.thicknessBasedOn?x=h:"numReads"===this.config.thicknessBasedOn?x=c:"numSamplesWithThisJunction"===this.config.thicknessBasedOn&&void 0!==u&&(x=u),x=1+Math.log(x+1)/Math.log(12)),void 0===this.config.bounceHeightBasedOn||"random"===this.config.bounceHeightBasedOn?y=(t.start+t.end)%7:"distance"===this.config.bounceHeightBasedOn?y=6*(t.end-t.start)/(cl.referenceFrameEnd-cl.referenceFrameStart):"thickness"===this.config.bounceHeightBasedOn&&(y=2*x),g+=d*Math.max(7-y,0)/10,v=t.attributes.color?t.attributes.color:void 0===this.config.colorBy||"numUniqueReads"===this.config.colorBy?h>this.config.colorByNumReadsThreshold?"blue":"#AAAAAA":"numReads"===this.config.colorBy?c>this.config.colorByNumReadsThreshold?"blue":"#AAAAAA":"isAnnotatedJunction"===this.config.colorBy?"true"===t.attributes.annotated_junction?"#b0b0ec":"orange":"strand"===this.config.colorBy?"+"===t.strand?"#b0b0ec":"#ecb0b0":"motif"===this.config.colorBy?ll.getColor(t.attributes.motif):"#AAAAAA";let C="";t.attributes.label?C=t.attributes.label.replace(/_/g," "):void 0===this.config.labelWith||"uniqueReadCount"===this.config.labelWith?C=h:"totalReadCount"===this.config.labelWith?C=c:"numSamplesWithThisJunction"===this.config.labelWith?void 0!==u&&(C=u):"percentSamplesWithThisJunction"===this.config.labelWith?void 0!==t.attributes.percent_samples_with_this_junction&&(C=t.attributes.percent_samples_with_this_junction.toFixed(0)+"%"):"motif"===this.config.labelWith&&void 0!==t.attributes.motif&&(C+=t.attributes.motif),"uniqueReadCount"===this.config.labelWithInParen?C+=" ("+h+")":"totalReadCount"===this.config.labelWithInParen?C+=" ("+c+")":"multiMappedReadCount"===this.config.labelWithInParen?l>0&&(C+=" (+"+l+")"):"numSamplesWithThisJunction"===this.config.labelWithInParen?void 0!==u&&(C+=" ("+u+")"):"percentSamplesWithThisJunction"===this.config.labelWithInParen?void 0!==t.attributes.percent_samples_with_this_junction&&(C+=" ("+t.attributes.percent_samples_with_this_junction.toFixed(0)+"%)"):"motif"===this.config.labelWithInParen&&void 0!==t.attributes.motif&&(C+=` ${t.attributes.motif}`),t.isVisible=!0,r.beginPath(),r.moveTo(s,m),r.bezierCurveTo(w,g,b,g,o,m),r.lineWidth=x,r.strokeStyle=v,r.stroke();const S=(t,e,i,n)=>{t.beginPath(),t.moveTo(e,i),t.lineTo(e-n/2,i-n),t.lineTo(e+n/2,i-n),t.lineTo(e,i),t.closePath(),t.fill()};if(t.attributes.left_shape||t.attributes.right_shape){r.fillStyle=v;const e=r.lineWidth>2?10:7;t.attributes.left_shape&&S(r,s,m,e),t.attributes.right_shape&&S(r,o,m,e)}r.fillText(C,a-r.measureText(C).width/2,(7*g+p)/8)}const bl=new Set(["nonsense","missense","stop-loss","frameshift","cds-indel"]),yl=new Set(["coding-synon"]),vl=new Set(["splice-3","splice-5"]),xl=new Set(["untranslated-5","untranslated-3"]);function Cl(t,e,i,n,r){var s,o,a,h,l=fl(t,e,i),c=this.margin,u=this.snpColors.length;switch(s="squished"===this.displayMode?this.squishedRowHeight:this.expandedRowHeight,this.colorBy){case"function":h=t.func,o=h.split(",").map((function(t){return bl.has(t)||vl.has(t)?u-1:yl.has(t)?u-2:xl.has(t)?u-3:0})).reduce((function(t,e){return Math.max(t,e)}));break;case"class":o="deletion"===(a=t.class)?u-1:"mnp"===a?u-2:"microsatellite"===a||"named"===a?u-3:0}r.fillStyle=this.snpColors[o],r.fillRect(l.px,c,l.pw,s)}function Sl(t,e,i){var n,r,s,o,a,h,l,c={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};function u(t){return 0===t?"0":Math.abs(t)>=10?t.toFixed():Math.abs(t)>=1?t.toFixed(1):t.toFixed(2)}void 0!==this.dataRange&&void 0!==this.dataRange.max&&void 0!==this.dataRange.min&&(al.fillRect(t,0,0,e,i,{fillStyle:"rgb(255, 255, 255)"}),n=(l=.95*e)-8,.01,a={x:r=l,y:s=o=.01*i},al.strokeLine(t,n,s,r,o,c),al.fillText(t,u(this.dataRange.max),n+4,s+12,c),h={x:r,y:s=o=.99*i},al.strokeLine(t,n,s,r,o,c),al.fillText(t,u(this.dataRange.min),n+4,s-4,c),al.strokeLine(t,a.x,a.y,h.x,h.y,c))}function kl(t,e){let i=_i("<div>",{class:"igv-menu-popup-check-container"}),n=_i("<div>");i.append(n);let r=Tl("check",!0===e?"#444":"transparent");n.append(r);let s=_i("<div>");return s.text(t),i.append(s),i}function Tl(t,e){e=e||"currentColor";let i=Rl[t];i||(console.error(`No icon named: ${t}`),i=Rl.question);let n='<svg viewBox="0 0 '+i[0]+" "+i[1]+'">';return n+='<path fill="'+e+'" d="'+i[4]+'"></path>',n+="</svg>",n}const Rl={check:[512,512,[],"f00c","M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"],cog:[512,512,[],"f013","M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"],exclamation:[192,512,[],"f12a","M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z"],"exclamation-circle":[512,512,[],"f06a","M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"exclamation-triangle":[576,512,[],"f071","M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],minus:[448,512,[],"f068","M424 318.2c13.3 0 24-10.7 24-24v-76.4c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h400z"],"minus-circle":[512,512,[],"f056","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"],"minus-square":[448,512,[],"f146","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"],plus:[448,512,[],"f067","M448 294.2v-76.4c0-13.3-10.7-24-24-24H286.2V56c0-13.3-10.7-24-24-24h-76.4c-13.3 0-24 10.7-24 24v137.8H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h137.8V456c0 13.3 10.7 24 24 24h76.4c13.3 0 24-10.7 24-24V318.2H424c13.3 0 24-10.7 24-24z"],"plus-circle":[512,512,[],"f055","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],"plus-square":[448,512,[],"f0fe","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],question:[384,512,[],"f128","M202.021 0C122.202 0 70.503 32.703 29.914 91.026c-7.363 10.58-5.093 25.086 5.178 32.874l43.138 32.709c10.373 7.865 25.132 6.026 33.253-4.148 25.049-31.381 43.63-49.449 82.757-49.449 30.764 0 68.816 19.799 68.816 49.631 0 22.552-18.617 34.134-48.993 51.164-35.423 19.86-82.299 44.576-82.299 106.405V320c0 13.255 10.745 24 24 24h72.471c13.255 0 24-10.745 24-24v-5.773c0-42.86 125.268-44.645 125.268-160.627C377.504 66.256 286.902 0 202.021 0zM192 373.459c-38.196 0-69.271 31.075-69.271 69.271 0 38.195 31.075 69.27 69.271 69.27s69.271-31.075 69.271-69.271-31.075-69.27-69.271-69.27z"],save:[448,512,[],"f0c7","M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"],share:[512,512,[],"f064","M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"],spinner:[512,512,[],"f110","M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"],square:[448,512,[],"f0c8","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"],"square-full":[512,512,[],"f45c","M512 512H0V0h512v512z"],times:[384,512,[],"f00d","M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z"],"times-circle":[512,512,[],"f057","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"],wrench:[512,512,[],"f0ad","M481.156 200c9.3 0 15.12 10.155 10.325 18.124C466.295 259.992 420.419 288 368 288c-79.222 0-143.501-63.974-143.997-143.079C223.505 65.469 288.548-.001 368.002 0c52.362.001 98.196 27.949 123.4 69.743C496.24 77.766 490.523 88 481.154 88H376l-40 56 40 56h105.156zm-171.649 93.003L109.255 493.255c-24.994 24.993-65.515 24.994-90.51 0-24.993-24.994-24.993-65.516 0-90.51L218.991 202.5c16.16 41.197 49.303 74.335 90.516 90.503zM104 432c0-13.255-10.745-24-24-24s-24 10.745-24 24 10.745 24 24 24 24-10.745 24-24z"]},Il=function(t){let e=[];e.push(function(t){const e=e=>{const i=e=>{e=""===(e=e.trim())||void 0===e?"untitled":e,t.setTrackName(e)};t.browser.inputDialog.present({label:"Track Name",value:t.track.name,callback:i},e)},i=_i("<div>");return i.text("Set track name"),{object:i,click:e}}(t)),e.push("<hr/>"),e.push(function(t){let{trackRenderer:e,label:i,option:n}=t;var r;return(r=_i("<div>")).text(i),{object:r,click:function(){e.colorPicker.show()}}}({trackRenderer:t,label:"Set color",option:"color"})),e.push(function(t){let{trackRenderer:e,label:i}=t;const n=_i("<div>");return n.text(i),{object:n,click:()=>{e.track.color=void 0,e.repaintViews()}}}({trackRenderer:t,label:"Unset color"}));const i=t.track.menuItemList();var n,r;return i&&i.length>0&&(e.push("<hr/>"),e.push.apply(e,i)),!1!==t.track.removable&&(e.push("<hr/>"),e.push((n=t,(r=_i("<div>")).text("Remove track"),{object:r,click:function(){n.browser.layoutController.removeTrackXYPair(n)}}))),e},Dl=function(t){const e=[],i=_i("<div>");i.text("Set data range");return e.push({object:i,click:function(){const e=t.track.dataRange;t.dataRangeDialog.show({min:e.min||0,max:e.max})}}),void 0!==t.track.logScale&&e.push({object:kl("Log scale",t.track.logScale),click:()=>{t.track.logScale=!t.track.logScale,t.repaintViews()}}),e.push({object:kl("Autoscale",t.track.autoscale),click:()=>{t.track.autoscale=!t.track.autoscale,t.repaintViews()}}),e};class Ml extends un{constructor(t,e){super(t,e),this.type="wig",this.height=t.height||50,this.featureType="numeric";const i=t.format?t.format.toLowerCase():t.format;this.featureSource="bigwig"===i?new Yh(t,e.genome):"tdf"===i?new el(t,e.genome):ol(t,e.genome),this.autoscale=t.autoscale||void 0===t.max,this.autoscale||(this.dataRange={min:t.min||0,max:t.max}),this.windowFunction=t.windowFunction||"mean",this.paintAxis=Sl,this.graphType=t.graphType||"bar",this.normalize=t.normalize,this.scaleFactor=t.scaleFactor}async postInit(){const t=await this.getHeader();t&&this.setTrackProperties(t)}async getFeatures(t,e,i,n){const r=await this.featureSource.getFeatures({chr:t,start:e,end:i,bpPerPixel:n,windowFunction:this.windowFunction});if(this.normalize&&this.featureSource.normalizationFactor){const t=this.featureSource.normalizationFactor;for(let e of r)e.value*=t}if(this.scaleFactor){const t=this.scaleFactor;for(let e of r)e.value*=t}return r}menuItemList(){return Dl(this.trackView)}async getHeader(){return"function"==typeof this.featureSource.getHeader&&(this.header=await this.featureSource.getHeader()),this.header}draw(t){const e=t.features,i=t.context,n=t.bpPerPixel,r=t.bpStart,s=t.pixelWidth,o=t.pixelHeight,a=r+s*n+1;let h=-1,l=-1;const c=this.color||"rgb(150,150,150)";let u;"string"==typeof c&&c.startsWith("rgb(")&&(u=V.addAlpha(c,.1));const f=t=>(this.dataRange.max-t)/(this.dataRange.max-this.dataRange.min)*o;if(e&&e.length>0&&(void 0===this.dataRange.min&&(this.dataRange.min=0),this.dataRange.max>this.dataRange.min)){const s=0==this.dataRange.min?o:f(0);for(let t of e){if(t.end<r)continue;if(t.start>a)break;const e=Math.floor((t.start-r)/n);if(isNaN(e))continue;let o=f(t.value);const u=Math.ceil((t.end-r)/n),d=Math.max(1,u-e);let p=t.value<0&&this.altColor?this.altColor:c;const g="function"==typeof p?p(t.value):p;if("points"===this.graphType){const t=this.config.pointSize||3,n=e+d/2;al.fillCircle(i,n,o,t/2,{fillStyle:g,strokeStyle:g})}else{let n=o-s;Math.abs(n)<1&&(n=n<0?-1:1);const r=e+d;(r>h||t.value>=0&&t.value>l||t.value<0&&t.value<1)&&al.fillRect(i,e,s,d,n,{fillStyle:g}),l=t.value,h=r}}if(this.dataRange.min<0){const e=this.dataRange.max/(this.dataRange.max-this.dataRange.min)*t.pixelHeight;al.strokeLine(i,0,e,t.pixelWidth,e,{strokeStyle:u})}}if(this.config.hasOwnProperty("guideLines"))for(let e of this.config.guideLines)if(e.hasOwnProperty("color")&&e.hasOwnProperty("y")&&e.hasOwnProperty("dotted")){let i=f(e.y),n={strokeStyle:e.color,strokeWidth:2};e.dotted?al.dashedLine(t.context,0,i,t.pixelWidth,i,5,n):al.strokeLine(t.context,0,i,t.pixelWidth,i,n)}}popupData(t,e){if(e||(e=this.clickedFeatures(t)),e&&e.length>0){let i=[],n=function(t,e,i){var n,r,s=0,o=t.length-1,a=s+o>>1;for(;!h(t[a],e,i)&&s<o;)e<t[a].start?o=a-1:e>t[a].end&&(s=a+1),a=s+o>>1;if(h(t[a],e,i)){if(h(n=t[a],e,0))return n;for(r=a;r-- >=0&&(h(t[r]),!i);){if(h(t[r],e,0))return t[r];for(l(t[r],e)<l(n,e)&&(n=t[r]),r=a;r++<t.length&&(h(t[r]),!i);){if(h(t[r],e,0))return t[r];l(t[r],e)<l(n,e)&&(n=t[r])}}return n}return void console.log(e+" not found!");function h(t,e,i){return e>=t.start-i&&e<=t.end+i}function l(t,e){return Math.min(Math.abs(t.start-e),Math.abs(t.end-e))}}(e,t.genomicLocation,2*t.viewport.referenceFrame.bpPerPixel);if(n){let t=n.end-n.start==1?u(n.start+1):u(n.start+1)+"-"+u(n.end);i.push({name:"Position:",value:t}),i.push({name:"Value:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",value:u(n.value)})}return i}return[]}supportsWholeGenome(){return"function"==typeof this.featureSource.supportsWholeGenome&&this.featureSource.supportsWholeGenome()}dispose(){this.trackView=void 0}}const Ll=c,El=1e6;class Al extends un{constructor(t,e){super(t,e),this.visibilityWindow=t.visibilityWindow,this.displayMode=t.displayMode||"EXPANDED",this.labelDisplayMode=t.labelDisplayMode,this.variantHeight=t.variantHeight||10,this.squishedCallHeight=t.squishedCallHeight||1,this.expandedCallHeight=t.expandedCallHeight||10,this.expandedVGap=void 0!==t.expandedVGap?t.expandedVGap:2,this.squishedVGap=void 0!==t.squishedVGap?t.squishedVGap:1,this.expandedGroupGap=t.expandedGroupGap||10,this.squishedGroupGap=t.squishedGroupGap||5,this.featureHeight=t.featureHeight||14,this.visibilityWindow=t.visibilityWindow,this.featureSource=ol(t,e.genome),this.noCallColor=t.noCallColor||"rgb(245, 245, 245)",this.nonRefColor=t.nonRefColor||"rgb(200, 200, 215)",this.mixedColor=t.mixedColor||"rgb(200, 220, 200)",this.homrefColor=t.homrefColor||"rgb(200, 200, 200)",this.homvarColor=t.homvarColor||"rgb(17,248,254)",this.hetvarColor=t.hetvarColor||"rgb(34,12,253)",this.sortDirection="ASC",this.type=t.type||"variant",this.nRows=1}async postInit(){if(await this.getHeader(),void 0===this.visibilityWindow&&!1!==this.config.indexed){const t=Oi(this.config.url)?this.config.url.name:this.config.url;if(Ll(t)&&t.toLowerCase().includes("gnomad"))this.visibilityWindow=1e3;else if(this.callSets){const t=this.callSets.length;this.visibilityWindow=Math.max(1e3,El-1e4*t)}else this.visibilityWindow=El}return this}supportsWholeGenome(){return!1===this.config.indexed&&!1!==this.config.supportsWholeGenome}async getHeader(){if(this.header)return this.header;if("function"==typeof this.featureSource.getHeader){const t=await this.featureSource.getHeader();return t&&(this.callSets=t.callSets||[]),this.header=t,t}this.callSets=[]}getCallsetsLength(){return this.callSets.length}async getFeatures(t,e,i,n){return void 0===this.header&&(this.header=await this.getHeader()),this.featureSource.getFeatures({chr:t,start:e,end:i,bpPerPixel:n,visibilityWindow:this.visibilityWindow})}computePixelHeight(t){if("COLLAPSED"===this.displayMode)return this.nRows=1,10+this.variantHeight;{var e=0;if(t)for(let i of t)i.row&&i.row>e&&(e=i.row);const i="EXPANDED"===this.displayMode?this.expandedVGap:this.squishedVGap;this.nRows=e+1;const n=10+this.nRows*(this.variantHeight+i);this.variantBandHeight=n;const r="EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight;return n+i+(this.getCallsetsLength()*this.nRows+1)*(r+i)}}draw(t){const e=t.context,i=this.callSets,n=this.getCallsetsLength(),r=t.pixelWidth,s=t.pixelHeight,o="EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight,a=t.bpPerPixel,h=t.bpStart,l=h+r*a+1;al.fillRect(e,0,t.pixelTop,r,s,{fillStyle:"rgb(255, 255, 255)"});const c="EXPANDED"===this.displayMode?this.expandedVGap:this.squishedVGap;i&&n>0&&"COLLAPSED"!==this.displayMode&&al.strokeLine(e,0,this.variantBandHeight,r,this.variantBandHeight,{strokeStyle:"rgb(224,224,224) "});const u=t.features;if(u)for(let t of u){if(t.end<h)continue;if(t.start>l)break;const r=10+("COLLAPSED"===this.displayMode?0:t.row*(this.variantHeight+c)),s=this.variantHeight;let u=Math.round((t.start-h)/a),f=Math.round((t.end-h)/a),d=Math.max(1,f-u);if(d<3?(d=3,u-=1):d>5&&(u+=1,d-=2),"NONVARIANT"===t.type?e.fillStyle=this.nonRefColor:"MIXED"===t.type?e.fillStyle=this.mixedColor:e.fillStyle=this.color||this.defaultColor,e.fillRect(u,r,d,s),n>0&&t.calls&&"COLLAPSED"!==this.displayMode){let n=0;for(let r of i){const i=t.calls[r.id];if(i){const r=this.variantBandHeight+c+(n+t.row)*(o+c);let s=!0,a=!0,h=!1;for(let t of i.genotype){if("."===t){h=!0;break}0!==t&&(a=!1),0===t&&(s=!1)}e.fillStyle=h?this.noCallColor:a?this.homrefColor:s?this.homvarColor:this.hetvarColor,e.fillRect(u,r,d,o)}n++}}}else console.log("No feature list")}popupData(t,e){e||(e=this.clickedFeatures(t));const i=t.genomicLocation,n=this.browser.genome.id,r=[],s=this.browser.sampleInformation;for(let a of e)if(r.length>0&&r.push("<HR>"),"COLLAPSED"===this.displayMode)Array.prototype.push.apply(r,a.popupData(i,this.type));else{const e=t.y,h="EXPANDED"===this.displayMode?this.expandedVGap:this.squishedVGap;if(e<=this.variantBandHeight){const t=Math.floor((e-10)/(this.variantHeight+h));a.row===t&&Array.prototype.push.apply(r,a.popupData(i,n),this.type)}else{const t=this.callSets;if(t&&a.calls){const i=this.nRows*("SQUISHED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight),l=Math.floor((e-this.variantBandHeight)/(i+h));if(l>=0&&l<t.length){const e=t[l],i=a.calls[e.id];Array.prototype.push.apply(r,o(i,a,n,s))}}}}return r;function o(t,e,i,n){let r="";const s=e.alternateBases.split(",");for(let i of t.genotype){if("."===i){r+="No Call";break}if(0===i)r+=e.referenceBases;else{r+=s[i-1].replace("<","&lt;")}}let o=[];if(void 0!==t.callSetName&&o.push({name:"Name",value:t.callSetName}),o.push({name:"Genotype",value:r}),void 0!==t.phaseset&&o.push({name:"Phase set",value:t.phaseset}),void 0!==t.genotypeLikelihood&&o.push({name:"genotypeLikelihood",value:t.genotypeLikelihood.toString()}),n){var a=n.getAttributes(t.callSetName);a&&Object.keys(a).forEach((function(t){var e=t.replace(/([A-Z])/g," $1");e=e.charAt(0).toUpperCase()+e.slice(1),o.push({name:e,value:a[t]})}))}var h=Object.keys(t.info);h.length&&o.push("<hr>"),h.forEach((function(e){o.push({name:e,value:t.info[e]})}));let l=[];return l.length>0&&(o.push("<HR/>"),o=o.concat(l)),o}}menuItemList(){var t=this,e=[];return e.push({object:_i('<div class="igv-track-menu-border-top">')}),["COLLAPSED","SQUISHED","EXPANDED"].forEach((function(i){e.push({object:kl({COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"}[i],i===t.displayMode),click:function(){t.displayMode=i,t.trackView.checkContentHeight(),t.trackView.repaint()}})})),e}}var Bl={tracks:{feature:(t,e)=>new ul(t,e),wig:(t,e)=>new Ml(t,e),variant:(t,e)=>new Al(t,e)},addTrack:function(t,e){this.tracks[t]=e},getTrack:function(t){return this.tracks[t]}};const zl={async createTrack(t,e){let i=await async function(t){return"function"==typeof t?t():t}(t.url);if(c(i)&&(i=i.trim()),i)if(t.format)t.format=t.format.toLowerCase();else{let e=t.filename;e||(e=await getFilename(i)),t.format=w(e)}let n,r=t.type;if(r&&"bedtype"!==r)r=r.toLowerCase();else if(r=Hi(t),"bedtype"===r){const i=ol(t,e.genome);t._featureSource=i;const n=await i.trackType();r=n||"annotation",t.type=r}switch(r){case"annotation":case"genes":case"fusionjuncspan":case"junctions":case"splicejunctions":case"snp":n=Bl.getTrack("feature")(t,e);break;default:n=Bl.tracks.hasOwnProperty(r)?Bl.getTrack(r)(t,e):void 0}if(t.roi&&n){n.roi=[];for(let i of t.roi)n.roi.push(new ROI(i,e.genome))}return n}};function Fl(t){return Nl("div",t)}function Nl(t,e){const i=document.createElement(t);return e&&(e.class&&i.classList.add(e.class),e.id&&(i.id=e.id),e.style&&function(t,e){for(let i of Object.keys(e))t.style[i]=e[i]}(i,e.style)),i}function _l(t){const e=getComputedStyle(t);"none"!==e.display&&(t._initialDisplay=e.display),t.style.display="none"}function Ol(t){if("none"===getComputedStyle(t).display){const e=t._initialDisplay||"block";t.style.display=e}}function $l(t){if(t.type.startsWith("touch")){const e=t.touches[0];return{x:e.pageX,y:e.pageY}}return{x:t.pageX,y:t.pageY}}function Ul(t,e){return function(t,e){e=e||"currentColor";let i=Hl[t];i||(console.error(`No icon named: ${t}`),i=Hl.question);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"viewBox","0 0 "+i[0]+" "+i[1]);const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"fill",e),r.setAttributeNS(null,"d",i[4]),n.appendChild(r),n}(t,e)}const Hl={check:[512,512,[],"f00c","M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"],cog:[512,512,[],"f013","M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"],exclamation:[192,512,[],"f12a","M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z"],"exclamation-circle":[512,512,[],"f06a","M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"exclamation-triangle":[576,512,[],"f071","M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],minus:[448,512,[],"f068","M424 318.2c13.3 0 24-10.7 24-24v-76.4c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h400z"],"minus-circle":[512,512,[],"f056","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"],"minus-square":[448,512,[],"f146","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"],plus:[448,512,[],"f067","M448 294.2v-76.4c0-13.3-10.7-24-24-24H286.2V56c0-13.3-10.7-24-24-24h-76.4c-13.3 0-24 10.7-24 24v137.8H24c-13.3 0-24 10.7-24 24v76.4c0 13.3 10.7 24 24 24h137.8V456c0 13.3 10.7 24 24 24h76.4c13.3 0 24-10.7 24-24V318.2H424c13.3 0 24-10.7 24-24z"],"plus-circle":[512,512,[],"f055","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],"plus-square":[448,512,[],"f0fe","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"],question:[384,512,[],"f128","M202.021 0C122.202 0 70.503 32.703 29.914 91.026c-7.363 10.58-5.093 25.086 5.178 32.874l43.138 32.709c10.373 7.865 25.132 6.026 33.253-4.148 25.049-31.381 43.63-49.449 82.757-49.449 30.764 0 68.816 19.799 68.816 49.631 0 22.552-18.617 34.134-48.993 51.164-35.423 19.86-82.299 44.576-82.299 106.405V320c0 13.255 10.745 24 24 24h72.471c13.255 0 24-10.745 24-24v-5.773c0-42.86 125.268-44.645 125.268-160.627C377.504 66.256 286.902 0 202.021 0zM192 373.459c-38.196 0-69.271 31.075-69.271 69.271 0 38.195 31.075 69.27 69.271 69.27s69.271-31.075 69.271-69.271-31.075-69.27-69.271-69.27z"],save:[448,512,[],"f0c7","M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"],share:[512,512,[],"f064","M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"],spinner:[512,512,[],"f110","M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"],square:[448,512,[],"f0c8","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"],"square-full":[512,512,[],"f45c","M512 512H0V0h512v512z"],times:[384,512,[],"f00d","M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z"],"times-circle":[512,512,[],"f057","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"],wrench:[512,512,[],"f0ad","M481.156 200c9.3 0 15.12 10.155 10.325 18.124C466.295 259.992 420.419 288 368 288c-79.222 0-143.501-63.974-143.997-143.079C223.505 65.469 288.548-.001 368.002 0c52.362.001 98.196 27.949 123.4 69.743C496.24 77.766 490.523 88 481.154 88H376l-40 56 40 56h105.156zm-171.649 93.003L109.255 493.255c-24.994 24.993-65.515 24.994-90.51 0-24.993-24.994-24.993-65.516 0-90.51L218.991 202.5c16.16 41.197 49.303 74.335 90.516 90.503zM104 432c0-13.255-10.745-24-24-24s-24 10.745-24 24 10.745 24 24 24 24-10.745 24-24z"]};function Pl(t,e){var i=document.createElement("div");t.appendChild(i),i.appendChild(Ul("times")),i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e()}))}var Vl={Huffman:{},Util:{},CRC32:{},CompressionMethod:{DEFLATE:8,RESERVED:15},Zip:function(t){t=t||{},this.files=[],this.comment=t.comment,this.password}};Vl.Zip.CompressionMethod={STORE:0,DEFLATE:8},Vl.Zip.OperatingSystem={MSDOS:0,UNIX:3,MACINTOSH:7},Vl.Zip.Flags={ENCRYPT:1,DESCRIPTOR:8,UTF8:2048},Vl.Zip.FileHeaderSignature=[80,75,1,2],Vl.Zip.LocalFileHeaderSignature=[80,75,3,4],Vl.Zip.CentralDirectorySignature=[80,75,5,6],Vl.Zip.prototype.addFile=function(t,e){var i;(e=e||{}).filename;var n=t.length,r=0;if(t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof e.compressionMethod&&(e.compressionMethod=Vl.Zip.CompressionMethod.DEFLATE),e.compress)switch(e.compressionMethod){case Vl.Zip.CompressionMethod.STORE:break;case Vl.Zip.CompressionMethod.DEFLATE:r=Vl.CRC32.calc(t),t=this.deflateWithOption(t,e),i=!0;break;default:throw new Error("unknown compression method:"+e.compressionMethod)}this.files.push({buffer:t,option:e,compressed:i,encrypted:!1,size:n,crc32:r})},Vl.Zip.prototype.setPassword=function(t){this.password=t},Vl.Zip.prototype.compress=function(){var t,e,i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y,v,x,C,S,k,T,R=this.files,I=0,D=0;for(C=0,S=R.length;C<S;++C){if(d=(t=R[C]).option.filename?t.option.filename.length:0,p=t.option.extraField?t.option.extraField.length:0,g=t.option.comment?t.option.comment.length:0,!t.compressed)switch(t.crc32=Vl.CRC32.calc(t.buffer),t.option.compressionMethod){case Vl.Zip.CompressionMethod.STORE:break;case Vl.Zip.CompressionMethod.DEFLATE:t.buffer=this.deflateWithOption(t.buffer,t.option),t.compressed=!0;break;default:throw new Error("unknown compression method:"+t.option.compressionMethod)}if(void 0!==t.option.password||void 0!==this.password){for(x=this.createEncryptionKey(t.option.password||this.password),y=t.buffer,(v=new Uint8Array(y.length+12)).set(y,12),y=v,k=0;k<12;++k)y[k]=this.encode(x,11===C?255&t.crc32:256*Math.random()|0);for(T=y.length;k<T;++k)y[k]=this.encode(x,y[k]);t.buffer=y}I+=30+d+t.buffer.length,D+=46+d+g}for(s=22+(this.comment?this.comment.length:0),e=new Uint8Array(I+D+s),i=0,r=(n=I)+D,C=0,S=R.length;C<S;++C)d=(t=R[C]).option.filename?t.option.filename.length:0,p=0,g=t.option.comment?t.option.comment.length:0,o=i,e[i++]=Vl.Zip.LocalFileHeaderSignature[0],e[i++]=Vl.Zip.LocalFileHeaderSignature[1],e[i++]=Vl.Zip.LocalFileHeaderSignature[2],e[i++]=Vl.Zip.LocalFileHeaderSignature[3],e[n++]=Vl.Zip.FileHeaderSignature[0],e[n++]=Vl.Zip.FileHeaderSignature[1],e[n++]=Vl.Zip.FileHeaderSignature[2],e[n++]=Vl.Zip.FileHeaderSignature[3],20,e[n++]=20,e[n++]=t.option.os||Vl.Zip.OperatingSystem.MSDOS,e[i++]=e[n++]=20,e[i++]=e[n++]=0,a=0,(t.option.password||this.password)&&(a|=Vl.Zip.Flags.ENCRYPT),e[i++]=e[n++]=255&a,e[i++]=e[n++]=a>>8&255,h=t.option.compressionMethod,e[i++]=e[n++]=255&h,e[i++]=e[n++]=h>>8&255,l=t.option.date||new Date,e[i++]=e[n++]=(7&l.getMinutes())<<5|l.getSeconds()/2|0,e[i++]=e[n++]=l.getHours()<<3|l.getMinutes()>>3,e[i++]=e[n++]=(l.getMonth()+1&7)<<5|l.getDate(),e[i++]=e[n++]=(l.getFullYear()-1980&127)<<1|l.getMonth()+1>>3,c=t.crc32,e[i++]=e[n++]=255&c,e[i++]=e[n++]=c>>8&255,e[i++]=e[n++]=c>>16&255,e[i++]=e[n++]=c>>24&255,u=t.buffer.length,e[i++]=e[n++]=255&u,e[i++]=e[n++]=u>>8&255,e[i++]=e[n++]=u>>16&255,e[i++]=e[n++]=u>>24&255,f=t.size,e[i++]=e[n++]=255&f,e[i++]=e[n++]=f>>8&255,e[i++]=e[n++]=f>>16&255,e[i++]=e[n++]=f>>24&255,e[i++]=e[n++]=255&d,e[i++]=e[n++]=d>>8&255,e[i++]=e[n++]=255&p,e[i++]=e[n++]=p>>8&255,e[n++]=255&g,e[n++]=g>>8&255,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=255&o,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,(m=t.option.filename)&&(e.set(m,i),e.set(m,n),i+=d,n+=d),(w=t.option.extraField)&&(e.set(w,i),e.set(w,n),i+=p,n+=p),(b=t.option.comment)&&(e.set(b,n),n+=g),e.set(t.buffer,i),i+=t.buffer.length;return e[r++]=Vl.Zip.CentralDirectorySignature[0],e[r++]=Vl.Zip.CentralDirectorySignature[1],e[r++]=Vl.Zip.CentralDirectorySignature[2],e[r++]=Vl.Zip.CentralDirectorySignature[3],e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=255&S,e[r++]=S>>8&255,e[r++]=255&S,e[r++]=S>>8&255,e[r++]=255&D,e[r++]=D>>8&255,e[r++]=D>>16&255,e[r++]=D>>24&255,e[r++]=255&I,e[r++]=I>>8&255,e[r++]=I>>16&255,e[r++]=I>>24&255,g=this.comment?this.comment.length:0,e[r++]=255&g,e[r++]=g>>8&255,this.comment&&(e.set(this.comment,r),r+=g),e},Vl.Zip.prototype.deflateWithOption=function(t,e){return new Vl.RawDeflate(t,e.deflateOption).compress()},Vl.Zip.prototype.getByte=function(t){var e=65535&t[2]|2;return e*(1^e)>>8&255},Vl.Zip.prototype.encode=function(t,e){var i=this.getByte(t);return this.updateKeys(t,e),i^e},Vl.Zip.prototype.updateKeys=function(t,e){t[0]=Vl.CRC32.single(t[0],e),t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=Vl.CRC32.single(t[2],t[1]>>>24)},Vl.Zip.prototype.createEncryptionKey=function(t){var e,i,n=[305419896,591751049,878082192];for(n=new Uint32Array(n),e=0,i=t.length;e<i;++e)this.updateKeys(n,255&t[e]);return n},Vl.Huffman.buildHuffmanTable=function(t){var e,i,n,r,s,o,a,h,l,c,u,f=t.length,d=0,p=Number.POSITIVE_INFINITY;for(h=0,l=f;h<l;++h)t[h]>d&&(d=t[h]),t[h]<p&&(p=t[h]);for(e=1<<d,i=new Uint32Array(e),n=1,r=0,s=2;n<=d;){for(h=0;h<f;++h)if(t[h]===n){for(o=0,a=r,c=0;c<n;++c)o=o<<1|1&a,a>>=1;for(u=n<<16|h,c=o;c<e;c+=s)i[c]=u;++r}++n,r<<=1,s<<=1}return[i,d,p]};var Wl=Vl.Huffman.buildHuffmanTable;Vl.RawInflate=function(t,e){switch(this.buffer,this.blocks=[],this.bufferSize=32768,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output,this.op,this.bfinal=!1,this.bufferType=Vl.RawInflate.BufferType.ADAPTIVE,this.resize=!1,!e&&(e={})||(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case Vl.RawInflate.BufferType.BLOCK:this.op=Vl.RawInflate.MaxBackwardLength,this.output=new Uint8Array(Vl.RawInflate.MaxBackwardLength+this.bufferSize+Vl.RawInflate.MaxCopyLength);break;case Vl.RawInflate.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize);break;default:throw new Error("invalid inflate mode")}},Vl.RawInflate.BufferType={BLOCK:0,ADAPTIVE:1},Vl.RawInflate.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case Vl.RawInflate.BufferType.BLOCK:return this.concatBufferBlock();case Vl.RawInflate.BufferType.ADAPTIVE:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}},Vl.RawInflate.MaxBackwardLength=32768,Vl.RawInflate.MaxCopyLength=258,Vl.RawInflate.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vl.RawInflate.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Vl.RawInflate.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Vl.RawInflate.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Vl.RawInflate.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Vl.RawInflate.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return Wl(i)}(),Vl.RawInflate.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return Wl(i)}(),Vl.RawInflate.prototype.parseBlock=function(){var t=this.readBits(3);switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+t)}},Vl.RawInflate.prototype.readBits=function(t){var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;if(s+(t-n+7>>3)>=r.length)throw new Error("input buffer is broken");for(;n<t;)i|=r[s++]<<n,n+=8;return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},Vl.RawInflate.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=s.length,h=t[0],l=t[1];r<l&&!(o>=a);)n|=s[o++]<<r,r+=8;if((i=(e=h[n&(1<<l)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},Vl.RawInflate.prototype.parseUncompressedBlock=function(){var t,e,i=this.input,n=this.ip,r=this.output,s=this.op,o=i.length,a=r.length;if(this.bitsbuf=0,this.bitsbuflen=0,n+1>=o)throw new Error("invalid uncompressed block header: LEN");if(t=i[n++]|i[n++]<<8,n+1>=o)throw new Error("invalid uncompressed block header: NLEN");if(t===~(i[n++]|i[n++]<<8))throw new Error("invalid uncompressed block header: length verify");if(n+t>i.length)throw new Error("input buffer is broken");switch(this.bufferType){case Vl.RawInflate.BufferType.BLOCK:for(;s+t>r.length;)t-=e=a-s,r.set(i.subarray(n,n+e),s),s+=e,n+=e,this.op=s,r=this.expandBufferBlock(),s=this.op;break;case Vl.RawInflate.BufferType.ADAPTIVE:for(;s+t>r.length;)r=this.expandBufferAdaptive({fixRatio:2});break;default:throw new Error("invalid inflate mode")}r.set(i.subarray(n,n+t),s),s+=t,n+=t,this.ip=n,this.op=s,this.output=r},Vl.RawInflate.prototype.parseFixedHuffmanBlock=function(){switch(this.bufferType){case Vl.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(Vl.RawInflate.FixedLiteralLengthTable,Vl.RawInflate.FixedDistanceTable);break;case Vl.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(Vl.RawInflate.FixedLiteralLengthTable,Vl.RawInflate.FixedDistanceTable);break;default:throw new Error("invalid inflate mode")}},Vl.RawInflate.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r,s,o,a,h,l=this.readBits(5)+257,c=this.readBits(5)+1,u=this.readBits(4)+4,f=new Uint8Array(Vl.RawInflate.Order.length);for(a=0;a<u;++a)f[Vl.RawInflate.Order[a]]=this.readBits(3);for(t=Wl(f),n=new Uint8Array(l+c),a=0,h=l+c;a<h;)switch(r=this.readCodeByTable(t)){case 16:for(o=3+this.readBits(2);o--;)n[a++]=s;break;case 17:for(o=3+this.readBits(3);o--;)n[a++]=0;s=0;break;case 18:for(o=11+this.readBits(7);o--;)n[a++]=0;s=0;break;default:n[a++]=r,s=r}switch(e=Wl(n.subarray(0,l)),i=Wl(n.subarray(l)),this.bufferType){case Vl.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(e,i);break;case Vl.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(e,i);break;default:throw new Error("invalid inflate mode")}},Vl.RawInflate.prototype.decodeHuffmanBlock=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,a,h=i.length-Vl.RawInflate.MaxCopyLength,l=Vl.RawInflate.LengthCodeTable,c=Vl.RawInflate.LengthExtraTable,u=Vl.RawInflate.DistCodeTable,f=Vl.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=h&&(this.op=n,i=this.expandBufferBlock(),n=this.op),i[n++]=r;else for(a=l[s=r-257],c[s]>0&&(a+=this.readBits(c[s])),o=u[r=this.readCodeByTable(e)],f[r]>0&&(o+=this.readBits(f[r])),n>=h&&(this.op=n,i=this.expandBufferBlock(),n=this.op);a--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},Vl.RawInflate.prototype.decodeHuffmanAdaptive=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,a,h=i.length,l=Vl.RawInflate.LengthCodeTable,c=Vl.RawInflate.LengthExtraTable,u=Vl.RawInflate.DistCodeTable,f=Vl.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=h&&(h=(i=this.expandBufferAdaptive()).length),i[n++]=r;else for(a=l[s=r-257],c[s]>0&&(a+=this.readBits(c[s])),o=u[r=this.readCodeByTable(e)],f[r]>0&&(o+=this.readBits(f[r])),n+a>h&&(h=(i=this.expandBufferAdaptive()).length);a--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},Vl.RawInflate.prototype.expandBufferBlock=function(t){var e=new Uint8Array(this.op-Vl.RawInflate.MaxBackwardLength),i=this.op-Vl.RawInflate.MaxBackwardLength,n=this.output;return e.set(n.subarray(Vl.RawInflate.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,n.set(n.subarray(i,i+Vl.RawInflate.MaxBackwardLength)),this.op=Vl.RawInflate.MaxBackwardLength,n},Vl.RawInflate.prototype.expandBufferAdaptive=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.currentLitlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},Vl.RawInflate.prototype.concatBufferBlock=function(){var t,e,i,n,r,s=0,o=this.totalpos+(this.op-Vl.RawInflate.MaxBackwardLength),a=this.output,h=this.blocks,l=new Uint8Array(o);if(0===h.length)return this.output.subarray(Vl.RawInflate.MaxBackwardLength,this.op);for(e=0,i=h.length;e<i;++e)for(n=0,r=(t=h[e]).length;n<r;++n)l[s++]=t[n];for(e=Vl.RawInflate.MaxBackwardLength,i=this.op;e<i;++e)l[s++]=a[e];return this.blocks=[],this.buffer=l,this.buffer},Vl.RawInflate.prototype.concatBufferDynamic=function(){var t,e=this.op;return this.resize?(t=new Uint8Array(e)).set(this.output.subarray(0,e)):t=this.output.subarray(0,e),this.buffer=t,this.buffer};Wl=Vl.Huffman.buildHuffmanTable;let Gl;function jl(t,e){e.addEventListener("mousedown",ql.bind(t))}function ql(t){t.stopPropagation(),t.preventDefault(),function(t){if(!t.getClientRects().length)return{top:0,left:0};const e=t.getBoundingClientRect(),i=t.ownerDocument.defaultView;e.top,i.pageYOffset,e.left,i.pageXOffset}(this);const e=Zl.bind(this),i=Kl.bind(this),n=getComputedStyle(this),r=parseInt(n.top.replace("px","")),s=parseInt(n.left.replace("px",""));Gl={dragFunction:e,dragEndFunction:i,screenX:t.screenX,screenY:t.screenY,top:r,left:s},document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",i),document.addEventListener("mouseexit",i)}function Zl(t){if(!Gl)return;t.stopPropagation(),t.preventDefault();const e=t.screenX-Gl.screenX,i=t.screenY-Gl.screenY;this.style.left=`${Gl.left+e}px`,this.style.top=`${Gl.top+i}px`}function Kl(t){if(!Gl)return;t.stopPropagation(),t.preventDefault();const e=Gl.dragFunction,i=Gl.dragEndFunction;document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",i),document.removeEventListener("mouseexit",i),Gl=void 0}Vl.RawInflateStream=function(t,e,i){this.blocks=[],this.bufferSize=i||65e3,this.totalpos=0,this.ip=void 0===e?0:e,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output=new Uint8Array(this.bufferSize),this.op=0,this.bfinal=!1,this.blockLength,this.resize=!1,this.litlenTable,this.distTable,this.sp=0,this.status=Vl.RawInflateStream.Status.INITIALIZED,this.ip_,this.bitsbuflen_,this.bitsbuf_},Vl.RawInflateStream.BlockType={UNCOMPRESSED:0,FIXED:1,DYNAMIC:2},Vl.RawInflateStream.Status={INITIALIZED:0,BLOCK_HEADER_START:1,BLOCK_HEADER_END:2,BLOCK_BODY_START:3,BLOCK_BODY_END:4,DECODE_BLOCK_START:5,DECODE_BLOCK_END:6},Vl.RawInflateStream.prototype.decompress=function(t,e){var i=!1;for(void 0!==t&&(this.input=t),void 0!==e&&(this.ip=e);!i;)switch(this.status){case Vl.RawInflateStream.Status.INITIALIZED:case Vl.RawInflateStream.Status.BLOCK_HEADER_START:this.readBlockHeader()<0&&(i=!0);break;case Vl.RawInflateStream.Status.BLOCK_HEADER_END:case Vl.RawInflateStream.Status.BLOCK_BODY_START:switch(this.currentBlockType){case Vl.RawInflateStream.BlockType.UNCOMPRESSED:this.readUncompressedBlockHeader()<0&&(i=!0);break;case Vl.RawInflateStream.BlockType.FIXED:this.parseFixedHuffmanBlock()<0&&(i=!0);break;case Vl.RawInflateStream.BlockType.DYNAMIC:this.parseDynamicHuffmanBlock()<0&&(i=!0)}break;case Vl.RawInflateStream.Status.BLOCK_BODY_END:case Vl.RawInflateStream.Status.DECODE_BLOCK_START:switch(this.currentBlockType){case Vl.RawInflateStream.BlockType.UNCOMPRESSED:this.parseUncompressedBlock()<0&&(i=!0);break;case Vl.RawInflateStream.BlockType.FIXED:case Vl.RawInflateStream.BlockType.DYNAMIC:this.decodeHuffman()<0&&(i=!0)}break;case Vl.RawInflateStream.Status.DECODE_BLOCK_END:this.bfinal?i=!0:this.status=Vl.RawInflateStream.Status.INITIALIZED}return this.concatBuffer()},Vl.RawInflateStream.MaxBackwardLength=32768,Vl.RawInflateStream.MaxCopyLength=258,Vl.RawInflateStream.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vl.RawInflateStream.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Vl.RawInflateStream.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Vl.RawInflateStream.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Vl.RawInflateStream.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Vl.RawInflateStream.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return Wl(i)}(),Vl.RawInflateStream.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return Wl(i)}(),Vl.RawInflateStream.prototype.readBlockHeader=function(){var t;if(this.status=Vl.RawInflateStream.Status.BLOCK_HEADER_START,this.save_(),(t=this.readBits(3))<0)return this.restore_(),-1;switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.currentBlockType=Vl.RawInflateStream.BlockType.UNCOMPRESSED;break;case 1:this.currentBlockType=Vl.RawInflateStream.BlockType.FIXED;break;case 2:this.currentBlockType=Vl.RawInflateStream.BlockType.DYNAMIC;break;default:throw new Error("unknown BTYPE: "+t)}this.status=Vl.RawInflateStream.Status.BLOCK_HEADER_END},Vl.RawInflateStream.prototype.readBits=function(t){for(var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;n<t;){if(r.length<=s)return-1;i|=(e=r[s++])<<n,n+=8}return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},Vl.RawInflateStream.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=t[0],h=t[1];r<h;){if(s.length<=o)return-1;n|=s[o++]<<r,r+=8}if((i=(e=a[n&(1<<h)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},Vl.RawInflateStream.prototype.readUncompressedBlockHeader=function(){var t,e=this.input,i=this.ip;if(this.status=Vl.RawInflateStream.Status.BLOCK_BODY_START,i+4>=e.length)return-1;if((t=e[i++]|e[i++]<<8)===~(e[i++]|e[i++]<<8))throw new Error("invalid uncompressed block header: length verify");this.bitsbuf=0,this.bitsbuflen=0,this.ip=i,this.blockLength=t,this.status=Vl.RawInflateStream.Status.BLOCK_BODY_END},Vl.RawInflateStream.prototype.parseUncompressedBlock=function(){var t=this.input,e=this.ip,i=this.output,n=this.op,r=this.blockLength;for(this.status=Vl.RawInflateStream.Status.DECODE_BLOCK_START;r--;){if(n===i.length&&(i=this.expandBuffer({fixRatio:2})),e>=t.length)return this.ip=e,this.op=n,this.blockLength=r+1,-1;i[n++]=t[e++]}return r<0&&(this.status=Vl.RawInflateStream.Status.DECODE_BLOCK_END),this.ip=e,this.op=n,0},Vl.RawInflateStream.prototype.parseFixedHuffmanBlock=function(){return this.status=Vl.RawInflateStream.Status.BLOCK_BODY_START,this.litlenTable=Vl.RawInflateStream.FixedLiteralLengthTable,this.distTable=Vl.RawInflateStream.FixedDistanceTable,this.status=Vl.RawInflateStream.Status.BLOCK_BODY_END,0},Vl.RawInflateStream.prototype.save_=function(){this.ip_=this.ip,this.bitsbuflen_=this.bitsbuflen,this.bitsbuf_=this.bitsbuf},Vl.RawInflateStream.prototype.restore_=function(){this.ip=this.ip_,this.bitsbuflen=this.bitsbuflen_,this.bitsbuf=this.bitsbuf_},Vl.RawInflateStream.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r=new Uint8Array(Vl.RawInflateStream.Order.length);if(this.status=Vl.RawInflateStream.Status.BLOCK_BODY_START,this.save_(),t=this.readBits(5)+257,e=this.readBits(5)+1,i=this.readBits(4)+4,t<0||e<0||i<0)return this.restore_(),-1;try{(function(){var s,o,a,h,l,c,u=0;for(l=0;l<i;++l){if((s=this.readBits(3))<0)throw new Error("not enough input");r[Vl.RawInflateStream.Order[l]]=s}for(n=Wl(r),h=new Uint8Array(t+e),l=0,c=t+e;l<c;){if((o=this.readCodeByTable(n))<0)throw new Error("not enough input");switch(o){case 16:if((s=this.readBits(2))<0)throw new Error("not enough input");for(a=3+s;a--;)h[l++]=u;break;case 17:if((s=this.readBits(3))<0)throw new Error("not enough input");for(a=3+s;a--;)h[l++]=0;u=0;break;case 18:if((s=this.readBits(7))<0)throw new Error("not enough input");for(a=11+s;a--;)h[l++]=0;u=0;break;default:h[l++]=o,u=o}}this.litlenTable=Wl(h.subarray(0,t)),this.distTable=Wl(h.subarray(t))}).call(this)}catch(t){return this.restore_(),-1}return this.status=Vl.RawInflateStream.Status.BLOCK_BODY_END,0},Vl.RawInflateStream.prototype.decodeHuffman=function(){var t,e,i,n,r,s=this.output,o=this.op,a=this.litlenTable,h=this.distTable,l=s.length;for(this.status=Vl.RawInflateStream.Status.DECODE_BLOCK_START;;){if(this.save_(),(t=this.readCodeByTable(a))<0)return this.op=o,this.restore_(),-1;if(256===t)break;if(t<256)o===l&&(l=(s=this.expandBuffer()).length),s[o++]=t;else{if(e=t-257,n=Vl.RawInflateStream.LengthCodeTable[e],Vl.RawInflateStream.LengthExtraTable[e]>0){if((r=this.readBits(Vl.RawInflateStream.LengthExtraTable[e]))<0)return this.op=o,this.restore_(),-1;n+=r}if((t=this.readCodeByTable(h))<0)return this.op=o,this.restore_(),-1;if(i=Vl.RawInflateStream.DistCodeTable[t],Vl.RawInflateStream.DistExtraTable[t]>0){if((r=this.readBits(Vl.RawInflateStream.DistExtraTable[t]))<0)return this.op=o,this.restore_(),-1;i+=r}for(o+n>=l&&(l=(s=this.expandBuffer()).length);n--;)s[o]=s[o++-i];if(this.ip===this.input.length)return this.op=o,-1}}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=o,this.status=Vl.RawInflateStream.Status.DECODE_BLOCK_END},Vl.RawInflateStream.prototype.expandBuffer=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.litlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},Vl.RawInflateStream.prototype.concatBuffer=function(){var t,e,i=this.op;return t=this.resize?new Uint8Array(this.output.subarray(this.sp,i)):this.output.subarray(this.sp,i),this.sp=i,i>Vl.RawInflateStream.MaxBackwardLength+this.bufferSize&&(this.op=this.sp=Vl.RawInflateStream.MaxBackwardLength,e=this.output,this.output=new Uint8Array(this.bufferSize+Vl.RawInflateStream.MaxBackwardLength),this.output.set(e.subarray(i-Vl.RawInflateStream.MaxBackwardLength,i))),t},Vl.Inflate=function(t,e){var i,n;if(this.input=t,this.ip=0,this.rawinflate,this.verify,!e&&(e={})||(e.index&&(this.ip=e.index),e.verify&&(this.verify=e.verify)),i=t[this.ip++],n=t[this.ip++],(15&i)!==Vl.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=Vl.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.rawinflate=new Vl.RawInflate(t,{index:this.ip,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})},Vl.Inflate.BufferType=Vl.RawInflate.BufferType,Vl.Inflate.prototype.decompress=function(){var t,e=this.input;if(t=this.rawinflate.decompress(),this.ip=this.rawinflate.ip,this.verify&&(e[this.ip++]<<24|e[this.ip++]<<16|e[this.ip++]<<8|e[this.ip++])>>>0!==Vl.Adler32(t))throw new Error("invalid adler-32 checksum");return t},Vl.InflateStream=function(t){this.input=void 0===t?new Uint8Array:t,this.ip=0,this.rawinflate=new Vl.RawInflateStream(this.input,this.ip),this.method,this.output=this.rawinflate.output},Vl.InflateStream.prototype.decompress=function(t){var e;if(void 0!==t){var i=new Uint8Array(this.input.length+t.length);i.set(this.input,0),i.set(t,this.input.length),this.input=i}return void 0===this.method&&this.readHeader()<0?new Uint8Array:(e=this.rawinflate.decompress(this.input,this.ip),0!==this.rawinflate.ip&&(this.input=this.input.subarray(this.rawinflate.ip),this.ip=0),e)},Vl.InflateStream.prototype.readHeader=function(){var t=this.ip,e=this.input,i=e[t++],n=e[t++];if(void 0===i||void 0===n)return-1;if((15&i)!==Vl.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=Vl.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.ip=t},Vl.Gunzip=function(t,e){this.input=t,this.ip=0,this.member=[],this.decompressed=!1},Vl.Gunzip.prototype.getMembers=function(){return this.decompressed||this.decompress(),this.member.slice()},Vl.Gunzip.prototype.decompress=function(){for(var t=this.input.length;this.ip<t;)this.decodeMember();return this.decompressed=!0,this.concatMember()},Vl.Gunzip.prototype.decodeMember=function(){var t,e,i,n,r,s,o,a,h,l=new Vl.GunzipMember,c=this.input,u=this.ip;if(l.id1=c[u++],l.id2=c[u++],31!==l.id1||139!==l.id2)throw new Error("invalid file signature:"+l.id1+","+l.id2);if(l.cm=c[u++],8!==l.cm)throw new Error("unknown compression method: "+l.cm);if(l.flg=c[u++],a=c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24,l.mtime=new Date(1e3*a),l.xfl=c[u++],l.os=c[u++],(l.flg&Vl.Gzip.FlagsMask.FEXTRA)>0&&(l.xlen=c[u++]|c[u++]<<8,u=this.decodeSubField(u,l.xlen)),(l.flg&Vl.Gzip.FlagsMask.FNAME)>0){for(o=[],s=0;(r=c[u++])>0;)o[s++]=String.fromCharCode(r);l.name=o.join("")}if((l.flg&Vl.Gzip.FlagsMask.FCOMMENT)>0){for(o=[],s=0;(r=c[u++])>0;)o[s++]=String.fromCharCode(r);l.comment=o.join("")}if((l.flg&Vl.Gzip.FlagsMask.FHCRC)>0&&(l.crc16=65535&Vl.CRC32.calc(c,0,u),l.crc16!==(c[u++]|c[u++]<<8)))throw new Error("invalid header crc16");if(t=c[c.length-4]|c[c.length-3]<<8|c[c.length-2]<<16|c[c.length-1]<<24,c.length-u-4-4<512*t&&(n=t),e=new Vl.RawInflate(c,{index:u,bufferSize:n}),l.data=i=e.decompress(),u=e.ip,l.crc32=h=(c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24)>>>0,Vl.CRC32.calc(i)!==h)throw new Error("invalid CRC-32 checksum: 0x"+Vl.CRC32.calc(i).toString(16)+" / 0x"+h.toString(16));if(l.isize=t=(c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24)>>>0,(4294967295&i.length)!==t)throw new Error("invalid input size: "+(4294967295&i.length)+" / "+t);this.member.push(l),this.ip=u},Vl.Gunzip.prototype.decodeSubField=function(t,e){return t+e},Vl.Gunzip.prototype.concatMember=function(){var t,e,i,n=this.member,r=0,s=0;for(t=0,e=n.length;t<e;++t)s+=n[t].data.length;for(i=new Uint8Array(s),t=0;t<e;++t)i.set(n[t].data,r),r+=n[t].data.length;return i},Vl.GunzipMember=function(){this.id1,this.id2,this.cm,this.flg,this.mtime,this.xfl,this.os,this.crc16,this.xlen,this.crc32,this.isize,this.name,this.comment,this.data},Vl.GunzipMember.prototype.getName=function(){return this.name},Vl.GunzipMember.prototype.getData=function(){return this.data},Vl.GunzipMember.prototype.getMtime=function(){return this.mtime},Vl.Gzip=function(t,e){this.input=t,this.ip=0,this.output,this.op=0,this.flags={},this.filename,this.comment,this.deflateOptions,e&&(e.flags&&(this.flags=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.comment=e.comment),e.deflateOptions&&(this.deflateOptions=e.deflateOptions)),this.deflateOptions||(this.deflateOptions={})},Vl.Gzip.DefaultBufferSize=32768,Vl.Gzip.prototype.compress=function(){var t,e,i,n,r,s,o,a,h=new Uint8Array(Vl.Gzip.DefaultBufferSize),l=0,c=this.input,u=this.ip,f=this.filename,d=this.comment;if(h[l++]=31,h[l++]=139,h[l++]=8,t=0,this.flags.fname&&(t|=Vl.Gzip.FlagsMask.FNAME),this.flags.fcomment&&(t|=Vl.Gzip.FlagsMask.FCOMMENT),this.flags.fhcrc&&(t|=Vl.Gzip.FlagsMask.FHCRC),h[l++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,h[l++]=255&e,h[l++]=e>>>8&255,h[l++]=e>>>16&255,h[l++]=e>>>24&255,h[l++]=0,h[l++]=Vl.Gzip.OperatingSystem.UNKNOWN,void 0!==this.flags.fname){for(o=0,a=f.length;o<a;++o)(s=f.charCodeAt(o))>255&&(h[l++]=s>>>8&255),h[l++]=255&s;h[l++]=0}if(this.flags.comment){for(o=0,a=d.length;o<a;++o)(s=d.charCodeAt(o))>255&&(h[l++]=s>>>8&255),h[l++]=255&s;h[l++]=0}return this.flags.fhcrc&&(i=65535&Vl.CRC32.calc(h,0,l),h[l++]=255&i,h[l++]=i>>>8&255),this.deflateOptions.outputBuffer=h,this.deflateOptions.outputIndex=l,h=(r=new Vl.RawDeflate(c,this.deflateOptions)).compress(),(l=r.op)+8>h.buffer.byteLength?(this.output=new Uint8Array(l+8),this.output.set(new Uint8Array(h.buffer)),h=this.output):h=new Uint8Array(h.buffer),n=Vl.CRC32.calc(c),h[l++]=255&n,h[l++]=n>>>8&255,h[l++]=n>>>16&255,h[l++]=n>>>24&255,a=c.length,h[l++]=255&a,h[l++]=a>>>8&255,h[l++]=a>>>16&255,h[l++]=a>>>24&255,this.ip=u,l<h.length&&(this.output=h=h.subarray(0,l)),h},Vl.Gzip.OperatingSystem={FAT:0,AMIGA:1,VMS:2,UNIX:3,VM_CMS:4,ATARI_TOS:5,HPFS:6,MACINTOSH:7,Z_SYSTEM:8,CP_M:9,TOPS_20:10,NTFS:11,QDOS:12,ACORN_RISCOS:13,UNKNOWN:255},Vl.Gzip.FlagsMask={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},Vl.Heap=function(t){this.buffer=new Uint16Array(2*t),this.length=0},Vl.Heap.prototype.getParent=function(t){return 2*((t-2)/4|0)},Vl.Heap.prototype.getChild=function(t){return 2*t+2},Vl.Heap.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;i>0&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},Vl.Heap.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;!((n=this.getChild(r))>=this.length)&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}},Vl.RawDeflate=function(t,e){this.compressionType=Vl.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.freqsLitLen,this.freqsDist,this.input=t instanceof Array?new Uint8Array(t):t,this.output,this.op=0,e&&(e.lazy&&(this.lazy=e.lazy),"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e.outputBuffer&&(this.output=e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.op=e.outputIndex)),this.output||(this.output=new Uint8Array(32768))},Vl.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3},Vl.RawDeflate.Lz77MinLength=3,Vl.RawDeflate.Lz77MaxLength=258,Vl.RawDeflate.WindowSize=32768,Vl.RawDeflate.MaxCodeLength=16,Vl.RawDeflate.HUFMAX=286,Vl.RawDeflate.FixedHuffmanTable=function(){var t,e=[];for(t=0;t<288;t++)switch(!0){case t<=143:e.push([t+48,8]);break;case t<=255:e.push([t-144+400,9]);break;case t<=279:e.push([t-256+0,7]);break;case t<=287:e.push([t-280+192,8]);break;default:throw"invalid literal: "+t}return e}(),Vl.RawDeflate.prototype.compress=function(){var t,e,i,n=this.input;switch(this.compressionType){case Vl.RawDeflate.CompressionType.NONE:for(e=0,i=n.length;e<i;)e+=(t=n.subarray(e,e+65535)).length,this.makeNocompressBlock(t,e===i);break;case Vl.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(n,!0),this.op=this.output.length;break;case Vl.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(n,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output},Vl.RawDeflate.prototype.makeNocompressBlock=function(t,e){var i,n,r,s,o=this.output,a=this.op;for(o=new Uint8Array(this.output.buffer);o.length<=a+t.length+5;)o=new Uint8Array(o.length<<1);return o.set(this.output),i=e?1:0,n=Vl.RawDeflate.CompressionType.NONE,o[a++]=i|n<<1,s=65536+~(r=t.length)&65535,o[a++]=255&r,o[a++]=r>>>8&255,o[a++]=255&s,o[a++]=s>>>8&255,o.set(t,a),a+=t.length,o=o.subarray(0,a),this.op=a,this.output=o,o},Vl.RawDeflate.prototype.makeFixedHuffmanBlock=function(t,e){var i,n,r,s=new Vl.BitStream(new Uint8Array(this.output.buffer),this.op);return i=e?1:0,n=Vl.RawDeflate.CompressionType.FIXED,s.writeBits(i,1,!0),s.writeBits(n,2,!0),r=this.lz77(t),this.fixedHuffman(r,s),s.finish()},Vl.RawDeflate.prototype.makeDynamicHuffmanBlock=function(t,e){var i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y=new Vl.BitStream(new Uint8Array(this.output.buffer),this.op),v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=new Array(19);for(i=e?1:0,n=Vl.RawDeflate.CompressionType.DYNAMIC,y.writeBits(i,1,!0),y.writeBits(n,2,!0),r=this.lz77(t),h=this.getLengths_(this.freqsLitLen,15),l=this.getCodesFromLengths_(h),c=this.getLengths_(this.freqsDist,7),u=this.getCodesFromLengths_(c),s=286;s>257&&0===h[s-1];s--);for(o=30;o>1&&0===c[o-1];o--);for(f=this.getTreeSymbols_(s,h,o,c),d=this.getLengths_(f.freqs,7),w=0;w<19;w++)x[w]=d[v[w]];for(a=19;a>4&&0===x[a-1];a--);for(p=this.getCodesFromLengths_(d),y.writeBits(s-257,5,!0),y.writeBits(o-1,5,!0),y.writeBits(a-4,4,!0),w=0;w<a;w++)y.writeBits(x[w],3,!0);for(w=0,b=f.codes.length;w<b;w++)if(g=f.codes[w],y.writeBits(p[g],d[g],!0),g>=16){switch(w++,g){case 16:m=2;break;case 17:m=3;break;case 18:m=7;break;default:throw"invalid code: "+g}y.writeBits(f.codes[w],m,!0)}return this.dynamicHuffman(r,[l,h],[u,c],y),y.finish()},Vl.RawDeflate.prototype.dynamicHuffman=function(t,e,i,n){var r,s,o,a,h,l,c,u;for(h=e[0],l=e[1],c=i[0],u=i[1],r=0,s=t.length;r<s;++r)if(o=t[r],n.writeBits(h[o],l[o],!0),o>256)n.writeBits(t[++r],t[++r],!0),a=t[++r],n.writeBits(c[a],u[a],!0),n.writeBits(t[++r],t[++r],!0);else if(256===o)break;return n},Vl.RawDeflate.prototype.fixedHuffman=function(t,e){var i,n,r;for(i=0,n=t.length;i<n;i++)if(r=t[i],Vl.BitStream.prototype.writeBits.apply(e,Vl.RawDeflate.FixedHuffmanTable[r]),r>256)e.writeBits(t[++i],t[++i],!0),e.writeBits(t[++i],5),e.writeBits(t[++i],t[++i],!0);else if(256===r)break;return e},Vl.RawDeflate.Lz77Match=function(t,e){this.length=t,this.backwardDistance=e},Vl.RawDeflate.Lz77Match.LengthCodeTable=function(t){return new Uint32Array(t)}(function(){var t,e,i=[];for(t=3;t<=258;t++)e=n(t),i[t]=e[2]<<24|e[1]<<16|e[0];function n(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}return i}()),Vl.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(t){var e;switch(!0){case 1===t:e=[0,t-1,0];break;case 2===t:e=[1,t-2,0];break;case 3===t:e=[2,t-3,0];break;case 4===t:e=[3,t-4,0];break;case t<=6:e=[4,t-5,1];break;case t<=8:e=[5,t-7,1];break;case t<=12:e=[6,t-9,2];break;case t<=16:e=[7,t-13,2];break;case t<=24:e=[8,t-17,3];break;case t<=32:e=[9,t-25,3];break;case t<=48:e=[10,t-33,4];break;case t<=64:e=[11,t-49,4];break;case t<=96:e=[12,t-65,5];break;case t<=128:e=[13,t-97,5];break;case t<=192:e=[14,t-129,6];break;case t<=256:e=[15,t-193,6];break;case t<=384:e=[16,t-257,7];break;case t<=512:e=[17,t-385,7];break;case t<=768:e=[18,t-513,8];break;case t<=1024:e=[19,t-769,8];break;case t<=1536:e=[20,t-1025,9];break;case t<=2048:e=[21,t-1537,9];break;case t<=3072:e=[22,t-2049,10];break;case t<=4096:e=[23,t-3073,10];break;case t<=6144:e=[24,t-4097,11];break;case t<=8192:e=[25,t-6145,11];break;case t<=12288:e=[26,t-8193,12];break;case t<=16384:e=[27,t-12289,12];break;case t<=24576:e=[28,t-16385,13];break;case t<=32768:e=[29,t-24577,13];break;default:throw"invalid distance"}return e},Vl.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var t,e=this.length,i=this.backwardDistance,n=[],r=0;return t=Vl.RawDeflate.Lz77Match.LengthCodeTable[e],n[r++]=65535&t,n[r++]=t>>16&255,n[r++]=t>>24,t=this.getDistanceCode_(i),n[r++]=t[0],n[r++]=t[1],n[r++]=t[2],n},Vl.RawDeflate.prototype.lz77=function(t){var e,i,n,r,s,o,a,h,l,c={},u=Vl.RawDeflate.WindowSize,f=new Uint16Array(2*t.length),d=0,p=0,g=new Uint32Array(286),m=new Uint32Array(30),w=this.lazy;function b(t,e){var i,n,r=t.toLz77Array();for(i=0,n=r.length;i<n;++i)f[d++]=r[i];g[r[0]]++,m[r[3]]++,p=t.length+e-1,h=null}for(g[256]=1,e=0,i=t.length;e<i;++e){for(s=0,n=0,r=Vl.RawDeflate.Lz77MinLength;n<r&&e+n!==i;++n)s=s<<8|t[e+n];if(void 0===c[s]&&(c[s]=[]),o=c[s],p-- >0)o.push(e);else{for(;o.length>0&&e-o[0]>u;)o.shift();if(e+Vl.RawDeflate.Lz77MinLength>=i){for(h&&b(h,-1),n=0,r=i-e;n<r;++n)l=t[e+n],f[d++]=l,++g[l];break}o.length>0?(a=this.searchLongestMatch_(t,e,o),h?h.length<a.length?(l=t[e-1],f[d++]=l,++g[l],b(a,0)):b(h,-1):a.length<w?h=a:b(a,0)):h?b(h,-1):(l=t[e],f[d++]=l,++g[l]),o.push(e)}}return f[d++]=256,g[256]++,this.freqsLitLen=g,this.freqsDist=m,f.subarray(0,d)},Vl.RawDeflate.prototype.searchLongestMatch_=function(t,e,i){var n,r,s,o,a,h,l=0,c=t.length;t:for(o=0,h=i.length;o<h;o++){if(n=i[h-o-1],s=Vl.RawDeflate.Lz77MinLength,l>Vl.RawDeflate.Lz77MinLength){for(a=l;a>Vl.RawDeflate.Lz77MinLength;a--)if(t[n+a-1]!==t[e+a-1])continue t;s=l}for(;s<Vl.RawDeflate.Lz77MaxLength&&e+s<c&&t[n+s]===t[e+s];)++s;if(s>l&&(r=n,l=s),s===Vl.RawDeflate.Lz77MaxLength)break}return new Vl.RawDeflate.Lz77Match(l,e-r)},Vl.RawDeflate.prototype.getTreeSymbols_=function(t,e,i,n){var r,s,o,a,h,l,c=new Uint32Array(t+i),u=new Uint32Array(316),f=new Uint8Array(19);for(s=0,r=0;r<t;r++)c[s++]=e[r];for(r=0;r<i;r++)c[s++]=n[r];for(h=0,r=0,a=c.length;r<a;r+=s){for(s=1;r+s<a&&c[r+s]===c[r];++s);if(o=s,0===c[r])if(o<3)for(;o-- >0;)u[h++]=0,f[0]++;else for(;o>0;)(l=o<138?o:138)>o-3&&l<o&&(l=o-3),l<=10?(u[h++]=17,u[h++]=l-3,f[17]++):(u[h++]=18,u[h++]=l-11,f[18]++),o-=l;else if(u[h++]=c[r],f[c[r]]++,--o<3)for(;o-- >0;)u[h++]=c[r],f[c[r]]++;else for(;o>0;)(l=o<6?o:6)>o-3&&l<o&&(l=o-3),u[h++]=16,u[h++]=l-3,f[16]++,o-=l}return{codes:u.subarray(0,h),freqs:f}},Vl.RawDeflate.prototype.getLengths_=function(t,e){var i,n,r,s,o,a=t.length,h=new Vl.Heap(2*Vl.RawDeflate.HUFMAX),l=new Uint8Array(a);for(s=0;s<a;++s)t[s]>0&&h.push(s,t[s]);if(i=new Array(h.length/2),n=new Uint32Array(h.length/2),1===i.length)return l[h.pop().index]=1,l;for(s=0,o=h.length/2;s<o;++s)i[s]=h.pop(),n[s]=i[s].value;for(r=this.reversePackageMerge_(n,n.length,e),s=0,o=i.length;s<o;++s)l[i[s].index]=r[s];return l},Vl.RawDeflate.prototype.reversePackageMerge_=function(t,e,i){var n,r,s,o,a,h=new Uint16Array(i),l=new Uint8Array(i),c=new Uint8Array(e),u=new Array(i),f=new Array(i),d=new Array(i),p=(1<<i)-e,g=1<<i-1;function m(t){var i=f[t][d[t]];i===e?(m(t+1),m(t+1)):--c[i],++d[t]}for(h[i-1]=e,r=0;r<i;++r)p<g?l[r]=0:(l[r]=1,p-=g),p<<=1,h[i-2-r]=(h[i-1-r]/2|0)+e;for(h[0]=l[0],u[0]=new Array(h[0]),f[0]=new Array(h[0]),r=1;r<i;++r)h[r]>2*h[r-1]+l[r]&&(h[r]=2*h[r-1]+l[r]),u[r]=new Array(h[r]),f[r]=new Array(h[r]);for(n=0;n<e;++n)c[n]=i;for(s=0;s<h[i-1];++s)u[i-1][s]=t[s],f[i-1][s]=s;for(n=0;n<i;++n)d[n]=0;for(1===l[i-1]&&(--c[0],++d[i-1]),r=i-2;r>=0;--r){for(n=0,o=0,a=d[r+1],s=0;s<h[r];s++)(o=u[r+1][a]+u[r+1][a+1])>t[n]?(u[r][s]=o,f[r][s]=e,a+=2):(u[r][s]=t[n],f[r][s]=n,++n);d[r]=0,1===l[r]&&m(r)}return c},Vl.RawDeflate.prototype.getCodesFromLengths_=function(t){var e,i,n,r,s=new Uint16Array(t.length),o=[],a=[],h=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,i=Vl.RawDeflate.MaxCodeLength;e<=i;e++)a[e]=h,h+=0|o[e],h<<=1;for(e=0,i=t.length;e<i;e++)for(h=a[t[e]],a[t[e]]+=1,s[e]=0,n=0,r=t[e];n<r;n++)s[e]=s[e]<<1|1&h,h>>>=1;return s},Vl.Unzip=function(t,e){e=e||{},this.input=t instanceof Array?new Uint8Array(t):t,this.ip=0,this.eocdrOffset,this.numberOfThisDisk,this.startDisk,this.totalEntriesThisDisk,this.totalEntries,this.centralDirectorySize,this.centralDirectoryOffset,this.commentLength,this.comment,this.fileHeaderList,this.filenameToIndex,this.verify=e.verify||!1,this.password=e.password},Vl.Unzip.CompressionMethod=Vl.Zip.CompressionMethod,Vl.Unzip.FileHeaderSignature=Vl.Zip.FileHeaderSignature,Vl.Unzip.LocalFileHeaderSignature=Vl.Zip.LocalFileHeaderSignature,Vl.Unzip.CentralDirectorySignature=Vl.Zip.CentralDirectorySignature,Vl.Unzip.FileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.version,this.os,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.fileCommentLength,this.diskNumberStart,this.internalFileAttributes,this.externalFileAttributes,this.relativeOffset,this.filename,this.extraField,this.comment},Vl.Unzip.FileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==Vl.Unzip.FileHeaderSignature[0]||t[e++]!==Vl.Unzip.FileHeaderSignature[1]||t[e++]!==Vl.Unzip.FileHeaderSignature[2]||t[e++]!==Vl.Unzip.FileHeaderSignature[3])throw new Error("invalid file header signature");this.version=t[e++],this.os=t[e++],this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.fileCommentLength=t[e++]|t[e++]<<8,this.diskNumberStart=t[e++]|t[e++]<<8,this.internalFileAttributes=t[e++]|t[e++]<<8,this.externalFileAttributes=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,this.relativeOffset=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.comment=t.subarray(e,e+this.fileCommentLength),this.length=e-this.offset},Vl.Unzip.LocalFileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.filename,this.extraField},Vl.Unzip.LocalFileHeader.Flags=Vl.Zip.Flags,Vl.Unzip.LocalFileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==Vl.Unzip.LocalFileHeaderSignature[0]||t[e++]!==Vl.Unzip.LocalFileHeaderSignature[1]||t[e++]!==Vl.Unzip.LocalFileHeaderSignature[2]||t[e++]!==Vl.Unzip.LocalFileHeaderSignature[3])throw new Error("invalid local file header signature");this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.length=e-this.offset},Vl.Unzip.prototype.searchEndOfCentralDirectoryRecord=function(){var t,e=this.input;for(t=e.length-12;t>0;--t)if(e[t]===Vl.Unzip.CentralDirectorySignature[0]&&e[t+1]===Vl.Unzip.CentralDirectorySignature[1]&&e[t+2]===Vl.Unzip.CentralDirectorySignature[2]&&e[t+3]===Vl.Unzip.CentralDirectorySignature[3])return void(this.eocdrOffset=t);throw new Error("End of Central Directory Record not found")},Vl.Unzip.prototype.parseEndOfCentralDirectoryRecord=function(){var t,e=this.input;if(this.eocdrOffset||this.searchEndOfCentralDirectoryRecord(),t=this.eocdrOffset,e[t++]!==Vl.Unzip.CentralDirectorySignature[0]||e[t++]!==Vl.Unzip.CentralDirectorySignature[1]||e[t++]!==Vl.Unzip.CentralDirectorySignature[2]||e[t++]!==Vl.Unzip.CentralDirectorySignature[3])throw new Error("invalid signature");this.numberOfThisDisk=e[t++]|e[t++]<<8,this.startDisk=e[t++]|e[t++]<<8,this.totalEntriesThisDisk=e[t++]|e[t++]<<8,this.totalEntries=e[t++]|e[t++]<<8,this.centralDirectorySize=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.centralDirectoryOffset=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.commentLength=e[t++]|e[t++]<<8,this.comment=e.subarray(t,t+this.commentLength)},Vl.Unzip.prototype.parseFileHeader=function(){var t,e,i,n,r=[],s={};if(!this.fileHeaderList){for(void 0===this.centralDirectoryOffset&&this.parseEndOfCentralDirectoryRecord(),t=this.centralDirectoryOffset,i=0,n=this.totalEntries;i<n;++i)(e=new Vl.Unzip.FileHeader(this.input,t)).parse(),t+=e.length,r[i]=e,s[e.filename]=i;if(this.centralDirectorySize<t-this.centralDirectoryOffset)throw new Error("invalid file header size");this.fileHeaderList=r,this.filenameToIndex=s}},Vl.Unzip.prototype.getFileData=function(t,e){e=e||{};var i,n,r,s,o,a,h,l,c=this.input,u=this.fileHeaderList;if(u||this.parseFileHeader(),void 0===u[t])throw new Error("wrong index");if(n=u[t].relativeOffset,(i=new Vl.Unzip.LocalFileHeader(this.input,n)).parse(),n+=i.length,r=i.compressedSize,0!=(i.flags&Vl.Unzip.LocalFileHeader.Flags.ENCRYPT)){if(!e.password&&!this.password)throw new Error("please set password");for(a=this.createDecryptionKey(e.password||this.password),h=n,l=n+12;h<l;++h)this.decode(a,c[h]);for(h=n+=12,l=n+(r-=12);h<l;++h)c[h]=this.decode(a,c[h])}switch(i.compression){case Vl.Unzip.CompressionMethod.STORE:s=this.input.subarray(n,n+r);break;case Vl.Unzip.CompressionMethod.DEFLATE:s=new Vl.RawInflate(this.input,{index:n,bufferSize:i.plainSize}).decompress();break;default:throw new Error("unknown compression type")}if(this.verify&&(o=Vl.CRC32.calc(s),i.crc32!==o))throw new Error("wrong crc: file=0x"+i.crc32.toString(16)+", data=0x"+o.toString(16));return s},Vl.Unzip.prototype.getFilenames=function(){var t,e,i,n=[];for(this.fileHeaderList||this.parseFileHeader(),t=0,e=(i=this.fileHeaderList).length;t<e;++t)n[t]=i[t].filename;return n},Vl.Unzip.prototype.decompress=function(t,e){var i;if(this.filenameToIndex||this.parseFileHeader(),void 0===(i=this.filenameToIndex[t]))throw new Error(t+" not found");return this.getFileData(i,e)},Vl.Unzip.prototype.setPassword=function(t){this.password=t},Vl.Unzip.prototype.decode=function(t,e){return e^=this.getByte(t),this.updateKeys(t,e),e},Vl.Unzip.prototype.updateKeys=Vl.Zip.prototype.updateKeys,Vl.Unzip.prototype.createDecryptionKey=Vl.Zip.prototype.createEncryptionKey,Vl.Unzip.prototype.getByte=Vl.Zip.prototype.getByte,Vl.Util.stringToByteArray=function(t){var e,i,n=t.split("");for(e=0,i=n.length;e<i;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;return n},Vl.Adler32=function(t){return"string"==typeof t&&(t=Vl.Util.stringToByteArray(t)),Vl.Adler32.update(1,t)},Vl.Adler32.update=function(t,e){for(var i,n=65535&t,r=t>>>16&65535,s=e.length,o=0;s>0;){s-=i=s>Vl.Adler32.OptimizationParameter?Vl.Adler32.OptimizationParameter:s;do{r+=n+=e[o++]}while(--i);n%=65521,r%=65521}return(r<<16|n)>>>0},Vl.Adler32.OptimizationParameter=1024,Vl.BitStream=function(t,e){if(this.index="number"==typeof e?e:0,this.bitindex=0,this.buffer=t instanceof Uint8Array?t:new Uint8Array(Vl.BitStream.DefaultBlockSize),2*this.buffer.length<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()},Vl.BitStream.DefaultBlockSize=32768,Vl.BitStream.prototype.expandBuffer=function(){var t=this.buffer,e=t.length,i=new Uint8Array(e<<1);return i.set(t),this.buffer=i},Vl.BitStream.prototype.writeBits=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.bitindex,a=r[s];if(i&&e>1&&(t=e>8?function(t){return Vl.BitStream.ReverseTable[255&t]<<24|Vl.BitStream.ReverseTable[t>>>8&255]<<16|Vl.BitStream.ReverseTable[t>>>16&255]<<8|Vl.BitStream.ReverseTable[t>>>24&255]}(t)>>32-e:Vl.BitStream.ReverseTable[t]>>8-e),e+o<8)a=a<<e|t,o+=e;else for(n=0;n<e;++n)a=a<<1|t>>e-n-1&1,8==++o&&(o=0,r[s++]=Vl.BitStream.ReverseTable[a],a=0,s===r.length&&(r=this.expandBuffer()));r[s]=a,this.buffer=r,this.bitindex=o,this.index=s},Vl.BitStream.prototype.finish=function(){var t=this.buffer,e=this.index;return this.bitindex>0&&(t[e]<<=8-this.bitindex,t[e]=Vl.BitStream.ReverseTable[t[e]],e++),t.subarray(0,e)},Vl.BitStream.ReverseTable=function(){var t,e=new Uint8Array(256);for(t=0;t<256;++t)e[t]=function(t){var e=t,i=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--i;return(e<<i&255)>>>0}(t);return e}(),Vl.CRC32.calc=function(t,e,i){return Vl.CRC32.update(t,0,e,i)},Vl.CRC32.update=function(t,e,i,n){var r=Vl.CRC32.Table,s="number"==typeof i?i:i=0,o="number"==typeof n?n:t.length;for(e^=4294967295,s=7&o;s--;++i)e=e>>>8^r[255&(e^t[i])];for(s=o>>3;s--;i+=8)e=(e=(e=(e=(e=(e=(e=(e=e>>>8^r[255&(e^t[i])])>>>8^r[255&(e^t[i+1])])>>>8^r[255&(e^t[i+2])])>>>8^r[255&(e^t[i+3])])>>>8^r[255&(e^t[i+4])])>>>8^r[255&(e^t[i+5])])>>>8^r[255&(e^t[i+6])])>>>8^r[255&(e^t[i+7])];return(4294967295^e)>>>0},Vl.CRC32.single=function(t,e){return(Vl.CRC32.Table[255&(t^e)]^t>>>8)>>>0},Vl.CRC32.Table_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],Vl.CRC32.Table=new Uint32Array(Vl.CRC32.Table_),Vl.Deflate=function(t,e){this.input=t,this.output=new Uint8Array(Vl.Deflate.DefaultBufferSize),this.compressionType=Vl.Deflate.CompressionType.DYNAMIC,this.rawDeflate;var i,n={};for(i in!e&&(e={})||"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.output,this.rawDeflate=new Vl.RawDeflate(this.input,n)},Vl.Deflate.DefaultBufferSize=32768,Vl.Deflate.CompressionType=Vl.RawDeflate.CompressionType,Vl.Deflate.compress=function(t,e){return new Vl.Deflate(t,e).compress()},Vl.Deflate.prototype.compress=function(){var t,e,i,n,r,s,o=0;if(s=this.output,(t=Vl.CompressionMethod.DEFLATE)!==Vl.CompressionMethod.DEFLATE)throw new Error("invalid compression method");if(e=Math.LOG2E*Math.log(Vl.RawDeflate.WindowSize)-8<<4|t,s[o++]=e,0,t!==Vl.CompressionMethod.DEFLATE)throw new Error("invalid compression method");switch(this.compressionType){case Vl.Deflate.CompressionType.NONE:n=0;break;case Vl.Deflate.CompressionType.FIXED:n=1;break;case Vl.Deflate.CompressionType.DYNAMIC:n=2;break;default:throw new Error("unsupported compression type")}return i=n<<6|0,i|=31-(256*e+i)%31,s[o++]=i,r=Vl.Adler32(this.input),this.rawDeflate.op=o,o=(s=this.rawDeflate.compress()).length,(s=new Uint8Array(s.buffer)).length<=o+4&&(this.output=new Uint8Array(s.length+4),this.output.set(s),s=this.output),(s=s.subarray(0,o+4))[o++]=r>>24&255,s[o++]=r>>16&255,s[o++]=r>>8&255,s[o++]=255&r,s},"undefined"==typeof btoa&&require("btoa"),"object"==typeof process&&"undefined"==typeof window&&(global.atob=function(t){return Buffer.from(t,"base64").toString("binary")});const Yl={licorice:"#000000",lead:"#1e1e1e",tungsten:"#3a3a3a",iron:"#545453",steel:"#6e6e6e",tin:"#878687",nickel:"#888787",aluminum:"#a09fa0",magnesium:"#b8b8b8",silver:"#d0d0d0",mercury:"#e8e8e8",snow:"#ffffff",cayenne:"#891100",mocha:"#894800",aspargus:"#888501",fern:"#458401",clover:"#028401",moss:"#018448",teal:"#008688",ocean:"#004a88",midnight:"#001888",eggplant:"#491a88",plum:"#891e88",maroon:"#891648",maraschino:"#ff2101",tangerine:"#ff8802",lemon:"#fffa03",lime:"#83f902",spring:"#05f802",seam_foam:"#03f987",turquoise:"#00fdff",aqua:"#008cff",blueberry:"#002eff",grape:"#8931ff",magenta:"#ff39ff",strawberry:"#ff2987",salmon:"#ff726e",cantaloupe:"#ffce6e",banana:"#fffb6d",honeydew:"#cefa6e",flora:"#68f96e",spindrift:"#68fbd0",ice:"#68fdff",sky:"#6acfff",orchid:"#6e76ff",lavender:"#d278ff",bubblegum:"#ff7aff",carnation:"#ff7fd3"};new class{constructor(t){this.requestsPerSecond=t.requestsPerSecond||10,this.lastStartTime=0,this.queued=[]}add(t,e){var i=this;return new Promise((function(e,n){i.queued.push({resolve:e,reject:n,asyncFunction:t}),i.dequeue()}))}addAll(t,e){var i=t.map(function(t){return this.add(t,e)}.bind(this));return Promise.all(i)}dequeue(){if(this.queued.length>0){var t=new Date,e=1e3/this.requestsPerSecond+1,i=t-this.lastStartTime;i>=e?this._execute():setTimeout(function(){this.dequeue()}.bind(this),e-i)}}async _execute(){this.lastStartTime=new Date;var t=this.queued.shift();const e=t.asyncFunction;try{const i=await e();t.resolve(i)}catch(e){t.reject(e)}}}({requestsPerSecond:8});class Xl{constructor({value:t,label:e,onchange:i}){if(this.elem=Fl({class:"igv-ui-generic-dialog-label-input"}),e){const t=Fl();t.innerHTML=e,this.elem.appendChild(t)}this.textBox=Nl("input"),t&&(this.textBox.value=t),this.elem.appendChild(this.textBox),i&&this.textBox.addEventListener("change",(t=>i(this.textBox.value)))}get value(){return this.textBox.value}set value(t){this.textBox.value=t}}class Jl{constructor(){this.elem=Nl("div",{class:"igv-ui-panel-column"})}add(t){if(t instanceof Node)this.elem.append(t);else if("object"==typeof t)this.elem.append(t.elem);else{const e=Fl();e.innerHTML=t,this.elem.append(e)}}}class Ql{constructor({label:t,content:e,okHandler:i,cancelHandler:n}){const r=()=>{_l(this.elem),"function"==typeof n&&n(this)};this.elem=Fl({class:"igv-ui-generic-dialog-container"});const s=Fl({class:"igv-ui-generic-dialog-header"});if(this.elem.appendChild(s),Pl(s,r),t){const e=Fl({class:"igv-ui-dialog-one-liner"});this.elem.appendChild(e),e.innerHTML=t}e.elem.style.margin="8px",this.elem.appendChild(e.elem);const o=Fl({class:"igv-ui-generic-dialog-ok-cancel"});this.elem.appendChild(o),this.ok=Fl(),o.appendChild(this.ok),this.ok.textContent="OK",this.cancel=Fl(),o.appendChild(this.cancel),this.cancel.textContent="Cancel",this.ok.addEventListener("click",(t=>{_l(this.elem),"function"==typeof i&&i(this)})),this.cancel.addEventListener("click",r),jl(this.elem,s),this.elem.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation()}))}present(t,e){this.label.textContent=t.label,this.input.value=t.value,this.callback=t.callback;const i=$l(e);this.clampLocation(i.x,i.y),Ol(this.elem)}clampLocation(t,e){let i=this.elem.getBoundingClientRect(),n=this.parent.getBoundingClientRect();const r=Math.min(Math.max(e,n.y),n.y+n.height-i.height),s=Math.min(Math.max(t,n.x),n.x+n.width-i.width);this.elem.style.left=s+"px",this.elem.style.top=r+"px"}}class tc{constructor(t,e){const i=new Jl;let n;this.minbox=new Xl({label:"Minimum",value:"0"}),i.add(this.minbox),this.maxbox=new Xl({label:"Maximum",value:"0"}),i.add(this.maxbox),n=e?t=>{e(Number.parseFloat(this.minbox.value),Number.parseFloat(this.maxbox.value))}:t=>{},this.dialog=new Ql({content:i,okHandler:n}),this.dialog.elem.style.position="absolute",_l(this.dialog.elem),t.appendChild(this.dialog.elem)}show({min:t,max:e}){void 0!==t&&(this.minbox.value=t.toString()),void 0!==e&&(this.maxbox.value=e.toString()),Ol(this.dialog.elem)}}const ec={401:"Access unauthorized",403:"Access forbidden",404:"Not found"};class ic{constructor(t){this.container=Fl({class:"igv-ui-alert-dialog-container"}),t.appendChild(this.container),this.container.setAttribute("tabIndex","-1");const e=Fl();this.container.appendChild(e),this.errorHeadline=Fl(),e.appendChild(this.errorHeadline),this.errorHeadline.textContent="";let i=Fl({id:"igv-ui-alert-dialog-body"});this.container.appendChild(i),this.body=Fl({id:"igv-ui-alert-dialog-body-copy"}),i.appendChild(this.body);let n=Fl();this.container.appendChild(n),this.ok=Fl(),n.appendChild(this.ok),this.ok.textContent="OK";const r=()=>{"function"==typeof this.callback&&(this.callback("OK"),this.callback=void 0),this.body.innerHTML="",_l(this.container)};this.ok.addEventListener("click",(t=>{t.stopPropagation(),r()})),this.container.addEventListener("keypress",(t=>{t.stopPropagation(),"Enter"===t.key&&r()})),jl(this.container,e),_l(this.container)}present(t,e){this.errorHeadline.textContent=t.message?"ERROR":"";let i=t.message||t;ec.hasOwnProperty(i)&&(i=ec[i]),this.body.innerHTML=i,this.callback=e,Ol(this.container),this.container.focus()}}let nc;const rc={init(t){nc||(nc=new ic(t))},presentAlert(t,e){nc||this.init(document.body),nc.present(t,e)}};class sc{constructor(t){this.parent=t,this.container=Fl({class:"igv-ui-generic-dialog-container"}),t.appendChild(this.container);const e=Fl({class:"igv-ui-generic-dialog-header"});this.container.appendChild(e),this.label=Fl({class:"igv-ui-generic-dialog-one-liner"}),this.container.appendChild(this.label),this.label.text="Unlabeled",this.input_container=Fl({class:"igv-ui-generic-dialog-input"}),this.container.appendChild(this.input_container),this.input=document.createElement("input"),this.input_container.appendChild(this.input);const i=Fl({class:"igv-ui-generic-dialog-ok-cancel"});this.container.appendChild(i),this.ok=Fl(),i.appendChild(this.ok),this.ok.textContent="OK",this.cancel=Fl(),i.appendChild(this.cancel),this.cancel.textContent="Cancel",_l(this.container),this.input.addEventListener("keyup",(t=>{13===t.keyCode&&("function"==typeof this.callback&&(this.callback(this.input.value),this.callback=void 0),this.input.value=void 0,_l(this.container))})),this.ok.addEventListener("click",(()=>{"function"==typeof this.callback&&(this.callback(this.input.value),this.callback=void 0),this.input.value=void 0,_l(this.container)}));const n=()=>{this.input.value="",_l(this.container)};this.cancel.addEventListener("click",n),Pl(e,n),jl(this.container,e)}present(t,e){this.label.textContent=t.label,this.input.value=t.value,this.callback=t.callback||t.click,Ol(this.container);const{x:i,y:n}=$l(e);this.clampLocation(i,n)}clampLocation(t,e){const{width:i,height:n}=this.container.getBoundingClientRect(),{x:r,y:s,width:o,height:a}=this.parent.getBoundingClientRect(),h=Math.min(Math.max(e,s),s+a-n),l=Math.min(Math.max(t,r),r+o-i);this.container.style.left=`${l}px`,this.container.style.top=`${h}px`}}class oc extends class{constructor({parent:t,top:e,left:i,width:n,height:r,border:s,closeHandler:o}){let a=Fl({class:"igv-ui-generic-container"});t.appendChild(a),_l(a),this.container=a,void 0!==e&&(this.container.style.top=`${e}px`),void 0!==i&&(this.container.style.left=`${i}px`),void 0!==n&&(this.container.style.width=`${n}px`),void 0!==r&&(this.container.style.height=`${r}px`),s&&(this.container.style.border=s);const h=Fl();this.container.appendChild(h),Pl(h,(t=>{_l(this.container),"function"==typeof o&&o(t)})),jl(this.container,h)}show(){Ol(this.container)}hide(){_l(this.container)}dispose(){this.container.parent&&this.container.parent.removeChild(this.container)}}{constructor({parent:t,top:e,left:i,width:n,height:r,defaultColors:s,colorHandler:o}){super({parent:t,top:e,left:i,width:n,height:r,border:"1px solid gray"}),ac(this.container,o,s)}}const ac=(t,e,i)=>{const n=Object.values(Yl);for(let i of n){const n=Fl({class:"igv-ui-color-swatch"});t.appendChild(n),hc(n,i,e)}if(i)for(let n of i){const i=Fl({class:"igv-ui-color-swatch"});t.appendChild(i),hc(i,n,e)}},hc=(t,e,i)=>{t.style.backgroundColor=e,t.addEventListener("mouseenter",(i=>t.style.borderColor=e)),t.addEventListener("mouseleave",(e=>t.style.borderColor="white")),t.addEventListener("click",(t=>{t.stopPropagation(),i(e)})),t.addEventListener("touchend",(t=>{t.stopPropagation(),i(e)}))};if("undefined"!=typeof document){function uf(t){for(let e of document.styleSheets)if(e=e.href?e.href.replace(/^.*[\\\/]/,""):"",e===t)return!0;return!1}uf("igv-ui.css")||((lc=document.createElement("style")).setAttribute("type","text/css"),lc.innerHTML='.igv-ui-popover {\n  cursor: default;\n  position: absolute;\n  z-index: 2048;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: 1px;\n  font-family: "Open Sans", sans-serif;\n  font-size: small;\n  background-color: white; }\n  .igv-ui-popover > div:first-child {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    justify-content: flex-end;\n    align-items: center;\n    width: 100%;\n    height: 24px;\n    cursor: move;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    border-bottom-color: #7F7F7F;\n    border-bottom-style: solid;\n    border-bottom-width: thin;\n    background-color: #eee; }\n    .igv-ui-popover > div:first-child > div {\n      margin-right: 4px;\n      height: 12px;\n      width: 12px;\n      color: #7F7F7F; }\n    .igv-ui-popover > div:first-child > div:hover {\n      cursor: pointer;\n      color: #444; }\n  .igv-ui-popover > div:last-child {\n    overflow-y: auto;\n    overflow-x: hidden;\n    max-height: 400px;\n    background-color: white; }\n    .igv-ui-popover > div:last-child > div {\n      -webkit-user-select: all;\n      /* Chrome/Safari */\n      -moz-user-select: all;\n      /* Firefox */\n      margin-left: 4px;\n      margin-right: 4px;\n      max-width: 384px;\n      min-width: 220px;\n      overflow-x: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap; }\n      .igv-ui-popover > div:last-child > div > span {\n        font-weight: bolder; }\n    .igv-ui-popover > div:last-child hr {\n      width: 100%; }\n\n.igv-ui-alert-dialog-container {\n  box-sizing: content-box;\n  position: absolute;\n  z-index: 2048;\n  top: 50%;\n  left: 50%;\n  width: 400px;\n  height: 200px;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  outline: none;\n  font-family: "Open Sans", sans-serif;\n  font-size: 15px;\n  font-weight: 400;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  align-items: center; }\n  .igv-ui-alert-dialog-container > div:first-child {\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: flex-start;\n    align-items: center;\n    width: 100%;\n    height: 24px;\n    cursor: move;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    border-bottom-color: #7F7F7F;\n    border-bottom-style: solid;\n    border-bottom-width: thin;\n    background-color: #eee; }\n    .igv-ui-alert-dialog-container > div:first-child div:first-child {\n      padding-left: 8px; }\n  .igv-ui-alert-dialog-container #igv-ui-alert-dialog-body {\n    color: #373737;\n    width: 100%;\n    height: calc(100% - 24px - 64px);\n    overflow-y: scroll; }\n    .igv-ui-alert-dialog-container #igv-ui-alert-dialog-body #igv-ui-alert-dialog-body-copy {\n      cursor: pointer;\n      margin: 16px;\n      width: auto;\n      height: auto;\n      overflow-wrap: break-word;\n      word-break: break-word;\n      background-color: white;\n      border: unset; }\n  .igv-ui-alert-dialog-container > div:last-child {\n    width: 100%;\n    margin-bottom: 10px;\n    background-color: white;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: center;\n    align-items: center; }\n    .igv-ui-alert-dialog-container > div:last-child div {\n      margin: unset;\n      width: 40px;\n      height: 30px;\n      line-height: 30px;\n      text-align: center;\n      color: white;\n      font-family: "Open Sans", sans-serif;\n      font-size: small;\n      font-weight: 400;\n      border-color: #2B81AF;\n      border-style: solid;\n      border-width: thin;\n      border-radius: 4px;\n      background-color: #2B81AF; }\n    .igv-ui-alert-dialog-container > div:last-child div:hover {\n      cursor: pointer;\n      border-color: #25597f;\n      background-color: #25597f; }\n\n.igv-ui-color-swatch {\n  position: relative;\n  box-sizing: content-box;\n  display: flex;\n  flex-flow: row;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  width: 32px;\n  height: 32px;\n  border-style: solid;\n  border-width: 2px;\n  border-color: white;\n  border-radius: 4px; }\n\n.igv-ui-color-swatch:hover {\n  border-color: dimgray; }\n\n.igv-ui-colorpicker-menu-close-button {\n  display: flex;\n  flex-flow: row;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  height: 32px;\n  margin-top: 4px;\n  margin-bottom: 4px;\n  padding-right: 8px; }\n  .igv-ui-colorpicker-menu-close-button i.fa {\n    display: block;\n    margin-left: 4px;\n    margin-right: 4px;\n    color: #5f5f5f; }\n  .igv-ui-colorpicker-menu-close-button i.fa:hover,\n  .igv-ui-colorpicker-menu-close-button i.fa:focus,\n  .igv-ui-colorpicker-menu-close-button i.fa:active {\n    cursor: pointer;\n    color: #0f0f0f; }\n\n.igv-ui-generic-dialog-container {\n  box-sizing: content-box;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 300px;\n  height: 200px;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  z-index: 2048;\n  background-color: white;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-header {\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: flex-end;\n    align-items: center;\n    width: 100%;\n    height: 24px;\n    cursor: move;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    border-bottom-color: #7F7F7F;\n    border-bottom-style: solid;\n    border-bottom-width: thin;\n    background-color: #eee; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-header div {\n      margin-right: 4px;\n      margin-bottom: 2px;\n      height: 12px;\n      width: 12px;\n      color: #7F7F7F; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-header div:hover {\n      cursor: pointer;\n      color: #444; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-one-liner {\n    color: #373737;\n    width: 95%;\n    height: 24px;\n    line-height: 24px;\n    text-align: left;\n    margin-top: 8px;\n    padding-left: 8px;\n    overflow-wrap: break-word;\n    background-color: white; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input {\n    margin-top: 8px;\n    width: 95%;\n    height: 24px;\n    color: #373737;\n    line-height: 24px;\n    padding-left: 8px;\n    background-color: white;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: flex-start;\n    align-items: center; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input div {\n      width: 30%;\n      height: 100%;\n      font-size: 16px;\n      text-align: right;\n      padding-right: 8px;\n      background-color: white; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input input {\n      display: block;\n      height: 100%;\n      width: 100%;\n      padding-left: 4px;\n      font-family: "Open Sans", sans-serif;\n      font-weight: 400;\n      color: #373737;\n      text-align: left;\n      outline: none;\n      border-style: solid;\n      border-width: thin;\n      border-color: #7F7F7F;\n      background-color: white; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-label-input input {\n      width: 50%;\n      font-size: 16px; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-input {\n    margin-top: 8px;\n    width: calc(100% - 16px);\n    height: 24px;\n    color: #373737;\n    line-height: 24px;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: space-around;\n    align-items: center; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-input input {\n      display: block;\n      height: 100%;\n      width: 100%;\n      padding-left: 4px;\n      font-family: "Open Sans", sans-serif;\n      font-weight: 400;\n      color: #373737;\n      text-align: left;\n      outline: none;\n      border-style: solid;\n      border-width: thin;\n      border-color: #7F7F7F;\n      background-color: white; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-input input {\n      font-size: 16px; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel {\n    width: 100%;\n    height: 28px;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: space-around;\n    align-items: center; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div {\n      margin-top: 32px;\n      color: white;\n      font-family: "Open Sans", sans-serif;\n      font-size: 14px;\n      font-weight: 400;\n      width: 75px;\n      height: 28px;\n      line-height: 28px;\n      text-align: center;\n      border-color: transparent;\n      border-style: solid;\n      border-width: thin;\n      border-radius: 2px; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:first-child {\n      margin-left: 32px;\n      margin-right: 0;\n      background-color: #5ea4e0; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:last-child {\n      margin-left: 0;\n      margin-right: 32px;\n      background-color: #c4c4c4; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:first-child:hover {\n      cursor: pointer;\n      background-color: #3b5c7f; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok-cancel div:last-child:hover {\n      cursor: pointer;\n      background-color: #7f7f7f; }\n  .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok {\n    width: 100%;\n    height: 36px;\n    margin-top: 32px;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: space-around;\n    align-items: center; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok div {\n      width: 98px;\n      height: 36px;\n      line-height: 36px;\n      text-align: center;\n      color: white;\n      font-family: "Open Sans", sans-serif;\n      font-size: medium;\n      font-weight: 400;\n      border-color: white;\n      border-style: solid;\n      border-width: thin;\n      border-radius: 4px;\n      background-color: #2B81AF; }\n    .igv-ui-generic-dialog-container .igv-ui-generic-dialog-ok div:hover {\n      cursor: pointer;\n      background-color: #25597f; }\n\n.igv-ui-generic-container {\n  box-sizing: content-box;\n  position: absolute;\n  z-index: 2048;\n  background-color: white;\n  cursor: pointer;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  align-items: center; }\n  .igv-ui-generic-container div:first-child {\n    cursor: move;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: flex-end;\n    align-items: center;\n    height: 24px;\n    width: 100%;\n    background-color: #dddddd; }\n    .igv-ui-generic-container div:first-child div {\n      display: block;\n      color: #5f5f5f;\n      cursor: pointer;\n      width: 14px;\n      height: 14px;\n      margin-right: 8px;\n      margin-bottom: 4px; }\n\n.igv-ui-dialog {\n  z-index: 2048;\n  position: fixed;\n  width: fit-content;\n  height: fit-content;\n  display: flex;\n  flex-flow: column;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  background-color: white;\n  border-color: #7F7F7F;\n  border-radius: 4px;\n  border-style: solid;\n  border-width: thin;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400; }\n  .igv-ui-dialog .igv-ui-dialog-header {\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: flex-end;\n    align-items: center;\n    width: 100%;\n    height: 24px;\n    cursor: move;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    border-bottom-color: #7F7F7F;\n    border-bottom-style: solid;\n    border-bottom-width: thin;\n    background-color: #eee; }\n    .igv-ui-dialog .igv-ui-dialog-header div {\n      margin-right: 4px;\n      margin-bottom: 2px;\n      height: 12px;\n      width: 12px;\n      color: #7F7F7F; }\n    .igv-ui-dialog .igv-ui-dialog-header div:hover {\n      cursor: pointer;\n      color: #444; }\n  .igv-ui-dialog .igv-ui-dialog-one-liner {\n    width: 95%;\n    height: 24px;\n    line-height: 24px;\n    text-align: left;\n    margin: 8px;\n    overflow-wrap: break-word;\n    background-color: white;\n    font-weight: bold; }\n  .igv-ui-dialog .igv-ui-dialog-ok-cancel {\n    width: 100%;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: space-around;\n    align-items: center; }\n    .igv-ui-dialog .igv-ui-dialog-ok-cancel div {\n      margin: 16px;\n      margin-top: 32px;\n      color: white;\n      font-family: "Open Sans", sans-serif;\n      font-size: 14px;\n      font-weight: 400;\n      width: 75px;\n      height: 28px;\n      line-height: 28px;\n      text-align: center;\n      border-color: transparent;\n      border-style: solid;\n      border-width: thin;\n      border-radius: 2px; }\n    .igv-ui-dialog .igv-ui-dialog-ok-cancel div:first-child {\n      background-color: #5ea4e0; }\n    .igv-ui-dialog .igv-ui-dialog-ok-cancel div:last-child {\n      background-color: #c4c4c4; }\n    .igv-ui-dialog .igv-ui-dialog-ok-cancel div:first-child:hover {\n      cursor: pointer;\n      background-color: #3b5c7f; }\n    .igv-ui-dialog .igv-ui-dialog-ok-cancel div:last-child:hover {\n      cursor: pointer;\n      background-color: #7f7f7f; }\n  .igv-ui-dialog .igv-ui-dialog-ok {\n    width: 100%;\n    height: 36px;\n    margin-top: 32px;\n    display: flex;\n    flex-flow: row;\n    flex-wrap: nowrap;\n    justify-content: space-around;\n    align-items: center; }\n    .igv-ui-dialog .igv-ui-dialog-ok div {\n      width: 98px;\n      height: 36px;\n      line-height: 36px;\n      text-align: center;\n      color: white;\n      font-family: "Open Sans", sans-serif;\n      font-size: medium;\n      font-weight: 400;\n      border-color: white;\n      border-style: solid;\n      border-width: thin;\n      border-radius: 4px;\n      background-color: #2B81AF; }\n    .igv-ui-dialog .igv-ui-dialog-ok div:hover {\n      cursor: pointer;\n      background-color: #25597f; }\n\n.igv-ui-panel, .igv-ui-panel-column, .igv-ui-panel-row {\n  z-index: 2048;\n  background-color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-start; }\n\n.igv-ui-panel-column {\n  display: flex;\n  flex-direction: column; }\n\n.igv-ui-panel-row {\n  display: flex;\n  flex-direction: row; }\n\n.igv-ui-textbox {\n  background-color: white;\n  font-family: "Open Sans", sans-serif;\n  font-size: medium;\n  font-weight: 400;\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-start; }\n\n/*# sourceMappingURL=igv-ui.css.map */\n',document.head.insertBefore(lc,document.head.childNodes[document.head.childNodes.length-1]))}var lc;const cc={},uc="displayAllMatrix",fc="displayLowerMatrix",dc="displayUpperMatrix";class pc{constructor(){this.subscribers={},this.stack=[]}subscribe(t,e){var i=this.subscribers[t];null==i&&(i=[],this.subscribers[t]=i),i.push(e)}post(t){const e=t.type;if(this._hold)this.stack.push(t);else{const i=this.subscribers[e];if(i)for(let e of i)"function"==typeof e.receiveEvent?e.receiveEvent(t):"function"==typeof e&&e(t)}}hold(){this._hold=!0}release(){this._hold=!1;for(let t of this.stack)this.post(t);this.stack=[]}}pc.globalBus=new pc;class gc{constructor(t,e){this.config=t,this.name=t.name,this.featureMap={},this.featureCount=0,this.isVisible=!0,this.displayMode=uc,t.color&&function(t){var e=document.createElement("div");return e.style.borderColor=t,""!==e.style.borderColor}(t.color)&&(this.color=this.color=t.color),this.repColor=e.length>0?e[0].color:"black";for(let t of e){this.featureCount++;const e=mc(t.chr1,t.chr2);let i=this.featureMap[e];i||(i=[],this.featureMap[e]=i),i.push(t)}}static async loadTrack2D(t,e){const i=await nt.loadString(t.url,function(t,e){const i={oauthToken:t.oauthToken,headers:t.headers,withCredentials:t.withCredentials,filename:t.filename};return Object.assign(i,e)}(t)),n=function(t,e,i){if(!t)return null;const n=f(t),r=[],s="\t",o=e?10:6;let a=0;for(let t of n){if(t=t.trim(),t.startsWith("#")||t.startsWith("track")||t.startsWith("browser")||0===t.length)continue;const e=t.split(s);if(e.length<6&&a<=5){5===a?console.error("..."):console.error("Could not parse line: "+t),a++;continue}const n={chr1:i?i.getChromosomeName(e[0]):e[0],x1:parseInt(e[1]),x2:parseInt(e[2]),chr2:i?i.getChromosomeName(e[3]):e[3],y1:parseInt(e[4]),y2:parseInt(e[5])};e.length>o&&(n.color="rgb("+e[o]+")"),Number.isNaN(n.x1)||r.push(n)}return r}(i,function(t){return"string"==typeof t.url?t.url.toLowerCase().indexOf(".bedpe")>0:"string"!=typeof t.name||t.name.toLowerCase().indexOf(".bedpe")>0}(t),e);return new gc(t,n)}getColor(){return this.color||this.repColor}getFeatures(t,e){const i=mc(t,e);return this.featureMap[i]}}function mc(t,e){return t>e?e+"_"+t:t+"_"+e}class wc{constructor(t,e,i){this.browser=t,this.axis=i,this.$axis=e.find("div[id$='-axis']"),this.$canvas=e.find("canvas"),this.ctx=this.$canvas.get(0).getContext("2d"),this.ctx.canvas.width=this.$axis.width(),this.ctx.canvas.height=this.$axis.height(),this.$wholeGenomeContainer=e.find("div[id$='-axis-whole-genome-container']"),this.yAxisTransformWithContext=t=>{t.scale(-1,1),t.rotate(Math.PI/2)},this.setAxisTransform(i),t.eventBus.subscribe("MapLoad",this),t.eventBus.subscribe("UpdateContactMapMousePosition",this)}wholeGenomeLayout(t,e,i,n){var r,s,o,a,h,l,c=this;if(e.empty(),r=n.chromosomes.filter((function(t){return"all"!==t.name.toLowerCase()})),o=0,r.forEach((function(t){o+=t.size})),s="x"===i?t.width():t.height(),a=0,this.bboxes=[],l=void 0,r.forEach((function(t){var n,r;if((r=t.bpLength/o)*s<1)a+=r;else{h=_i("<div>",{class:`${c.axis}-axis-whole-genome-chromosome-container`}),e.append(h),h.data("label",t.name),l||(l=h),"x"===i?(n=Math.round(r*s),h.width(n)):(n=Math.round(r*s),h.height(n));const o=_i("<div>");h.append(o);const a=_i("<div>");o.append(a),a.text(h.data("label")),a.get(0).title=h.data("label"),u.call(c,h)}})),a*=s,(a=Math.floor(a))>=1){const t=c.axis+"-axis-whole-genome-chromosome-container";h=_i("<div>",{class:t}),e.append(h),h.data("label","-"),h.width(a),u.call(c,h)}function u(t){var e=this;t.on("click",(function(t){var i;i=_i(this).first(),e.browser.parseGotoInput(i.text()),e.unhighlightWholeChromosome(),e.otherRuler.unhighlightWholeChromosome()})),t.hover((function(){f.call(e,_i(this),!0)}),(function(){f.call(e,_i(this),!1)}))}function f(t,e){var i,n;i=t.data("label"),this.otherRuler.$wholeGenomeContainer.children().each((function(t){i===_i(this).data("label")&&(n=_i(this))})),!0===e?(t.addClass("hic-whole-genome-chromosome-highlight"),n.addClass("hic-whole-genome-chromosome-highlight")):(t.removeClass("hic-whole-genome-chromosome-highlight"),n.removeClass("hic-whole-genome-chromosome-highlight"))}e.children().each((function(t){var e,n,r,s,o,a,h;c.bboxes.push((e=i,n=_i(this),r=l,a="x"===e?n.offset().left:n.offset().top,h="x"===e?r.offset().left:r.offset().top,s=a-h,o="x"===e?n.width():n.height(),{$e:n,a:s,b:s+o}))})),this.hideWholeGenome()}hideWholeGenome(){this.$wholeGenomeContainer.hide(),this.$canvas.show()}showWholeGenome(){this.$canvas.hide(),this.$wholeGenomeContainer.show()}setAxisTransform(t){this.canvasTransform="y"===t?this.yAxisTransformWithContext:vc,this.labelReflectionTransform="y"===t?yc:function(t,e){}}unhighlightWholeChromosome(){this.$wholeGenomeContainer.children().removeClass("hic-whole-genome-chromosome-highlight")}receiveEvent(t){var e,i,n,r,s,o;"MapLoad"===t.type?(this.wholeGenomeLayout(this.$axis,this.$wholeGenomeContainer,this.axis,t.data),this.update()):"UpdateContactMapMousePosition"===t.type&&this.bboxes&&(this.unhighlightWholeChromosome(),e="x"===this.axis?t.data.x:t.data.y,n=this.bboxes,r=e,o=!1,s=void 0,n.forEach((function(t){!1===o&&(r<t.a||r>t.b||(s=t.$e,o=!0))})),(i=s)&&i.addClass("hic-whole-genome-chromosome-highlight"))}locusChange(t){this.update()}updateWidthWithCalculation(t){this.$axis.css("width",t),this.$canvas.width(this.$axis.width()),this.$canvas.attr("width",this.$axis.width()),this.wholeGenomeLayout(this.$axis,this.$wholeGenomeContainer,this.axis,this.browser.dataset),this.update()}updateHeight(t){this.$canvas.height(t),this.$canvas.attr("height",t),this.wholeGenomeLayout(this.$axis,this.$wholeGenomeContainer,this.axis,this.browser.dataset),this.update()}update(){var t,e,i,n={},r=this.browser;r.dataset.isWholeGenome(r.state.chr1)?this.showWholeGenome():(this.hideWholeGenome(),vc(this.ctx),al.fillRect(this.ctx,0,0,this.$canvas.width(),this.$canvas.height(),{fillStyle:V.rgbColor(255,255,255)}),this.canvasTransform(this.ctx),t="x"===this.axis?this.$canvas.width():this.$canvas.height(),e="x"===this.axis?this.$canvas.height():this.$canvas.width(),al.fillRect(this.ctx,0,0,t,e,{fillStyle:V.rgbColor(255,255,255)}),n.bpPerPixel=r.dataset.bpResolutions[r.state.zoom]/r.state.pixelSize,i="x"===this.axis?r.state.x:r.state.y,n.bpStart=i*r.dataset.bpResolutions[r.state.zoom],n.rulerTickMarkReferencePixels=Math.max(Math.max(this.$canvas.width(),this.$canvas.height()),Math.max(this.$otherRulerCanvas.width(),this.$otherRulerCanvas.height())),n.rulerLengthPixels=t,n.rulerHeightPixels=e,n.height=Math.min(this.$canvas.width(),this.$canvas.height()),this.draw(n))}draw(t){var e,i,n,r,s,o,a,h,l,c,u=this.browser.dataset.chromosomes;if("x"===this.axis?u[this.browser.state.chr1].name:u[this.browser.state.chr2].name,c="x"===this.axis?u[this.browser.state.chr1].size:u[this.browser.state.chr2].size,"all"===t.chrName);else{for(al.fillRect(this.ctx,0,0,t.rulerLengthPixels,t.rulerHeightPixels,{fillStyle:V.rgbColor(255,255,255)}),e={textAlign:"center",font:"9px PT Sans",fillStyle:"rgba(64, 64, 64, 1)",strokeStyle:"rgba(64, 64, 64, 1)"},n=(i=function(t){if(t<10)return new bc(1,"",1);var e=Math.floor(r(t)),i="",n=1;e>9&&(i="gb",n=1e9);e>6?(i="mb",n=1e6):e>3&&(i="kb",n=1e3);return t/Math.pow(10,e-1)<25?new bc(Math.pow(10,e-1),i,n):new bc(Math.pow(10,e)/2,i,n);function r(t){var e=Math.log(10);return Math.log(t)/e}}(Math.floor(t.rulerTickMarkReferencePixels*t.bpPerPixel))).majorTick,r=Math.floor(t.bpStart/n)-1,o=s=0,al.setProperties(this.ctx,e),this.ctx.lineWidth=1,1,8;o<t.rulerLengthPixels;)h=Math.floor(r*n),o=Math.round((h-1-t.bpStart+.5)/t.bpPerPixel),l=f(h/i.unitMultiplier,0)+" "+i.majorUnit,a=Math.abs(o-s),0==r%(this.ctx.measureText(l).width>a?a<32?4:2:1)&&Math.floor(o*t.bpPerPixel+t.bpStart)<c&&(this.ctx.save(),this.labelReflectionTransform(this.ctx,o),al.fillText(this.ctx,l,o,t.height-8/.75),this.ctx.restore()),Math.floor(o*t.bpPerPixel+t.bpStart)<c&&al.strokeLine(this.ctx,o,t.height-8,o,t.height-1),s=o,r++;al.strokeLine(this.ctx,0,t.height-1,t.rulerLengthPixels,t.height-1)}function f(t,e){var i=10;switch(e){case 0:i=1;break;case 1:i=10;break;case 2:i=100;break;default:i=1e3}var n=""+Math.abs(Math.round(t*i)/i);-1===n.indexOf(".")&&(n+=".");for(var r=n.substr(0,n.indexOf(".")),s=r-0,o=n.substr(n.indexOf("."));o.length-1<e;)o+="0";if("."===o&&(o=""),s>=1e3){var a=r.length;r=parseInt(""+s/1e3)+","+r.substring(a-3,a)}s>=1e6&&(a=r.length,r=parseInt(""+s/1e6)+","+r.substring(a-7,a));var h=r+o;return t<0&&(h="("+h+")"),h}}}function bc(t,e,i){this.majorTick=t,this.majorUnit=e,this.unitMultiplier=i}function yc(t,e){t.translate(e,0),t.scale(-1,1),t.translate(-e,0)}function vc(t){t.setTransform(1,0,0,1,0,0)}const xc=function(t){this.$popover=_i("<div>",{class:"igv-menu-popup"}),t.append(this.$popover);let e=_i("<div>",{class:"igv-menu-popup-header"});this.$popover.append(e),o(e.get(0),(()=>this.$popover.hide())),this.$popoverContent=_i("<div>"),this.$popover.append(this.$popoverContent),G(this.$popover.get(0),e.get(0)),e.on("click.menu-popup-dismiss",(function(t){t.stopPropagation(),t.preventDefault()}))};xc.prototype.presentMenuList=function(t,e,i){if(Cc(),i.length>0){this.$popoverContent.empty(),i=((t,e)=>{var i=[];return t.length>0&&(i=t.map((function(t,i){let n;if(t.name?(n=_i("<div>"),n.text(t.name)):t.object?n=_i(t.object):"string"==typeof t.label?(n=_i("<div>"),n.html(t.label)):"string"==typeof t&&(n=t.startsWith("<")?_i(t):_i("<div>"+t+"</div>")),0===i&&n.addClass("igv-track-menu-border-top"),t.click){function r(i){t.click(i),e.hide(),i.preventDefault(),i.stopPropagation()}n.on("click",r),n.on("touchend",(function(t){r(t)})),n.on("mouseup",(function(t){t.preventDefault(),t.stopPropagation()}))}return{object:n,init:t.init||void 0}}))),i})(i,this.$popover);for(let t of i){t.init&&t.init();let e=t.object;0===i.indexOf(t)&&e.removeClass("igv-track-menu-border-top"),e.hasClass("igv-track-menu-border-top")||e.hasClass("igv-menu-popup-check-container")||e.is("div")&&e.addClass("igv-menu-popup-shim"),this.$popoverContent.append(e)}this.$popover.css({left:t+"px",top:e+"px"}),this.$popover.show()}},xc.prototype.presentTrackContextMenu=function(i,n){this.$popoverContent.empty();const r=(s=n,o=this.$popover.get(0),s.map((i=>{let n;if("string"==typeof i&&"<hr/>"===i)n=document.createElement("hr");else if("string"==typeof i)n=t({class:"context-menu"}),n.innerHTML=i;else if("Node"==typeof i)n=i;else{if("function"==typeof i.init&&i.init(),"checkbox"===i.type)n=Icon.createCheckbox("Show all bases",i.value);else if("color"===i.type){const r=new oc({parent:o.parentElement,width:364,colorHandler:t=>i.click(t)});n=t({class:"context-menu"}),"string"==typeof i.label&&(n.innerHTML=i.label);const s=t=>{r.show(),e(o),t.preventDefault(),t.stopPropagation()};n.addEventListener("click",s),n.addEventListener("touchend",s),n.addEventListener("mouseup",(function(t){t.preventDefault(),t.stopPropagation()}))}else n=t({class:"context-menu"}),"string"==typeof i.label&&(n.innerHTML=i.label);if(i.click&&"color"!==i.type){function a(t){i.click(),e(o),t.preventDefault(),t.stopPropagation()}n.addEventListener("click",a),n.addEventListener("touchend",a),n.addEventListener("mouseup",(function(t){t.preventDefault(),t.stopPropagation()}))}}return{object:n,init:i.init}})));var s,o;for(let t of r)this.$popoverContent.get(0).appendChild(t.object);!function(t,e){const{x:i,y:n}=function(t,e){const{clientX:i,clientY:n}=t;return((t,{clientX:e,clientY:i})=>{const{left:n,top:r,width:s,height:o}=t.getBoundingClientRect(),a=e-n,h=i-r;return{x:a,y:h,xNormalized:a/s,yNormalized:h/o,width:s,height:o}})(e,{clientX:i,clientY:n})}(t,e.parentNode),{width:r}=e.parentNode.getBoundingClientRect(),{width:s}=e.getBoundingClientRect(),o=i+s;e.style.left=`${o>r?i-(o-r):i}px`,e.style.top=`${n}px`}(i,this.$popover.get(0)),this.$popover.show()},xc.prototype.dispose=function(){this.$popover.empty(),this.$popoverContent.empty(),Object.keys(this).forEach((function(t){this[t]=void 0}))};const Cc=()=>_i(".igv-menu-popup").hide();class Sc{constructor(t,e,i,n,r,s){this.browser=t,this.track=r,this.x=new kc(t,{height:e},i,r,"x",s),this.y=new kc(t,{width:e},n,r,"y",s),this.init()}init(){this.colorPicker=new oc({parent:this.x.$viewport[0],width:456,height:void 0,colorHandler:t=>this.setColor(t)}),this.colorPicker.hide(),this.dataRangeDialog=new tc(this.x.$viewport[0],((t,e)=>this.setDataRange(t,e))),this.appendRightHandGutter(this.x.$viewport),this.track.trackView=this,this.track.trackView.trackDiv=this.x.$viewport.get(0)}presentColorPicker(){const t=this.x.trackDiv.getBoundingClientRect();this.colorPicker.origin={x:t.x,y:0},this.colorPicker.$container.offset({left:this.colorPicker.origin.x,top:this.colorPicker.origin.y}),this.colorPicker.$container.show()}setTrackName(t){this.track.name=t,this.x.$label.text(t)}setColor(t){this.y.tile=void 0,this.x.tile=void 0,this.track.color=t,this.repaintViews()}dataRange(){return this.track.dataRange?this.track.dataRange:void 0}setDataRange(t,e){void 0!==t&&(this.track.dataRange.min=t,this.track.config.min=t),void 0!==e&&(this.track.dataRange.max=e,this.track.config.max=e),this.track.autoscale=!1,this.track.config.autoScale=!1,this.y.tile=void 0,this.x.tile=void 0,this.repaintViews()}appendRightHandGutter(t){let e=_i('<div class="hic-igv-right-hand-gutter">');t.append(e),this.createTrackGearPopup(e)}createTrackGearPopup(t){let e=_i("<div>",{class:"igv-trackgear-container"});t.append(e),e.append(function(t,e){return _i(Tl(t,e))}("cog")),this.trackGearPopup=new xc(t),this.trackGearPopup.$popover.hide(),e.click((t=>{t.preventDefault(),t.stopPropagation(),this.trackGearPopup.presentMenuList(-this.trackGearPopup.$popover.width(),0,Il(this))}))}async updateViews(){if(this.updating)this.pending=!0;else try{this.updating=!0;const t=this.browser.genomicState(this.x.axis);let e=await this.getTileX(t);e&&this.x.drawTile(e,t);const i=this.browser.genomicState(this.y.axis);let n=await this.getTileY(i);n&&this.y.drawTile(n,i)}finally{this.updating=!1,this.pending&&(this.pending=!1,this.updateViews())}}async repaintViews(){const t=this.browser.genomicState(this.x.axis);this.tileX&&(this.tileX=await this.createImageTile(t,this.tileX.features),this.x.drawTile(this.tileX,t));const e=this.browser.genomicState(this.y.axis);this.tileY&&(this.tileY=await this.createImageTile(t,this.tileY.features),this.y.drawTile(this.tileY,e))}async getTileX(t){const e=t.chromosome.name,i=t.bpp;return this.tileX&&this.tileX.containsRange(e,t.startBP,t.endBP,i)||(this.tileX=await this.createImageTile(t)),this.tileX}async getTileY(t){const e=t.chromosome.name,i=t.bpp;return this.tileX&&this.tileX.containsRange(e,t.startBP,t.endBP,i)?this.tileY=this.tileX:this.tileY&&this.tileY.containsRange(e,t.startBP,t.endBP,i)||(this.tileY=await this.createImageTile(t)),this.tileY}async createImageTile(t,e){const i=t.chromosome.name,n=t.bpp;if(!(n*Math.max(this.x.$canvas.width(),this.x.$canvas.height())>this.track.visibilityWindow)){const r=3*this.x.$canvas.width(),s=Math.round(n*r),o=Math.max(0,Math.round(t.startBP-s/3)),a=o+s,h=e||await this.track.getFeatures(t.chromosome.name,o,a,n),l=document.createElement("canvas");l.width=r,l.height=this.x.$canvas.height();const c=l.getContext("2d");if(h){const e={features:h,context:c,pixelWidth:r,bpStart:o,bpEnd:a,bpPerPixel:n,genomicState:t,pixelHeight:Math.min(l.width,l.height),viewportContainerX:(t.startBP-o)/n,viewportContainerWidth:r,viewportWidth:r,referenceFrame:{}};!this.track.autoscale&&this.track.dataRange||("function"==typeof this.track.doAutoscale?this.track.doAutoscale(h):this.track.dataRange=function(t){var e,i;return t.length>0?(e=Number.MAX_VALUE,i=-Number.MAX_VALUE,t.forEach((function(t){Number.isNaN(t.value)||(e=Math.min(e,t.value),i=Math.max(i,t.value))})),i>0&&(e=Math.min(0,e)),i<0&&(i=0)):(e=0,i=100),{min:e,max:i}}(h)),this.track.draw(e)}else c.clearRect(0,0,this.$canvas.width(),this.$canvas.height());return this.tile=new Tc(i,o,a,n,l,h),this.tile}}dispose(){this.x.dispose(),this.y.dispose()}}class kc{constructor(t,e,n,r,s,o){this.browser=t,this.track=r,this.id=`trackRender_${i()}`,this.axis=s,this.init(n,e,o)}init(t,e,i){var n=this;if(this.$viewport="x"===this.axis?_i('<div class="x-track-canvas-container">'):_i('<div class="y-track-canvas-container">'),e.width&&this.$viewport.width(e.width),e.height&&this.$viewport.height(e.height),t.append(this.$viewport),this.$viewport.css({order:i}),this.$canvas=_i("<canvas>"),this.$viewport.append(this.$canvas),this.ctx=this.$canvas.get(0).getContext("2d"),"x"===this.axis){this.$label=_i('<div class="x-track-label">');const t=this.track.name||"untitled";this.$label.text(t),this.$viewport.append(this.$label),!0===n.browser.showTrackLabelAndGutter?this.$label.show():this.$label.hide(),this.$viewport.on("click",(function(t){t.preventDefault(),t.stopPropagation(),n.browser.toggleTrackLabelAndGutterState(),!0===n.browser.showTrackLabelAndGutter?(_i(".x-track-label").show(),_i(".hic-igv-right-hand-gutter").show()):(_i(".x-track-label").hide(),_i(".hic-igv-right-hand-gutter").hide())}))}this.$spinner="x"===this.axis?_i('<div class="x-track-spinner">'):_i('<div class="y-track-spinner">'),this.$viewport.append(this.$spinner),this.stopSpinner()}dispose(t,e,i){this.tile=void 0,this.$viewport.remove()}syncCanvas(){this.$canvas.width(this.$viewport.width()),this.$canvas.attr("width",this.$viewport.width()),this.$canvas.height(this.$viewport.height()),this.$canvas.attr("height",this.$viewport.height())}drawTile(t,e){t&&(this.offsetPixel=Math.round((t.startBP-e.startBP)/e.bpp),"x"===this.axis?(this.ctx.clearRect(0,0,this.$canvas.width(),this.$canvas.height()),this.ctx.drawImage(t.buffer,this.offsetPixel,0)):(this.ctx.setTransform(0,1,1,0,0,0),this.ctx.clearRect(0,0,this.$canvas.height(),this.$canvas.width()),this.ctx.drawImage(t.buffer,this.offsetPixel,0)))}startSpinner(){this.browser.startSpinner()}stopSpinner(){this.browser.stopSpinner()}isLoading(){return!(void 0===this.loading)}}class Tc{constructor(t,e,i,n,r,s){this.chr=t,this.startBP=e,this.endBP=i,this.bpp=n,this.buffer=r,this.features=s}containsRange(t,e,i,n){return t===this.chr&&this.bpp===n&&this.startBP<=e&&this.endBP>=i}}const Rc=20,Ic=40;class Dc{constructor(t,e){this.browser=t,function(t,e){const i=_i("<div>",{class:"hic-navbar-container"});e.append(i),i.on("click",(e=>{e.stopPropagation(),e.preventDefault(),Ku(t)}));const n=`<div id="${t.id}-contact-map-hic-nav-bar-map-container">\n            <div id="${t.id}-contact-map-hic-nav-bar-map-label">\n            </div>\n             <div class="hic-nav-bar-button-container">\n                <i class="fa fa-bars fa-lg" title="Present menu"></i>\n                <i class="fa fa-minus-circle fa-lg" title="Delete browser panel" style="display: none;"></i>\n             </div>\n        </div>`;i.append(_i(n)),t.$contactMaplabel=i.find("div[id$='contact-map-hic-nav-bar-map-label']"),t.$menuPresentDismiss=i.find(".fa-bars"),t.$menuPresentDismiss.on("click",(e=>t.toggleMenu())),t.$browser_panel_delete_button=i.find(".fa-minus-circle"),t.$browser_panel_delete_button.on("click",(e=>function(t){t.unsyncSelf(),t.$root.remove(),Zu=Zu.filter((e=>e!=t)),Zu.length<=1&&Zu.forEach((function(t){t.$browser_panel_delete_button.hide()}))}(t))),t.$browser_panel_delete_button.hide();const r=`<div id="${t.id}-control-map-hic-nav-bar-map-container">\n            <div id="${t.id}-control-map-hic-nav-bar-map-label"></div>\n        </div>`;i.append(_i(r)),t.$controlMaplabel=i.find("div[id$='control-map-hic-nav-bar-map-label']");const s=`<div id="${t.id}-upper-hic-nav-bar-widget-container"></div>`;i.append(_i(s));const o=`<div id="${t.id}-lower-hic-nav-bar-widget-container"></div>`;i.append(_i(o))}(t,e),this.createAllContainers(t,e)}createAllContainers(t,e){const i=`<div id="${t.id}-x-track-container"><div id="${t.id}-track-shim"></div><div id="${t.id}-x-tracks"><div id="${t.id}-y-track-guide" style="display: none;"></div></div></div>`;e.append(_i(i)),this.$x_track_container=e.find("div[id$='x-track-container']"),this.$track_shim=this.$x_track_container.find("div[id$='track-shim']"),this.$x_tracks=this.$x_track_container.find("div[id$='x-tracks']"),this.$y_track_guide=this.$x_track_container.find("div[id$='y-track-guide']");const n=`<div id="${t.id}-content-container"></div>`;this.$content_container=_i(n),e.append(this.$content_container);const r=`<div id="${t.id}-x-axis-container">\n            <div id="${t.id}-x-axis">\n                <canvas></canvas>\n                <div id="${t.id}-x-axis-whole-genome-container"></div>\n            </div>\n\t    </div>`;this.$content_container.append(_i(r));const s=this.$content_container.find("div[id$='x-axis-container']");this.xAxisRuler=new wc(t,s,"x");const o=`<div id="${t.id}-y-tracks-y-axis-viewport-y-scrollbar">\n\n            <div id="${t.id}-y-tracks">\n                <div id="${t.id}-x-track-guide" style="display: none;"></div>\n            </div>\n            \n            <div id="${t.id}-y-axis">\n    \t\t\t<canvas></canvas>\n\t\t\t    <div id="${t.id}-y-axis-whole-genome-container"></div>\n\t\t    </div>\n\t\t    \n        </div>`;this.$content_container.append(_i(o));const a=this.$content_container.find("div[id$='-y-tracks-y-axis-viewport-y-scrollbar']");this.$y_tracks=a.find("div[id$='-y-tracks']"),this.$x_track_guide=this.$y_tracks.find("div[id$='-x-track-guide']"),this.yAxisRuler=new wc(t,a,"y"),this.xAxisRuler.$otherRulerCanvas=this.yAxisRuler.$canvas,this.xAxisRuler.otherRuler=this.yAxisRuler,this.yAxisRuler.$otherRulerCanvas=this.xAxisRuler.$canvas,this.yAxisRuler.otherRuler=this.xAxisRuler;const h=`<div id="${t.id}-viewport">\n\t\t\t<canvas></canvas>\n\t\t\t<i class="fa fa-spinner fa-spin" style="font-size: 48px; position: absolute; left: 40%; top: 40%; display: none;"></i>\n\t\t\t<div id="${t.id}-sweep-zoom-container" style="display: none;"></div>\n\t\t\t<div id="${t.id}-x-guide" style="display: none;"></div>\n\t\t\t<div id="${t.id}-y-guide" style="display: none;"></div>\n\t\t</div>`;a.append(_i(h));const l=`<div id="${t.id}-y-axis-scrollbar-container">\n\t\t\t<div id="${t.id}-y-axis-scrollbar">\n\t\t\t\t<div class="scrollbar-label-rotation-in-place"></div>\n\t\t\t</div>\n\t\t</div>`;a.append(_i(l));const c=`<div id="${t.id}-x-scrollbar-container">\n            <div id="${t.id}-x-axis-scrollbar-container">\n                <div id="${t.id}-x-axis-scrollbar">\n                    <div></div>\n                </div>\n            </div>\n\t    </div>`;this.$content_container.append(_i(c))}getContactMatrixViewport(){return this.$content_container.find("div[id$='-y-tracks-y-axis-viewport-y-scrollbar']").find("div[id$='-viewport']")}getYAxisScrollbarContainer(){return this.$content_container.find("div[id$='-y-tracks-y-axis-viewport-y-scrollbar']").find("div[id$='-y-axis-scrollbar-container']")}getXAxisScrollbarContainer(){return this.$content_container.find("div[id$='-x-axis-scrollbar-container']")}tracksLoaded(t){this.doLayoutTrackXYPairCount(t.length+this.browser.trackPairs.length),t.forEach(((t,e)=>{const i=new Sc(this.browser,40,this.$x_tracks,this.$y_tracks,t,e);this.browser.trackPairs.push(i)}))}removeAllTrackXYPairs(){if(0!==this.browser.trackPairs.length){for(let t of this.browser.trackPairs)t.dispose();this.browser.trackPairs=[],this.browser.updateLayout(),this.doLayoutTrackXYPairCount(0)}}removeLastTrackXYPair(){if(this.browser.trackPairs.length>0){let t=this.browser.trackPairs[this.browser.trackPairs.length-1];t.x.$viewport.remove(),t.y.$viewport.remove();const e=this.browser.trackPairs.indexOf(t);this.browser.trackPairs.splice(e,1),t=void 0,this.doLayoutTrackXYPairCount(this.browser.trackPairs.length),this.browser.updateLayout()}}removeTrackXYPair(t){if(this.browser.trackPairs.length>0){const e=t;e.x.$viewport.remove(),e.y.$viewport.remove();const i=this.browser.trackPairs.indexOf(e);this.browser.trackPairs.splice(i,1),this.doLayoutTrackXYPairCount(this.browser.trackPairs.length),this.browser.updateLayout()}}doLayoutTrackXYPairCount(t){const e=0===t?0:42*t;let i=[Mc(),e].map((t=>`${t}px`));const n="calc(100% - ("+i.join(" + ")+"))";i=[e,Ic,Rc].map((t=>`${t}px`));const r="calc(100% - ("+i.join(" + ")+"))";this.$x_track_container.height(e),this.$track_shim.width(e),this.$x_tracks.css("width",r),this.$content_container.css("height",n),this.xAxisRuler.updateWidthWithCalculation(r),this.$y_tracks.width(e),this.yAxisRuler.updateHeight(this.yAxisRuler.$axis.height()),this.browser.contactMatrixView.$viewport.css("width",r),this.browser.contactMatrixView.scrollbarWidget.$x_axis_scrollbar_container.css("width",r)}doLayoutWithRootContainerSize(t){this.browser.$root.width(t.width),this.browser.$root.height(t.height+Mc());const e=this.browser.trackPairs.length>0?this.browser.trackPairs.length:0;this.doLayoutTrackXYPairCount(e),this.browser.updateLayout()}}const Mc=()=>160,Lc=t=>t.$root.find(".hic-navbar-container");function Ec(t,e,i){return{type:t,data:e||{},propogate:void 0===i||i}}var Ac={Huffman:{},Util:{},CRC32:{},CompressionMethod:{DEFLATE:8,RESERVED:15},Zip:function(t){t=t||{},this.files=[],this.comment=t.comment,this.password}};Ac.Zip.CompressionMethod={STORE:0,DEFLATE:8},Ac.Zip.OperatingSystem={MSDOS:0,UNIX:3,MACINTOSH:7},Ac.Zip.Flags={ENCRYPT:1,DESCRIPTOR:8,UTF8:2048},Ac.Zip.FileHeaderSignature=[80,75,1,2],Ac.Zip.LocalFileHeaderSignature=[80,75,3,4],Ac.Zip.CentralDirectorySignature=[80,75,5,6],Ac.Zip.prototype.addFile=function(t,e){var i;(e=e||{}).filename;var n=t.length,r=0;if(t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof e.compressionMethod&&(e.compressionMethod=Ac.Zip.CompressionMethod.DEFLATE),e.compress)switch(e.compressionMethod){case Ac.Zip.CompressionMethod.STORE:break;case Ac.Zip.CompressionMethod.DEFLATE:r=Ac.CRC32.calc(t),t=this.deflateWithOption(t,e),i=!0;break;default:throw new Error("unknown compression method:"+e.compressionMethod)}this.files.push({buffer:t,option:e,compressed:i,encrypted:!1,size:n,crc32:r})},Ac.Zip.prototype.setPassword=function(t){this.password=t},Ac.Zip.prototype.compress=function(){var t,e,i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y,v,x,C,S,k,T,R=this.files,I=0,D=0;for(C=0,S=R.length;C<S;++C){if(d=(t=R[C]).option.filename?t.option.filename.length:0,p=t.option.extraField?t.option.extraField.length:0,g=t.option.comment?t.option.comment.length:0,!t.compressed)switch(t.crc32=Ac.CRC32.calc(t.buffer),t.option.compressionMethod){case Ac.Zip.CompressionMethod.STORE:break;case Ac.Zip.CompressionMethod.DEFLATE:t.buffer=this.deflateWithOption(t.buffer,t.option),t.compressed=!0;break;default:throw new Error("unknown compression method:"+t.option.compressionMethod)}if(void 0!==t.option.password||void 0!==this.password){for(x=this.createEncryptionKey(t.option.password||this.password),y=t.buffer,(v=new Uint8Array(y.length+12)).set(y,12),y=v,k=0;k<12;++k)y[k]=this.encode(x,11===C?255&t.crc32:256*Math.random()|0);for(T=y.length;k<T;++k)y[k]=this.encode(x,y[k]);t.buffer=y}I+=30+d+t.buffer.length,D+=46+d+g}for(s=22+(this.comment?this.comment.length:0),e=new Uint8Array(I+D+s),i=0,r=(n=I)+D,C=0,S=R.length;C<S;++C)d=(t=R[C]).option.filename?t.option.filename.length:0,p=0,g=t.option.comment?t.option.comment.length:0,o=i,e[i++]=Ac.Zip.LocalFileHeaderSignature[0],e[i++]=Ac.Zip.LocalFileHeaderSignature[1],e[i++]=Ac.Zip.LocalFileHeaderSignature[2],e[i++]=Ac.Zip.LocalFileHeaderSignature[3],e[n++]=Ac.Zip.FileHeaderSignature[0],e[n++]=Ac.Zip.FileHeaderSignature[1],e[n++]=Ac.Zip.FileHeaderSignature[2],e[n++]=Ac.Zip.FileHeaderSignature[3],20,e[n++]=20,e[n++]=t.option.os||Ac.Zip.OperatingSystem.MSDOS,e[i++]=e[n++]=20,e[i++]=e[n++]=0,a=0,(t.option.password||this.password)&&(a|=Ac.Zip.Flags.ENCRYPT),e[i++]=e[n++]=255&a,e[i++]=e[n++]=a>>8&255,h=t.option.compressionMethod,e[i++]=e[n++]=255&h,e[i++]=e[n++]=h>>8&255,l=t.option.date||new Date,e[i++]=e[n++]=(7&l.getMinutes())<<5|l.getSeconds()/2|0,e[i++]=e[n++]=l.getHours()<<3|l.getMinutes()>>3,e[i++]=e[n++]=(l.getMonth()+1&7)<<5|l.getDate(),e[i++]=e[n++]=(l.getFullYear()-1980&127)<<1|l.getMonth()+1>>3,c=t.crc32,e[i++]=e[n++]=255&c,e[i++]=e[n++]=c>>8&255,e[i++]=e[n++]=c>>16&255,e[i++]=e[n++]=c>>24&255,u=t.buffer.length,e[i++]=e[n++]=255&u,e[i++]=e[n++]=u>>8&255,e[i++]=e[n++]=u>>16&255,e[i++]=e[n++]=u>>24&255,f=t.size,e[i++]=e[n++]=255&f,e[i++]=e[n++]=f>>8&255,e[i++]=e[n++]=f>>16&255,e[i++]=e[n++]=f>>24&255,e[i++]=e[n++]=255&d,e[i++]=e[n++]=d>>8&255,e[i++]=e[n++]=255&p,e[i++]=e[n++]=p>>8&255,e[n++]=255&g,e[n++]=g>>8&255,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=255&o,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,(m=t.option.filename)&&(e.set(m,i),e.set(m,n),i+=d,n+=d),(w=t.option.extraField)&&(e.set(w,i),e.set(w,n),i+=p,n+=p),(b=t.option.comment)&&(e.set(b,n),n+=g),e.set(t.buffer,i),i+=t.buffer.length;return e[r++]=Ac.Zip.CentralDirectorySignature[0],e[r++]=Ac.Zip.CentralDirectorySignature[1],e[r++]=Ac.Zip.CentralDirectorySignature[2],e[r++]=Ac.Zip.CentralDirectorySignature[3],e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=255&S,e[r++]=S>>8&255,e[r++]=255&S,e[r++]=S>>8&255,e[r++]=255&D,e[r++]=D>>8&255,e[r++]=D>>16&255,e[r++]=D>>24&255,e[r++]=255&I,e[r++]=I>>8&255,e[r++]=I>>16&255,e[r++]=I>>24&255,g=this.comment?this.comment.length:0,e[r++]=255&g,e[r++]=g>>8&255,this.comment&&(e.set(this.comment,r),r+=g),e},Ac.Zip.prototype.deflateWithOption=function(t,e){return new Ac.RawDeflate(t,e.deflateOption).compress()},Ac.Zip.prototype.getByte=function(t){var e=65535&t[2]|2;return e*(1^e)>>8&255},Ac.Zip.prototype.encode=function(t,e){var i=this.getByte(t);return this.updateKeys(t,e),i^e},Ac.Zip.prototype.updateKeys=function(t,e){t[0]=Ac.CRC32.single(t[0],e),t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=Ac.CRC32.single(t[2],t[1]>>>24)},Ac.Zip.prototype.createEncryptionKey=function(t){var e,i,n=[305419896,591751049,878082192];for(n=new Uint32Array(n),e=0,i=t.length;e<i;++e)this.updateKeys(n,255&t[e]);return n},Ac.Huffman.buildHuffmanTable=function(t){var e,i,n,r,s,o,a,h,l,c,u,f=t.length,d=0,p=Number.POSITIVE_INFINITY;for(h=0,l=f;h<l;++h)t[h]>d&&(d=t[h]),t[h]<p&&(p=t[h]);for(e=1<<d,i=new Uint32Array(e),n=1,r=0,s=2;n<=d;){for(h=0;h<f;++h)if(t[h]===n){for(o=0,a=r,c=0;c<n;++c)o=o<<1|1&a,a>>=1;for(u=n<<16|h,c=o;c<e;c+=s)i[c]=u;++r}++n,r<<=1,s<<=1}return[i,d,p]};var Bc=Ac.Huffman.buildHuffmanTable;Ac.RawInflate=function(t,e){switch(this.buffer,this.blocks=[],this.bufferSize=32768,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output,this.op,this.bfinal=!1,this.bufferType=Ac.RawInflate.BufferType.ADAPTIVE,this.resize=!1,!e&&(e={})||(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case Ac.RawInflate.BufferType.BLOCK:this.op=Ac.RawInflate.MaxBackwardLength,this.output=new Uint8Array(Ac.RawInflate.MaxBackwardLength+this.bufferSize+Ac.RawInflate.MaxCopyLength);break;case Ac.RawInflate.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize);break;default:throw new Error("invalid inflate mode")}},Ac.RawInflate.BufferType={BLOCK:0,ADAPTIVE:1},Ac.RawInflate.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case Ac.RawInflate.BufferType.BLOCK:return this.concatBufferBlock();case Ac.RawInflate.BufferType.ADAPTIVE:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}},Ac.RawInflate.MaxBackwardLength=32768,Ac.RawInflate.MaxCopyLength=258,Ac.RawInflate.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ac.RawInflate.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Ac.RawInflate.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Ac.RawInflate.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Ac.RawInflate.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ac.RawInflate.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return Bc(i)}(),Ac.RawInflate.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return Bc(i)}(),Ac.RawInflate.prototype.parseBlock=function(){var t=this.readBits(3);switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+t)}},Ac.RawInflate.prototype.readBits=function(t){var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;if(s+(t-n+7>>3)>=r.length)throw new Error("input buffer is broken");for(;n<t;)i|=r[s++]<<n,n+=8;return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},Ac.RawInflate.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=s.length,h=t[0],l=t[1];r<l&&!(o>=a);)n|=s[o++]<<r,r+=8;if((i=(e=h[n&(1<<l)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},Ac.RawInflate.prototype.parseUncompressedBlock=function(){var t,e,i=this.input,n=this.ip,r=this.output,s=this.op,o=i.length,a=r.length;if(this.bitsbuf=0,this.bitsbuflen=0,n+1>=o)throw new Error("invalid uncompressed block header: LEN");if(t=i[n++]|i[n++]<<8,n+1>=o)throw new Error("invalid uncompressed block header: NLEN");if(t===~(i[n++]|i[n++]<<8))throw new Error("invalid uncompressed block header: length verify");if(n+t>i.length)throw new Error("input buffer is broken");switch(this.bufferType){case Ac.RawInflate.BufferType.BLOCK:for(;s+t>r.length;)t-=e=a-s,r.set(i.subarray(n,n+e),s),s+=e,n+=e,this.op=s,r=this.expandBufferBlock(),s=this.op;break;case Ac.RawInflate.BufferType.ADAPTIVE:for(;s+t>r.length;)r=this.expandBufferAdaptive({fixRatio:2});break;default:throw new Error("invalid inflate mode")}r.set(i.subarray(n,n+t),s),s+=t,n+=t,this.ip=n,this.op=s,this.output=r},Ac.RawInflate.prototype.parseFixedHuffmanBlock=function(){switch(this.bufferType){case Ac.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(Ac.RawInflate.FixedLiteralLengthTable,Ac.RawInflate.FixedDistanceTable);break;case Ac.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(Ac.RawInflate.FixedLiteralLengthTable,Ac.RawInflate.FixedDistanceTable);break;default:throw new Error("invalid inflate mode")}},Ac.RawInflate.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r,s,o,a,h,l=this.readBits(5)+257,c=this.readBits(5)+1,u=this.readBits(4)+4,f=new Uint8Array(Ac.RawInflate.Order.length);for(a=0;a<u;++a)f[Ac.RawInflate.Order[a]]=this.readBits(3);for(t=Bc(f),n=new Uint8Array(l+c),a=0,h=l+c;a<h;)switch(r=this.readCodeByTable(t)){case 16:for(o=3+this.readBits(2);o--;)n[a++]=s;break;case 17:for(o=3+this.readBits(3);o--;)n[a++]=0;s=0;break;case 18:for(o=11+this.readBits(7);o--;)n[a++]=0;s=0;break;default:n[a++]=r,s=r}switch(e=Bc(n.subarray(0,l)),i=Bc(n.subarray(l)),this.bufferType){case Ac.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(e,i);break;case Ac.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(e,i);break;default:throw new Error("invalid inflate mode")}},Ac.RawInflate.prototype.decodeHuffmanBlock=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,a,h=i.length-Ac.RawInflate.MaxCopyLength,l=Ac.RawInflate.LengthCodeTable,c=Ac.RawInflate.LengthExtraTable,u=Ac.RawInflate.DistCodeTable,f=Ac.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=h&&(this.op=n,i=this.expandBufferBlock(),n=this.op),i[n++]=r;else for(a=l[s=r-257],c[s]>0&&(a+=this.readBits(c[s])),o=u[r=this.readCodeByTable(e)],f[r]>0&&(o+=this.readBits(f[r])),n>=h&&(this.op=n,i=this.expandBufferBlock(),n=this.op);a--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},Ac.RawInflate.prototype.decodeHuffmanAdaptive=function(t,e){var i=this.output,n=this.op;this.currentLitlenTable=t;for(var r,s,o,a,h=i.length,l=Ac.RawInflate.LengthCodeTable,c=Ac.RawInflate.LengthExtraTable,u=Ac.RawInflate.DistCodeTable,f=Ac.RawInflate.DistExtraTable;256!==(r=this.readCodeByTable(t));)if(r<256)n>=h&&(h=(i=this.expandBufferAdaptive()).length),i[n++]=r;else for(a=l[s=r-257],c[s]>0&&(a+=this.readBits(c[s])),o=u[r=this.readCodeByTable(e)],f[r]>0&&(o+=this.readBits(f[r])),n+a>h&&(h=(i=this.expandBufferAdaptive()).length);a--;)i[n]=i[n++-o];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=n},Ac.RawInflate.prototype.expandBufferBlock=function(t){var e=new Uint8Array(this.op-Ac.RawInflate.MaxBackwardLength),i=this.op-Ac.RawInflate.MaxBackwardLength,n=this.output;return e.set(n.subarray(Ac.RawInflate.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,n.set(n.subarray(i,i+Ac.RawInflate.MaxBackwardLength)),this.op=Ac.RawInflate.MaxBackwardLength,n},Ac.RawInflate.prototype.expandBufferAdaptive=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.currentLitlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},Ac.RawInflate.prototype.concatBufferBlock=function(){var t,e,i,n,r,s=0,o=this.totalpos+(this.op-Ac.RawInflate.MaxBackwardLength),a=this.output,h=this.blocks,l=new Uint8Array(o);if(0===h.length)return this.output.subarray(Ac.RawInflate.MaxBackwardLength,this.op);for(e=0,i=h.length;e<i;++e)for(n=0,r=(t=h[e]).length;n<r;++n)l[s++]=t[n];for(e=Ac.RawInflate.MaxBackwardLength,i=this.op;e<i;++e)l[s++]=a[e];return this.blocks=[],this.buffer=l,this.buffer},Ac.RawInflate.prototype.concatBufferDynamic=function(){var t,e=this.op;return this.resize?(t=new Uint8Array(e)).set(this.output.subarray(0,e)):t=this.output.subarray(0,e),this.buffer=t,this.buffer};Bc=Ac.Huffman.buildHuffmanTable;Ac.RawInflateStream=function(t,e,i){this.blocks=[],this.bufferSize=i||ZLIB_STREAM_RAW_INFLATE_BUFFER_SIZE,this.totalpos=0,this.ip=void 0===e?0:e,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output=new Uint8Array(this.bufferSize),this.op=0,this.bfinal=!1,this.blockLength,this.resize=!1,this.litlenTable,this.distTable,this.sp=0,this.status=Ac.RawInflateStream.Status.INITIALIZED,this.ip_,this.bitsbuflen_,this.bitsbuf_},Ac.RawInflateStream.BlockType={UNCOMPRESSED:0,FIXED:1,DYNAMIC:2},Ac.RawInflateStream.Status={INITIALIZED:0,BLOCK_HEADER_START:1,BLOCK_HEADER_END:2,BLOCK_BODY_START:3,BLOCK_BODY_END:4,DECODE_BLOCK_START:5,DECODE_BLOCK_END:6},Ac.RawInflateStream.prototype.decompress=function(t,e){var i=!1;for(void 0!==t&&(this.input=t),void 0!==e&&(this.ip=e);!i;)switch(this.status){case Ac.RawInflateStream.Status.INITIALIZED:case Ac.RawInflateStream.Status.BLOCK_HEADER_START:this.readBlockHeader()<0&&(i=!0);break;case Ac.RawInflateStream.Status.BLOCK_HEADER_END:case Ac.RawInflateStream.Status.BLOCK_BODY_START:switch(this.currentBlockType){case Ac.RawInflateStream.BlockType.UNCOMPRESSED:this.readUncompressedBlockHeader()<0&&(i=!0);break;case Ac.RawInflateStream.BlockType.FIXED:this.parseFixedHuffmanBlock()<0&&(i=!0);break;case Ac.RawInflateStream.BlockType.DYNAMIC:this.parseDynamicHuffmanBlock()<0&&(i=!0)}break;case Ac.RawInflateStream.Status.BLOCK_BODY_END:case Ac.RawInflateStream.Status.DECODE_BLOCK_START:switch(this.currentBlockType){case Ac.RawInflateStream.BlockType.UNCOMPRESSED:this.parseUncompressedBlock()<0&&(i=!0);break;case Ac.RawInflateStream.BlockType.FIXED:case Ac.RawInflateStream.BlockType.DYNAMIC:this.decodeHuffman()<0&&(i=!0)}break;case Ac.RawInflateStream.Status.DECODE_BLOCK_END:this.bfinal?i=!0:this.status=Ac.RawInflateStream.Status.INITIALIZED}return this.concatBuffer()},Ac.RawInflateStream.MaxBackwardLength=32768,Ac.RawInflateStream.MaxCopyLength=258,Ac.RawInflateStream.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ac.RawInflateStream.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Ac.RawInflateStream.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Ac.RawInflateStream.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Ac.RawInflateStream.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ac.RawInflateStream.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return Bc(i)}(),Ac.RawInflateStream.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return Bc(i)}(),Ac.RawInflateStream.prototype.readBlockHeader=function(){var t;if(this.status=Ac.RawInflateStream.Status.BLOCK_HEADER_START,this.save_(),(t=this.readBits(3))<0)return this.restore_(),-1;switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.currentBlockType=Ac.RawInflateStream.BlockType.UNCOMPRESSED;break;case 1:this.currentBlockType=Ac.RawInflateStream.BlockType.FIXED;break;case 2:this.currentBlockType=Ac.RawInflateStream.BlockType.DYNAMIC;break;default:throw new Error("unknown BTYPE: "+t)}this.status=Ac.RawInflateStream.Status.BLOCK_HEADER_END},Ac.RawInflateStream.prototype.readBits=function(t){for(var e,i=this.bitsbuf,n=this.bitsbuflen,r=this.input,s=this.ip;n<t;){if(r.length<=s)return-1;i|=(e=r[s++])<<n,n+=8}return e=i&(1<<t)-1,i>>>=t,n-=t,this.bitsbuf=i,this.bitsbuflen=n,this.ip=s,e},Ac.RawInflateStream.prototype.readCodeByTable=function(t){for(var e,i,n=this.bitsbuf,r=this.bitsbuflen,s=this.input,o=this.ip,a=t[0],h=t[1];r<h;){if(s.length<=o)return-1;n|=s[o++]<<r,r+=8}if((i=(e=a[n&(1<<h)-1])>>>16)>r)throw new Error("invalid code length: "+i);return this.bitsbuf=n>>i,this.bitsbuflen=r-i,this.ip=o,65535&e},Ac.RawInflateStream.prototype.readUncompressedBlockHeader=function(){var t,e=this.input,i=this.ip;if(this.status=Ac.RawInflateStream.Status.BLOCK_BODY_START,i+4>=e.length)return-1;if((t=e[i++]|e[i++]<<8)===~(e[i++]|e[i++]<<8))throw new Error("invalid uncompressed block header: length verify");this.bitsbuf=0,this.bitsbuflen=0,this.ip=i,this.blockLength=t,this.status=Ac.RawInflateStream.Status.BLOCK_BODY_END},Ac.RawInflateStream.prototype.parseUncompressedBlock=function(){var t=this.input,e=this.ip,i=this.output,n=this.op,r=this.blockLength;for(this.status=Ac.RawInflateStream.Status.DECODE_BLOCK_START;r--;){if(n===i.length&&(i=this.expandBuffer({fixRatio:2})),e>=t.length)return this.ip=e,this.op=n,this.blockLength=r+1,-1;i[n++]=t[e++]}return r<0&&(this.status=Ac.RawInflateStream.Status.DECODE_BLOCK_END),this.ip=e,this.op=n,0},Ac.RawInflateStream.prototype.parseFixedHuffmanBlock=function(){return this.status=Ac.RawInflateStream.Status.BLOCK_BODY_START,this.litlenTable=Ac.RawInflateStream.FixedLiteralLengthTable,this.distTable=Ac.RawInflateStream.FixedDistanceTable,this.status=Ac.RawInflateStream.Status.BLOCK_BODY_END,0},Ac.RawInflateStream.prototype.save_=function(){this.ip_=this.ip,this.bitsbuflen_=this.bitsbuflen,this.bitsbuf_=this.bitsbuf},Ac.RawInflateStream.prototype.restore_=function(){this.ip=this.ip_,this.bitsbuflen=this.bitsbuflen_,this.bitsbuf=this.bitsbuf_},Ac.RawInflateStream.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,n,r=new Uint8Array(Ac.RawInflateStream.Order.length);if(this.status=Ac.RawInflateStream.Status.BLOCK_BODY_START,this.save_(),t=this.readBits(5)+257,e=this.readBits(5)+1,i=this.readBits(4)+4,t<0||e<0||i<0)return this.restore_(),-1;try{(function(){var s,o,a,h,l,c,u=0;for(l=0;l<i;++l){if((s=this.readBits(3))<0)throw new Error("not enough input");r[Ac.RawInflateStream.Order[l]]=s}for(n=Bc(r),h=new Uint8Array(t+e),l=0,c=t+e;l<c;){if((o=this.readCodeByTable(n))<0)throw new Error("not enough input");switch(o){case 16:if((s=this.readBits(2))<0)throw new Error("not enough input");for(a=3+s;a--;)h[l++]=u;break;case 17:if((s=this.readBits(3))<0)throw new Error("not enough input");for(a=3+s;a--;)h[l++]=0;u=0;break;case 18:if((s=this.readBits(7))<0)throw new Error("not enough input");for(a=11+s;a--;)h[l++]=0;u=0;break;default:h[l++]=o,u=o}}this.litlenTable=Bc(h.subarray(0,t)),this.distTable=Bc(h.subarray(t))}).call(this)}catch(t){return this.restore_(),-1}return this.status=Ac.RawInflateStream.Status.BLOCK_BODY_END,0},Ac.RawInflateStream.prototype.decodeHuffman=function(){var t,e,i,n,r,s=this.output,o=this.op,a=this.litlenTable,h=this.distTable,l=s.length;for(this.status=Ac.RawInflateStream.Status.DECODE_BLOCK_START;;){if(this.save_(),(t=this.readCodeByTable(a))<0)return this.op=o,this.restore_(),-1;if(256===t)break;if(t<256)o===l&&(l=(s=this.expandBuffer()).length),s[o++]=t;else{if(e=t-257,n=Ac.RawInflateStream.LengthCodeTable[e],Ac.RawInflateStream.LengthExtraTable[e]>0){if((r=this.readBits(Ac.RawInflateStream.LengthExtraTable[e]))<0)return this.op=o,this.restore_(),-1;n+=r}if((t=this.readCodeByTable(h))<0)return this.op=o,this.restore_(),-1;if(i=Ac.RawInflateStream.DistCodeTable[t],Ac.RawInflateStream.DistExtraTable[t]>0){if((r=this.readBits(Ac.RawInflateStream.DistExtraTable[t]))<0)return this.op=o,this.restore_(),-1;i+=r}for(o+n>=l&&(l=(s=this.expandBuffer()).length);n--;)s[o]=s[o++-i];if(this.ip===this.input.length)return this.op=o,-1}}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=o,this.status=Ac.RawInflateStream.Status.DECODE_BLOCK_END},Ac.RawInflateStream.prototype.expandBuffer=function(t){var e,i,n,r=this.input.length/this.ip+1|0,s=this.input,o=this.output;return t&&("number"==typeof t.fixRatio&&(r=t.fixRatio),"number"==typeof t.addRatio&&(r+=t.addRatio)),i=r<2?(n=(s.length-this.ip)/this.litlenTable[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*r,(e=new Uint8Array(i)).set(o),this.output=e,this.output},Ac.RawInflateStream.prototype.concatBuffer=function(){var t,e,i=this.op;return t=this.resize?new Uint8Array(this.output.subarray(this.sp,i)):this.output.subarray(this.sp,i),this.sp=i,i>Ac.RawInflateStream.MaxBackwardLength+this.bufferSize&&(this.op=this.sp=Ac.RawInflateStream.MaxBackwardLength,e=this.output,this.output=new Uint8Array(this.bufferSize+Ac.RawInflateStream.MaxBackwardLength),this.output.set(e.subarray(i-Ac.RawInflateStream.MaxBackwardLength,i))),t},Ac.Inflate=function(t,e){var i,n;if(this.input=t,this.ip=0,this.rawinflate,this.verify,!e&&(e={})||(e.index&&(this.ip=e.index),e.verify&&(this.verify=e.verify)),i=t[this.ip++],n=t[this.ip++],(15&i)!==Ac.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=Ac.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.rawinflate=new Ac.RawInflate(t,{index:this.ip,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})},Ac.Inflate.BufferType=Ac.RawInflate.BufferType,Ac.Inflate.prototype.decompress=function(){var t,e=this.input;if(t=this.rawinflate.decompress(),this.ip=this.rawinflate.ip,this.verify&&(e[this.ip++]<<24|e[this.ip++]<<16|e[this.ip++]<<8|e[this.ip++])>>>0!==Ac.Adler32(t))throw new Error("invalid adler-32 checksum");return t},Ac.InflateStream=function(t){this.input=void 0===t?new Uint8Array:t,this.ip=0,this.rawinflate=new Ac.RawInflateStream(this.input,this.ip),this.method,this.output=this.rawinflate.output},Ac.InflateStream.prototype.decompress=function(t){var e;if(void 0!==t){var i=new Uint8Array(this.input.length+t.length);i.set(this.input,0),i.set(t,this.input.length),this.input=i}return void 0===this.method&&this.readHeader()<0?new Uint8Array:(e=this.rawinflate.decompress(this.input,this.ip),0!==this.rawinflate.ip&&(this.input=this.input.subarray(this.rawinflate.ip),this.ip=0),e)},Ac.InflateStream.prototype.readHeader=function(){var t=this.ip,e=this.input,i=e[t++],n=e[t++];if(void 0===i||void 0===n)return-1;if((15&i)!==Ac.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=Ac.CompressionMethod.DEFLATE,((i<<8)+n)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw new Error("fdict flag is not supported");this.ip=t},Ac.Gunzip=function(t,e){this.input=t,this.ip=0,this.member=[],this.decompressed=!1},Ac.Gunzip.prototype.getMembers=function(){return this.decompressed||this.decompress(),this.member.slice()},Ac.Gunzip.prototype.decompress=function(){for(var t=this.input.length;this.ip<t;)this.decodeMember();return this.decompressed=!0,this.concatMember()},Ac.Gunzip.prototype.decodeMember=function(){var t,e,i,n,r,s,o,a,h,l=new Ac.GunzipMember,c=this.input,u=this.ip;if(l.id1=c[u++],l.id2=c[u++],31!==l.id1||139!==l.id2)throw new Error("invalid file signature:"+l.id1+","+l.id2);if(l.cm=c[u++],8!==l.cm)throw new Error("unknown compression method: "+l.cm);if(l.flg=c[u++],a=c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24,l.mtime=new Date(1e3*a),l.xfl=c[u++],l.os=c[u++],(l.flg&Ac.Gzip.FlagsMask.FEXTRA)>0&&(l.xlen=c[u++]|c[u++]<<8,u=this.decodeSubField(u,l.xlen)),(l.flg&Ac.Gzip.FlagsMask.FNAME)>0){for(o=[],s=0;(r=c[u++])>0;)o[s++]=String.fromCharCode(r);l.name=o.join("")}if((l.flg&Ac.Gzip.FlagsMask.FCOMMENT)>0){for(o=[],s=0;(r=c[u++])>0;)o[s++]=String.fromCharCode(r);l.comment=o.join("")}if((l.flg&Ac.Gzip.FlagsMask.FHCRC)>0&&(l.crc16=65535&Ac.CRC32.calc(c,0,u),l.crc16!==(c[u++]|c[u++]<<8)))throw new Error("invalid header crc16");if(t=c[c.length-4]|c[c.length-3]<<8|c[c.length-2]<<16|c[c.length-1]<<24,c.length-u-4-4<512*t&&(n=t),e=new Ac.RawInflate(c,{index:u,bufferSize:n}),l.data=i=e.decompress(),u=e.ip,l.crc32=h=(c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24)>>>0,Ac.CRC32.calc(i)!==h)throw new Error("invalid CRC-32 checksum: 0x"+Ac.CRC32.calc(i).toString(16)+" / 0x"+h.toString(16));if(l.isize=t=(c[u++]|c[u++]<<8|c[u++]<<16|c[u++]<<24)>>>0,(4294967295&i.length)!==t)throw new Error("invalid input size: "+(4294967295&i.length)+" / "+t);this.member.push(l),this.ip=u},Ac.Gunzip.prototype.decodeSubField=function(t,e){return t+e},Ac.Gunzip.prototype.concatMember=function(){var t,e,i,n=this.member,r=0,s=0;for(t=0,e=n.length;t<e;++t)s+=n[t].data.length;for(i=new Uint8Array(s),t=0;t<e;++t)i.set(n[t].data,r),r+=n[t].data.length;return i},Ac.GunzipMember=function(){this.id1,this.id2,this.cm,this.flg,this.mtime,this.xfl,this.os,this.crc16,this.xlen,this.crc32,this.isize,this.name,this.comment,this.data},Ac.GunzipMember.prototype.getName=function(){return this.name},Ac.GunzipMember.prototype.getData=function(){return this.data},Ac.GunzipMember.prototype.getMtime=function(){return this.mtime},Ac.Gzip=function(t,e){this.input=t,this.ip=0,this.output,this.op=0,this.flags={},this.filename,this.comment,this.deflateOptions,e&&(e.flags&&(this.flags=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.comment=e.comment),e.deflateOptions&&(this.deflateOptions=e.deflateOptions)),this.deflateOptions||(this.deflateOptions={})},Ac.Gzip.DefaultBufferSize=32768,Ac.Gzip.prototype.compress=function(){var t,e,i,n,r,s,o,a,h=new Uint8Array(Ac.Gzip.DefaultBufferSize),l=0,c=this.input,u=this.ip,f=this.filename,d=this.comment;if(h[l++]=31,h[l++]=139,h[l++]=8,t=0,this.flags.fname&&(t|=Ac.Gzip.FlagsMask.FNAME),this.flags.fcomment&&(t|=Ac.Gzip.FlagsMask.FCOMMENT),this.flags.fhcrc&&(t|=Ac.Gzip.FlagsMask.FHCRC),h[l++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,h[l++]=255&e,h[l++]=e>>>8&255,h[l++]=e>>>16&255,h[l++]=e>>>24&255,h[l++]=0,h[l++]=Ac.Gzip.OperatingSystem.UNKNOWN,void 0!==this.flags.fname){for(o=0,a=f.length;o<a;++o)(s=f.charCodeAt(o))>255&&(h[l++]=s>>>8&255),h[l++]=255&s;h[l++]=0}if(this.flags.comment){for(o=0,a=d.length;o<a;++o)(s=d.charCodeAt(o))>255&&(h[l++]=s>>>8&255),h[l++]=255&s;h[l++]=0}return this.flags.fhcrc&&(i=65535&Ac.CRC32.calc(h,0,l),h[l++]=255&i,h[l++]=i>>>8&255),this.deflateOptions.outputBuffer=h,this.deflateOptions.outputIndex=l,h=(r=new Ac.RawDeflate(c,this.deflateOptions)).compress(),(l=r.op)+8>h.buffer.byteLength?(this.output=new Uint8Array(l+8),this.output.set(new Uint8Array(h.buffer)),h=this.output):h=new Uint8Array(h.buffer),n=Ac.CRC32.calc(c),h[l++]=255&n,h[l++]=n>>>8&255,h[l++]=n>>>16&255,h[l++]=n>>>24&255,a=c.length,h[l++]=255&a,h[l++]=a>>>8&255,h[l++]=a>>>16&255,h[l++]=a>>>24&255,this.ip=u,l<h.length&&(this.output=h=h.subarray(0,l)),h},Ac.Gzip.OperatingSystem={FAT:0,AMIGA:1,VMS:2,UNIX:3,VM_CMS:4,ATARI_TOS:5,HPFS:6,MACINTOSH:7,Z_SYSTEM:8,CP_M:9,TOPS_20:10,NTFS:11,QDOS:12,ACORN_RISCOS:13,UNKNOWN:255},Ac.Gzip.FlagsMask={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},Ac.Heap=function(t){this.buffer=new Uint16Array(2*t),this.length=0},Ac.Heap.prototype.getParent=function(t){return 2*((t-2)/4|0)},Ac.Heap.prototype.getChild=function(t){return 2*t+2},Ac.Heap.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;i>0&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},Ac.Heap.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;!((n=this.getChild(r))>=this.length)&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}},Ac.RawDeflate=function(t,e){this.compressionType=Ac.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.freqsLitLen,this.freqsDist,this.input=t instanceof Array?new Uint8Array(t):t,this.output,this.op=0,e&&(e.lazy&&(this.lazy=e.lazy),"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e.outputBuffer&&(this.output=e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.op=e.outputIndex)),this.output||(this.output=new Uint8Array(32768))},Ac.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3},Ac.RawDeflate.Lz77MinLength=3,Ac.RawDeflate.Lz77MaxLength=258,Ac.RawDeflate.WindowSize=32768,Ac.RawDeflate.MaxCodeLength=16,Ac.RawDeflate.HUFMAX=286,Ac.RawDeflate.FixedHuffmanTable=function(){var t,e=[];for(t=0;t<288;t++)switch(!0){case t<=143:e.push([t+48,8]);break;case t<=255:e.push([t-144+400,9]);break;case t<=279:e.push([t-256+0,7]);break;case t<=287:e.push([t-280+192,8]);break;default:throw"invalid literal: "+t}return e}(),Ac.RawDeflate.prototype.compress=function(){var t,e,i,n=this.input;switch(this.compressionType){case Ac.RawDeflate.CompressionType.NONE:for(e=0,i=n.length;e<i;)e+=(t=n.subarray(e,e+65535)).length,this.makeNocompressBlock(t,e===i);break;case Ac.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(n,!0),this.op=this.output.length;break;case Ac.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(n,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output},Ac.RawDeflate.prototype.makeNocompressBlock=function(t,e){var i,n,r,s,o=this.output,a=this.op;for(o=new Uint8Array(this.output.buffer);o.length<=a+t.length+5;)o=new Uint8Array(o.length<<1);return o.set(this.output),i=e?1:0,n=Ac.RawDeflate.CompressionType.NONE,o[a++]=i|n<<1,s=65536+~(r=t.length)&65535,o[a++]=255&r,o[a++]=r>>>8&255,o[a++]=255&s,o[a++]=s>>>8&255,o.set(t,a),a+=t.length,o=o.subarray(0,a),this.op=a,this.output=o,o},Ac.RawDeflate.prototype.makeFixedHuffmanBlock=function(t,e){var i,n,r,s=new Ac.BitStream(new Uint8Array(this.output.buffer),this.op);return i=e?1:0,n=Ac.RawDeflate.CompressionType.FIXED,s.writeBits(i,1,!0),s.writeBits(n,2,!0),r=this.lz77(t),this.fixedHuffman(r,s),s.finish()},Ac.RawDeflate.prototype.makeDynamicHuffmanBlock=function(t,e){var i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y=new Ac.BitStream(new Uint8Array(this.output.buffer),this.op),v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=new Array(19);for(i=e?1:0,n=Ac.RawDeflate.CompressionType.DYNAMIC,y.writeBits(i,1,!0),y.writeBits(n,2,!0),r=this.lz77(t),h=this.getLengths_(this.freqsLitLen,15),l=this.getCodesFromLengths_(h),c=this.getLengths_(this.freqsDist,7),u=this.getCodesFromLengths_(c),s=286;s>257&&0===h[s-1];s--);for(o=30;o>1&&0===c[o-1];o--);for(f=this.getTreeSymbols_(s,h,o,c),d=this.getLengths_(f.freqs,7),w=0;w<19;w++)x[w]=d[v[w]];for(a=19;a>4&&0===x[a-1];a--);for(p=this.getCodesFromLengths_(d),y.writeBits(s-257,5,!0),y.writeBits(o-1,5,!0),y.writeBits(a-4,4,!0),w=0;w<a;w++)y.writeBits(x[w],3,!0);for(w=0,b=f.codes.length;w<b;w++)if(g=f.codes[w],y.writeBits(p[g],d[g],!0),g>=16){switch(w++,g){case 16:m=2;break;case 17:m=3;break;case 18:m=7;break;default:throw"invalid code: "+g}y.writeBits(f.codes[w],m,!0)}return this.dynamicHuffman(r,[l,h],[u,c],y),y.finish()},Ac.RawDeflate.prototype.dynamicHuffman=function(t,e,i,n){var r,s,o,a,h,l,c,u;for(h=e[0],l=e[1],c=i[0],u=i[1],r=0,s=t.length;r<s;++r)if(o=t[r],n.writeBits(h[o],l[o],!0),o>256)n.writeBits(t[++r],t[++r],!0),a=t[++r],n.writeBits(c[a],u[a],!0),n.writeBits(t[++r],t[++r],!0);else if(256===o)break;return n},Ac.RawDeflate.prototype.fixedHuffman=function(t,e){var i,n,r;for(i=0,n=t.length;i<n;i++)if(r=t[i],Ac.BitStream.prototype.writeBits.apply(e,Ac.RawDeflate.FixedHuffmanTable[r]),r>256)e.writeBits(t[++i],t[++i],!0),e.writeBits(t[++i],5),e.writeBits(t[++i],t[++i],!0);else if(256===r)break;return e},Ac.RawDeflate.Lz77Match=function(t,e){this.length=t,this.backwardDistance=e},Ac.RawDeflate.Lz77Match.LengthCodeTable=function(t){return new Uint32Array(t)}(function(){var t,e,i=[];for(t=3;t<=258;t++)e=n(t),i[t]=e[2]<<24|e[1]<<16|e[0];function n(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}return i}()),Ac.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(t){var e;switch(!0){case 1===t:e=[0,t-1,0];break;case 2===t:e=[1,t-2,0];break;case 3===t:e=[2,t-3,0];break;case 4===t:e=[3,t-4,0];break;case t<=6:e=[4,t-5,1];break;case t<=8:e=[5,t-7,1];break;case t<=12:e=[6,t-9,2];break;case t<=16:e=[7,t-13,2];break;case t<=24:e=[8,t-17,3];break;case t<=32:e=[9,t-25,3];break;case t<=48:e=[10,t-33,4];break;case t<=64:e=[11,t-49,4];break;case t<=96:e=[12,t-65,5];break;case t<=128:e=[13,t-97,5];break;case t<=192:e=[14,t-129,6];break;case t<=256:e=[15,t-193,6];break;case t<=384:e=[16,t-257,7];break;case t<=512:e=[17,t-385,7];break;case t<=768:e=[18,t-513,8];break;case t<=1024:e=[19,t-769,8];break;case t<=1536:e=[20,t-1025,9];break;case t<=2048:e=[21,t-1537,9];break;case t<=3072:e=[22,t-2049,10];break;case t<=4096:e=[23,t-3073,10];break;case t<=6144:e=[24,t-4097,11];break;case t<=8192:e=[25,t-6145,11];break;case t<=12288:e=[26,t-8193,12];break;case t<=16384:e=[27,t-12289,12];break;case t<=24576:e=[28,t-16385,13];break;case t<=32768:e=[29,t-24577,13];break;default:throw"invalid distance"}return e},Ac.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var t,e=this.length,i=this.backwardDistance,n=[],r=0;return t=Ac.RawDeflate.Lz77Match.LengthCodeTable[e],n[r++]=65535&t,n[r++]=t>>16&255,n[r++]=t>>24,t=this.getDistanceCode_(i),n[r++]=t[0],n[r++]=t[1],n[r++]=t[2],n},Ac.RawDeflate.prototype.lz77=function(t){var e,i,n,r,s,o,a,h,l,c={},u=Ac.RawDeflate.WindowSize,f=new Uint16Array(2*t.length),d=0,p=0,g=new Uint32Array(286),m=new Uint32Array(30),w=this.lazy;function b(t,e){var i,n,r=t.toLz77Array();for(i=0,n=r.length;i<n;++i)f[d++]=r[i];g[r[0]]++,m[r[3]]++,p=t.length+e-1,h=null}for(g[256]=1,e=0,i=t.length;e<i;++e){for(s=0,n=0,r=Ac.RawDeflate.Lz77MinLength;n<r&&e+n!==i;++n)s=s<<8|t[e+n];if(void 0===c[s]&&(c[s]=[]),o=c[s],p-- >0)o.push(e);else{for(;o.length>0&&e-o[0]>u;)o.shift();if(e+Ac.RawDeflate.Lz77MinLength>=i){for(h&&b(h,-1),n=0,r=i-e;n<r;++n)l=t[e+n],f[d++]=l,++g[l];break}o.length>0?(a=this.searchLongestMatch_(t,e,o),h?h.length<a.length?(l=t[e-1],f[d++]=l,++g[l],b(a,0)):b(h,-1):a.length<w?h=a:b(a,0)):h?b(h,-1):(l=t[e],f[d++]=l,++g[l]),o.push(e)}}return f[d++]=256,g[256]++,this.freqsLitLen=g,this.freqsDist=m,f.subarray(0,d)},Ac.RawDeflate.prototype.searchLongestMatch_=function(t,e,i){var n,r,s,o,a,h,l=0,c=t.length;t:for(o=0,h=i.length;o<h;o++){if(n=i[h-o-1],s=Ac.RawDeflate.Lz77MinLength,l>Ac.RawDeflate.Lz77MinLength){for(a=l;a>Ac.RawDeflate.Lz77MinLength;a--)if(t[n+a-1]!==t[e+a-1])continue t;s=l}for(;s<Ac.RawDeflate.Lz77MaxLength&&e+s<c&&t[n+s]===t[e+s];)++s;if(s>l&&(r=n,l=s),s===Ac.RawDeflate.Lz77MaxLength)break}return new Ac.RawDeflate.Lz77Match(l,e-r)},Ac.RawDeflate.prototype.getTreeSymbols_=function(t,e,i,n){var r,s,o,a,h,l,c=new Uint32Array(t+i),u=new Uint32Array(316),f=new Uint8Array(19);for(s=0,r=0;r<t;r++)c[s++]=e[r];for(r=0;r<i;r++)c[s++]=n[r];for(h=0,r=0,a=c.length;r<a;r+=s){for(s=1;r+s<a&&c[r+s]===c[r];++s);if(o=s,0===c[r])if(o<3)for(;o-- >0;)u[h++]=0,f[0]++;else for(;o>0;)(l=o<138?o:138)>o-3&&l<o&&(l=o-3),l<=10?(u[h++]=17,u[h++]=l-3,f[17]++):(u[h++]=18,u[h++]=l-11,f[18]++),o-=l;else if(u[h++]=c[r],f[c[r]]++,--o<3)for(;o-- >0;)u[h++]=c[r],f[c[r]]++;else for(;o>0;)(l=o<6?o:6)>o-3&&l<o&&(l=o-3),u[h++]=16,u[h++]=l-3,f[16]++,o-=l}return{codes:u.subarray(0,h),freqs:f}},Ac.RawDeflate.prototype.getLengths_=function(t,e){var i,n,r,s,o,a=t.length,h=new Ac.Heap(2*Ac.RawDeflate.HUFMAX),l=new Uint8Array(a);for(s=0;s<a;++s)t[s]>0&&h.push(s,t[s]);if(i=new Array(h.length/2),n=new Uint32Array(h.length/2),1===i.length)return l[h.pop().index]=1,l;for(s=0,o=h.length/2;s<o;++s)i[s]=h.pop(),n[s]=i[s].value;for(r=this.reversePackageMerge_(n,n.length,e),s=0,o=i.length;s<o;++s)l[i[s].index]=r[s];return l},Ac.RawDeflate.prototype.reversePackageMerge_=function(t,e,i){var n,r,s,o,a,h=new Uint16Array(i),l=new Uint8Array(i),c=new Uint8Array(e),u=new Array(i),f=new Array(i),d=new Array(i),p=(1<<i)-e,g=1<<i-1;function m(t){var i=f[t][d[t]];i===e?(m(t+1),m(t+1)):--c[i],++d[t]}for(h[i-1]=e,r=0;r<i;++r)p<g?l[r]=0:(l[r]=1,p-=g),p<<=1,h[i-2-r]=(h[i-1-r]/2|0)+e;for(h[0]=l[0],u[0]=new Array(h[0]),f[0]=new Array(h[0]),r=1;r<i;++r)h[r]>2*h[r-1]+l[r]&&(h[r]=2*h[r-1]+l[r]),u[r]=new Array(h[r]),f[r]=new Array(h[r]);for(n=0;n<e;++n)c[n]=i;for(s=0;s<h[i-1];++s)u[i-1][s]=t[s],f[i-1][s]=s;for(n=0;n<i;++n)d[n]=0;for(1===l[i-1]&&(--c[0],++d[i-1]),r=i-2;r>=0;--r){for(n=0,o=0,a=d[r+1],s=0;s<h[r];s++)(o=u[r+1][a]+u[r+1][a+1])>t[n]?(u[r][s]=o,f[r][s]=e,a+=2):(u[r][s]=t[n],f[r][s]=n,++n);d[r]=0,1===l[r]&&m(r)}return c},Ac.RawDeflate.prototype.getCodesFromLengths_=function(t){var e,i,n,r,s=new Uint16Array(t.length),o=[],a=[],h=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,i=Ac.RawDeflate.MaxCodeLength;e<=i;e++)a[e]=h,h+=0|o[e],h<<=1;for(e=0,i=t.length;e<i;e++)for(h=a[t[e]],a[t[e]]+=1,s[e]=0,n=0,r=t[e];n<r;n++)s[e]=s[e]<<1|1&h,h>>>=1;return s},Ac.Unzip=function(t,e){e=e||{},this.input=t instanceof Array?new Uint8Array(t):t,this.ip=0,this.eocdrOffset,this.numberOfThisDisk,this.startDisk,this.totalEntriesThisDisk,this.totalEntries,this.centralDirectorySize,this.centralDirectoryOffset,this.commentLength,this.comment,this.fileHeaderList,this.filenameToIndex,this.verify=e.verify||!1,this.password=e.password},Ac.Unzip.CompressionMethod=Ac.Zip.CompressionMethod,Ac.Unzip.FileHeaderSignature=Ac.Zip.FileHeaderSignature,Ac.Unzip.LocalFileHeaderSignature=Ac.Zip.LocalFileHeaderSignature,Ac.Unzip.CentralDirectorySignature=Ac.Zip.CentralDirectorySignature,Ac.Unzip.FileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.version,this.os,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.fileCommentLength,this.diskNumberStart,this.internalFileAttributes,this.externalFileAttributes,this.relativeOffset,this.filename,this.extraField,this.comment},Ac.Unzip.FileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==Ac.Unzip.FileHeaderSignature[0]||t[e++]!==Ac.Unzip.FileHeaderSignature[1]||t[e++]!==Ac.Unzip.FileHeaderSignature[2]||t[e++]!==Ac.Unzip.FileHeaderSignature[3])throw new Error("invalid file header signature");this.version=t[e++],this.os=t[e++],this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.fileCommentLength=t[e++]|t[e++]<<8,this.diskNumberStart=t[e++]|t[e++]<<8,this.internalFileAttributes=t[e++]|t[e++]<<8,this.externalFileAttributes=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,this.relativeOffset=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.comment=t.subarray(e,e+this.fileCommentLength),this.length=e-this.offset},Ac.Unzip.LocalFileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.filename,this.extraField},Ac.Unzip.LocalFileHeader.Flags=Ac.Zip.Flags,Ac.Unzip.LocalFileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==Ac.Unzip.LocalFileHeaderSignature[0]||t[e++]!==Ac.Unzip.LocalFileHeaderSignature[1]||t[e++]!==Ac.Unzip.LocalFileHeaderSignature[2]||t[e++]!==Ac.Unzip.LocalFileHeaderSignature[3])throw new Error("invalid local file header signature");this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.length=e-this.offset},Ac.Unzip.prototype.searchEndOfCentralDirectoryRecord=function(){var t,e=this.input;for(t=e.length-12;t>0;--t)if(e[t]===Ac.Unzip.CentralDirectorySignature[0]&&e[t+1]===Ac.Unzip.CentralDirectorySignature[1]&&e[t+2]===Ac.Unzip.CentralDirectorySignature[2]&&e[t+3]===Ac.Unzip.CentralDirectorySignature[3])return void(this.eocdrOffset=t);throw new Error("End of Central Directory Record not found")},Ac.Unzip.prototype.parseEndOfCentralDirectoryRecord=function(){var t,e=this.input;if(this.eocdrOffset||this.searchEndOfCentralDirectoryRecord(),t=this.eocdrOffset,e[t++]!==Ac.Unzip.CentralDirectorySignature[0]||e[t++]!==Ac.Unzip.CentralDirectorySignature[1]||e[t++]!==Ac.Unzip.CentralDirectorySignature[2]||e[t++]!==Ac.Unzip.CentralDirectorySignature[3])throw new Error("invalid signature");this.numberOfThisDisk=e[t++]|e[t++]<<8,this.startDisk=e[t++]|e[t++]<<8,this.totalEntriesThisDisk=e[t++]|e[t++]<<8,this.totalEntries=e[t++]|e[t++]<<8,this.centralDirectorySize=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.centralDirectoryOffset=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.commentLength=e[t++]|e[t++]<<8,this.comment=e.subarray(t,t+this.commentLength)},Ac.Unzip.prototype.parseFileHeader=function(){var t,e,i,n,r=[],s={};if(!this.fileHeaderList){for(void 0===this.centralDirectoryOffset&&this.parseEndOfCentralDirectoryRecord(),t=this.centralDirectoryOffset,i=0,n=this.totalEntries;i<n;++i)(e=new Ac.Unzip.FileHeader(this.input,t)).parse(),t+=e.length,r[i]=e,s[e.filename]=i;if(this.centralDirectorySize<t-this.centralDirectoryOffset)throw new Error("invalid file header size");this.fileHeaderList=r,this.filenameToIndex=s}},Ac.Unzip.prototype.getFileData=function(t,e){e=e||{};var i,n,r,s,o,a,h,l,c=this.input,u=this.fileHeaderList;if(u||this.parseFileHeader(),void 0===u[t])throw new Error("wrong index");if(n=u[t].relativeOffset,(i=new Ac.Unzip.LocalFileHeader(this.input,n)).parse(),n+=i.length,r=i.compressedSize,0!=(i.flags&Ac.Unzip.LocalFileHeader.Flags.ENCRYPT)){if(!e.password&&!this.password)throw new Error("please set password");for(a=this.createDecryptionKey(e.password||this.password),h=n,l=n+12;h<l;++h)this.decode(a,c[h]);for(h=n+=12,l=n+(r-=12);h<l;++h)c[h]=this.decode(a,c[h])}switch(i.compression){case Ac.Unzip.CompressionMethod.STORE:s=this.input.subarray(n,n+r);break;case Ac.Unzip.CompressionMethod.DEFLATE:s=new Ac.RawInflate(this.input,{index:n,bufferSize:i.plainSize}).decompress();break;default:throw new Error("unknown compression type")}if(this.verify&&(o=Ac.CRC32.calc(s),i.crc32!==o))throw new Error("wrong crc: file=0x"+i.crc32.toString(16)+", data=0x"+o.toString(16));return s},Ac.Unzip.prototype.getFilenames=function(){var t,e,i,n=[];for(this.fileHeaderList||this.parseFileHeader(),t=0,e=(i=this.fileHeaderList).length;t<e;++t)n[t]=i[t].filename;return n},Ac.Unzip.prototype.decompress=function(t,e){var i;if(this.filenameToIndex||this.parseFileHeader(),void 0===(i=this.filenameToIndex[t]))throw new Error(t+" not found");return this.getFileData(i,e)},Ac.Unzip.prototype.setPassword=function(t){this.password=t},Ac.Unzip.prototype.decode=function(t,e){return e^=this.getByte(t),this.updateKeys(t,e),e},Ac.Unzip.prototype.updateKeys=Ac.Zip.prototype.updateKeys,Ac.Unzip.prototype.createDecryptionKey=Ac.Zip.prototype.createEncryptionKey,Ac.Unzip.prototype.getByte=Ac.Zip.prototype.getByte,Ac.Util.stringToByteArray=function(t){var e,i,n=t.split("");for(e=0,i=n.length;e<i;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;return n},Ac.Adler32=function(t){return"string"==typeof t&&(t=Ac.Util.stringToByteArray(t)),Ac.Adler32.update(1,t)},Ac.Adler32.update=function(t,e){for(var i,n=65535&t,r=t>>>16&65535,s=e.length,o=0;s>0;){s-=i=s>Ac.Adler32.OptimizationParameter?Ac.Adler32.OptimizationParameter:s;do{r+=n+=e[o++]}while(--i);n%=65521,r%=65521}return(r<<16|n)>>>0},Ac.Adler32.OptimizationParameter=1024,Ac.BitStream=function(t,e){if(this.index="number"==typeof e?e:0,this.bitindex=0,this.buffer=t instanceof Uint8Array?t:new Uint8Array(Ac.BitStream.DefaultBlockSize),2*this.buffer.length<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()},Ac.BitStream.DefaultBlockSize=32768,Ac.BitStream.prototype.expandBuffer=function(){var t=this.buffer,e=t.length,i=new Uint8Array(e<<1);return i.set(t),this.buffer=i},Ac.BitStream.prototype.writeBits=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.bitindex,a=r[s];if(i&&e>1&&(t=e>8?function(t){return Ac.BitStream.ReverseTable[255&t]<<24|Ac.BitStream.ReverseTable[t>>>8&255]<<16|Ac.BitStream.ReverseTable[t>>>16&255]<<8|Ac.BitStream.ReverseTable[t>>>24&255]}(t)>>32-e:Ac.BitStream.ReverseTable[t]>>8-e),e+o<8)a=a<<e|t,o+=e;else for(n=0;n<e;++n)a=a<<1|t>>e-n-1&1,8==++o&&(o=0,r[s++]=Ac.BitStream.ReverseTable[a],a=0,s===r.length&&(r=this.expandBuffer()));r[s]=a,this.buffer=r,this.bitindex=o,this.index=s},Ac.BitStream.prototype.finish=function(){var t=this.buffer,e=this.index;return this.bitindex>0&&(t[e]<<=8-this.bitindex,t[e]=Ac.BitStream.ReverseTable[t[e]],e++),t.subarray(0,e)},Ac.BitStream.ReverseTable=function(){var t,e=new Uint8Array(256);for(t=0;t<256;++t)e[t]=function(t){var e=t,i=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--i;return(e<<i&255)>>>0}(t);return e}(),Ac.CRC32.calc=function(t,e,i){return Ac.CRC32.update(t,0,e,i)},Ac.CRC32.update=function(t,e,i,n){var r=Ac.CRC32.Table,s="number"==typeof i?i:i=0,o="number"==typeof n?n:t.length;for(e^=4294967295,s=7&o;s--;++i)e=e>>>8^r[255&(e^t[i])];for(s=o>>3;s--;i+=8)e=(e=(e=(e=(e=(e=(e=(e=e>>>8^r[255&(e^t[i])])>>>8^r[255&(e^t[i+1])])>>>8^r[255&(e^t[i+2])])>>>8^r[255&(e^t[i+3])])>>>8^r[255&(e^t[i+4])])>>>8^r[255&(e^t[i+5])])>>>8^r[255&(e^t[i+6])])>>>8^r[255&(e^t[i+7])];return(4294967295^e)>>>0},Ac.CRC32.single=function(t,e){return(Ac.CRC32.Table[255&(t^e)]^t>>>8)>>>0},Ac.CRC32.Table_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],Ac.CRC32.Table=new Uint32Array(Ac.CRC32.Table_),Ac.Deflate=function(t,e){this.input=t,this.output=new Uint8Array(Ac.Deflate.DefaultBufferSize),this.compressionType=Ac.Deflate.CompressionType.DYNAMIC,this.rawDeflate;var i,n={};for(i in!e&&(e={})||"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.output,this.rawDeflate=new Ac.RawDeflate(this.input,n)},Ac.Deflate.DefaultBufferSize=32768,Ac.Deflate.CompressionType=Ac.RawDeflate.CompressionType,Ac.Deflate.compress=function(t,e){return new Ac.Deflate(t,e).compress()},Ac.Deflate.prototype.compress=function(){var t,e,i,n,r,s,o=0;if(s=this.output,(t=Ac.CompressionMethod.DEFLATE)!==Ac.CompressionMethod.DEFLATE)throw new Error("invalid compression method");if(e=Math.LOG2E*Math.log(Ac.RawDeflate.WindowSize)-8<<4|t,s[o++]=e,0,t!==Ac.CompressionMethod.DEFLATE)throw new Error("invalid compression method");switch(this.compressionType){case Ac.Deflate.CompressionType.NONE:n=0;break;case Ac.Deflate.CompressionType.FIXED:n=1;break;case Ac.Deflate.CompressionType.DYNAMIC:n=2;break;default:throw new Error("unsupported compression type")}return i=n<<6|0,i|=31-(256*e+i)%31,s[o++]=i,r=Ac.Adler32(this.input),this.rawDeflate.op=o,o=(s=this.rawDeflate.compress()).length,(s=new Uint8Array(s.buffer)).length<=o+4&&(this.output=new Uint8Array(s.length+4),this.output.set(s),s=this.output),(s=s.subarray(0,o+4))[o++]=r>>24&255,s[o++]=r>>16&255,s[o++]=r>>8&255,s[o++]=255&r,s};const zc="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node?require("node-fetch"):fetch;class Fc{constructor(t){this.file=t}async read(t,e){const i=this.file;return void 0!==t?i.slice(t,t+e).arrayBuffer():i.arrayBuffer()}}let Nc,_c,Oc;if("undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node){const ff=require("util");Nc=require("fs"),_c=Nc&&ff.promisify(Nc.open),Oc=Nc&&ff.promisify(Nc.read)}class $c{constructor(t){this.path=t.path}async read(t,e){const i=Buffer.alloc(e),n=await _c(this.path,"r"),r=await Oc(n,i,0,e,t);Nc.close(n,(function(t){}));const s=r.buffer;return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}}const Uc="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;class Hc{constructor(t){var e;this.config=t,this.url=(e=t.path||t.url).includes("//www.dropbox.com")?e.replace("//www.dropbox.com","//dl.dropboxusercontent.com"):e.startsWith("ftp://ftp.ncbi.nlm.nih.gov")?e.replace("ftp://","https://"):e}async read(t,e){e=Math.ceil(e);const i=this.config.headers||{},n="bytes="+t+"-"+(t+e-1);i.Range=n;let r=this.url.slice();if(Uc)i["User-Agent"]="straw";else{if(this.config.oauthToken){const t=async function(t){return"function"==typeof t?await Promise.resolve(t()):t}(this.config.oauthToken);i.Authorization=`Bearer ${t}`}0==navigator.vendor.indexOf("Apple")&&/\sSafari\//.test(navigator.userAgent);const t=navigator.userAgent.indexOf("Chrome")>-1,e=this.url.indexOf("X-Amz-Signature")>-1;t&&!e&&(r=Pc(r,"randomSeed",Math.random().toString(36)))}this.config.apiKey&&(r=Pc(r,"key",this.config.apiKey));const s=await zc(r,{method:"GET",headers:i,redirect:"follow",mode:"cors"}),o=s.status;if(o>=400){console.error(`${o}  ${this.config.url}`);const t=Error(s.statusText);throw t.code=o,t}return s.arrayBuffer()}}function Pc(t,e,i){const n=t.includes("?")?"&":"?";return t+n+e+"="+i}class Vc{constructor(t,e){this.file=t,this.rateLimiter=e}async read(t,e){const i=this.file,n=this.rateLimiter;return new Promise((function(r,s){n.limiter((async function(i){try{const n=await i.read(t,e);r(n)}catch(t){s(t)}}))(i)}))}}class Wc{constructor(t){this.file=t.file,this.size=t.size||64e3,this.position=0,this.bufferStart=0,this.bufferLength=0,this.buffer=void 0}async read(t,e){const i=t,n=t+e,r=this.bufferStart,s=this.bufferStart+this.bufferLength;if(e>this.size)return this.buffer=void 0,this.bufferStart=0,this.bufferLength=0,this.file.read(t,e);if(i>=r&&n<=s){const t=i-r,n=t+e;return this.buffer.slice(t,n)}if(i<r&&n>r){const n=r-i,s=await this.file.read(t,n),o=e-n;if(o>0){const t=this.buffer.slice(0,o);return Gc(s,t)}return s}if(!(i<s&&n>s))return this.buffer=await this.file.read(t,this.size),this.bufferStart=t,this.bufferLength=this.buffer.byteLength,this.buffer.slice(0,e);{const t=s-i,n=this.bufferLength-t,r=this.buffer.slice(n,this.bufferLength),o=e-t;if(!(o>0))return r;try{this.buffer=await this.file.read(s,this.size),this.bufferStart=s,this.bufferLength=this.buffer.byteLength;const t=this.buffer.slice(0,o);return Gc(r,t)}catch(t){if(t.code&&416===t.code)return r;throw t}}}}var Gc=function(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer};const jc=function(t,e){this.littleEndian=void 0===e||e,this.position=0,this.view=t,this.length=t.byteLength};function qc(t,e){this.block=t,this.offset=e}jc.prototype.available=function(){return this.length-this.position},jc.prototype.remLength=function(){return this.length-this.position},jc.prototype.hasNext=function(){return this.position<this.length-1},jc.prototype.getByte=function(){var t=this.view.getUint8(this.position,this.littleEndian);return this.position++,t},jc.prototype.getShort=function(){var t=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,t},jc.prototype.getUShort=function(){var t=this.view.getUint16(this.position,this.littleEndian);return this.position+=2,t},jc.prototype.getInt=function(){var t=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,t},jc.prototype.getUInt=function(){var t=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,t},jc.prototype.getLong=function(){var t=[];t[0]=this.view.getUint8(this.position),t[1]=this.view.getUint8(this.position+1),t[2]=this.view.getUint8(this.position+2),t[3]=this.view.getUint8(this.position+3),t[4]=this.view.getUint8(this.position+4),t[5]=this.view.getUint8(this.position+5),t[6]=this.view.getUint8(this.position+6),t[7]=this.view.getUint8(this.position+7);var e=0;if(this.littleEndian)for(var i=t.length-1;i>=0;i--)e=256*e+t[i];else for(i=0;i<t.length;i++)e=256*e+t[i];return this.position+=8,e},jc.prototype.getString=function(t){for(var e,i="";0!=(e=this.view.getUint8(this.position++))&&(i+=String.fromCharCode(e),!t||i.length!=t););return i},jc.prototype.getFixedLengthString=function(t){var e,i,n="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>0&&(n+=String.fromCharCode(i));return n},jc.prototype.getFixedLengthTrimmedString=function(t){var e,i,n="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>32&&(n+=String.fromCharCode(i));return n},jc.prototype.getFloat=function(){var t=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,t},jc.prototype.getDouble=function(){var t=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,t},jc.prototype.skip=function(t){return this.position+=t,this.position},jc.prototype.getVPointer=function(){var t=this.position,e=this.view.getUint8(t+1)<<8|this.view.getUint8(t),i=4294967296*(255&this.view.getUint8(t+6))+16777216*(255&this.view.getUint8(t+5))+65536*(255&this.view.getUint8(t+4))+256*(255&this.view.getUint8(t+3))+(255&this.view.getUint8(t+2));return this.position+=8,new qc(i,e)},qc.prototype.isLessThan=function(t){return this.block<t.block||this.block===t.block&&this.offset<t.offset},qc.prototype.isGreaterThan=function(t){return this.block>t.block||this.block===t.block&&this.offset>t.offset},qc.prototype.print=function(){return this.block+":"+this.offset};class Zc{constructor(t,e){this.chr1=t,this.chr2=e}getKey(){return this.chr1.name+"_"+this.chr2.name+"_"+this.zoom.unit+"_"+this.zoom.binSize}getBlockNumbers(t,e,i){if(t.chr==this.chr2&&e.chr===this.chr1){const i=t;t=e,e=i}const n=this.chr1===this.chr2,r=this.zoom.binSize,s=this.blockBinCount,o=this.blockColumnCount;return i<9||!n?function(){const i=t.start/r,a=t.end/r,h=e.start/r,l=e.end/r,c=Math.floor(i/s),u=Math.floor((a-1)/s),f=Math.floor(h/s),d=Math.floor((l-1)/s),p=[];for(let t=f;t<=d;t++)for(let e=c;e<=u;e++){let i;i=n&&t<e?e*o+t:t*o+e,p.includes(i)||p.push(i)}return p}():function(){const i=t.start/r,n=t.end/r,a=e.start/r,h=e.end/r,l=Math.floor((i+a)/2/s),c=Math.floor((n+h)/2/s),u=Math.floor(Math.log2(1+Math.abs(i-h)/Math.sqrt(2)/s)),f=Math.floor(Math.log2(1+Math.abs(n-a)/Math.sqrt(2)/s)),d=(n-a)*(i-h)<0?0:Math.min(u,f),p=Math.max(u,f),g=[];for(let t=d;t<=p;t++)for(let e=l;e<=c;e++){const i=t*o+e;g.push(i)}return g}()}static parseMatrixZoomData(t,e,i){const n=new Zc(t,e),r=i.getString(),s=i.getInt(),o=i.getFloat(),a=i.getFloat(),h=i.getFloat(),l=i.getFloat(),c=i.getInt();n.blockBinCount=i.getInt(),n.blockColumnCount=i.getInt();const u=i.getInt();n.zoom={index:s,unit:r,binSize:c},n.blockIndex=new Kc(u,i);const f=o/(t.size/c)/(e.size/c);return n.averageCount=f,n.sumCounts=o,n.stdDev=h,n.occupiedCellCount=a,n.percent95=l,n}}class Kc{constructor(t,e){for(this.blockIndex={};t-- >0;){const t=e.getInt(),i=e.getLong(),n=e.getInt();this.blockIndex[t]={filePosition:i,size:n}}}getBlockIndexEntry(t){return this.blockIndex[t]}}class Yc{constructor(t,e,i){this.chr1=t,this.chr2=e,this.bpZoomData=[],this.fragZoomData=[];for(let t of i)"BP"===t.zoom.unit?this.bpZoomData.push(t):this.fragZoomData.push(t)}findZoomForResolution(t,e){const i="FRAG"===e?this.fragZoomData:this.bpZoomData;for(let e=1;e<i.length;e++){if(i[e].zoom.binSize<t)return e-1}return i.length-1}getZoomData(t,e){const i="BP"===(e=e||"BP")?this.bpZoomData:this.fragZoomData;for(let e=0;e<i.length;e++){var n=i[e];if(t===n.zoom.binSize)return n}}getZoomDataByIndex(t,e){return("FRAG"===e?this.fragZoomData:this.bpZoomData)[t]}static getKey(t,e){if(t>e){const i=t;t=e,e=i}return`${t}_${e}`}static parseMatrix(t,e){const i=new jc(new DataView(t)),n=i.getInt(),r=i.getInt(),s=e[n],o=e[r];let a=i.getInt();const h=[];for(;a-- >0;){const t=Zc.parseMatrixZoomData(s,o,i);h.push(t)}return new Yc(n,r,h)}}class Xc{constructor(t,e,i){this.bin1=t,this.bin2=e,this.counts=i}getKey(){return this.bin1+"_"+this.bin2}}class Jc{constructor(t=10){this.max=t,this.map=new Map}get(t){let e=this.map.get(t);return e&&(this.map.delete(t),this.map.set(t,e)),e}set(t,e){this.map.has(t)?this.map.delete(t):this.map.size===this.max&&this.map.delete(this.first()),this.map.set(t,e)}has(t){return this.map.has(t)}clear(){this.map.clear()}first(){return this.map.keys().next().value}}class Qc{constructor(t,e,i,n){this.file=t,this.filePosition=e,this.nValues=i,this.dataType=n,this.cache=void 0}async getValues(t,e){if(!this.cache||t<this.cache.start||e>this.cache.end){const i=Math.max(0,t-1e3),n=Math.min(this.nValues,e+1e3),r=this.filePosition+i*this.dataType,s=n-i,o=s*this.dataType,a=await this.file.read(r,o);if(!a)return;const h=new jc(new DataView(a)),l=[];for(let t=0;t<s;t++)l[t]=8===this.dataType?h.getDouble():h.getFloat();this.cache={start:i,end:n,values:l}}const i=t-this.cache.start,n=i+(e-t);return this.cache.values.slice(i,n)}getKey(){return Qc.getKey(this.type,this.chrIdx,this.unit,this.resolution)}static getNormalizationVectorKey(t,e,i,n){return t+"_"+e+"_"+i+"_"+n}}const tu="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,eu=new class{constructor(t){this.wait=void 0===t?100:t,this.isCalled=!1,this.calls=[]}limiter(t){const e=this;let i=function(){e.calls.length&&!e.isCalled&&(e.isCalled=!0,e.calls.shift().call(),setTimeout((function(){e.isCalled=!1,i()}),e.wait))};return function(){e.calls.push(t.bind(this,...arguments)),i()}}}(100);class iu{constructor(t){if(this.config=t,this.loadFragData=t.loadFragData,this.fragmentSitesCache={},this.normVectorCache=new Jc(10),this.normalizationTypes=["NONE"],this.matrixCache=new Jc(10),this.blockCache=new su,t.file)this.file=t.file;else if(t.blob)this.file=new Fc(t.blob);else if(t.url||t.path&&!tu){this.url=t.url||this.path,this.remote=!0;const i=new Hc(t);(e=this.url).indexOf("drive.google.com")>=0||e.indexOf("www.googleapis.com/drive")>0?this.file=new Vc(i,eu):this.file=i}else{if(!t.path)throw Error("Arguments must include file, blob, url, or path");this.file=new $c({path:t.path})}var e}async init(){this.initialized||(await this.readHeaderAndFooter(),this.initialized=!0)}async getVersion(){if(void 0===this.version){const t=await this.file.read(0,128);if(!t)return;const e=new jc(new DataView(t));return this.magic=e.getString(),this.version=e.getInt(),this.version}return this.version}async getMetaData(){return await this.init(),this.meta}async readHeaderAndFooter(){let t=await this.file.read(0,16);if(!t||0===t.byteLength)throw Error("File content is empty");let e=new jc(new DataView(t));if(this.magic=e.getString(),this.version=e.getInt(),this.version<5)throw Error("Unsupported hic version: "+this.version);this.footerPosition=e.getLong(),await this.readFooter();const i=Object.values(this.masterIndex).reduce(((t,e)=>Math.min(t,e.start)),Number.MAX_VALUE),n=i-16;t=await this.file.read(16,n),e=new jc(new DataView(t)),this.genomeId=e.getString(),this.version>=9&&(this.normVectorIndexPosition=e.getLong(),this.normVectorIndexSize=e.getLong()),this.attributes={};let r=e.getInt();for(;r-- >0;)this.attributes[e.getString()]=e.getString();this.chromosomes=[],this.chromosomeIndexMap={};let s=e.getInt(),o=0;for(;s-- >0;){const t={index:o,name:e.getString(),size:this.version<9?e.getInt():e.getLong()};"all"===t.name.toLowerCase()&&(this.wholeGenomeChromosome=t,this.wholeGenomeResolution=Math.round(2*t.size)),this.chromosomes.push(t),this.chromosomeIndexMap[t.name]=t.index,o++}this.bpResolutions=[];let a=e.getInt();for(;a-- >0;)this.bpResolutions.push(e.getInt());if(this.loadFragData){this.fragResolutions=[];let t=e.getInt();if(t>0)for(;t-- >0;)this.fragResolutions.push(e.getInt())}this.chrAliasTable={};for(let t of Object.keys(this.chromosomeIndexMap))t.startsWith("chr")?this.chrAliasTable[t.substr(3)]=t:"MT"===t?this.chrAliasTable.chrM=t:this.chrAliasTable["chr"+t]=t;this.meta={version:this.version,genome:this.genomeId,chromosomes:this.chromosomes,resolutions:this.bpResolutions}}async readFooter(){const t=this.version<9?8:12;let e=await this.file.read(this.footerPosition,t);if(!e)return null;let i=new jc(new DataView(e));const n=this.version<9?i.getInt():i.getLong();let r=i.getInt();const s=196*r;for(e=await this.file.read(this.footerPosition+t,Math.min(s,n)),i=new jc(new DataView(e)),this.masterIndex={};r-- >0;){const t=i.getString(),e=i.getLong(),n=i.getInt();this.masterIndex[t]={start:e,size:n}}if(this.expectedValueVectors={},this.version>5){const t=this.version<9?4:8;this.normExpectedValueVectorsPosition=this.footerPosition+t+n}return this}async printIndexStats(){let t,e=0,i=0;await await this.init();for(let n of Object.keys(this.masterIndex)){const r=this.masterIndex[n];e+=r.size,r.size>i&&(i=r.size,t=n)}console.log(`${i}  ${t}  ${this.config.url}`)}async getMatrix(t,e){const i=Yc.getKey(t,e);if(this.matrixCache.has(i))return this.matrixCache.get(i);{const n=await this.readMatrix(t,e);return this.matrixCache.set(i,n),n}}async readMatrix(t,e){if(await this.init(),t>e){const i=t;t=e,e=i}const i=Yc.getKey(t,e),n=this.masterIndex[i];if(!n)return;const r=await this.file.read(n.start,n.size);return r?Yc.parseMatrix(r,this.chromosomes):void 0}async getContactRecords(t,e,i,n,r,s=!1){await this.init();const o=this.chromosomeIndexMap[this.getFileChrName(e.chr)],a=this.chromosomeIndexMap[this.getFileChrName(i.chr)];if(o>a||o===a&&e.start>=i.end){const t=e;e=i,i=t}const h=await this.getBlocks(e,i,n,r);if(!h||0===h.length)return[];const l=[],c=e.start/r,u=e.end/r,f=i.start/r,d=i.end/r,p=Math.floor(c),g=Math.ceil(u),m=Math.floor(f),w=Math.ceil(d);for(let o of h)if(o){let a,h,b=t&&"NONE"!==t;const y=this.getFileChrName(e.chr),v=this.getFileChrName(i.chr);if(b){const e=await this.getNormalizationVector(t,y,n,r),i=y===v?e:await this.getNormalizationVector(t,v,n,r);e&&i?(a=await e.getValues(p,g),h=await i.getValues(m,w)):b=!1}for(let t of o.records)if(s||t.bin1>=c&&t.bin1<u&&t.bin2>=f&&t.bin2<d)if(b){const e=t.bin1,i=t.bin2,n=a[e-p]*h[i-m];if(0!==n&&!isNaN(n)){const r=t.counts/n;l.push(new Xc(e,i,r))}}else l.push(t)}return l}async getBlocks(t,e,i,n){await this.init();const r=this.getFileChrName(t.chr),s=this.getFileChrName(e.chr),o=this.chromosomeIndexMap[r],a=this.chromosomeIndexMap[s];if(void 0===o)return console.log("No chromosome named: "+t.chr),[];if(void 0===a)return console.log("No chromosome named: "+e.chr),[];const h=await this.getMatrix(o,a);if(!h)return console.log("No matrix for "+t.chr+"-"+e.chr),[];const l=h.getZoomData(n,i);if(!l){let i=`No data avalailble for resolution: ${n}  for map ${t.chr}-${e.chr}`;throw new Error(i)}const c=l.getBlockNumbers(t,e,this.version),u=[],f=[];for(let t of c)this.blockCache.has(n,t)?u.push(this.blockCache.get(n,t)):f.push(t);const d=f.map((t=>this.readBlock(t,l))),p=await Promise.all(d);for(let t of p)t&&this.blockCache.set(n,t.blockNumber,t);return u.concat(p)}async readBlock(t,e){const i=await e.blockIndex.getBlockIndexEntry(t);if(i){let n=await this.file.read(i.filePosition,i.size);if(!n)return;n=new Ac.Inflate(new Uint8Array(n)).decompress().buffer;const r=new jc(new DataView(n)),s=r.getInt(),o=[];if(this.version<7)for(let t=0;t<s;t++){const t=r.getInt(),e=r.getInt(),i=r.getFloat();o.push(new Xc(t,e,i))}else{const t=r.getInt(),e=r.getInt(),i=1===r.getByte(),n=!(this.version<9)&&1==r.getByte(),s=!(this.version<9)&&1==r.getByte(),a=r.getByte();if(1===a){const a=s?r.getInt():r.getShort();for(let h=0;h<a;h++){const a=e+(s?r.getInt():r.getShort()),h=n?r.getInt():r.getShort();for(let e=0;e<h;e++){const e=t+(n?r.getInt():r.getShort()),s=i?r.getFloat():r.getShort();o.push(new Xc(e,a,s))}}}else{if(2!=a)throw new Error("Unknown block type: "+a);{const n=r.getInt(),s=r.getShort();for(let a=0;a<n;a++){const n=Math.floor(a/s),h=t+(a-n*s),l=e+n;if(i){const t=r.getFloat();isNaN(t)||o.push(new Xc(h,l,t))}else{const t=r.getShort();-32768!=t&&o.push(new Xc(h,l,t))}}}}}return new ru(t,e,o,i)}}async hasNormalizationVector(t,e,i,n){let r;if(await this.init(),Number.isInteger(e))r=e;else{const t=this.getFileChrName(e);r=this.chromosomeIndexMap[t]}const s=nu(t,r,i.toString(),n),o=await this.getNormVectorIndex();return o&&o[s]}async getNormalizationVector(t,e,i,n){let r;if(await this.init(),Number.isInteger(e))r=e;else{const t=this.getFileChrName(e);r=this.chromosomeIndexMap[t]}const s=nu(t,r,i.toString(),n);if(this.normVectorCache.has(s))return this.normVectorCache.get(s);const o=await this.getNormVectorIndex();if(!o)return void console.log("Normalization vectors not present in this file");const a=o[s];if(!a)return void console.log("Normalization option "+t+" not available at this resolution");const h=await this.file.read(a.filePosition,8);if(!h)return;const l=new jc(new DataView(h)),c=this.version<9?l.getInt():l.getLong(),u=this.version<9?8:4,f=this.version<9?a.filePosition+4:a.filePosition+8,d=new Qc(this.file,f,c,u);return this.normVectorCache.set(s,d),d}async getNormVectorIndex(){if(!(this.version<6)){if(!this.normVectorIndex){if(!this.config.nvi&&this.remote&&this.url){const t=new URL(this.url),e=encodeURIComponent(t.hostname+t.pathname),i=await zc("https://t5dvc6kn3f.execute-api.us-east-1.amazonaws.com/dev/nvi/"+e);if(200===i.status){const t=await i.text();t&&(this.config.nvi=t)}}if(this.config.nvi){const t=decodeURIComponent(this.config.nvi).split(","),e={start:parseInt(t[0]),size:parseInt(t[1])};return this.readNormVectorIndex(e)}try{return await this.readNormExpectedValuesAndNormVectorIndex(),this.normVectorIndex}catch(t){"416"===t.code||416===t.code?this.normExpectedValueVectorsPosition=void 0:console.error(t)}}return this.normVectorIndex}}async getNormalizationOptions(){return await this.getNormVectorIndex(),this.normalizationTypes}async readNormVectorIndex(t){await this.init(),this.normalizationVectorIndexRange=t;const e=await this.file.read(t.start,t.size),i=new jc(new DataView(e));this.normVectorIndex={};let n=i.getInt();for(;n-- >0;)this.parseNormVectorEntry(i);return this.normVectorIndex}async readNormExpectedValuesAndNormVectorIndex(){if(await this.init(),void 0===this.normExpectedValueVectorsPosition)return;const t=await this.skipExpectedValues(this.normExpectedValueVectorsPosition);let e=4,i=await this.file.read(t,4);if(0===i.byteLength)return;const n=new jc(new DataView(i)).getInt(),r={start:t+e,size:30*n};i=await this.file.read(r.start,r.size),this.normalizedExpectedValueVectors={},this.normVectorIndex={},await async function i(n,r){const s=new jc(new DataView(r));for(;n-- >0;){if(s.available()<100){n++,e+=s.position;const r=Math.max(1e3,30*n),o={start:t+e,size:r},a=await this.file.read(o.start,o.size);return i.call(this,n,a)}this.parseNormVectorEntry(s)}e+=s.position}.call(this,n,i),this.config.nvi=t.toString()+","+e}async skipExpectedValues(t){const e=this.version,i=new Wc({file:this.file,size:256e3}),n={start:t,size:4},r=await i.read(n.start,n.size),s=new jc(new DataView(r)).getInt();return 0===s?t+4:async function t(n,r){let s={start:n,size:500},o=0,a=n,h=await i.read(s.start,s.size),l=new jc(new DataView(h));l.getString(),l.getString(),l.getInt();const c=e<9?l.getInt():l.getLong();o+=l.position+c*(e<9?8:4),s={start:n+o,size:4},h=await i.read(s.start,s.size),l=new jc(new DataView(h));const u=l.getInt();return o+=4+u*(4+(e<9?8:4)),0===--r?a+o:t(a+o,r)}(t+4,s)}getZoomIndexForBinSize(t,e){let i;if("BP"===(e=e||"BP"))i=this.bpResolutions;else{if("FRAG"!==e)throw new Error("Invalid unit: "+e);i=this.fragResolutions}for(let e=0;e<i.length;e++)if(i[e]===t)return e;return-1}parseNormVectorEntry(t){const e=t.getString(),i=t.getInt(),n=t.getString(),r=t.getInt(),s=t.getLong(),o=this.version<9?t.getInt():t.getLong(),a=e+"_"+i+"_"+n+"_"+r;this.normalizationTypes.includes(e)||this.normalizationTypes.push(e),this.normVectorIndex[a]={filePosition:s,size:o}}getFileChrName(t){return this.chrAliasTable.hasOwnProperty(t)?this.chrAliasTable[t]:t}}function nu(t,e,i,n){return t+"_"+e+"_"+i+"_"+n}class ru{constructor(t,e,i,n){this.blockNumber=t,this.zoomData=e,this.records=i,this.idx=n}}class su{constructor(){this.resolution=void 0,this.map=new Jc(6)}set(t,e,i){this.resolution!==t&&this.map.clear(),this.resolution=t,this.map.set(e,i)}get(t,e){return this.resolution===t?this.map.get(e):void 0}has(t,e){return this.resolution===t&&this.map.has(e)}}class ou{constructor(t){this.config=t,this.hicFile=new iu(t)}async getMetaData(){return await this.hicFile.getMetaData()}async getContactRecords(t,e,i,n,r){return this.hicFile.getContactRecords(t,e,i,n,r)}async getNormalizationOptions(){return this.hicFile.getNormalizationOptions()}async getNVI(){return await this.hicFile.getNormVectorIndex(),this.hicFile.config.nvi}async printIndexStats(){await this.hicFile.printIndexStats()}getFileChrName(t){return this.hicFile.chrAliasTable.hasOwnProperty(t)?this.hicFile.chrAliasTable[t]:t}}class au{constructor(t){this.config=t,this.url=t.path||t.url}async read(t,e){const i={start:t,size:e};return nt.loadArrayBuffer(this.url,{range:i})}}const hu={hg19:[249250621,243199373,198022430],hg38:[248956422,242193529,198295559],mm10:[195471971,182113224,160039680],mm9:[197195432,181748087,159599783],dm6:[23513712,25286936,28110227]};class lu{constructor(t){this.straw=new ou(t)}async init(){this.hicFile=this.straw.hicFile,await this.hicFile.init(),this.normalizationTypes=["NONE"],this.genomeId=this.hicFile.genomeId,this.chromosomes=this.hicFile.chromosomes,this.bpResolutions=this.hicFile.bpResolutions,this.wholeGenomeChromosome=this.hicFile.wholeGenomeChromosome,this.wholeGenomeResolution=this.hicFile.wholeGenomeResolution;const t=function(t){if(t.length<4)return;const e=Object.keys(hu);let i;for(let n of t)for(let t of e)if(hu[t].includes(n.size)){i=t;break}if(i){const e=new Set(t.map((t=>t.size)));for(let t of hu[i])if(!e.has(t))return;return i}return}(this.chromosomes);t&&(this.genomeId=t)}async getContactRecords(t,e,i,n,r){return this.straw.getContactRecords(t,e,i,n,r)}async hasNormalizationVector(t,e,i,n){return this.straw.hicFile.hasNormalizationVector(t,e,i,n)}clearCaches(){this.colorScaleCache={}}async getMatrix(t,e){return this.hicFile.getMatrix(t,e)}getZoomIndexForBinSize(t,e){var i,n;if("BP"===(e=e||"BP"))n=this.bpResolutions;else{if("FRAG"!==e)throw new Error("Invalid unit: "+e);n=this.fragResolutions}for(i=0;i<n.length;i++)if(n[i]===t)return i;return-1}getBinSizeForZoomIndex(t,e){var i;if("BP"===(e=e||"BP"))i=this.bpResolutions;else{if("FRAG"!==e)throw new Error("Invalid unit: "+e);i=this.fragResolutions}return i[t]}getChrIndexFromName(t){var e;for(e=0;e<this.chromosomes.length;e++)if(t===this.chromosomes[e].name)return e}compareChromosomes(t){const e=this.chromosomes,i=t.chromosomes;if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(e[t].size!==i[t].size)return!1;return!0}isWholeGenome(t){return null!=this.wholeGenomeChromosome&&this.wholeGenomeChromosome.index===t}async getNormVectorIndex(){return this.hicFile.getNormVectorIndex()}async getNormalizationOptions(){return this.hicFile.getNormalizationOptions()}isCompatible(t){const e=this.genomeId,i=t.genomeId;return("hg38"===e||"GRCh38"===e)&&("hg38"===i||"GRCh38"===i)||("hg19"===e||"GRCh37"===e)&&("hg19"===i||"GRCh37"===i)||("mm10"===e||"GRCm38"===e)&&("mm10"===i||"GRCm38"===i)||this.compareChromosomes(t)}static async loadDataset(t){if(Oi(t.url))t.blob=t.url,delete t.url;else if(b(t.url)){v(t.url)&&(t.url=C(t.url));const e=Object.assign({},t);t.file=new au(e)}const e=new lu(t);return await e.init(),e.url=t.url,e}}class cu{constructor(t,e){this.id=t,this.chromosomes=e,this.wgChromosomeNames=[],this.chromosomeLookupTable={},this.genomeLength=0;for(let t of this.chromosomes)t.bpLength=t.size,"all"!==t.name.toLowerCase()&&(this.genomeLength+=t.size,this.wgChromosomeNames.push(t.name));var i={};for(let t of e){const e=t.name;if(e.startsWith("arm_")){const t=e.substring(4);i[t]=e,i["chr"+t]=e}else{i[e.startsWith("chr")?e.substring(3):"chr"+e]=e,"chrM"===e&&(i.MT="chrM"),"MT"===e&&(i.chrmM="MT")}this.chromosomeLookupTable[e.toLowerCase()]=t}this.chrAliasTable=i}getChromosomeName(t){var e=this.chrAliasTable[t];return e||t}getChromosome(t){var e=this.getChromosomeName(t).toLowerCase();return this.chromosomeLookupTable[e]}getGenomeCoordinate(t,e){return this.getCumulativeOffset(t.name)+e}getChromsosomeForCoordinate(t){var e,i=0,n=0;for(i=1;i<this.chromosomes.length;i++){if(n+(e=this.chromosomes[i].size)>t)return this.chromosomes[i];n+=e}return this.chromosomes[this.chromosomes.length-1]}getCumulativeOffset(t){const e=this.getChromosomeName(t);return void 0===this.cumulativeOffsets&&uu.call(this),this.cumulativeOffsets[e]}getGenomeLength(){return this.genomeLength}}function uu(){const t={};let e=0;for(let i of this.chromosomes)"all"!==i.name&&(t[i.name]=Math.floor(e),e+=i.size);this.cumulativeOffsets=t}class fu{constructor(t,e,i,n,r,s,o,a,h){Number.isNaN(a)&&(a=1),void 0!==t&&(t<=e?(this.chr1=t,this.chr2=e,this.x=n,this.y=r):(this.chr1=e,this.chr2=t,this.x=r,this.y=n),this.zoom=i,this.pixelSize=a,this.width=s,this.height=o,"undefined"===h&&(console.log("No normalization defined !!!"),h=void 0),this.normalization=h)}stringify(){return this.normalization?`${this.chr1},${this.chr2},${this.zoom},${this.x},${this.y},${this.width},${this.height},${this.pixelSize},${this.normalization}`:`${this.chr1},${this.chr2},${this.zoom},${this.x},${this.y},${this.width},${this.height},${this.pixelSize}`}clone(){return Object.assign(new fu,this)}equals(t){return JSON.stringify(this)===JSON.stringify(t)}static parse(t){const e=t.split(",");return e.length<=7?new fu(parseInt(e[0]),parseInt(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4]),ju.width,ju.height,parseFloat(e[5]),e.length>6?e[6]:"NONE"):new fu(parseInt(e[0]),parseInt(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4]),parseInt(e[5]),parseInt(e[6]),parseFloat(e[7]),e.length>8?e[8]:"NONE")}static default(t){return t?new fu(0,0,0,0,0,t.width,t.height,1,"NONE"):new fu(0,0,0,0,0,ju.width,ju.height,1,"NONE")}}async function du(t,e){const i="https://portals.broadinstitute.org/webservices/igv/locus?genome="+t+"&name="+e;var n=function(t){const e=f(t),i=[],n=[];for(let t of e)""===t||i.push(t);for(let t of i){const e=t.split("\t");e.length>=3&&n.push(e[1])}return n}(await nt.loadString(i));return 0===n.length?void 0:n[0]}class pu{constructor(t,e){this.browser=t;const i=e.find("div[id$='upper-hic-nav-bar-widget-container']");this.$container=_i("<div>",{class:"hic-chromosome-goto-container",title:"Chromosome Goto"}),i.append(this.$container),this.$resolution_selector=_i('<input type="text" placeholder="chr-x-axis chr-y-axis">'),this.$container.append(this.$resolution_selector),this.$resolution_selector.on("change",(function(e){t.parseGotoInput(_i(this).val()),_i(this).blur()})),this.browser.eventBus.subscribe("LocusChange",this)}receiveEvent(t){if("LocusChange"===t.type){let e;const i=t.data.state||this.browser.state;if(this.browser.dataset.isWholeGenome(i.chr1))e="All";else{const t=this.browser.dataset.chromosomes[i.chr1],n=this.browser.dataset.chromosomes[i.chr2],r=this.browser.dataset.bpResolutions[i.zoom],s=this.browser.contactMatrixView.getViewDimensions(),o=i.pixelSize,a=1+Math.round(i.x*r),h=1+Math.round(i.y*r),l=Math.min(t.size,Math.round(s.width/o*r)+a-1),c=Math.min(n.size,Math.round(s.height/o*r)+h-1);e=t.name+":"+u(a)+"-"+u(l)+" "+n.name+":"+u(h)+"-"+u(c)}this.$resolution_selector.val(e)}}}class gu{constructor(t,e){this.browser=t;const i=e.find("div[id$='upper-hic-nav-bar-widget-container']");this.$container=_i("<div>",{class:"hic-resolution-selector-container",title:"Resolution"}),i.append(this.$container),this.$label_container=_i('<div id="hic-resolution-label-container">'),this.$container.append(this.$label_container),this.$label=_i("<div>"),this.$label_container.append(this.$label),this.$label.text("Resolution (kb)"),this.$label.hide(),this.$resolution_lock=_i('<i id="hic-resolution-lock" class="fa fa-unlock" aria-hidden="true">'),this.$label_container.append(this.$resolution_lock),this.$label_container.on("click",(()=>{this.browser.resolutionLocked=!this.browser.resolutionLocked,this.setResolutionLock(this.browser.resolutionLocked)})),this.$resolution_selector=_i('<select name="select">'),this.$container.append(this.$resolution_selector),this.$resolution_selector.attr("name","resolution_selector"),this.$resolution_selector.on("change",(()=>{const t=parseInt(this.$resolution_selector.val());this.browser.setZoom(t)})),this.browser.eventBus.subscribe("LocusChange",this),this.browser.eventBus.subscribe("MapLoad",this),this.browser.eventBus.subscribe("ControlMapLoad",this)}setResolutionLock(t){this.$resolution_lock.removeClass(!0===t?"fa-unlock":"fa-lock"),this.$resolution_lock.addClass(!0===t?"fa-lock":"fa-unlock")}receiveEvent(t){const e=this.browser;if("LocusChange"===t.type)if(!0===t.data.resolutionChanged&&(e.resolutionLocked=!1,this.setResolutionLock(e.resolutionLocked)),!1!==t.data.chrChanged){const n=e.dataset.isWholeGenome(t.data.state.chr1);this.$label.text(n?"Resolution (mb)":"Resolution (kb)"),i.call(this,e.state.zoom)}else{const t=e.state.zoom;this.$resolution_selector.find("option").filter((function(e){return e===t})).prop("selected",!0)}else"MapLoad"===t.type?(e.resolutionLocked=!1,this.setResolutionLock(!1),i.call(this,e.state.zoom)):"ControlMapLoad"===t.type&&i.call(this,e.state.zoom);async function i(t){const i=e.isWholeGenome()?[{index:0,binSize:e.dataset.wholeGenomeResolution}]:e.getResolutions();let n="";for(let e of i){const i=e.binSize,r=e.index;let s,o;i>=1e6?(s=1e6,o="mb"):i>=1e3?(s=1e3,o="kb"):(s=1,o="bp");const a=u(Math.round(i/s))+" "+o,h=t===e.index;n+="<option data-resolution="+i.toString()+" value="+r+(h?" selected":"")+">"+a+"</option>"}this.$resolution_selector.empty(),this.$resolution_selector.append(n)}}}const mu={threshold:2e3,r:255,g:0,b:0};class wu{constructor(t){this.threshold=t.threshold,this.r=t.r,this.g=t.g,this.b=t.b,this.cache=[],this.nbins=2e3,this.binsize=this.threshold/this.nbins}setThreshold(t){this.threshold=t,this.cache=[],this.binsize=this.threshold/this.nbins}getThreshold(){return this.threshold}setColorComponents(t){this.r=t.r,this.g=t.g,this.b=t.b,this.cache=[]}getColorComponents(){return{r:this.r,g:this.g,b:this.b}}equals(t){return JSON.stringify(this)===JSON.stringify(t)}getColor(t){const e=Math.floor(Math.min(this.threshold,t)/this.binsize);if(void 0===this.cache[e]){const i=Math.floor(255*(U(t,0,this.threshold)-0)/(this.threshold-0));this.cache[e]={red:this.r,green:this.g,blue:this.b,alpha:i,rgbaString:`rgba(${this.r},${this.g},${this.b}, ${i})`}}return this.cache[e]}stringify(){return this.threshold+","+this.r+","+this.g+","+this.b}static parse(t){var e,i;return t.startsWith("R:")?(e=t.substring(2).split(":"),(i=new yu(Number.parseFloat(e[0]))).positiveScale=n(e[1]),i.negativeScale=n(e[2]),i):n(t);function n(t){var e,i;return e={threshold:(i=t.split(","))[0],r:i[1],g:i[2],b:i[3]},new wu(e)}}}const bu={threshold:5,positive:{r:255,g:0,b:0},negative:{r:0,g:0,b:255}};class yu{constructor(t){this.threshold=t,this.positiveScale=new wu({threshold:Math.log(t),r:255,g:0,b:0}),this.negativeScale=new wu({threshold:Math.log(t),r:0,g:0,b:255})}setThreshold(t){this.threshold=t,this.positiveScale.setThreshold(Math.log(t)),this.negativeScale.setThreshold(Math.log(t))}getThreshold(){return this.threshold}setColorComponents(t,e){return"-"===e?this.negativeScale.setColorComponents(t):this.positiveScale.setColorComponents(t)}getColorComponents(t){return"-"===t?this.negativeScale.getColorComponents():this.positiveScale.getColorComponents()}getColor(t){var e=Math.log(t);return e<0?this.negativeScale.getColor(-e):this.positiveScale.getColor(e)}stringify(){return"R:"+this.threshold+":"+this.positiveScale.stringify()+":"+this.negativeScale.stringify()}}const vu=685;class xu{constructor(t,e,i,n,r,s,o){this.browser=t,this.$viewport=e,this.sweepZoom=i,this.scrollbarWidget=n,this.colorScale=r,this.ratioColorScale=s,this.backgroundColor=o,this.backgroundRGBString=V.rgbColor(o.r,o.g,o.b),this.$canvas=e.find("canvas"),this.ctx=this.$canvas.get(0).getContext("2d"),this.$fa_spinner=e.find(".fa-spinner"),this.spinnerCount=0,this.$x_guide=e.find("div[id$='-x-guide']"),this.$y_guide=e.find("div[id$='-y-guide']"),this.displayMode="A",this.imageTileCache={},this.imageTileCacheKeys=[],this.imageTileCacheLimit=8,this.colorScaleThresholdCache={},this.browser.eventBus.subscribe("NormalizationChange",this),this.browser.eventBus.subscribe("TrackLoad2D",this),this.browser.eventBus.subscribe("TrackState2D",this),this.browser.eventBus.subscribe("MapLoad",this),this.browser.eventBus.subscribe("ControlMapLoad",this),this.browser.eventBus.subscribe("ColorChange",this),this.drawsInProgress=new Set}setBackgroundColor(t){this.backgroundColor=t,this.backgroundRGBString=V.rgbColor(t.r,t.g,t.b),this.repaint()}stringifyBackgroundColor(){return`${this.backgroundColor.r},${this.backgroundColor.g},${this.backgroundColor.b}`}static parseBackgroundColor(t){const[e,i,n]=t.split(",").map((t=>parseInt(t)));return{r:e,g:i,b:n}}setColorScale(t){switch(this.displayMode){case"AOB":case"BOA":this.ratioColorScale=t;break;case"AMB":this.diffColorScale=t;break;default:this.colorScale=t}this.colorScaleThresholdCache[Cu(this.browser.state,this.displayMode)]=t.threshold}async setColorScaleThreshold(t){this.getColorScale().setThreshold(t),this.colorScaleThresholdCache[Cu(this.browser.state,this.displayMode)]=t,this.imageTileCache={},await this.update()}getColorScale(){switch(this.displayMode){case"AOB":case"BOA":return this.ratioColorScale;case"AMB":return this.diffColorScale;default:return this.colorScale}}async setDisplayMode(t){this.displayMode=t,this.clearImageCaches(),await this.update()}clearImageCaches(){this.imageTileCache={},this.imageTileCacheKeys=[]}getViewDimensions(){return{width:this.$viewport.width(),height:this.$viewport.height()}}async receiveEvent(t){"MapLoad"===t.type||"ControlMapLoad"===t.type?(this.mouseHandlersEnabled||(this.addTouchHandlers(this.$viewport),this.addMouseHandlers(this.$viewport),this.mouseHandlersEnabled=!0),this.clearImageCaches(),this.colorScaleThresholdCache={}):("LocusChange"!==t.type&&this.clearImageCaches(),this.update())}async update(){this.disableUpdates||await this.repaint()}async repaint(){if(!this.browser.dataset)return;const t=this.$viewport.width(),e=this.$viewport.height(),i=this.$canvas.width(),n=this.$canvas.height();i===t&&n===e||(this.$canvas.width(t),this.$canvas.height(e),this.$canvas.attr("width",this.$viewport.width()),this.$canvas.attr("height",this.$viewport.height()));const r=this.browser,s=r.state;let o,a,h,l,c;switch(this.displayMode){case"A":l=s.zoom,o=this.browser.dataset;break;case"B":l=y(s.zoom),o=this.browser.controlDataset;break;case"AOB":case"AMB":l=s.zoom,c=y(s.zoom),o=this.browser.dataset,a=this.browser.controlDataset;break;case"BOA":l=y(s.zoom),c=s.zoom,o=this.browser.controlDataset,a=this.browser.dataset}const u=(await o.getMatrix(s.chr1,s.chr2)).getZoomDataByIndex(l,"BP");if(a){h=(await a.getMatrix(s.chr1,s.chr2)).getZoomDataByIndex(c,"BP")}const f=Math.max(1,Math.floor(s.pixelSize)),d=this.$viewport.width()/f,p=this.$viewport.height()/f,g=Math.floor(s.x/vu),m=Math.floor((s.x+d)/vu),w=Math.floor(s.y/vu),b=Math.floor((s.y+p)/vu);"NONE"!==s.normalization&&(o.hasNormalizationVector(s.normalization,u.chr1.name,u.zoom.unit,u.zoom.binSize)||(Alert.presentAlert("Normalization option "+normalization+" unavailable at this resolution."),this.browser.eventBus.post(new Ec("NormalizationExternalChange","NONE")),s.normalization="NONE")),await this.checkColorScale(o,u,w,b,g,m,s.normalization),this.ctx.clearRect(0,0,t,e);for(let t=w;t<=b;t++)for(let e=g;e<=m;e++){const i=await this.getImageTile(o,a,u,h,t,e,s);i.image&&this.paintTile(i)}function y(t){const e=r.dataset.getBinSizeForZoomIndex(t);if(!e)throw Error("Invalid zoom (resolution) index: "+t);const i=r.controlDataset.getZoomIndexForBinSize(e);if(i<0)throw Error(`Invalid binSize for "B" map: ${e}`);return i}this.genomicExtent={chr1:s.chr1,chr2:s.chr2,x:s.x*u.zoom.binSize,y:s.y*u.zoom.binSize,w:t*u.zoom.binSize/s.pixelSize,h:e*u.zoom.binSize/s.pixelSize}}async getImageTile(t,e,i,n,r,s,o){const a=`${i.chr1.name}_${i.chr2.name}_${i.zoom.binSize}_${i.zoom.unit}_${r}_${s}_${o.normalization}_${this.displayMode}`;if(this.imageTileCache.hasOwnProperty(a))return this.imageTileCache[a];if(this.drawsInProgress.has(a)){const t=function(t){let e=Su[t];if(!e){e=document.createElement("canvas"),e.width=t,e.height=t;const i=e.getContext("2d");i.font="24px sans-serif",i.fillStyle="rgb(230, 230, 230)",i.fillRect(0,0,e.width,e.height),i.fillStyle="black";for(let e=100;e<t;e+=300)for(let n=100;n<t;n+=300)i.fillText("Loading...",e,n);Su[t]=e}return e}(vu);return{row:r,column:s,blockBinCount:vu,image:t,inProgress:!0}}this.drawsInProgress.add(a);try{this.startSpinner();const c=i.chr1.index===i.chr2.index,u=c&&r<s,f=i.averageCount,d=n?n.averageCount:1,p=(f+d)/2,g=vu,m=document.createElement("canvas");m.width=g,m.height=g;const w=m.getContext("2d"),b=vu*i.zoom.binSize,y=s*b,v={chr:i.chr1.name,start:y,end:y+b},x=r*b,C={chr:i.chr2.name,start:x,end:x+b},S=await t.getContactRecords(o.normalization,v,C,i.zoom.unit,i.zoom.binSize);let k;if(n&&(k=await e.getContactRecords(o.normalization,v,C,n.zoom.unit,n.zoom.binSize)),S.length>0){const t={};if("AOB"===this.displayMode||"BOA"===this.displayMode||"AMB"===this.displayMode)for(let e of k)t[e.getKey()]=e;let e=w.getImageData(0,0,m.width,m.height);const i=u?r*vu:s*vu,n=u?s*vu:r*vu;for(let o=0;o<S.length;o++){const a=S[o];let h,g=Math.floor(a.bin1-i),m=Math.floor(a.bin2-n);if(u){const t=m;m=g,g=t}switch(this.displayMode){case"AOB":case"BOA":let e=a.getKey(),i=t[e];if(!i)continue;let n=a.counts/f/(i.counts/d);h=this.ratioColorScale.getColor(n);break;case"AMB":if(e=a.getKey(),i=t[e],!i)continue;n=p*(a.counts/f-i.counts/d),h=this.diffColorScale.getColor(n);break;default:h=this.colorScale.getColor(a.counts)}l(e,g,m,h.red,h.green,h.blue,h.alpha),c&&r===s&&l(e,m,g,h.red,h.green,h.blue,h.alpha)}w.putImageData(e,0,0)}w.save(),w.lineWidth=2;for(let t of this.browser.tracks2D)if(t.isVisible){const e=i.chr1.name,n=i.chr2.name,o=t.getFeatures(e,n);if(o)for(let{chr1:n,x1:a,x2:h,y1:l,y2:f,color:d}of o){const o=e!==n,p=u||o?f:h,g=u||o?a:l,b=u||o?h:f;let v=((u||o?l:a)-y)/i.zoom.binSize,C=(p-y)/i.zoom.binSize,S=(g-x)/i.zoom.binSize,k=(b-x)/i.zoom.binSize,T=C-v,R=k-S;const I=Math.max(m.width,m.height);C>0&&v<I&&k>0&&S<I&&(w.strokeStyle=t.color?t.color:d,w.strokeRect(v,S,T,R),c&&r===s&&w.strokeRect(S,v,R,T))}}w.restore();var h={row:r,column:s,blockBinCount:vu,image:m};return this.imageTileCacheLimit>0&&(this.imageTileCacheKeys.length>this.imageTileCacheLimit&&(delete this.imageTileCache[this.imageTileCacheKeys[0]],this.imageTileCacheKeys.shift()),this.imageTileCache[a]=h),h}finally{this.drawsInProgress.delete(a),this.stopSpinner()}function l(t,e,i,n,r,s,o){const a=4*(e+i*t.width);t.data[a+0]=n,t.data[a+1]=r,t.data[a+2]=s,t.data[a+3]=o}}async checkColorScale(t,e,i,n,r,s,o){const a=Cu(this.browser.state,this.displayMode);if("AOB"===this.displayMode||"BOA"===this.displayMode)return this.ratioColorScale;if(this.colorScaleThresholdCache[a]){const t=this.colorScale.threshold!==this.colorScaleThresholdCache[a];return this.colorScale.setThreshold(this.colorScaleThresholdCache[a]),t&&this.browser.eventBus.post(Ec("ColorScale",this.colorScale)),this.colorScale}try{const h=vu*e.zoom.binSize,l=r*h,c=(s-r+1)*h,u={chr:e.chr1.name,start:l,end:l+c},f=i*h,d=(n-i+1)*h,p={chr:e.chr2.name,start:f,end:f+d};let g=function(t,e){const i=t.map((t=>t.counts));i.sort((function(t,e){return t-e}));const n=Math.floor(e/100*t.length);return i[n]}(await t.getContactRecords(o,u,p,e.zoom.unit,e.zoom.binSize,!0),95);return isNaN(g)||(0===e.chr1.index&&(g*=4),this.colorScale=new wu(this.colorScale),this.colorScale.setThreshold(g),this.computeColorScale=!1,this.browser.eventBus.post(Ec("ColorScale",this.colorScale)),this.colorScaleThresholdCache[a]=g),this.colorScale}finally{this.stopSpinner()}}async zoomIn(){const t=this.browser.state,e=this.$viewport.width(),i=this.$viewport.height();var n=(await ku.call(this,t.chr1,t.chr2))[0];if(n){const r="BP",s=await n.getZoomDataByIndex(t.zoom,r),o={x:t.x*s.zoom.binSize,y:t.y*s.zoom.binSize,w:e*s.zoom.binSize/t.pixelSize,h:i*s.zoom.binSize/t.pixelSize};if(o.w>this.genomicExtent.w)return;const a=(o.x-this.genomicExtent.x)/this.genomicExtent.w*e,h=(o.y-this.genomicExtent.y)/this.genomicExtent.w*i,l=o.w/this.genomicExtent.w*e,c=o.h/this.genomicExtent.h*i,u=this.$canvas[0],f=document.createElement("canvas");f.width=u.width,f.height=u.height;f.getContext("2d").drawImage(u,a,h,l,c,0,0,e,i),this.ctx.clearRect(0,0,e,i),this.ctx.drawImage(f,0,0)}}paintTile(t){let{image:e,row:i,column:n,blockBinCount:r}=t;const s=r*n,o=r*i,{x:a,y:h,pixelSize:l}=this.browser.state,c=(s-a)*l,u=(o-h)*l,f=l,d=e.width*f,p=e.height*f,g=this.$viewport.width(),m=this.$viewport.height();c<=g&&c+d>=0&&u<=m&&u+p>=0&&(this.ctx.fillStyle=this.backgroundRGBString,this.ctx.fillRect(c,u,d,p),1===f?this.ctx.drawImage(e,c,u):this.ctx.drawImage(e,c,u,d,p))}startSpinner(){!0===this.browser.isLoadingHICFile&&this.browser.$user_interaction_shield&&this.browser.$user_interaction_shield.show(),this.$fa_spinner.css("display","inline-block"),this.spinnerCount++}stopSpinner(){this.spinnerCount--,0===this.spinnerCount&&this.$fa_spinner.css("display","none"),this.spinnerCount=Math.max(0,this.spinnerCount)}addMouseHandlers(t){let e,i,n,r=!1,s=!1;const o=t=>{!0===this.isDragging&&(this.isDragging=!1,this.browser.eventBus.post(Ec("DragStopped"))),r=!1,e=i=void 0};this.isDragging=!1,this.browser.isMobile||(t.dblclick((t=>{t.preventDefault(),t.stopPropagation();const e=t.offsetX||t.layerX,i=t.offsetY||t.layerX;this.browser.zoomAndCenter(1,e,i)})),t.on("mouseover",(t=>n=!0)),t.on("mouseout",(t=>n=void 0)),t.on("mousedown",(t=>{if(t.preventDefault(),t.stopPropagation(),this.browser.$menu.is(":visible")&&this.browser.hideMenu(),i={x:t.offsetX,y:t.offsetY},e={x:t.offsetX,y:t.offsetY},s=!0===t.altKey,s){const e=_i.event.fix(t);this.sweepZoom.initialize({x:e.pageX,y:e.pageY})}r=!0})),t.on("mousemove",(n=>{n.preventDefault(),n.stopPropagation();const o={x:n.offsetX,y:n.offsetY},a=_i.event.fix(n),h={x:a.pageX-t.offset().left,y:a.pageY-t.offset().top},{width:l,height:c}=t.get(0).getBoundingClientRect();if(h.xNormalized=h.x/l,h.yNormalized=h.y/c,this.browser.eventBus.post(Ec("UpdateContactMapMousePosition",h,!1)),!0===this.willShowCrosshairs&&(this.browser.updateCrosshairs(h),this.browser.showCrosshairs()),r){if(s)this.sweepZoom.update({x:a.pageX,y:a.pageY});else if(e.x&&Math.abs(o.x-e.x)>2){this.isDragging=!0;const t=i.x-o.x,e=i.y-o.y;this.browser.shiftPixels(t,e)}i=o}})),t.on("mouseup",o),t.on("mouseleave",(()=>{this.browser.layoutController.xAxisRuler.unhighlightWholeChromosome(),this.browser.layoutController.yAxisRuler.unhighlightWholeChromosome(),o()})),_i(document).on("keydown.contact_matrix_view",(t=>{void 0===this.willShowCrosshairs&&!0===n&&!0===t.shiftKey&&(this.willShowCrosshairs=!0,this.browser.eventBus.post(Ec("DidShowCrosshairs","DidShowCrosshairs",!1)))})),_i(document).on("keyup.contact_matrix_view",(t=>{this.browser.hideCrosshairs(),this.willShowCrosshairs=void 0,this.browser.eventBus.post(Ec("DidHideCrosshairs","DidHideCrosshairs",!1))})),_i(document).on("mouseup.contact_matrix_view",(t=>{t.preventDefault(),t.stopPropagation(),s&&(s=!1,this.sweepZoom.commit())})))}addTouchHandlers(t){let e,i;const n=t[0];var r,s,o,a,h;function l(t,e){var i=_i(e);return{x:t.pageX-i.offset().left,y:t.pageY-i.offset().top}}n.ontouchstart=t=>{t.preventDefault(),t.stopPropagation();var i,r,s,o=l(t.targetTouches[0],n),a=o.x,h=o.y,c=t.targetTouches.length,u=t.timeStamp||Date.now(),f=!1;2===c&&(a=(a+(o=l(t.targetTouches[0],n)).x)/2,h=(h+o.y)/2),e&&u-e.timeStamp<300&&t.targetTouches.length>1&&1===e.count?e={x:a,y:h,timeStamp:u,count:t.targetTouches.length}:(e&&u-e.timeStamp<300&&(s=2===e.count||2===c?-1:1,i=e.x-a,r=e.y-h,Math.sqrt(i*i+r*r)<20&&(this.browser.zoomAndCenter(s,a,h),e=void 0,f=!0)),f||(e={x:a,y:h,timeStamp:u,count:t.targetTouches.length}))},n.ontouchmove=(r=t=>{var r,s,o;if(t.preventDefault(),t.stopPropagation(),2===t.targetTouches.length)r=l(t.targetTouches[0],n),s=l(t.targetTouches[1],n),o={x1:r.x,y1:r.y,x2:s.x,y2:s.y},i?i.end=o:i={start:o};else{var a=l(t.targetTouches[0],n),h=a.x,c=a.y;if(e){var u=e.x-h,f=e.y-c;isNaN(u)||isNaN(f)||(this.isDragging=!0,this.browser.shiftPixels(e.x-h,e.y-c))}e={x:h,y:c,timeStamp:t.timeStamp||Date.now(),count:t.targetTouches.length}}},(s=50)||(s=200),function(){var t,e,i;t=o||this,e=+new Date,i=arguments,a&&e<a+s?(clearTimeout(h),h=setTimeout((function(){a=e,r.apply(t,i)}),s)):(a=e,r.apply(t,i))}),n.ontouchend=t=>{if(t.preventDefault(),t.stopPropagation(),i&&void 0!==i.end){var n=i.start,r=i.end,s=n.x2-n.x1,o=n.y2-n.y1,a=r.x2-r.x1,h=r.y2-r.y1,l=Math.sqrt(s*s+o*o),c=Math.sqrt(a*a+h*h)/l;r.x1,r.x2,n.x1,n.x2,r.y1,r.y2,n.y1,n.y2;var u=(n.x1+n.x2)/2,f=(n.y1+n.y2)/2;(c<.8||c>1.2)&&(e=void 0,this.browser.pinchZoom(u,f,c))}else this.isDragging&&(this.isDragging=!1,this.browser.eventBus.post(Ec("DragStopped")));i=void 0}}}function Cu(t,e){return t.chr1+"_"+t.chr2+"_"+t.zoom+"_"+t.normalization+"_"+e}xu.defaultBackgroundColor={r:255,g:255,b:255};const Su={};function ku(t,e){var i=[];return"B"===this.displayMode&&this.browser.controlDataset?i.push(this.browser.controlDataset.getMatrix(t,e)):(i.push(this.browser.dataset.getMatrix(t,e)),this.displayMode&&"A"!==this.displayMode&&this.browser.controlDataset&&i.push(this.browser.controlDataset.getMatrix(t,e))),Promise.all(i)}class Tu{constructor(t,e){this.browser=t;const i=e.find("div[id$='lower-hic-nav-bar-widget-container']");this.$container=_i('<div class="hic-colorscale-widget-container">'),i.append(this.$container);const{r:n,g:r,b:s}=xu.defaultBackgroundColor;this.$mapBackgroundColorpickerButton=Lu(V.rgbColor(n,r,s)),this.$container.append(this.$mapBackgroundColorpickerButton),this.backgroundColorpicker=Du(t,this.$mapBackgroundColorpickerButton,void 0);const{r:o,g:a,b:h}=bu.negative;this.$minusButton=Lu(V.rgbColor(o,a,h)),this.$container.append(this.$minusButton),this.minusColorPicker=Du(t,this.$minusButton,"-"),this.$minusButton.hide();const{r:l,g:c,b:u}=bu.positive;this.$plusButton=Lu(V.rgbColor(l,c,u)),this.$container.append(this.$plusButton),this.plusColorPicker=Du(t,this.$plusButton,"+"),this.$minusButton.on("click",(()=>Mu(this.minusColorPicker,this.plusColorPicker,this.backgroundColorpicker))),this.$plusButton.on("click",(()=>Mu(this.plusColorPicker,this.minusColorPicker,this.backgroundColorpicker))),this.$mapBackgroundColorpickerButton.on("click",(()=>Mu(this.backgroundColorpicker,this.minusColorPicker,this.plusColorPicker))),this.$high_colorscale_input=_i("<input>",{type:"text",placeholder:"",title:"color scale input"}),this.$container.append(this.$high_colorscale_input),this.$high_colorscale_input.on("change",(function(e){var i;i=_i(this).val().split(",").join().replace(",","","g"),isNaN(i)||t.setColorScaleThreshold(i)}));let f=_i("<i>",{class:"fa fa-minus","aria-hidden":"true",title:"negative threshold"});f.on("click",(()=>this.$high_colorscale_input.val(Iu(t,.5)))),this.$container.append(f),f=_i("<i>",{class:"fa fa-plus","aria-hidden":"true",title:"positive threshold"}),f.on("click",(()=>this.$high_colorscale_input.val(Iu(t,2)))),this.$container.append(f);this.browser.eventBus.subscribe("ColorScale",(t=>{if(t.data instanceof wu){const{threshold:e}=t.data;this.$high_colorscale_input.val(e),Ru(this.$plusButton,t.data)}else if(t.data instanceof yu){const{threshold:e,negativeScale:i,positiveScale:n}=t.data;this.$high_colorscale_input.val(e),Ru(this.$minusButton,i),Ru(this.$plusButton,n)}}));this.browser.eventBus.subscribe("DisplayMode",(t=>{if("AOB"===t.data||"BOA"===t.data){this.$minusButton.show();const{negativeScale:t,positiveScale:e}=this.browser.contactMatrixView.ratioColorScale;Ru(this.$minusButton,t),Ru(this.$plusButton,e)}else this.$minusButton.hide(),Ru(this.$plusButton,this.browser.contactMatrixView.colorScale)})),this.browser.eventBus.subscribe("MapLoad",(t=>{Ru(this.$mapBackgroundColorpickerButton,this.browser.contactMatrixView.backgroundColor)}))}}function Ru(t,e){let{r:i,g:n,b:r}=e;t.get(0).style.backgroundColor=V.rgbToHex(V.rgbColor(i,n,r))}const Iu=(t,e)=>{const i=t.getColorScale();return t.setColorScaleThreshold(i.getThreshold()*e),u(i.getThreshold())};function Du(t,e,i){let n,r;if(void 0===i){const{r:i,g:s,b:o}=xu.defaultBackgroundColor;n=[V.rgbToHex(V.rgbColor(i,s,o))],r=i=>{e.get(0).style.backgroundColor=i;const[n,r,s]=V.hexToRgb(i).split("(").pop().split(")").shift().split(",").map((t=>parseInt(t,10)));t.contactMatrixView.setBackgroundColor({r:n,g:r,b:s})}}else n=[bu.negative,bu.positive].map((t=>{let{r:e,g:i,b:n}=t;return V.rgbToHex(V.rgbColor(e,i,n))})),r=n=>{e.get(0).style.backgroundColor=n;const[r,s,o]=V.hexToRgb(n).split("(").pop().split(")").shift().split(",").map((t=>parseInt(t,10)));t.getColorScale().setColorComponents({r:r,g:s,b:o},i),t.repaintMatrix()};const s={parent:e.get(0),top:64,left:64,width:432,defaultColors:n,colorHandler:r};return new oc(s)}function Mu(t,e,i){e.hide(),i.hide(),t.show()}function Lu(e){const i=t({class:"igv-ui-color-swatch"});return i.style.backgroundColor=V.rgbToHex(e),_i(i)}class Eu{constructor(t,e){this.browser=t;const i=e.find("div[id$='lower-hic-nav-bar-widget-container']");this.$container=_i('<div class="hic-control-map-selector-container">'),this.$container.hide(),i.append(this.$container),this.$select=_i("<select>"),this.$select.attr("name","control_map_selector"),this.$container.append(this.$select);const n=_i("<div>");this.$container.append(n);const r=_i("<div>");this.$container.append(r),this.controlMapHash=new Au(t,this.$select,n,r,function(){let t,e;return t='<svg width="34px" height="34px" viewBox="0 0 34 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 51 (57462) - http://www.bohemiancoding.com/sketch --\x3e\n    <title>Toggle Maps</title>\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group">\n            <rect id="Rectangle" stroke="#A6A6A6" stroke-width="1.25201381" fill="#F8F8F8" x="0.626006904" y="0.626006904" width="32.7479862" height="32.7479862" rx="3.91254315"></rect>\n            <g id="arrows" transform="translate(6.533947, 7.003452)" fill-rule="nonzero" stroke="#5F5F5F" stroke-width="0.626006904">\n                <path d="M25.9411017,8.76431329 L11.8559464,8.76431329 L11.8559464,6.88629258 C11.8559464,6.05237313 10.8440845,5.63114873 10.2529383,6.22229488 L7.12290378,9.3523294 C6.75622024,9.71905207 6.75622024,10.3136021 7.12290378,10.6802857 L10.2529383,13.8103202 C10.8409153,14.3982581 11.8559464,13.9850935 11.8559464,13.1463616 L11.8559464,11.2683409 L25.9411017,11.2683409 C26.4597093,11.2683409 26.8801121,10.8479381 26.8801121,10.3293306 L26.8801121,9.70332365 C26.8801121,9.18471605 26.4597093,8.76431329 25.9411017,8.76431329 Z" id="down-arrow" fill="#F8F8F8" transform="translate(16.864002, 10.016110) rotate(-90.000000) translate(-16.864002, -10.016110) "></path>\n                <path d="M13.1470856,8.76431329 L-0.938069748,8.76431329 L-0.938069748,6.88629258 C-0.938069748,6.05237313 -1.94993166,5.63114873 -2.5410778,6.22229488 L-5.67111233,9.3523294 C-6.03779587,9.71905207 -6.03779587,10.3136021 -5.67111233,10.6802857 L-2.5410778,13.8103202 C-1.95310082,14.3982581 -0.938069748,13.9850935 -0.938069748,13.1463616 L-0.938069748,11.2683409 L13.1470856,11.2683409 C13.6656932,11.2683409 14.086096,10.8479381 14.086096,10.3293306 L14.086096,9.70332365 C14.086096,9.18471605 13.6656932,8.76431329 13.1470856,8.76431329 Z" id="up-arrow" fill="#5F5F5F" transform="translate(4.069985, 10.016110) scale(1, -1) rotate(-90.000000) translate(-4.069985, -10.016110) "></path>\n            </g>\n        </g>\n    </g>\n</svg>',e=t.split("\n").join(" "),_i(e)}(),function(){let t,e;return t='<svg width="34px" height="34px" viewBox="0 0 34 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 51 (57462) - http://www.bohemiancoding.com/sketch --\x3e\n    <title>Toggle Maps</title>\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group">\n            <rect id="Rectangle" stroke="#A6A6A6" stroke-width="1.25201381" fill="#F8F8F8" x="0.626006904" y="0.626006904" width="32.7479862" height="32.7479862" rx="3.91254315"></rect>\n            <g id="arrows" transform="translate(6.533947, 7.003452)" fill-rule="nonzero" stroke="#5F5F5F" stroke-width="0.626006904">\n                <path d="M25.9411017,8.76431329 L11.8559464,8.76431329 L11.8559464,6.88629258 C11.8559464,6.05237313 10.8440845,5.63114873 10.2529383,6.22229488 L7.12290378,9.3523294 C6.75622024,9.71905207 6.75622024,10.3136021 7.12290378,10.6802857 L10.2529383,13.8103202 C10.8409153,14.3982581 11.8559464,13.9850935 11.8559464,13.1463616 L11.8559464,11.2683409 L25.9411017,11.2683409 C26.4597093,11.2683409 26.8801121,10.8479381 26.8801121,10.3293306 L26.8801121,9.70332365 C26.8801121,9.18471605 26.4597093,8.76431329 25.9411017,8.76431329 Z" id="down-arrow" fill="#5F5F5F" transform="translate(16.864002, 10.016110) rotate(-90.000000) translate(-16.864002, -10.016110) "></path>\n                <path d="M13.1470856,8.76431329 L-0.938069748,8.76431329 L-0.938069748,6.88629258 C-0.938069748,6.05237313 -1.94993166,5.63114873 -2.5410778,6.22229488 L-5.67111233,9.3523294 C-6.03779587,9.71905207 -6.03779587,10.3136021 -5.67111233,10.6802857 L-2.5410778,13.8103202 C-1.95310082,14.3982581 -0.938069748,13.9850935 -0.938069748,13.1463616 L-0.938069748,11.2683409 L13.1470856,11.2683409 C13.6656932,11.2683409 14.086096,10.8479381 14.086096,10.3293306 L14.086096,9.70332365 C14.086096,9.18471605 13.6656932,8.76431329 13.1470856,8.76431329 Z" id="up-arrow" fill="#F8F8F8" transform="translate(4.069985, 10.016110) scale(1, -1) rotate(-90.000000) translate(-4.069985, -10.016110) "></path>\n            </g>\n        </g>\n    </g>\n</svg>',e=t.split("\n").join(" "),_i(e)}());const s=this;t.eventBus.subscribe("ControlMapLoad",(function(e){s.controlMapHash.updateOptions(t.getDisplayMode()),s.$container.show()})),t.eventBus.subscribe("MapLoad",(function(e){t.controlDataset||s.$container.hide()})),t.eventBus.subscribe("DisplayMode",(function(t){s.controlMapHash.updateOptions(t.data)}))}toggleDisplayMode(){this.controlMapHash.toggleDisplayMode()}toggleDisplayModeCycle(){this.controlMapHash.toggleDisplayModeCycle()}getDisplayModeCycle(){return this.controlMapHash.cycleID}}class Au{constructor(t,e,i,n,r,s){const o=this;this.browser=t,this.$select=e,this.$toggle=i,this.$cycle=n,this.$img_a=r,this.$toggle.append(this.$img_a),this.$img_b=s,this.$toggle.append(this.$img_b);const a={title:"A",value:"A",other:"B",$hidden:s,$shown:r},h={title:"B",value:"B",other:"A",$hidden:r,$shown:s},l={title:"A/B",value:"AOB",other:"BOA",$hidden:s,$shown:r},c={title:"B/A",value:"BOA",other:"AOB",$hidden:r,$shown:s};this.hash={A:a,B:h,AOB:l,BOA:c},this.$select.on("change",(function(t){let e;o.disableDisplayModeCycle(),e=_i(this).val(),o.setDisplayMode(e)})),this.$toggle.on("click",(function(t){o.disableDisplayModeCycle(),o.toggleDisplayMode()})),this.$cycle_outline=function(){let t,e;return t='<svg width="34px" height="34px" viewBox="0 0 34 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 51 (57462) - http://www.bohemiancoding.com/sketch --\x3e\n    <title>Cycle Maps</title>\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group" fill="#F8F8F8">\n            <rect id="Rectangle" stroke="#A6A6A6" stroke-width="1.25201381" x="0.626006904" y="0.626006904" width="32.7479862" height="32.7479862" rx="3.91254315"></rect>\n            <g id="circle-notch-group" transform="translate(5.947066, 6.103567)" fill-rule="nonzero" stroke="#5F5F5F" stroke-width="0.75">\n                <path d="M12.5012159,1.07356655 L12.5012159,1.81734411 C12.5012159,2.29971235 12.8262916,2.71738683 13.2908449,2.84717621 C16.7518005,3.81392183 19.2875784,6.98762275 19.2875784,10.7595067 C19.2875784,15.2996349 15.6133435,18.9745898 11.072508,18.9745898 C6.53238683,18.9745898 2.85743758,15.3003493 2.85743758,10.7595067 C2.85743758,6.98815851 5.39276905,3.81401113 8.85408182,2.84717621 C9.31872442,2.71738683 9.64380011,2.29962306 9.64380011,1.81721016 L9.64380011,1.07392373 C9.64380011,0.372561009 8.98150471,-0.138381443 8.30233269,0.0365908983 C3.5094195,1.27117502 -0.0270343765,5.6342771 0.00015572077,10.8189768 C0.0323016485,16.9379636 4.97728293,21.8448684 11.0963496,21.8319654 C17.2005487,21.819107 22.1449942,16.8667067 22.1449942,10.7595067 C22.1449942,5.5968181 18.611621,1.2595221 13.831209,0.0336441837 C13.1565464,-0.139363681 12.5012159,0.377070376 12.5012159,1.07356655 Z" id="circle-notch---solid"></path>\n            </g>\n        </g>\n    </g>\n</svg>',e=t.split("\n").join(" "),_i(e)}(),n.append(this.$cycle_outline),this.$cycle_solid=function(){let t,e;return t='<svg width="34px" height="34px" viewBox="0 0 34 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 51 (57462) - http://www.bohemiancoding.com/sketch --\x3e\n    <title>Cycle Maps</title>\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group">\n            <rect id="Rectangle" stroke="#A6A6A6" stroke-width="1.25201381" fill="#F8F8F8" x="0.626006904" y="0.626006904" width="32.7479862" height="32.7479862" rx="3.91254315"></rect>\n            <g id="circle-notch-group" transform="translate(5.947066, 6.103567)" fill="#5F5F5F" fill-rule="nonzero">\n                <path d="M12.5012159,1.07356655 L12.5012159,1.81734411 C12.5012159,2.29971235 12.8262916,2.71738683 13.2908449,2.84717621 C16.7518005,3.81392183 19.2875784,6.98762275 19.2875784,10.7595067 C19.2875784,15.2996349 15.6133435,18.9745898 11.072508,18.9745898 C6.53238683,18.9745898 2.85743758,15.3003493 2.85743758,10.7595067 C2.85743758,6.98815851 5.39276905,3.81401113 8.85408182,2.84717621 C9.31872442,2.71738683 9.64380011,2.29962306 9.64380011,1.81721016 L9.64380011,1.07392373 C9.64380011,0.372561009 8.98150471,-0.138381443 8.30233269,0.0365908983 C3.5094195,1.27117502 -0.0270343765,5.6342771 0.00015572077,10.8189768 C0.0323016485,16.9379636 4.97728293,21.8448684 11.0963496,21.8319654 C17.2005487,21.819107 22.1449942,16.8667067 22.1449942,10.7595067 C22.1449942,5.5968181 18.611621,1.2595221 13.831209,0.0336441837 C13.1565464,-0.139363681 12.5012159,0.377070376 12.5012159,1.07356655 Z" id="circle-notch---solid"></path>\n            </g>\n        </g>\n    </g>\n</svg>',e=t.split("\n").join(" "),_i(e)}(),n.append(this.$cycle_solid),this.$cycle_solid.hide(),n.on("click",(function(){o.toggleDisplayModeCycle()})),n.hide()}disableDisplayModeCycle(){this.cycleID&&(clearTimeout(this.cycleID),this.cycleID=void 0,this.$cycle_solid.hide(),this.$cycle_outline.show())}toggleDisplayModeCycle(){let t=this;this.cycleID?this.disableDisplayModeCycle():(!function e(){t.cycleID=setTimeout((async function(){await t.toggleDisplayMode(),e()}),2500)}(),this.$cycle_solid.show(),this.$cycle_outline.hide())}async toggleDisplayMode(){let t,e,i;t=this.browser.getDisplayMode(),e=this.hash[t].other,await this.browser.setDisplayMode(e),this.hash[e].$hidden.hide(),this.hash[e].$shown.show(),i="option[value="+e+"]",this.$select.find(i).prop("selected",!0)}setDisplayMode(t){Bu.call(this,t),this.browser.setDisplayMode(t)}updateOptions(t){let e=this;this.$img_a.hide(),this.$img_b.hide(),this.$select.empty(),Object.keys(this.hash).forEach((function(i){let n,r;n=e.hash[i],r=_i("<option>").attr("title",n.title).attr("value",n.value).text(n.title),t===n.value&&(r.attr("selected",!0),n.$shown.show(),Bu.call(e,t)),e.$select.append(r)}))}}function Bu(t){this.hash[t].$hidden.hide(),this.hash[t].$shown.show(),this.$cycle.show(),this.$toggle.show()}var zu={NONE:"None",VC:"Coverage",VC_SQRT:"Coverage - Sqrt",KR:"Balanced",INTER_VC:"Interchromosomal Coverage",INTER_VC_SQRT:"Interchromosomal Coverage - Sqrt",INTER_KR:"Interchromosomal Balanced",GW_VC:"Genome-wide Coverage",GW_VC_SQRT:"Genome-wide Coverage - Sqrt",GW_KR:"Genome-wide Balanced"};class Fu{constructor(t,e){this.browser=t;const i=e.find("div[id$='lower-hic-nav-bar-widget-container']");this.$container=_i("<div>",{class:"hic-normalization-selector-container",title:"Normalization"}),i.append(this.$container);let n=_i("<div>");n.text("Norm"),this.$container.append(n),this.$normalization_selector=_i('<select name="select">'),this.$normalization_selector.attr("name","normalization_selector"),this.$normalization_selector.on("change",(()=>{this.browser.setNormalization(this.$normalization_selector.val())})),this.$container.append(this.$normalization_selector),this.$spinner=_i("<div>"),this.$spinner.text("Loading ..."),this.$container.append(this.$spinner),this.$spinner.hide(),this.browser.eventBus.subscribe("MapLoad",this),this.browser.eventBus.subscribe("NormVectorIndexLoad",this),this.browser.eventBus.subscribe("NormalizationFileLoad",this),this.browser.eventBus.subscribe("NormalizationExternalChange",this)}startNotReady(){this.$normalization_selector.hide(),this.$spinner.show()}stopNotReady(){this.$spinner.hide(),this.$normalization_selector.show()}receiveEvent(t){"NormVectorIndexLoad"===t.type?(async function(){const t=this.browser.state.normalization,e=await this.browser.getNormalizationOptions();if(e){const i=e.map((function(e){const i=zu[e]||e;return"<option"+(void 0===i?"":' title = "'+i+'" ')+(" value="+e+(t===e?" selected":""))+">"+("&nbsp &nbsp"+i+"&nbsp &nbsp")+"</option>"}));this.$normalization_selector.empty(),this.$normalization_selector.append(i.join(""))}}.call(this),this.stopNotReady()):"NormalizationFileLoad"===t.type?"start"===t.data?this.startNotReady():this.stopNotReady():"NormalizationExternalChange"===t.type&&this.$normalization_selector.find("option").filter((function(e){return this.value===t.data})).prop("selected",!0)}}class Nu{constructor(t,e){this.browser=t,this.$x_axis_selector=e.find("select[name='x-axis-selector']"),this.$y_axis_selector=e.find("select[name='y-axis-selector']"),this.$x_axis_selector.on("change",(()=>{const t=this.$x_axis_selector.val();(0===parseInt(t,10)||0===parseInt(this.$y_axis_selector.val(),10))&&this.$y_axis_selector.val(t)})),this.$y_axis_selector.on("change",(()=>{const t=this.$y_axis_selector.val();(0===parseInt(t,10)||0===parseInt(this.$x_axis_selector.val(),10))&&this.$x_axis_selector.val(t)})),this.$y_axis_selector.next("div").on("click",(async()=>{const e=parseInt(this.$x_axis_selector.find("option:selected").val(),10),i=parseInt(this.$y_axis_selector.find("option:selected").val(),10);await t.setChromosomes(e,i)})),this.dataLoadConfig={receiveEvent:t=>{"MapLoad"===t.type&&this.respondToDataLoadWithDataset(t.data)}},t.eventBus.subscribe("MapLoad",this.dataLoadConfig),this.locusChangeConfig={receiveEvent:t=>{"LocusChange"===t.type&&this.respondToLocusChangeWithState(t.data.state)}},t.eventBus.subscribe("LocusChange",this.locusChangeConfig)}respondToDataLoadWithDataset(t){var e,i;this.$x_axis_selector.empty(),this.$y_axis_selector.empty(),e=t.chromosomes.map(((t,e)=>{let{name:i}=t;return`<option value=${e.toString()}>${i}</option>`})),this.$x_axis_selector.append(e.join("")),this.$y_axis_selector.append(e.join("")),i="option[value="+this.browser.state.chr1.toString()+"]",this.$x_axis_selector.find(i).prop("selected",!0),i="option[value="+this.browser.state.chr2.toString()+"]",this.$y_axis_selector.find(i).prop("selected",!0)}respondToLocusChangeWithState(t){var e,i,n,r;n=this.$x_axis_selector.find("option"),r=this.$y_axis_selector.find("option"),0!==n.length&&0!==r.length&&(n=this.$x_axis_selector.find("option:selected"),r=this.$y_axis_selector.find("option:selected"),n.prop("selected",!1),r.prop("selected",!1),e="option[value="+t.chr1.toString()+"]",i="option[value="+t.chr2.toString()+"]",this.$x_axis_selector.find(e).prop("selected",!0),this.$y_axis_selector.find(i).prop("selected",!0))}}class _u{constructor(t,e,i,n){let{title:r,alertMessage:s}=i;this.browser=t,this.trackListRetrievalCallback=n,Ou.call(this,e,s),$u.call(this,this.browser.$root,r)}updateBody(t){var e,i,n=this;if(n.$annotationPanel.find(".hic-annotation-row-container").remove(),t[0]instanceof gc)for(i=t.length-1;i>=0;i--)Uu.call(n,n.$annotationPanel,t[i]);else{e=t;for(let t of e)Uu.call(n,n.$annotationPanel,t)}}}function Ou(t,e){t.find("button").on("click",(()=>{this.trackListRetrievalCallback().length>0?(this.updateBody(this.trackListRetrievalCallback()),this.$annotationPanel.toggle()):rc.presentAlert(e),this.browser.hideMenu()}))}function $u(t,e){var i,n,r,s=this;this.$annotationPanel=_i("<div>",{class:"hic-annotation-panel-container"}),t.append(this.$annotationPanel),i=_i("<div>",{class:"hic-annotation-panel-header"}),this.$annotationPanel.append(i),(n=_i("<div>")).text(e),i.append(n),n=_i("<div>",{class:"hic-menu-close-button"}),i.append(n),r=_i("<i>",{class:"fa fa-times"}),n.append(r),r.on("click",(function(t){s.$annotationPanel.toggle()})),G(this.$annotationPanel.get(0),i.get(0)),this.$annotationPanel.hide()}function Uu(t,e){var i,n,r,s,o,a,h,l,c,u,f,d,p,g,m,w,b,y,v,x,C,S=this,k="#f7f7f7";if(f=e instanceof gc,d=this.trackListRetrievalCallback(),!1===f&&(m=(p=e).x.track,g=p.x.track.trackView),r=_i("<div>",{class:"hic-annotation-row-container"}),t.append(r),s=_i("<div>",{class:"hic-annotation-modal-row"}),r.append(s),(c=_i("<div>")).text(f?e.config.name:m.config.name),s.append(c),f&&(u=!0===e.isVisible?"fa fa-eye fa-lg":"fa fa-eye-slash fa-lg",o=_i("<i>",{class:u,"aria-hidden":"true"}),s.append(o),o.on("click",(function(t){o.hasClass("fa-eye")?(o.addClass("fa-eye-slash"),o.removeClass("fa-eye"),e.isVisible=!1):(o.addClass("fa-eye"),o.removeClass("fa-eye-slash"),e.isVisible=!0),S.browser.contactMatrixView.clearImageCaches(),S.browser.contactMatrixView.update()}))),f){const t=_i("<div>",{class:"matrix-diagonal-widget-container matrix-diagonal-widget-all"});s.append(t),t.on("click.matrix_diagonal_div",(i=>{var n,r;i.preventDefault(),r=e,(n=t).hasClass("matrix-diagonal-widget-all")?(n.removeClass("matrix-diagonal-widget-all"),n.addClass("matrix-diagonal-widget-lower"),r.displayMode=fc):n.hasClass("matrix-diagonal-widget-lower")?(n.removeClass("matrix-diagonal-widget-lower"),n.addClass("matrix-diagonal-widget-upper"),r.displayMode=dc):n.hasClass("matrix-diagonal-widget-upper")?(n.removeClass("matrix-diagonal-widget-upper"),n.addClass("matrix-diagonal-widget-all"),r.displayMode=uc):(n.addClass("matrix-diagonal-widget-all"),r.displayMode=uc)}))}v=f?e.getColor():m.color,x=_i("<div>",{class:"igv-color-swatch"}),C=_i("<i>",{class:"fa fa-square fa-lg","aria-hidden":"true"}),x.append(C),C.css({color:v}),n=x,s.append(n),i=function(t,e,i){var n,r,s;n=_i("<div>",{class:"hic-color-swatch-container"}),t.append(n),e&&e.width&&n.width(e.width);e&&e.height&&n.height(e.height);return r=_i("<div>"),n.append(r),s=_i("<i>",{class:"fa fa-times"}),r.append(s),s.on("click",(function(t){i()})),n}(r,{width:698},(function(){s.next(".hic-color-swatch-container").toggle()})),n.on("click",(function(t){s.next(".hic-color-swatch-container").toggle()})),i.hide();ac(i.get(0),(t=>{s.find(".fa-square").css({color:t}),f?(e.color=t,S.browser.eventBus.post(Ec("TrackState2D",e))):g.setColor(t)})),c=_i("<div>",{class:"up-down-arrow-container"}),s.append(c),h=_i("<i>",{class:"fa fa-arrow-up","aria-hidden":"true"}),c.append(h),l=_i("<i>",{class:"fa fa-arrow-down","aria-hidden":"true"}),c.append(l),1===d.length?(h.css("color",k),l.css("color",k)):e===d[0]?(f?l:h).css("color",k):e===d[d.length-1]&&(f?h:l).css("color",k),w=d.indexOf(e),b=function(t){e=d[w+1],d[w+1]=d[w],d[w]=e,f?(S.browser.eventBus.post(Ec("TrackState2D",d)),S.updateBody(d)):(S.browser.updateLayout(),S.updateBody(d))},y=function(t){e=d[w-1],d[w-1]=d[w],d[w]=e,f?(S.browser.eventBus.post(Ec("TrackState2D",d)),S.updateBody(d)):(S.browser.updateLayout(),S.updateBody(d))},h.on("click",f?b:y),l.on("click",f?y:b),a=_i("<i>",{class:"fa fa-trash-o fa-lg","aria-hidden":"true"}),s.append(a),a.on("click",(function(t){var i;f?(i=d.indexOf(e),d.splice(i,1),S.browser.contactMatrixView.clearImageCaches(),S.browser.contactMatrixView.update(),S.browser.eventBus.post(Ec("TrackLoad2D",d))):S.browser.layoutController.removeTrackXYPair(g.trackRenderPair),S.updateBody(d)}))}class Hu{constructor(t,e){this.browser=t,this.$target=e,this.$rulerSweeper=e.find("div[id$='-sweep-zoom-container']"),this.$rulerSweeper.hide(),this.sweepRect={}}initialize(t){this.anchor=t,this.coordinateFrame=this.$rulerSweeper.parent().offset(),this.aspectRatio=this.$target.width()/this.$target.height(),this.sweepRect.x={x:t.x,y:t.y,width:1,height:1},this.clipped={value:!1}}update(t){var e=this.anchor,i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);i/n>this.aspectRatio?n=i/this.aspectRatio:i=n*this.aspectRatio,this.sweepRect.width=i,this.sweepRect.height=n,this.sweepRect.x=e.x<t.x?e.x:e.x-i,this.sweepRect.y=e.y<t.y?e.y:e.y-n,this.$rulerSweeper.width(this.sweepRect.width),this.$rulerSweeper.height(this.sweepRect.height),this.$rulerSweeper.offset({left:this.sweepRect.x,top:this.sweepRect.y}),this.$rulerSweeper.show()}commit(){this.$rulerSweeper.hide();const t=this.browser.state,e=this.browser.resolution(),i=this.sweepRect.x-this.$target.offset().left,n=this.sweepRect.y-this.$target.offset().top,r=(t.x+i/t.pixelSize)*e,s=(t.y+n/t.pixelSize)*e,o=r+this.sweepRect.width/t.pixelSize*e,a=s+this.sweepRect.height/t.pixelSize*e,h=this.browser.dataset.bpResolutions[this.browser.dataset.bpResolutions.length-1];this.browser.goto(t.chr1,r,o,t.chr2,s,a,h)}}class Pu{constructor(t,e,i){this.browser=t,this.isDragging=!1,this.$x_axis_scrollbar_container=e,this.$x_axis_scrollbar=this.$x_axis_scrollbar_container.find("div[id$='-x-axis-scrollbar']"),this.$x_label=this.$x_axis_scrollbar.find("div"),this.$x_label.text(""),this.$y_axis_scrollbar_container=i,this.$y_axis_scrollbar=this.$y_axis_scrollbar_container.find("div[id$='-y-axis-scrollbar']"),this.$y_label=this.$y_axis_scrollbar.find(".scrollbar-label-rotation-in-place"),this.$y_label.text(""),this.browser.eventBus.subscribe("LocusChange",this)}css2Bin(t,e,i){var n,r;return n=e.css(i).slice(0,-2),r=e.parent().css("left"===i?"width":"height").slice(0,-2),parseInt(n,10)/parseInt(r,10)*t.size/this.browser.dataset.bpResolutions[this.browser.state.zoom]}receiveEvent(t){var e,i,n,r,s;if(!this.isDragging&&"LocusChange"===t.type){var o=t.data.state,a=this.browser.dataset;if(0===o.chr1)this.$x_axis_scrollbar.hide(),this.$y_axis_scrollbar.hide();else{this.$x_axis_scrollbar.show(),this.$y_axis_scrollbar.show(),this.$x_axis_scrollbar_container.show(),this.$y_axis_scrollbar_container.show();const{chr1:t,chr2:h,zoom:l,pixelSize:c,x:u,y:f}=o;e=[t,h].map((t=>a.chromosomes[t].size/a.bpResolutions[l])),i=e.map((t=>t*c)),s=[(n=[this.browser.contactMatrixView.getViewDimensions().width,this.browser.contactMatrixView.getViewDimensions().height])[0]/c,n[n.length-1]/c].map(((t,r)=>{const s=Math.min(t,e[r])/e[r],o=Math.min(i[r],n[r])/n[r];return Math.max(1,Math.round(100*s*o))})),this.$x_axis_scrollbar.css("width",`${s[0]}%`),this.$y_axis_scrollbar.css("height",`${s[s.length-1]}%`),r=Math.round(100*u/e[0]),this.$x_axis_scrollbar.css("left",`${r}%`),r=Math.round(100*f/e[e.length-1]),this.$y_axis_scrollbar.css("top",`${r}%`),this.$x_label.text(a.chromosomes[t].name),this.$y_label.text(a.chromosomes[h].name)}}}}class Vu{constructor(t,e){this.config=e,this.figureMode=e.figureMode||e.miniMode,this.resolutionLocked=!1,this.eventBus=new pc,this.showTrackLabelAndGutter=!0,this.id=`browser_${i()}`,this.trackPairs=[],this.tracks2D=[],this.normVectorFiles=[],this.synchable=!1!==e.synchable,this.synchedBrowsers=[],this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.$root=_i('<div class="hic-root unselect">'),e.width&&this.$root.css("width",String(e.width)),e.height&&this.$root.css("height",String(e.height+Mc())),t.append(this.$root),this.layoutController=new Dc(this,this.$root),this.locusGoto=new pu(this,Lc(this)),this.resolutionSelector=new gu(this,Lc(this)),this.resolutionSelector.setResolutionLock(this.resolutionLocked),this.colorscaleWidget=new Tu(this,Lc(this)),this.controlMapWidget=new Eu(this,Lc(this)),this.normalizationSelector=new Fu(this,Lc(this)),this.inputDialog=new sc(t.get(0),this);const n=new Hu(this,this.layoutController.getContactMatrixViewport()),r=new Pu(this,this.layoutController.getXAxisScrollbarContainer(),this.layoutController.getYAxisScrollbarContainer()),s=new wu(mu),o=new yu(bu.threshold);o.setColorComponents(bu.negative,"-"),o.setColorComponents(bu.positive,"+");const a=e.backgroundColor||xu.defaultBackgroundColor;this.contactMatrixView=new xu(this,this.layoutController.getContactMatrixViewport(),n,r,s,o,a),this.$menu=this.createMenu(this.$root),this.$menu.hide(),this.chromosomeSelector=new Nu(this,this.$menu.find(".hic-chromosome-selector-widget-container"));this.annotation2DWidget=new _u(this,this.$menu.find(".hic-annotation-presentation-button-container"),{title:"2D Annotations",alertMessage:"No 2D annotations currently loaded for this map"},(()=>this.tracks2D)),this.$user_interaction_shield=_i("<div>",{class:"hic-root-prevent-interaction"}),this.$root.append(this.$user_interaction_shield),this.$user_interaction_shield.hide(),this.hideCrosshairs()}async init(t){this.state=t.state?t.state:fu.default(),this.pending=new Map,this.eventBus.hold(),this.contactMatrixView.disableUpdates=!0;try{this.contactMatrixView.startSpinner(),this.$user_interaction_shield.show(),await this.loadHicFile(t,!0),t.controlUrl&&await this.loadHicControlFile({url:t.controlUrl,name:t.controlName,nvi:t.controlNvi,isControl:!0},!0),t.cycle&&(t.displayMode="A"),t.displayMode&&(this.contactMatrixView.displayMode=t.displayMode,this.eventBus.post({type:"DisplayMode",data:t.displayMode})),t.colorScale&&(this.contactMatrixView.setColorScale(t.colorScale),this.eventBus.post({type:"ColorScale",data:this.contactMatrixView.getColorScale()})),t.locus&&await this.parseGotoInput(t.locus);var e=[];if(t.tracks&&e.push(this.loadTracks(t.tracks)),t.normVectorFiles&&t.normVectorFiles.forEach((function(t){e.push(this.loadNormalizationFile(t))})),await Promise.all(e),t.normalization){const e=await this.getNormalizationOptions(),i=new Set(e);this.state.normalization=i.has(t.normalization)?t.normalization:"NONE"}const i=this.contactMatrixView.colorScaleThresholdCache;this.eventBus.release(),this.contactMatrixView.colorScaleThresholdCache=i,t.cycle?this.controlMapWidget.toggleDisplayModeCycle():await this.update()}finally{this.contactMatrixView.stopSpinner(),this.$user_interaction_shield.hide(),this.contactMatrixView.disableUpdates=!1,this.contactMatrixView.update()}}createMenu(t){t.append(_i('<div class="hic-menu" style="display: none;">\n            <div class="hic-menu-close-button">\n                <i class="fa fa-times"></i>\n            </div>\n\t        <div class="hic-chromosome-selector-widget-container">\n\t\t        <div>Chromosomes</div>\n                <div>\n                    <select name="x-axis-selector"></select>\n                    <select name="y-axis-selector"></select>\n                    <div></div>\n                </div>\n\t        </div>\n\t        <div class="hic-annotation-presentation-button-container">\n\t\t        <button type="button">2D Annotations</button>\n\t        </div>\n        </div>'));const e=t.find(".hic-menu");return t.find(".fa-times").on("click",(()=>this.toggleMenu())),e}toggleTrackLabelAndGutterState(){this.showTrackLabelAndGutter=!this.showTrackLabelAndGutter}toggleMenu(){this.$menu.is(":visible")?this.hideMenu():this.showMenu()}showMenu(){this.$menu.show()}hideMenu(){this.$menu.hide()}startSpinner(){this.contactMatrixView.startSpinner()}stopSpinner(){this.contactMatrixView.stopSpinner()}async setDisplayMode(t){await this.contactMatrixView.setDisplayMode(t),this.eventBus.post(Ec("DisplayMode",t))}getDisplayMode(){return this.contactMatrixView?this.contactMatrixView.displayMode:void 0}toggleDisplayMode(){this.controlMapWidget.toggleDisplayMode()}async getNormalizationOptions(){if(!this.dataset)return[];const t=await this.dataset.getNormalizationOptions();if(this.controlDataset){let e=await this.controlDataset.getNormalizationOptions();return e=new Set(e),t.filter((t=>e.has(t)))}return t}getResolutions(){if(!this.dataset)return[];const t=this.dataset.bpResolutions.map((function(t,e){return{index:e,binSize:t}}));if(this.controlDataset){let e=new Set(this.controlDataset.bpResolutions);return t.filter((t=>e.has(t.binSize)))}return t}isWholeGenome(){return this.dataset&&this.state&&this.dataset.isWholeGenome(this.state.chr1)}getColorScale(){if(this.contactMatrixView)switch(this.getDisplayMode()){case"AOB":case"BOA":return this.contactMatrixView.ratioColorScale;case"AMB":return this.contactMatrixView.diffColorScale;default:return this.contactMatrixView.colorScale}}setColorScaleThreshold(t){this.contactMatrixView.setColorScaleThreshold(t)}updateCrosshairs(t){let{x:e,y:i,xNormalized:n,yNormalized:r}=t;const s=i<0?{left:0}:{top:i,left:0};this.contactMatrixView.$x_guide.css(s),this.layoutController.$x_track_guide.css(s);const o=e<0?{top:0}:{top:0,left:e};if(this.contactMatrixView.$y_guide.css(o),this.layoutController.$y_track_guide.css(o),this.customCrosshairsHandler){const{x:t,y:s,pixelSize:o}=this.state,a=this.resolution(),h=(t+e/o)*a,l=(s+i/o)*a;let{startBP:c,endBP:u}=this.genomicState("x"),{startBP:f,endBP:d}=this.genomicState("y");this.customCrosshairsHandler({xBP:h,yBP:l,startXBP:c,startYBP:f,endXBP:u,endYBP:d,interpolantX:n,interpolantY:r})}}setCustomCrosshairsHandler(t){this.customCrosshairsHandler=t}hideCrosshairs(){this.contactMatrixView.$x_guide.hide(),this.layoutController.$x_track_guide.hide(),this.contactMatrixView.$y_guide.hide(),this.layoutController.$y_track_guide.hide()}showCrosshairs(){this.contactMatrixView.$x_guide.show(),this.layoutController.$x_track_guide.show(),this.contactMatrixView.$y_guide.show(),this.layoutController.$y_track_guide.show()}genomicState(t){let e=this.contactMatrixView.getViewDimensions().width,i=this.dataset.bpResolutions[this.state.zoom];const n="all"===this.dataset.chromosomes[this.state.chr1].name.toLowerCase()?this.genome.getGenomeLength()/e:i/this.state.pixelSize,r={bpp:n};return"x"===t?(r.chromosome=this.dataset.chromosomes[this.state.chr1],r.startBP=this.state.x*i,r.endBP=r.startBP+n*e):(r.chromosome=this.dataset.chromosomes[this.state.chr2],r.startBP=this.state.y*i,r.endBP=r.startBP+n*this.contactMatrixView.getViewDimensions().height),r}async loadTracks(t){const e=1===t.length?"Error loading track "+t[0].name:"Error loading tracks";try{this.contactMatrixView.startSpinner();const e=[],i=[];for(let n of t){const t=Oi(n.url)?n.url.name:await B(n.url);if(n.format||(n.format=w(t)),"annotation"===n.type&&"rgb(22, 129, 198)"===n.color&&delete n.color,void 0===n.max&&(n.autoscale=!0),n.height=40,void 0===n.format||"bedpe"===n.format||"interact"===n.format)i.push(gc.loadTrack2D(n,this.genome));else{const t=await zl.createTrack(n,this);e.push(t)}}if(e.length>0){this.layoutController.tracksLoaded(e);const t=_i(".hic-igv-right-hand-gutter");!0===this.showTrackLabelAndGutter?t.show():t.hide(),await this.updateLayout()}if(i.length>0){const t=await Promise.all(i);t&&t.length>0&&(this.tracks2D=this.tracks2D.concat(t),this.eventBus.post(Ec("TrackLoad2D",this.tracks2D)))}}catch(t){!function(t,e){const i={401:"Access unauthorized",403:"Access forbidden",404:"Not found"};var n=e.message;i.hasOwnProperty(n)&&(n=i[n]);rc.presentAlert(t+": "+n)}(e,t),console.error(t)}finally{this.contactMatrixView.stopSpinner()}}async loadNormalizationFile(t){if(!this.dataset)return;this.eventBus.post(Ec("NormalizationFileLoad","start"));const e=await this.dataset.hicFile.readNormalizationVectorFile(t,this.dataset.chromosomes);for(let t of e.types)this.dataset.normalizationTypes||(this.dataset.normalizationTypes=[]),this.dataset.normalizationTypes.includes(t)||this.dataset.normalizationTypes.push(t),this.eventBus.post(Ec("NormVectorIndexLoad",this.dataset));return e}async renderTrackXY(t){try{this.startSpinner(),await t.updateViews()}finally{this.stopSpinner()}}reset(){this.layoutController.removeAllTrackXYPairs(),this.contactMatrixView.clearImageCaches(),this.tracks2D=[],this.tracks=[],this.$contactMaplabel.text(""),this.$contactMaplabel.attr("title",""),this.$controlMaplabel.text(""),this.$controlMaplabel.attr("title",""),this.dataset=void 0,this.controlDataset=void 0,this.unsyncSelf()}clearSession(){this.dataset=void 0,this.controlDataset=void 0,this.setDisplayMode("A"),this.unsyncSelf()}unsyncSelf(){const t=Xu();for(let e of t)e.unsync(this)}unsync(t){this.synchedBrowsers=this.synchedBrowsers.filter((e=>e!=t))}async loadHicFile(t,e){if(t.url){this.clearSession();try{this.contactMatrixView.startSpinner(),e||this.$user_interaction_shield.show();const i=Wu(t),n=this.controlDataset?"A: ":"";this.$contactMaplabel.text(n+i),this.$contactMaplabel.attr("title",i),t.name=i,this.dataset=await lu.loadDataset(t),this.dataset.name=i;const r=this.genome?this.genome.id:void 0;this.genome=new cu(this.dataset.genomeId,this.dataset.chromosomes),this.genome.id!==r&&pc.globalBus.post(Ec("GenomeChange",this.genome.id)),this.eventBus.post(Ec("MapLoad",this.dataset)),t.state?(t.state.hasOwnProperty("chr1")||(t.state=fu.parse(t.state)),await this.setState(t.state)):t.synchState&&this.canBeSynched(t.synchState)?this.syncState(t.synchState):await this.setState(fu.default(this.config));const s=this.eventBus;if(!t.nvi&&"string"==typeof t.url){const e=new URL(t.url),i=encodeURIComponent(e.hostname+e.pathname),n=await fetch("https://t5dvc6kn3f.execute-api.us-east-1.amazonaws.com/dev/nvi/"+i);if(200===n.status){const e=await n.text();e&&(t.nvi=e)}}if(t.nvi)await this.dataset.getNormVectorIndex(t),s.post(Ec("NormVectorIndexLoad",this.dataset));else{const e=this.dataset;e.getNormVectorIndex(t).then((function(i){t.isControl||s.post(Ec("NormVectorIndexLoad",e))}))}Yu();const o=Xu().filter((t=>t!=this&&t.dataset&&t.dataset.isCompatible(this.dataset)));o.length>0&&this.syncState(o[0].getSyncState())}catch(e){throw this.$contactMaplabel.text(""),this.$contactMaplabel.attr(""),t.name=name,e}finally{this.stopSpinner(),e||this.$user_interaction_shield.hide()}}else console.log("No .hic url specified")}async loadHicControlFile(t,e){try{this.$user_interaction_shield.show(),this.contactMatrixView.startSpinner(),this.controlUrl=t.url;const i=Wu(t);t.name=i;const n=await lu.loadDataset(t);n.name=i,!this.dataset||this.dataset.isCompatible(n)?(this.controlDataset=n,this.dataset&&this.$contactMaplabel.text("A: "+this.dataset.name),this.$controlMaplabel.text("B: "+n.name),this.$controlMaplabel.attr("title",n.name),await n.getNormVectorIndex(t),this.eventBus.post(Ec("ControlMapLoad",this.controlDataset)),e||this.update()):rc.presentAlert('"B" map genome ('+n.genomeId+') does not match "A" map genome ('+this.genome.id+")")}finally{this.$user_interaction_shield.hide(),this.stopSpinner()}}async parseGotoInput(t){let e,i;const n=t.split(" ");if(1===n.length?(e=this.parseLocusString(n[0]),i=e):(e=this.parseLocusString(n[0]),i=this.parseLocusString(n[1]),void 0===i&&(i=e)),void 0===e){const t=await du(this.genome.id,n[0].trim());t?(cc.selectedGene=n[0].trim(),e=this.parseLocusString(t),i=e,this.state.selectedGene=cc.selectedGene,this.goto(e.chr,e.start,e.end,i.chr,i.start,i.end,5e3)):alert('No feature found with name "'+n[0]+'"')}else e.wholeChr&&i.wholeChr?await this.setChromosomes(e.chr,i.chr):this.goto(e.chr,e.start,e.end,i.chr,i.start,i.end)}findMatchingZoomIndex(t,e){const i=e.length>0&&void 0!==e[0].index;for(let n=e.length-1;n>0;n--){const r=i?e[n].binSize:e[n],s=i?e[n].index:n;if(r>=t)return s}return 0}parseLocusString(t){const e={},i=t.trim().split(":"),n=this.genome.getChromosome(i[0].toLowerCase());if(n){if(e.chr=n.index,1===i.length)e.start=0,e.end=this.dataset.chromosomes[e.chr].size,e.wholeChr=!0;else{const t=i[1].split("-");let n=t[0].replace(/\,/g,"");e.start=isNaN(n)?void 0:parseInt(n,10)-1,2==t.length&&(n=t[1].replace(/\,/g,""),e.end=isNaN(n)?void 0:parseInt(n,10))}return e}}async pinchZoom(t,e,i){if(0===this.state.chr1)await this.zoomAndCenter(1,t,e);else try{this.startSpinner();const n=this.getResolutions(),r=n[this.state.zoom];let s,o,a,h;if(this.resolutionLocked||this.state.zoom===n.length-1&&i>1||0===this.state.zoom&&i<1)s=r.binSize,a=Math.min(12,this.state.pixelSize*i),o=this.state.zoom,h=!1;else{const t=r.binSize/this.state.pixelSize/i;o=this.findMatchingZoomIndex(t,n),s=n[o].binSize,h=o!==this.state.zoom,a=Math.min(12,s/t)}const l=await this.minZoom(this.state.chr1,this.state.chr2);if(!this.resolutionLocked&&i<1&&o<l)this.setChromosomes(0,0);else{const n=await this.minPixelSize(this.state.chr1,this.state.chr2,o),l=this.state;a=Math.max(a,n);const c=(l.x+t/l.pixelSize)*r.binSize,u=(l.y+e/l.pixelSize)*r.binSize;l.x=c/s-t/a,l.y=u/s-e/a,l.zoom=o,l.pixelSize=a,this.clamp(),this.contactMatrixView.zoomIn(t,e,1/i);let f=Ec("LocusChange",{state:l,resolutionChanged:h,chrChanged:!1});this.update(f)}}finally{this.stopSpinner()}}async zoomAndCenter(t,e,i){if(this.dataset)if(this.dataset.isWholeGenome(this.state.chr1)&&t>0){const t=e*this.dataset.wholeGenomeResolution/this.state.pixelSize,n=i*this.dataset.wholeGenomeResolution/this.state.pixelSize,r=this.genome.getChromsosomeForCoordinate(t),s=this.genome.getChromsosomeForCoordinate(n);this.setChromosomes(r.index,s.index)}else{const n=this.getResolutions(),r=this.contactMatrixView.getViewDimensions(),s=void 0===e?0:e-r.width/2,o=void 0===i?0:i-r.height/2;if(this.state.x+=s/this.state.pixelSize,this.state.y+=o/this.state.pixelSize,this.resolutionLocked||t>0&&this.state.zoom===n[n.length-1].index||t<0&&this.state.zoom===n[0].index){const e=await this.minPixelSize(this.state.chr1,this.state.chr2,this.state.zoom),i=this.state,n=Math.max(Math.min(12,i.pixelSize*(t>0?2:.5)),e),s=(n-i.pixelSize)/n;i.pixelSize=n,i.x+=s*(r.width/i.pixelSize),i.y+=s*(r.height/i.pixelSize),this.clamp();let o=Ec("LocusChange",{state:i,resolutionChanged:!1,chrChanged:!1});this.update(o)}else{let e;for(e=0;e<n.length&&this.state.zoom!==n[e].index;e++);if(void 0!==e){const i=n[e+t].index;this.setZoom(i)}}}}async setZoom(t){try{const e=this.dataset.bpResolutions,i=e[this.state.zoom],n=this.contactMatrixView.getViewDimensions(),r=this.state.x+n.width/(2*this.state.pixelSize),s=this.state.y+n.height/(2*this.state.pixelSize),o=e[t],a=r*(i/o),h=s*(i/o),l=await this.minPixelSize(this.state.chr1,this.state.chr2,t),c=this.state,u=Math.max(1,l),f=c.zoom!==t;c.zoom=t,c.x=Math.max(0,a-n.width/(2*u)),c.y=Math.max(0,h-n.height/(2*u)),c.pixelSize=u,this.clamp(),await this.contactMatrixView.zoomIn();let d=Ec("LocusChange",{state:c,resolutionChanged:f,chrChanged:!1});this.update(d)}finally{}}async setChromosomes(t,e){try{this.startSpinner();const i=await this.minZoom(t,e);this.state.chr1=Math.min(t,e),this.state.chr2=Math.max(t,e),this.state.x=0,this.state.y=0,this.state.zoom=i;const n=await this.minPixelSize(this.state.chr1,this.state.chr2,this.state.zoom);this.state.pixelSize=Math.min(100,Math.max(1,n));let r=Ec("LocusChange",{state:this.state,resolutionChanged:!0,chrChanged:!0});this.update(r)}finally{this.stopSpinner()}}async updateLayout(){function t(t,e){t.$viewport.css({order:e}),t.syncCanvas()}this.clamp(),this.trackPairs.forEach((function(e,i){t(e.x,i),t(e.y,i)})),this.layoutController.xAxisRuler.update(),this.layoutController.yAxisRuler.update(),await this.update()}async setState(t){const e=!this.state||this.state.chr1!==t.chr1||this.state.chr2!==t.chr2;this.state=t;const i=await this.minPixelSize(this.state.chr1,this.state.chr2,this.state.zoom);this.state.pixelSize=Math.max(t.pixelSize,i);let n=new Ec("LocusChange",{state:this.state,resolutionChanged:!0,chrChanged:e});this.update(n),this.eventBus.post(n)}getSyncState(){return{chr1Name:this.dataset.chromosomes[this.state.chr1].name,chr2Name:this.dataset.chromosomes[this.state.chr2].name,binSize:this.dataset.bpResolutions[this.state.zoom],binX:this.state.x,binY:this.state.y,pixelSize:this.state.pixelSize}}canBeSynched(t){return!1!==this.synchable&&(this.dataset&&void 0!==this.dataset.getChrIndexFromName(t.chr1Name)&&void 0!==this.dataset.getChrIndexFromName(t.chr2Name))}syncState(t){if(!t||!1===this.synchable)return;if(!this.dataset)return;var e=this.genome.getChromosome(t.chr1Name),i=this.genome.getChromosome(t.chr2Name),n=this.dataset.getZoomIndexForBinSize(t.binSize,"BP"),r=t.binX,s=t.binY,o=t.pixelSize;if(!e||!i)return;if(void 0===n&&(n=this.findMatchingZoomIndex(t.binSize,this.dataset.bpResolutions),o=t.pixelSize/t.binSize*this.dataset.bpResolutions[n],r=t.binX/t.pixelSize*o,s=t.binY/t.pixelSize*o,o>12))return void console.log("Cannot synch map "+this.dataset.name+" (resolution "+t.binSize+" not available)");const a=this.state.zoom!==n,h=this.state.chr1!==e.index||this.state.chr2!==i.index;this.state.chr1=e.index,this.state.chr2=i.index,this.state.zoom=n,this.state.x=r,this.state.y=s,this.state.pixelSize=o;let l=Ec("LocusChange",{state:this.state,resolutionChanged:a,chrChanged:h},!1);this.update(l)}setNormalization(t){this.state.normalization=t,this.eventBus.post(Ec("NormalizationChange",this.state.normalization))}shiftPixels(t,e){if(!this.dataset)return;this.state.x+=t/this.state.pixelSize,this.state.y+=e/this.state.pixelSize,this.clamp();const i=Ec("LocusChange",{state:this.state,resolutionChanged:!1,dragging:!0,chrChanged:!1});i.dragging=!0,this.update(i),this.eventBus.post(i)}goto(t,e,i,n,r,s,o){const a=this.contactMatrixView.getViewDimensions(),h=this.getResolutions(),l=h[this.state.zoom].binSize,c=a.width;i||(i=(e=Math.max(0,e-Math.floor(c*l/2)))+c*l),s||(s=(r=Math.max(0,r-Math.floor(a.height*l/2)))+a.height*l);let u,f,d=Math.max((i-e)/a.width,(s-r)/a.height);if(o&&d<o){const t=c*o,n=(e+i)/2,a=(r+s)/2;e=Math.max(n-t/2),r=Math.max(0,a-t/2),d=o}!0===this.resolutionLocked&&void 0===o?(u=!1,f=this.state.zoom):(f=this.findMatchingZoomIndex(d,h),u=f!==this.state.zoom);const p=h[f].binSize,g=Math.min(12,Math.max(1,p/d)),m=e/p,w=r/p,b=!this.state||this.state.chr1!==t||this.state.chr2!==n;this.state.chr1=t,this.state.chr2=n,this.state.zoom=f,this.state.x=m,this.state.y=w,this.state.pixelSize=g,this.contactMatrixView.clearImageCaches();let y=Ec("LocusChange",{state:this.state,resolutionChanged:u,chrChanged:b});this.update(y)}clamp(){var t=this.contactMatrixView.getViewDimensions(),e=this.dataset.chromosomes[this.state.chr1].size,i=this.dataset.chromosomes[this.state.chr2].size,n=this.dataset.bpResolutions[this.state.zoom],r=e/n-t.width/this.state.pixelSize,s=i/n-t.height/this.state.pixelSize;r=Math.max(0,r),s=Math.max(0,s),this.state.x=Math.min(Math.max(0,this.state.x),r),this.state.y=Math.min(Math.max(0,this.state.y),s)}receiveEvent(t){}async update(t){if(this.updating){const e=t?t.type:"NONE";this.pending.set(e,t)}else{this.updating=!0;try{this.startSpinner(),void 0!==t&&"LocusChange"===t.type&&(this.layoutController.xAxisRuler.locusChange(t),this.layoutController.yAxisRuler.locusChange(t));const e=[];for(let t of this.trackPairs)e.push(this.renderTrackXY(t));if(e.push(this.contactMatrixView.update(t)),await Promise.all(e),t&&t.propogate){let t=this.getSyncState();for(let e of this.synchedBrowsers)e.syncState(t)}}finally{if(this.updating=!1,this.pending.size>0){const t=[];for(let[e,i]of this.pending)t.push(i);this.pending.clear();for(let e of t)this.update(e)}t&&this.eventBus.post(t),this.stopSpinner()}}}repaintMatrix(){this.contactMatrixView.imageTileCache={},this.contactMatrixView.initialImage=void 0,this.contactMatrixView.update()}resolution(){return this.dataset.bpResolutions[this.state.zoom]}toJSON(){if(!this.dataset||!this.dataset.url)return"{}";const t={};t.backgroundColor=this.contactMatrixView.stringifyBackgroundColor(),t.url=this.dataset.url,this.dataset.name&&(t.name=this.dataset.name),t.state=this.state.stringify(),t.colorScale=this.contactMatrixView.getColorScale().stringify(),cc.selectedGene&&(t.selectedGene=cc.selectedGene);let e=Gu(this.dataset);if(e&&(t.nvi=e),this.controlDataset){t.controlUrl=this.controlUrl,this.controlDataset.name&&(t.controlName=this.controlDataset.name);this.getDisplayMode()&&(t.displayMode=this.getDisplayMode()),e=Gu(this.controlDataset),e&&(t.controlNvi=e),void 0!==this.controlMapWidget.getDisplayModeCycle()&&(t.cycle=!0)}if(this.trackPairs.length>0||this.tracks2D.length>0){let e=[];t.tracks=e;for(let t of this.trackPairs){const i=t.x.track,n=i.config;if("string"==typeof n.url){const t={url:n.url};i.name&&(t.name=i.name),i.dataRange&&(t.min=i.dataRange.min,t.max=i.dataRange.max),i.color&&(t.color=i.color),e.push(t)}}for(let t of this.tracks2D){var i=t.config;if("string"==typeof i.url){const n={url:i.url};t.name&&(n.name=t.name),t.color&&(n.color=t.color),e.push(n)}}}return t}async minZoom(t,e){const i=this.contactMatrixView.getViewDimensions(),n=this.dataset.chromosomes[t],r=this.dataset.chromosomes[e],s=n.size,o=r.size,a=Math.max(s/i.width,o/i.height),h=await this.dataset.getMatrix(t,e);if(!h)throw new Error(`Data not avaiable for chromosomes ${n.name} - ${r.name}`);return h.findZoomForResolution(a)}async minPixelSize(t,e,i){const n=this.contactMatrixView.getViewDimensions(),r=this.dataset.chromosomes[t].size,s=this.dataset.chromosomes[e].size,o=(await this.dataset.getMatrix(t,e)).getZoomDataByIndex(i,"BP").zoom.binSize,a=r/o,h=s/o;return Math.min(n.width/a,n.height/h)}}function Wu(t){if(void 0===t.name){const e=t.url;if(Oi(e))return e.name;{const t=e.split("?").shift(),i=e.lastIndexOf("/");return i>0?t.substring(i+1):t}}return t.name}function Gu(t){return t.hicFile.config.nvi}const ju={width:640,height:640};let qu,Zu=[];function Ku(t){if(void 0===t)return qu&&qu.$root.removeClass("hic-root-selected"),void(qu=t);t!==qu&&(qu&&qu.$root.removeClass("hic-root-selected"),t.$root.addClass("hic-root-selected"),qu=t,pc.globalBus.post(Ec("BrowserSelect",t)))}function Yu(t){const e=(t||Zu).filter((t=>!1!==t.synchable&&void 0!==t.dataset));for(let t of e)for(let i of e)t!==i&&t.dataset.isCompatible(i.dataset)&&(t.synchedBrowsers.push(i),i.synchedBrowsers.push(t))}function Xu(){return Zu}function Ju(t){t.state&&(c(t.state)?t.state=fu.parse(t.state):t.state=new fu(t.state.chr1,t.state.chr2,t.state.zoom,t.state.x,t.state.y,t.width,t.height,t.state.pixelSize,t.state.normalization)),!0===t.figureMode?(t.showLocusGoto=!1,t.showHicContactMapLabel=!1,t.showChromosomeSelector=!1):(void 0===t.width&&(t.width=t.state?t.state.width:ju.width),void 0===t.height&&(t.height=t.state?t.state.height:ju.height),void 0===t.showLocusGoto&&(t.showLocusGoto=!0),void 0===t.showHicContactMapLabel&&(t.showHicContactMapLabel=!0),void 0===t.showChromosomeSelector&&(t.showChromosomeSelector=!0))}function Qu(){const t={},e=[],i=Xu();for(let t of i)e.push(t.toJSON());t.browsers=e,cc.selectedGene&&(t.selectedGene=cc.selectedGene);const n=document.getElementById("hic-caption");if(n){var r=n.textContent;r&&(r=r.trim())&&(t.caption=r)}return t}async function tf(t,e){if(function(){for(let t of Zu)t.$root.remove();Zu=[]}(),e.hasOwnProperty("selectedGene")&&(cc.selectedGene=e.selectedGene),e.hasOwnProperty("caption")){const t=e.caption;var i=document.getElementById("hic-caption");i&&(i.textContent=t)}await async function(t,e){const i=_i(t),n=e.browsers||[e];Zu=[];const r=[];for(let t of n){Ju(t),c(t.state)&&(t.state=fu.parse(t.state)),c(t.colorScale)&&(t.colorScale=wu.parse(t.colorScale)),c(t.backgroundColor)&&(t.backgroundColor=xu.parseBackgroundColor(t.backgroundColor)),!1===e.syncDatasets&&(t.synchable=!1);const n=new Vu(i,t);Zu.push(n),r.push(n.init(t))}await Promise.all(r),Ku(Zu[0]),Zu.length>1&&Zu.forEach((function(t){t.$browser_panel_delete_button.show()}))}(t,e),!1!==e.syncDatasets&&Yu()}const ef={"*s3e/":"https://hicfiles.s3.amazonaws.com/external/","*s3/":"https://hicfiles.s3.amazonaws.com/","*s3e_/":"http://hicfiles.s3.amazonaws.com/external/","*s3_/":"http://hicfiles.s3.amazonaws.com/","*enc/":"https://www.encodeproject.org/files/"};async function nf(t){let e,i=hf(t);if(i.hasOwnProperty("session")&&(i.session.startsWith("blob:")||i.session.startsWith("data:"))&&(e=JSON.parse(p(i.session.substr(5)))),i.hasOwnProperty("juiceboxURL")){i=hf(await async function(t){const e="https://api-ssl.bitly.com/v4/expand",i={bitlink_id:t.startsWith("http://")?t.substring(7):t.substring(8)},n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${btoa("ttsf9snz")}`},body:JSON.stringify(i)});if(!n.ok)throw new Error(`Network error (${n.status}): ${n.statusText}`);let r=(await n.json()).long_url;return r=r.replace("{","%7B").replace("}","%7D"),r}(i.juiceboxURL))}if(i.hasOwnProperty("juicebox")||i.hasOwnProperty("juiceboxData")){let t;i.hasOwnProperty("juiceboxData")?t=p(i.juiceboxData):(t=i.juicebox,t.startsWith("%7B")&&(t=decodeURIComponent(t))),t=t.substr(1,t.length-2);const n=t.split("},{"),r=[];for(let t of n){const e=hf(decodeURIComponent(t));r.push(sf(e))}e={browsers:r}}const n=sf(i,!0);if(n.url&&(e=n),e)if(e.browsers)for(let t of e.browsers)rf(t);else rf(e);return e}function rf(t){if(t.tracks)for(let e of t.tracks)"rgb(22, 129, 198)"===e.color&&delete e.color,void 0!==e.min&&Number.isNaN(e.min)&&delete e.min,void 0!==e.max&&Number.isNaN(e.max)&&delete e.max,e.displayMode="COLLAPSED"}function sf(t,e){const i={};let n=t.hicUrl;const r=t.name;let s=t.state,o=t.colorScale,a=t.tracks;const h=t.selectedGene,l=t.nvi;let c=t.controlUrl;const u=t.controlName,f=t.displayMode,d=t.controlNvi,p=t.cycle;return n&&(n=of(n,e),Object.keys(ef).forEach((function(t){var e=ef[t];n.startsWith(t)&&(n=n.replace(t,e))})),i.url=n),r&&(i.name=of(r,e)),c&&(c=of(c,e),Object.keys(ef).forEach((function(t){var e=ef[t];c.startsWith(t)&&(c=c.replace(t,e))})),i.controlUrl=c),u&&(i.controlName=of(u,e)),s&&(s=of(s,e),i.state=fu.parse(s)),o&&(o=of(o,e),i.colorScale=wu.parse(o)),f&&(i.displayMode=of(f,e)),a&&(a=of(a,e),i.tracks=function(t){const e=t.split("|||"),i=[];for(let t of e){const e=t.split("|"),r=e.pop();let s=e.length>1?e[0]:t;if(s&&s.trim().length>0&&"undefined"!==s){const t=Object.keys(ef);for(let e of t){var n=ef[e];if(s.startsWith(e)){s=s.replace(e,n);break}}const o={url:s};if(e.length>1&&(o.name=af(e[1],"$","|")),e.length>2){const t=e[2];if(t.startsWith("-")){const e=t.substring(1).split("-");o.min=-parseFloat(e[0]),o.max=parseFloat(e[1])}else{const e=t.split("-");o.min=parseFloat(e[0]),o.max=parseFloat(e[1])}}r&&(o.color=r),i.push(o)}}return i}(a),i.tracks&&i.oauthToken&&i.tracks.forEach((function(t){t.oauthToken=i.oauthToken}))),h&&(cc.selectedGene=h),i.cycle=p,l&&(i.nvi=of(l,e)),d&&(i.controlNvi=of(d,e)),i}function of(t,e){if(e)return decodeURIComponent(t);var i=af(t,"%26","&");return i=af(i,"%20"," "),i=af(i,"+"," "),i=af(i,"%7C","|"),i=af(i,"%23","#"),i=af(i,"%3F","?"),i=af(i,"%3D","=")}function af(t,e,i){return t.split(e).join(i)}function hf(t){var e,i,n,r,s,o;s={},e=t.indexOf("?"),i=t.lastIndexOf("#");for(e>t.indexOf("=")&&(e=-1),i<0&&(i=t.length),n=e+1;n<i;)(r=t.indexOf("&",n))<0&&(r=i),2===(o=t.substring(n,r).split("=",2)).length&&(s[o[0]]=o[1]),n=r+1;return s}return{version:"2.2.1",init:async function(t,e){if(rc.init(t),!1!==e.queryParametersSupported){const t=await nf(window.location.href);t&&(e=t)}await tf(t,e);const i=Xu();return 1===i.length?i[0]:i},toJSON:Qu,restoreSession:tf,compressedSession:function(){return`session=blob:${function(t){const e=[];for(var i=0;i<t.length;i++)e.push(t.charCodeAt(i));const n=new a.RawDeflate(e).compress(),r=String.fromCharCode.apply(null,n);return btoa(r).replace(/\+/g,".").replace(/\//g,"_").replace(/=/g,"-")}(JSON.stringify(Qu()))}`},createBrowser:async function(t,e,i){const n=_i(t);Ju(e),c(e.state)&&(e.state=fu.parse(e.state)),c(e.colorScale)&&(e.colorScale=wu.parse(e.colorScale)),c(e.backgroundColor)&&(e.backgroundColor=xu.parseBackgroundColor(e.backgroundColor));const r=new Vu(n,e);return await r.init(e),"function"==typeof i&&i(),Zu.push(r),Ku(r),Zu.length>1&&Zu.forEach((function(t){t.$browser_panel_delete_button.show()})),r},getCurrentBrowser:function(){return qu},setCurrentBrowser:Ku,getAllBrowsers:Xu,igvxhr:nt,EventBus:pc}}));
//# sourceMappingURL=juicebox.min.js.map
